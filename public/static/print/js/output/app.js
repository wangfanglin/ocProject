"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(t){return t<10?"0"+t:t}function quote(t){return escapable.lastIndex=0,escapable.test(t)?'"'+t.replace(escapable,function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,e){var i,n,a,r,s,o=gap,l=e[t];switch(l&&"object"==typeof l&&"function"==typeof l.toJSON&&(l=l.toJSON(t)),"function"==typeof rep&&(l=rep.call(e,t,l)),typeof l){case"string":return quote(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(l)){for(r=l.length,i=0;i<r;i+=1)s[i]=str(i,l)||"null";return a=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+o+"]":"["+s.join(",")+"]",gap=o,a}if(rep&&"object"==typeof rep)for(r=rep.length,i=0;i<r;i+=1)"string"==typeof rep[i]&&(a=str(n=rep[i],l))&&s.push(quote(n)+(gap?": ":":")+a);else for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(a=str(n,l))&&s.push(quote(n)+(gap?": ":":")+a);return a=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+o+"}":"{"+s.join(",")+"}",gap=o,a}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(t){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(t){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(t,e,i){var n;if(gap="",indent="","number"==typeof i)for(n=0;n<i;n+=1)indent+=" ";else"string"==typeof i&&(indent=i);if(rep=e,e&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length))throw new Error("JSON.stringify");return str("",{"":t})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(t,e){var i,n,a=t[e];if(a&&"object"==typeof a)for(i in a)Object.prototype.hasOwnProperty.call(a,i)&&((n=walk(a,i))!==undefined?a[i]=n:delete a[i]);return reviver.call(t,e,a)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),define("base/json2",function(){}),define("app/core/app-core",["jquery","app/core/app-jquery","base/json2"],function($){var $A=undefined,$hostUrl="",$contextPath,$caInfo=null;return $A=function(t,e){return"function"==typeof $A._exfn?$A._exfn(t,e):$(t,e)},$A.debug=!1,function(t){for(var e=window.location.search.substring(1).split("&"),i=0;i<e.length;i++){var n=e[i].split("=");if("__debug"==n[0]&&"true"==n[1])return void($A.debug=!0)}}(),$.extend($A,{develop:!0,keyCode:{ENTER:13,ESC:27,END:35,HOME:36,SHIFT:16,TAB:9,LEFT:37,RIGHT:39,UP:38,DOWN:40,DELETE:46,BACKSPACE:8,HOME:36,END:35,PLUS:187,PLUS1:107,MINUS:189,MINUS1:109,POINT:190,POINT1:110,PgUp:33,PgDn:34,Z:90},containKeyCode:function(t,e){for(var i=0;i<e.length;i++){var n=e[i];if(isNaN(n)){if(n.keyCode!=t.keyCode)continue;if(n.ctrlKey!=undefined&&n.ctrlKey!=t.ctrlKey)continue;if(n.shiftKey!=undefined&&n.shiftKey!=t.shiftKey)continue;return!0}if(t.keyCode==n)return!0}return!1},statusCode:{ok:200,error:300,timeout:"250",internalError:500,notFound:404},jsattrs:{PARAM:"__jsparam",OBJECT:"__jsobj"},initMethods:{},destroyMethods:{},status:{spliter:!0},eventType:{pageLoad:"onload",pageDestroy:"pageDestroy"},regInitMethod:function(t,e){var i=this.initMethods;if($.isPlainObject(t))i=$.extend(i,t);else if($.isFunction(t))t.appid?(i[t.appid]=null,delete i[t.appid]):(t.appid=this.nextId(),i[t.appid]=t);else{if("string"!=typeof t)throw"valid component's constructor";e&&$.isFunction(e)?(e.appid=t,i[t]=e):(i[t]=null,delete i[t])}},getPageComponens:function(t){t=t||$A.getContainer();if(!$(t).data("componens")){var e=$("[name=componens]",t),i=null;if(e.length>0){var n=e.val().trim();i=$.parseJSON(n)}$(t).data("componens",i),$("[name=componens]",t).remove()}return $(t).data("componens")},cehckPageComponensById:function(t){var e=this.getPageComponens(),i=!0;if(e)for(var n=0;n<e.length;n++)cmp=e[n],cmp.id==t&&1==cmp.hidden&&(i=!1);return i},checkPageComponens:function(t){var e,i=this.getPageComponens(t);if(i)for(var n=0;n<i.length;n++)1==(e=i[n]).hidden&&$("[id="+e.id+"]",t).remove()},initCalls:function(t){var e=$A.initMethods;for(name in e)e[name](t)},init:function(t){var e=$(t||"body");e.clearAppJsObject();var i=$("[name=jsRequire]",e);if(this.checkPageComponens(e),0!=i.length){var n=new Array,a=new Array;if(i.each(function(t,e){var i=$(this),r=i.val();r&&(a.push(i.attr("id")),n.push(r))}),0==n.length)return e.css("visibility",""),void $A.initCalls(e);require(n,function(){var t=new Array,i=new Array,n=arguments;if($.each(n,function(e){null!=n[e]&&null!=a[e]&&(t.push(n[e]),i.push(a[e]))}),i.length>0&&(e.setAppJsObject(i,t),function(t,e){if(t&&t[0]){var i=t[0].beforePageInit;$.isFunction(i)&&(i(e,e.data("uiPageModel")),e.css("visibility",""))}}(t,e),e.data("onPageLoad"))){var r=e.data("onPageLoad");try{var s=new Function(i,"return ("+r+")").apply(this,t);e.one($A.eventType.pageLoad,{pageLoadFunc:s,uiPageModel:e.data("uiPageModel")},function(i){i.data.pageLoadFunc&&i.data.pageLoadFunc.call(t[0],i.data.uiPageModel,e)})}catch(o){return window.alert(o),{}}}$A.initCalls(e)}),i.remove(),$A.resolveUiPageModel(e),e.removeData("onPageLoad");var r=$(">div.__uiPageLoad",e);if(r.length>0){var s=r.text();e.data("onPageLoad",s),r.remove()}}else $A.initCalls(e)},resolveUiPageModel:function(t){var e=$(">div.__uiPageModel",t);if(e.length>0){var i=e.text();t.data("uiPageModel",$.parseJSON(i)),e.remove()}else t.data("uiPageModel",{innerModel:!0})},regDestroyMethod:function(t,e){var i=this.destroyMethods;if($.isPlainObject(t))i=$.extend(i,t);else if($.isFunction(t))t.appid?(i[t.appid]=null,delete i[t.appid]):(t.appid=this.nextId(),i[t.appid]=t);else{if("string"!=typeof t)throw"valid component's destroy";e&&$.isFunction(e)?(e.appid=t,i[t]=e):(i[t]=null,delete i[t])}},destroyCalls:function(t,e){var i=this.destroyMethods;for(name in i)i[name](t,e)},boot:function(t){this.options=$.extend(this.options,t),this.init();var e=$(document),i=this;e.isBind(this.eventType.pageDestroy)||e.bind(this.eventType.pageDestroy,function(t){var e=t.target;i.destroyCalls(e,t)})},nextId:function(){var t=0;return function(e){if(e&&e>1){for(var i=new Array,n=0;n<e;n++)t++,i.push("app_"+t);return i}return++t}}(),jsonEval:function(json,context){try{if(context){var evalstr="";for(var key in context)evalstr+="var "+key+'=context["'+key+'"];';return eval(evalstr),eval("("+json+")")}return eval("("+json+")")}catch(e){return{}}},toJsonString:function(t,e,i){return JSON.stringify(t,e,i)},log:function(t){this.develop&&(window.console?console.log(t):alert(t))},uuid:function(t){return(t=t===undefined?"bs_":t)+this.nextId()},getAttrFromElement:function(t){try{var e=function(t){var e={};return t.attributes&&$.each(t.attributes,function(t,i){var n=i.name.toLowerCase();"true"==i.value?e[n]=!0:"false"==i.value?e[n]=!1:i.value&&(e[n]=$.fn.escapeHtml(i.value))}),e}(t[0]),i=t.getJsonAttr("_options");return e.data&&(e.data=t.getJsonAttr("data")),e.selectednode&&(e.selectednode=t.getJsonAttr("selectednode")),e.events&&$.extend(e,t.getJsEvent(e.events)),$.extend(e,i)}catch(a){var n=t.attr("id");throw n||(n=t[0].outerHTML),new Error("组件["+n+"]获取属性出错.")}},destroyDom:function(t){for(var e=$A.options.getPlugins(),i=[],n=0;n<e.length;n++){var a,r=e[n];(a=r.className?$("."+r.className,t):$(".app-"+r.pluginName,t)).length&&a[r.pluginName]&&i.push({name:r.pluginName,jq:a})}var s=!1;for(n=0;n<i.length;n++){var o=i[n];s=!1,$.each(o.jq,function(t,e){var i=$("input:first-child",e).data(o.name);i&&(i.destroy(),s=!0)}),0==s&&o.jq[o.name]("destroy")}},getComponent:function(t,e){if(!$A.debug)return t.data(e);var i=t.data();if(i){for(var n=["textbox","number","money","comboztree","combogrid","checkbox","suggest","datetime","typeahead","reference","combobox"],a=[],r=0;r<n.length;r++){var s=n[r];i[s]&&a.push(s)}if(0==a.length)return null;if(1==a.length){if(a[0]==e)return i[e];throw new Error("该组件已经声明为["+a[0]+"],无法重复声明为["+e+"]")}throw new Error("无法捕获的异常")}},componentMethodApply:function(t,e,i){if(!t)throw new Error("调用未初始化的组件方法");var n=t[e];if($.isFunction(n))return n.apply(t,i);throw new Error("组件未声明["+e+"]方法")},throwCompMethodError:function(t,e,i,n){var a=t.attr("id"),r="",s=function(t,e){if("调用未初始化的组件方法"==t.message){var i=e.parent();if(!i.hasClass("app-wrapper"))return"";if(i.hasClass("app-textbox"))return"textbox";if(i.hasClass("app-combobox"))return"combobox";if(i.hasClass("app-number"))return"number";if(i.hasClass("app-money"))return"money";if(i.hasClass("app-comboztree"))return"comboztree";if(i.hasClass("app-combogrid"))return"combogrid";if(i.hasClass("app-typeahead"))return"typeahead";if(i.hasClass("app-suggest"))return"suggest";if(i.hasClass("app-datatime"))return"datatime"}return""}(n,t);throw a||(a=t[0].outerHTML),r="通过元素["+a+"]调用类型为["+e+"]组件的["+i+"]方法时出现异常",r+=s?":元素已声明为类型["+s+"]的组件:"+n:":"+n,new Error(r)},throwCompInitError:function(t,e){var i=t.attr("id");throw i||(i=t[0].outerHTML),new Error("元素["+i+"]已经初始化为["+e+"]组件:无法重复初始化")},showWaitScreen:function(t){void 0===t&&(t="正在努力加载中..."),$a.$wait?($a.$wait.find("#waitScreenMsg").text(t),$a.$wait.show()):($a.$wait=$('<div id="waitMask" class="dialog-mask" style="z-index:999999999;display:block;"><div>'),$a.$wait.append($('<div style="width: 150px;height: 150px;margin: auto;position: absolute;top: 0;left: 0;bottom: 0;right: 0;color: #fff;font-size: 18px;">\t\t\t\t\t\t\t\t\t<div style="width: 124px;height: 124px;background:url(resources/common/themes/default/images/loading2.gif) no-repeat center center;margin-bottom: 5px;"></div>\t\t\t\t\t\t\t\t\t<div id="waitScreenMsg">'+t+"</div></div>")),$a.$wait.appendTo("body"))},hideWaitScreen:function(){$a.$wait&&$a.$wait.hide()},setContextPath:function(t){$contextPath=t},getContextPath:function(){return $contextPath},getCaProvider:function(){return _caProvider},setCaInfo:function(t){$caInfo=t},getCaInfo:function(){return $caInfo},getHostUrl:function(){var t=window.location;try{$contextPath||($contextPath=_contextPath)}catch(e){}return""==$hostUrl&&($hostUrl=t.protocol+"//"+t.host+$contextPath+"/"),$hostUrl}})}),define("base/pinyin",[],function(){function t(t,e){for(var i in a)if(!(a[i].indexOf(t)<0))return e?e(i):i;return!1}function e(t){return t.substr(0,1).toUpperCase()}function i(t){return t.substr(0,1).toUpperCase()}function n(e,i){for(var n=e.length,a="",r=new RegExp("[a-zA-Z0-9- ]"),s=0;s<n;s++){var o=e.charAt(s),l=t(o,i);r.test(o)?a+=o:!1!==l&&(a+=l)}for(a=a.replace(/ /g,"-");a.indexOf("--")>0;)a=a.replace("--","-");return a}var a={a:"啊阿锕",ai:"埃挨哎唉哀皑癌蔼矮艾碍爱隘诶捱嗳嗌嫒瑷暧砹锿霭",an:"鞍氨安俺按暗岸胺案谙埯揞犴庵桉铵鹌顸黯",ang:"肮昂盎",ao:"凹敖熬翱袄傲奥懊澳坳拗嗷噢岙廒遨媪骜聱螯鏊鳌鏖",ba:"芭捌扒叭吧笆八疤巴拔跋靶把耙坝霸罢爸茇菝萆捭岜灞杷钯粑鲅魃",bai:"白柏百摆佰败拜稗薜掰鞴",ban:"斑班搬扳般颁板版扮拌伴瓣半办绊阪坂豳钣瘢癍舨",bang:"邦帮梆榜膀绑棒磅蚌镑傍谤蒡螃",bao:"苞胞包褒雹保堡饱宝抱报暴豹鲍爆勹葆宀孢煲鸨褓趵龅",bo:"剥薄玻菠播拨钵波博勃搏铂箔伯帛舶脖膊渤泊驳亳蕃啵饽檗擘礴钹鹁簸跛",bei:"杯碑悲卑北辈背贝钡倍狈备惫焙被孛陂邶埤蓓呗怫悖碚鹎褙鐾",ben:"奔苯本笨畚坌锛",beng:"崩绷甭泵蹦迸唪嘣甏",bi:"逼鼻比鄙笔彼碧蓖蔽毕毙毖币庇痹闭敝弊必辟壁臂避陛匕仳俾芘荜荸吡哔狴庳愎滗濞弼妣婢嬖璧贲畀铋秕裨筚箅篦舭襞跸髀",bian:"鞭边编贬扁便变卞辨辩辫遍匾弁苄忭汴缏煸砭碥稹窆蝙笾鳊",biao:"标彪膘表婊骠飑飙飚灬镖镳瘭裱鳔",bie:"鳖憋别瘪蹩鳘",bin:"彬斌濒滨宾摈傧浜缤玢殡膑镔髌鬓",bing:"兵冰柄丙秉饼炳病并禀邴摒绠枋槟燹",bu:"捕卜哺补埠不布步簿部怖拊卟逋瓿晡钚醭",ca:"擦嚓礤",cai:"猜裁材才财睬踩采彩菜蔡",can:"餐参蚕残惭惨灿骖璨粲黪",cang:"苍舱仓沧藏伧",cao:"操糙槽曹草艹嘈漕螬艚",ce:"厕策侧册测刂帻恻",ceng:"层蹭噌",cha:"插叉茬茶查碴搽察岔差诧猹馇汊姹杈楂槎檫钗锸镲衩",chai:"拆柴豺侪茈瘥虿龇",chan:"搀掺蝉馋谗缠铲产阐颤冁谄谶蒇廛忏潺澶孱羼婵嬗骣觇禅镡裣蟾躔",chang:"昌猖场尝常长偿肠厂敞畅唱倡伥鬯苌菖徜怅惝阊娼嫦昶氅鲳",chao:"超抄钞朝嘲潮巢吵炒怊绉晁耖",che:"车扯撤掣彻澈坼屮砗",chen:"郴臣辰尘晨忱沉陈趁衬称谌抻嗔宸琛榇肜胂碜龀",cheng:"撑城橙成呈乘程惩澄诚承逞骋秤埕嵊徵浈枨柽樘晟塍瞠铖裎蛏酲",chi:"吃痴持匙池迟弛驰耻齿侈尺赤翅斥炽傺墀芪茌搋叱哧啻嗤彳饬沲媸敕胝眙眵鸱瘛褫蚩螭笞篪豉踅踟魑",chong:"充冲虫崇宠茺忡憧铳艟",chou:"抽酬畴踌稠愁筹仇绸瞅丑俦圳帱惆溴妯瘳雠鲋",chu:"臭初出橱厨躇锄雏滁除楚础储矗搐触处亍刍憷绌杵楮樗蜍蹰黜",chuan:"揣川穿椽传船喘串掾舛惴遄巛氚钏镩舡",chuang:"疮窗幢床闯创怆",chui:"吹炊捶锤垂陲棰槌",chun:"春椿醇唇淳纯蠢促莼沌肫朐鹑蝽",chuo:"戳绰蔟辶辍镞踔龊",ci:"疵茨磁雌辞慈瓷词此刺赐次荠呲嵯鹚螅糍趑",cong:"聪葱囱匆从丛偬苁淙骢琮璁枞",cu:"凑粗醋簇猝殂蹙",cuan:"蹿篡窜汆撺昕爨",cui:"摧崔催脆瘁粹淬翠萃悴璀榱隹",cun:"村存寸磋忖皴",cuo:"撮搓措挫错厝脞锉矬痤鹾蹉躜",da:"搭达答瘩打大耷哒嗒怛妲疸褡笪靼鞑",dai:"呆歹傣戴带殆代贷袋待逮怠埭甙呔岱迨逯骀绐玳黛",dan:"耽担丹单郸掸胆旦氮但惮淡诞弹蛋亻儋卩萏啖澹檐殚赕眈瘅聃箪",dang:"当挡党荡档谠凼菪宕砀铛裆",dao:"刀捣蹈倒岛祷导到稻悼道盗叨啁忉洮氘焘忑纛",de:"德得的锝",deng:"蹬灯登等瞪凳邓噔嶝戥磴镫簦",di:"堤低滴迪敌笛狄涤翟嫡抵底地蒂第帝弟递缔氐籴诋谛邸坻莜荻嘀娣柢棣觌砥碲睇镝羝骶",dian:"颠掂滇碘点典靛垫电佃甸店惦奠淀殿丶阽坫埝巅玷癜癫簟踮",diao:"碉叼雕凋刁掉吊钓调轺铞蜩粜貂",die:"跌爹碟蝶迭谍叠佚垤堞揲喋渫轶牒瓞褶耋蹀鲽鳎",ding:"丁盯叮钉顶鼎锭定订丢仃啶玎腚碇町铤疔耵酊",dong:"东冬董懂动栋侗恫冻洞垌咚岽峒夂氡胨胴硐鸫",dou:"兜抖斗陡豆逗痘蔸钭窦窬蚪篼酡",du:"都督毒犊独读堵睹赌杜镀肚度渡妒芏嘟渎椟橐牍蠹笃髑黩",duan:"端短锻段断缎彖椴煅簖",dui:"堆兑队对怼憝碓",dun:"墩吨蹲敦顿囤钝盾遁炖砘礅盹镦趸",duo:"掇哆多夺垛躲朵跺舵剁惰堕咄哚缍柁铎裰踱",e:"蛾峨鹅俄额讹娥恶厄扼遏鄂饿噩谔垩垭苊莪萼呃愕屙婀轭曷腭硪锇锷鹗颚鳄",en:"恩蒽摁唔嗯",er:"而儿耳尔饵洱二贰迩珥铒鸸鲕",fa:"发罚筏伐乏阀法珐垡砝",fan:"藩帆番翻樊矾钒繁凡烦反返范贩犯饭泛蘩幡犭梵攵燔畈蹯",fang:"坊芳方肪房防妨仿访纺放匚邡彷钫舫鲂",fei:"菲非啡飞肥匪诽吠肺废沸费芾狒悱淝妃绋绯榧腓斐扉祓砩镄痱蜚篚翡霏鲱",fen:"芬酚吩氛分纷坟焚汾粉奋份忿愤粪偾瀵棼愍鲼鼢",feng:"丰封枫蜂峰锋风疯烽逢冯缝讽奉凤俸酆葑沣砜",fu:"佛否夫敷肤孵扶拂辐幅氟符伏俘服浮涪福袱弗甫抚辅俯釜斧脯腑府腐赴副覆赋复傅付阜父腹负富讣附妇缚咐匐凫郛芙苻茯莩菔呋幞滏艴孚驸绂桴赙黻黼罘稃馥虍蚨蜉蝠蝮麸趺跗鳆",ga:"噶嘎蛤尬呷尕尜旮钆",gai:"该改概钙盖溉丐陔垓戤赅胲",gan:"干甘杆柑竿肝赶感秆敢赣坩苷尴擀泔淦澉绀橄旰矸疳酐",gang:"冈刚钢缸肛纲岗港戆罡颃筻",gong:"杠工攻功恭龚供躬公宫弓巩汞拱贡共蕻廾咣珙肱蚣蛩觥",gao:"篙皋高膏羔糕搞镐稿告睾诰郜蒿藁缟槔槁杲锆",ge:"哥歌搁戈鸽胳疙割革葛格阁隔铬个各鬲仡哿塥嗝纥搿膈硌铪镉袼颌虼舸骼髂",gei:"给",gen:"根跟亘茛哏艮",geng:"耕更庚羹埂耿梗哽赓鲠",gou:"钩勾沟苟狗垢构购够佝诟岣遘媾缑觏彀鸲笱篝鞲",gu:"辜菇咕箍估沽孤姑鼓古蛊骨谷股故顾固雇嘏诂菰哌崮汩梏轱牯牿胍臌毂瞽罟钴锢瓠鸪鹄痼蛄酤觚鲴骰鹘",gua:"刮瓜剐寡挂褂卦诖呱栝鸹",guai:"乖拐怪哙",guan:"棺关官冠观管馆罐惯灌贯倌莞掼涫盥鹳鳏",guang:"光广逛犷桄胱疒",gui:"瑰规圭硅归龟闺轨鬼诡癸桂柜跪贵刽匦刿庋宄妫桧炅晷皈簋鲑鳜",gun:"辊滚棍丨衮绲磙鲧",guo:"锅郭国果裹过馘蠃埚掴呙囗帼崞猓椁虢锞聒蜮蜾蝈",ha:"哈",hai:"骸孩海氦亥害骇咴嗨颏醢",han:"酣憨邯韩含涵寒函喊罕翰撼捍旱憾悍焊汗汉邗菡撖阚瀚晗焓颔蚶鼾",hen:"夯痕很狠恨",hang:"杭航沆绗珩桁",hao:"壕嚎豪毫郝好耗号浩薅嗥嚆濠灏昊皓颢蚝",he:"呵喝荷菏核禾和何合盒貉阂河涸赫褐鹤贺诃劾壑藿嗑嗬阖盍蚵翮",hei:"嘿黑",heng:"哼亨横衡恒訇蘅",hong:"轰哄烘虹鸿洪宏弘红黉讧荭薨闳泓",hou:"喉侯猴吼厚候后堠後逅瘊篌糇鲎骺",hu:"呼乎忽瑚壶葫胡蝴狐糊湖弧虎唬护互沪户冱唿囫岵猢怙惚浒滹琥槲轷觳烀煳戽扈祜鹕鹱笏醐斛",hua:"花哗华猾滑画划化话劐浍骅桦铧稞",huai:"槐徊怀淮坏还踝",huan:"欢环桓缓换患唤痪豢焕涣宦幻郇奂垸擐圜洹浣漶寰逭缳锾鲩鬟",huang:"荒慌黄磺蝗簧皇凰惶煌晃幌恍谎隍徨湟潢遑璜肓癀蟥篁鳇",hui:"灰挥辉徽恢蛔回毁悔慧卉惠晦贿秽会烩汇讳诲绘诙茴荟蕙哕喙隳洄彗缋珲晖恚虺蟪麾",hun:"荤昏婚魂浑混诨馄阍溷缗",huo:"豁活伙火获或惑霍货祸攉嚯夥钬锪镬耠蠖",ji:"击圾基机畸稽积箕肌饥迹激讥鸡姬绩缉吉极棘辑籍集及急疾汲即嫉级挤几脊己蓟技冀季伎祭剂悸济寄寂计记既忌际妓继纪居丌乩剞佶佴脔墼芨芰萁蒺蕺掎叽咭哜唧岌嵴洎彐屐骥畿玑楫殛戟戢赍觊犄齑矶羁嵇稷瘠瘵虮笈笄暨跻跽霁鲚鲫髻麂",jia:"嘉枷夹佳家加荚颊贾甲钾假稼价架驾嫁伽郏拮岬浃迦珈戛胛恝铗镓痂蛱笳袈跏",jian:"歼监坚尖笺间煎兼肩艰奸缄茧检柬碱硷拣捡简俭剪减荐槛鉴践贱见键箭件健舰剑饯渐溅涧建僭谏谫菅蒹搛囝湔蹇謇缣枧柙楗戋戬牮犍毽腱睑锏鹣裥笕箴翦趼踺鲣鞯",jiang:"僵姜将浆江疆蒋桨奖讲匠酱降茳洚绛缰犟礓耩糨豇",jiao:"蕉椒礁焦胶交郊浇骄娇嚼搅铰矫侥脚狡角饺缴绞剿教酵轿较叫佼僬茭挢噍峤徼姣纟敫皎鹪蛟醮跤鲛",jie:"窖揭接皆秸街阶截劫节桔杰捷睫竭洁结解姐戒藉芥界借介疥诫届偈讦诘喈嗟獬婕孑桀獒碣锴疖袷颉蚧羯鲒骱髫",jin:"巾筋斤金今津襟紧锦仅谨进靳晋禁近烬浸尽卺荩堇噤馑廑妗缙瑾槿赆觐钅锓衿矜",jing:"劲荆兢茎睛晶鲸京惊精粳经井警景颈静境敬镜径痉靖竟竞净刭儆阱菁獍憬泾迳弪婧肼胫腈旌",jiong:"炯窘冂迥扃",jiu:"揪究纠玖韭久灸九酒厩救旧臼舅咎就疚僦啾阄柩桕鹫赳鬏",ju:"鞠拘狙疽驹菊局咀矩举沮聚拒据巨具距踞锯俱句惧炬剧倨讵苣苴莒掬遽屦琚枸椐榘榉橘犋飓钜锔窭裾趄醵踽龃雎鞫",juan:"捐鹃娟倦眷卷绢鄄狷涓桊蠲锩镌隽",jue:"撅攫抉掘倔爵觉决诀绝厥劂谲矍蕨噘崛獗孓珏桷橛爝镢蹶觖",jun:"均菌钧军君峻俊竣浚郡骏捃狻皲筠麇",ka:"喀咖卡佧咔胩",ke:"咯坷苛柯棵磕颗科壳咳可渴克刻客课岢恪溘骒缂珂轲氪瞌钶疴窠蝌髁",kai:"开揩楷凯慨剀垲蒈忾恺铠锎",kan:"刊堪勘坎砍看侃凵莰莶戡龛瞰",kang:"康慷糠扛抗亢炕坑伉闶钪",kao:"考拷烤靠尻栲犒铐",ken:"肯啃垦恳垠裉颀",keng:"吭忐铿",kong:"空恐孔控倥崆箜",kou:"抠口扣寇芤蔻叩眍筘",ku:"枯哭窟苦酷库裤刳堀喾绔骷",kua:"夸垮挎跨胯侉",kuai:"块筷侩快蒯郐蒉狯脍",kuan:"宽款髋",kuang:"匡筐狂框矿眶旷况诓诳邝圹夼哐纩贶",kui:"亏盔岿窥葵奎魁傀馈愧溃馗匮夔隗揆喹喟悝愦阕逵暌睽聩蝰篑臾跬",kun:"坤昆捆困悃阃琨锟醌鲲髡",kuo:"括扩廓阔蛞",la:"垃拉喇蜡腊辣啦剌摺邋旯砬瘌",lai:"莱来赖崃徕涞濑赉睐铼癞籁",lan:"蓝婪栏拦篮阑兰澜谰揽览懒缆烂滥啉岚懔漤榄斓罱镧褴",lang:"琅榔狼廊郎朗浪莨蒗啷阆锒稂螂",lao:"捞劳牢老佬姥酪烙涝唠崂栳铑铹痨醪",le:"勒乐肋仂叻嘞泐鳓",lei:"雷镭蕾磊累儡垒擂类泪羸诔荽咧漯嫘缧檑耒酹",ling:"棱冷拎玲菱零龄铃伶羚凌灵陵岭领另令酃塄苓呤囹泠绫柃棂瓴聆蛉翎鲮",leng:"楞愣",li:"厘梨犁黎篱狸离漓理李里鲤礼莉荔吏栗丽厉励砾历利傈例俐痢立粒沥隶力璃哩俪俚郦坜苈莅蓠藜捩呖唳喱猁溧澧逦娌嫠骊缡珞枥栎轹戾砺詈罹锂鹂疠疬蛎蜊蠡笠篥粝醴跞雳鲡鳢黧",lian:"俩联莲连镰廉怜涟帘敛脸链恋炼练挛蔹奁潋濂娈琏楝殓臁膦裢蠊鲢",liang:"粮凉梁粱良两辆量晾亮谅墚椋踉靓魉",liao:"撩聊僚疗燎寥辽潦了撂镣廖料蓼尥嘹獠寮缭钌鹩耢",lie:"列裂烈劣猎冽埒洌趔躐鬣",lin:"琳林磷霖临邻鳞淋凛赁吝蔺嶙廪遴檩辚瞵粼躏麟",liu:"溜琉榴硫馏留刘瘤流柳六抡偻蒌泖浏遛骝绺旒熘锍镏鹨鎏","long":"龙聋咙笼窿隆垄拢陇弄垅茏泷珑栊胧砻癃",lou:"楼娄搂篓漏陋喽嵝镂瘘耧蝼髅",lu:"芦卢颅庐炉掳卤虏鲁麓碌露路赂鹿潞禄录陆戮垆摅撸噜泸渌漉璐栌橹轳辂辘氇胪镥鸬鹭簏舻鲈",lv:"驴吕铝侣旅履屡缕虑氯律率滤绿捋闾榈膂稆褛",luan:"峦孪滦卵乱栾鸾銮",lue:"掠略锊",lun:"轮伦仑沦纶论囵",luo:"萝螺罗逻锣箩骡裸落洛骆络倮荦摞猡泺椤脶镙瘰雒",ma:"妈麻玛码蚂马骂嘛吗唛犸嬷杩麽",mai:"埋买麦卖迈脉劢荬咪霾",man:"瞒馒蛮满蔓曼慢漫谩墁幔缦熳镘颟螨鳗鞔",mang:"芒茫盲忙莽邙漭朦硭蟒",meng:"氓萌蒙檬盟锰猛梦孟勐甍瞢懵礞虻蜢蠓艋艨黾",miao:"猫苗描瞄藐秒渺庙妙喵邈缈缪杪淼眇鹋蜱",mao:"茅锚毛矛铆卯茂冒帽貌贸侔袤勖茆峁瑁昴牦耄旄懋瞀蛑蝥蟊髦",me:"么",mei:"玫枚梅酶霉煤没眉媒镁每美昧寐妹媚坶莓嵋猸浼湄楣镅鹛袂魅",men:"门闷们扪玟焖懑钔",mi:"眯醚靡糜迷谜弥米秘觅泌蜜密幂芈冖谧蘼嘧猕獯汨宓弭脒敉糸縻麋",mian:"棉眠绵冕免勉娩缅面沔湎腼眄",mie:"蔑灭咩蠛篾",min:"民抿皿敏悯闽苠岷闵泯珉",ming:"明螟鸣铭名命冥茗溟暝瞑酩",miu:"谬",mo:"摸摹蘑模膜磨摩魔抹末莫墨默沫漠寞陌谟茉蓦馍嫫镆秣瘼耱蟆貊貘",mou:"谋牟某厶哞婺眸鍪",mu:"拇牡亩姆母墓暮幕募慕木目睦牧穆仫苜呒沐毪钼",na:"拿哪呐钠那娜纳内捺肭镎衲箬",nai:"氖乃奶耐奈鼐艿萘柰",nan:"南男难囊喃囡楠腩蝻赧",nao:"挠脑恼闹孬垴猱瑙硇铙蛲",ne:"淖呢讷",nei:"馁",nen:"嫩能枘恁",ni:"妮霓倪泥尼拟你匿腻逆溺伲坭猊怩滠昵旎祢慝睨铌鲵",nian:"蔫拈年碾撵捻念廿辇黏鲇鲶",niang:"娘酿",niao:"鸟尿茑嬲脲袅",nie:"捏聂孽啮镊镍涅乜陧蘖嗫肀颞臬蹑",nin:"您柠",ning:"狞凝宁拧泞佞蓥咛甯聍",niu:"牛扭钮纽狃忸妞蚴",nong:"脓浓农侬",nu:"奴努怒呶帑弩胬孥驽",nv:"女恧钕衄",nuan:"暖",nuenue:"虐",nue:"疟谑",nuo:"挪懦糯诺傩搦喏锘",ou:"哦欧鸥殴藕呕偶沤怄瓯耦",pa:"啪趴爬帕怕琶葩筢",pai:"拍排牌徘湃派俳蒎",pan:"攀潘盘磐盼畔判叛爿泮袢襻蟠蹒",pang:"乓庞旁耪胖滂逄",pao:"抛咆刨炮袍跑泡匏狍庖脬疱",pei:"呸胚培裴赔陪配佩沛掊辔帔淠旆锫醅霈",pen:"喷盆湓",peng:"砰抨烹澎彭蓬棚硼篷膨朋鹏捧碰坯堋嘭怦蟛",pi:"砒霹批披劈琵毗啤脾疲皮匹痞僻屁譬丕陴邳郫圮鼙擗噼庀媲纰枇甓睥罴铍痦癖疋蚍貔",pian:"篇偏片骗谝骈犏胼褊翩蹁",piao:"飘漂瓢票剽嘌嫖缥殍瞟螵",pie:"撇瞥丿苤氕",pin:"拼频贫品聘拚姘嫔榀牝颦",ping:"乒坪苹萍平凭瓶评屏俜娉枰鲆",po:"坡泼颇婆破魄迫粕叵鄱溥珀钋钷皤笸",pou:"剖裒踣",pu:"扑铺仆莆葡菩蒲埔朴圃普浦谱曝瀑匍噗濮璞氆镤镨蹼",qi:"期欺栖戚妻七凄漆柒沏其棋奇歧畦崎脐齐旗祈祁骑起岂乞企启契砌器气迄弃汽泣讫亟亓圻芑萋葺嘁屺岐汔淇骐绮琪琦杞桤槭欹祺憩碛蛴蜞綦綮趿蹊鳍麒",qia:"掐恰洽葜",qian:"牵扦钎铅千迁签仟谦乾黔钱钳前潜遣浅谴堑嵌欠歉佥阡芊芡荨掮岍悭慊骞搴褰缱椠肷愆钤虔箝",qiang:"枪呛腔羌墙蔷强抢嫱樯戗炝锖锵镪襁蜣羟跫跄",qiao:"橇锹敲悄桥瞧乔侨巧鞘撬翘峭俏窍劁诮谯荞愀憔缲樵毳硗跷鞒",qie:"切茄且怯窃郄唼惬妾挈锲箧",qin:"钦侵亲秦琴勤芹擒禽寝沁芩蓁蕲揿吣嗪噙溱檎螓衾",qing:"青轻氢倾卿清擎晴氰情顷请庆倩苘圊檠磬蜻罄箐謦鲭黥",qiong:"琼穷邛茕穹筇銎",qiu:"秋丘邱球求囚酋泅俅氽巯艽犰湫逑遒楸赇鸠虬蚯蝤裘糗鳅鼽",qu:"趋区蛆曲躯屈驱渠取娶龋趣去诎劬蕖蘧岖衢阒璩觑氍祛磲癯蛐蠼麴瞿黢",quan:"圈颧权醛泉全痊拳犬券劝诠荃獾悛绻辁畎铨蜷筌鬈",que:"缺炔瘸却鹊榷确雀阙悫",qun:"裙群逡",ran:"然燃冉染苒髯",rang:"瓤壤攘嚷让禳穰",rao:"饶扰绕荛娆桡",ruo:"惹若弱",re:"热偌",ren:"壬仁人忍韧任认刃妊纫仞荏葚饪轫稔衽",reng:"扔仍",ri:"日",rong:"戎茸蓉荣融熔溶容绒冗嵘狨缛榕蝾",rou:"揉柔肉糅蹂鞣",ru:"茹蠕儒孺如辱乳汝入褥蓐薷嚅洳溽濡铷襦颥",ruan:"软阮朊",rui:"蕊瑞锐芮蕤睿蚋",run:"闰润",sa:"撒洒萨卅仨挲飒",sai:"腮鳃塞赛噻",san:"三叁伞散彡馓氵毵糁霰",sang:"桑嗓丧搡磉颡",sao:"搔骚扫嫂埽臊瘙鳋",se:"瑟色涩啬铩铯穑",sen:"森",seng:"僧",sha:"莎砂杀刹沙纱傻啥煞脎歃痧裟霎鲨",shai:"筛晒酾",shan:"珊苫杉山删煽衫闪陕擅赡膳善汕扇缮剡讪鄯埏芟潸姗骟膻钐疝蟮舢跚鳝",shang:"墒伤商赏晌上尚裳垧绱殇熵觞",shao:"梢捎稍烧芍勺韶少哨邵绍劭苕潲蛸笤筲艄",she:"奢赊蛇舌舍赦摄射慑涉社设厍佘猞畲麝",shen:"砷申呻伸身深娠绅神沈审婶甚肾慎渗诜谂吲哂渖椹矧蜃",sheng:"声生甥牲升绳省盛剩胜圣丞渑媵眚笙",shi:"师失狮施湿诗尸虱十石拾时什食蚀实识史矢使屎驶始式示士世柿事拭誓逝势是嗜噬适仕侍释饰氏市恃室视试谥埘莳蓍弑唑饣轼耆贳炻礻铈铊螫舐筮豕鲥鲺",shou:"收手首守寿授售受瘦兽扌狩绶艏",shu:"蔬枢梳殊抒输叔舒淑疏书赎孰熟薯暑曙署蜀黍鼠属术述树束戍竖墅庶数漱恕倏塾菽忄沭涑澍姝纾毹腧殳镯秫鹬",shua:"刷耍唰涮",shuai:"摔衰甩帅蟀",shuan:"栓拴闩",shuang:"霜双爽孀",shui:"谁水睡税",shun:"吮瞬顺舜恂",shuo:"说硕朔烁蒴搠嗍濯妁槊铄",si:"斯撕嘶思私司丝死肆寺嗣四伺似饲巳厮俟兕菥咝汜泗澌姒驷缌祀祠锶鸶耜蛳笥",song:"松耸怂颂送宋讼诵凇菘崧嵩忪悚淞竦",sou:"搜艘擞嗽叟嗖嗾馊溲飕瞍锼螋",su:"苏酥俗素速粟僳塑溯宿诉肃夙谡蔌嗉愫簌觫稣",suan:"酸蒜算",sui:"虽隋随绥髓碎岁穗遂隧祟蓑冫谇濉邃燧眭睢",sun:"孙损笋荪狲飧榫跣隼",suo:"梭唆缩琐索锁所唢嗦娑桫睃羧",ta:"塌他它她塔獭挞蹋踏闼溻遢榻沓",tai:"胎苔抬台泰酞太态汰邰薹肽炱钛跆鲐",tan:"坍摊贪瘫滩坛檀痰潭谭谈坦毯袒碳探叹炭郯蕈昙钽锬覃",tang:"汤塘搪堂棠膛唐糖傥饧溏瑭铴镗耥螗螳羰醣",thang:"倘躺淌",theng:"趟烫",tao:"掏涛滔绦萄桃逃淘陶讨套挑鼗啕韬饕",te:"特",teng:"藤腾疼誊滕",ti:"梯剔踢锑提题蹄啼体替嚏惕涕剃屉荑悌逖绨缇鹈裼醍",tian:"天添填田甜恬舔腆掭忝阗殄畋钿蚺",tiao:"条迢眺跳佻祧铫窕龆鲦",tie:"贴铁帖萜餮",ting:"厅听烃汀廷停亭庭挺艇莛葶婷梃蜓霆",tong:"通桐酮瞳同铜彤童桶捅筒统痛佟僮仝茼嗵恸潼砼",tou:"偷投头透亠",tu:"凸秃突图徒途涂屠土吐兔堍荼菟钍酴",tuan:"湍团疃",tui:"推颓腿蜕褪退忒煺",tun:"吞屯臀饨暾豚窀",tuo:"拖托脱鸵陀驮驼椭妥拓唾乇佗坨庹沱柝砣箨舄跎鼍",wa:"挖哇蛙洼娃瓦袜佤娲腽",wai:"歪外",wan:"豌弯湾玩顽丸烷完碗挽晚皖惋宛婉万腕剜芄苋菀纨绾琬脘畹蜿箢",wang:"汪王亡枉网往旺望忘妄罔尢惘辋魍",wei:"威巍微危韦违桅围唯惟为潍维苇萎委伟伪尾纬未蔚味畏胃喂魏位渭谓尉慰卫倭偎诿隈葳薇帏帷崴嵬猥猬闱沩洧涠逶娓玮韪軎炜煨熨痿艉鲔",wen:"瘟温蚊文闻纹吻稳紊问刎愠阌汶璺韫殁雯",weng:"嗡翁瓮蓊蕹",wo:"挝蜗涡窝我斡卧握沃莴幄渥杌肟龌",wu:"巫呜钨乌污诬屋无芜梧吾吴毋武五捂午舞伍侮坞戊雾晤物勿务悟误兀仵阢邬圬芴庑怃忤浯寤迕妩骛牾焐鹉鹜蜈鋈鼯",xi:"昔熙析西硒矽晰嘻吸锡牺稀息希悉膝夕惜熄烯溪汐犀檄袭席习媳喜铣洗系隙戏细僖兮隰郗茜葸蓰奚唏徙饩阋浠淅屣嬉玺樨曦觋欷熹禊禧钸皙穸蜥蟋舾羲粞翕醯鼷",xia:"瞎虾匣霞辖暇峡侠狭下厦夏吓掀葭嗄狎遐瑕硖瘕罅黠",xian:"锨先仙鲜纤咸贤衔舷闲涎弦嫌显险现献县腺馅羡宪陷限线冼藓岘猃暹娴氙祆鹇痫蚬筅籼酰跹",xiang:"相厢镶香箱襄湘乡翔祥详想响享项巷橡像向象芗葙饷庠骧缃蟓鲞飨",xiao:"萧硝霄削哮嚣销消宵淆晓小孝校肖啸笑效哓咻崤潇逍骁绡枭枵筱箫魈",xie:"楔些歇蝎鞋协挟携邪斜胁谐写械卸蟹懈泄泻谢屑偕亵勰燮薤撷廨瀣邂绁缬榭榍歙躞",xin:"薪芯锌欣辛新忻心信衅囟馨莘歆铽鑫",xing:"星腥猩惺兴刑型形邢行醒幸杏性姓陉荇荥擤悻硎",xiong:"兄凶胸匈汹雄熊芎",xiu:"休修羞朽嗅锈秀袖绣莠岫馐庥鸺貅髹",xu:"墟戌需虚嘘须徐许蓄酗叙旭序畜恤絮婿绪续讴诩圩蓿怵洫溆顼栩煦砉盱胥糈醑",xuan:"轩喧宣悬旋玄选癣眩绚儇谖萱揎馔泫洵渲漩璇楦暄炫煊碹铉镟痃",xue:"靴薛学穴雪血噱泶鳕",xun:"勋熏循旬询寻驯巡殉汛训讯逊迅巽埙荀薰峋徇浔曛窨醺鲟",ya:"压押鸦鸭呀丫芽牙蚜崖衙涯雅哑亚讶伢揠吖岈迓娅琊桠氩砑睚痖",yan:"焉咽阉烟淹盐严研蜒岩延言颜阎炎沿奄掩眼衍演艳堰燕厌砚雁唁彦焰宴谚验厣靥赝俨偃兖讠谳郾鄢芫菸崦恹闫阏洇湮滟妍嫣琰晏胭腌焱罨筵酽魇餍鼹",yang:"殃央鸯秧杨扬佯疡羊洋阳氧仰痒养样漾徉怏泱炀烊恙蛘鞅",yao:"邀腰妖瑶摇尧遥窑谣姚咬舀药要耀夭爻吆崾徭瀹幺珧杳曜肴鹞窈繇鳐",ye:"椰噎耶爷野冶也页掖业叶曳腋夜液谒邺揶馀晔烨铘",yi:"一壹医揖铱依伊衣颐夷遗移仪胰疑沂宜姨彝椅蚁倚已乙矣以艺抑易邑屹亿役臆逸肄疫亦裔意毅忆义益溢诣议谊译异翼翌绎刈劓佾诒圪圯埸懿苡薏弈奕挹弋呓咦咿噫峄嶷猗饴怿怡悒漪迤驿缢殪贻旖熠钇镒镱痍瘗癔翊衤蜴舣羿翳酏黟",yin:"茵荫因殷音阴姻吟银淫寅饮尹引隐印胤鄞堙茚喑狺夤氤铟瘾蚓霪龈",ying:"英樱婴鹰应缨莹萤营荧蝇迎赢盈影颖硬映嬴郢茔莺萦撄嘤膺滢潆瀛瑛璎楹鹦瘿颍罂",yo:"哟唷",yong:"拥佣臃痈庸雍踊蛹咏泳涌永恿勇用俑壅墉慵邕镛甬鳙饔",you:"幽优悠忧尤由邮铀犹油游酉有友右佑釉诱又幼卣攸侑莸呦囿宥柚猷牖铕疣蝣鱿黝鼬",yu:"迂淤于盂榆虞愚舆余俞逾鱼愉渝渔隅予娱雨与屿禹宇语羽玉域芋郁吁遇喻峪御愈欲狱育誉浴寓裕预豫驭禺毓伛俣谀谕萸蓣揄喁圄圉嵛狳饫庾阈妪妤纡瑜昱觎腴欤於煜燠聿钰鹆瘐瘀窳蝓竽舁雩龉",yuan:"鸳渊冤元垣袁原援辕园员圆猿源缘远苑愿怨院塬沅媛瑗橼爰眢鸢螈鼋",yue:"曰约越跃钥岳粤月悦阅龠樾刖钺",yun:"耘云郧匀陨允运蕴酝晕韵孕郓芸狁恽纭殒昀氲",za:"匝砸杂拶咂",zai:"栽哉灾宰载再在咱崽甾",zan:"攒暂赞瓒昝簪糌趱錾",zang:"赃脏葬奘戕臧",zao:"遭糟凿藻枣早澡蚤躁噪造皂灶燥唣缫",ze:"责择则泽仄赜啧迮昃笮箦舴",zei:"贼",zen:"怎谮",zeng:"增憎曾赠缯甑罾锃",zha:"扎喳渣札轧铡闸眨栅榨咋乍炸诈揸吒咤哳怍砟痄蚱齄",zhai:"摘斋宅窄债寨砦",zhan:"瞻毡詹粘沾盏斩辗崭展蘸栈占战站湛绽谵搌旃",zhang:"樟章彰漳张掌涨杖丈帐账仗胀瘴障仉鄣幛嶂獐嫜璋蟑",zhao:"招昭找沼赵照罩兆肇召爪诏棹钊笊",zhe:"遮折哲蛰辙者锗蔗这浙谪陬柘辄磔鹧褚蜇赭",zhen:"珍斟真甄砧臻贞针侦枕疹诊震振镇阵缜桢榛轸赈胗朕祯畛鸩",zheng:"蒸挣睁征狰争怔整拯正政帧症郑证诤峥钲铮筝",zhi:"芝枝支吱蜘知肢脂汁之织职直植殖执值侄址指止趾只旨纸志挚掷至致置帜峙制智秩稚质炙痔滞治窒卮陟郅埴芷摭帙忮彘咫骘栉枳栀桎轵轾攴贽膣祉祗黹雉鸷痣蛭絷酯跖踬踯豸觯",zhong:"中盅忠钟衷终种肿重仲众冢锺螽舂舯踵",zhou:"舟周州洲诌粥轴肘帚咒皱宙昼骤啄着倜诹荮鬻纣胄碡籀舳酎鲷",zhu:"珠株蛛朱猪诸诛逐竹烛煮拄瞩嘱主著柱助蛀贮铸筑住注祝驻伫侏邾苎茱洙渚潴驺杼槠橥炷铢疰瘃蚰竺箸翥躅麈",zhua:"抓",zhuai:"拽",zhuan:"专砖转撰赚篆抟啭颛",zhuang:"桩庄装妆撞壮状丬",zhui:"椎锥追赘坠缀萑骓缒",zhun:"谆准",zhuo:"捉拙卓桌琢茁酌灼浊倬诼廴蕞擢啜浞涿杓焯禚斫",zi:"兹咨资姿滋淄孜紫仔籽滓子自渍字谘嵫姊孳缁梓辎赀恣眦锱秭耔笫粢觜訾鲻髭",zong:"鬃棕踪宗综总纵腙粽",zou:"邹走奏揍鄹鲰",zu:"租足卒族祖诅阻组俎菹啐徂驵蹴",zuan:"钻纂攥缵",zui:"嘴醉最罪",zun:"尊遵撙樽鳟",zuo:"昨左佐柞做作坐座阝阼胙祚酢",cou:"薮楱辏腠",nang:"攮哝囔馕曩",o:"喔",dia:"嗲",chuai:"嘬膪踹",cen:"岑涔",diu:"铥",nou:"耨",fou:"缶",bia:"髟"};return{toInitials:function(t){return n(t,e)},toUpperInitials:function(t){return n(t,i)},toPinyin:function(t){return n(t)},toCapPinyin:function(t){return n(t)}}}),define("app/core/app-class",[],function(){function t(e){if(!(this instanceof t)&&l(e))return i(e)}function e(e){var i,n;for(i in e)n=e[i],t.Mutators.hasOwnProperty(i)?t.Mutators[i].call(this,n):this.prototype[i]=n}function i(i){return i.extend=t.extend,i.implement=e,i}function n(){}function a(t,e){for(var i in e)"prototype"!==i&&(t[i]=e[i])}t.create=function(n,r){function s(){n.apply(this,arguments),this.constructor===s&&this.initialize&&this.initialize.apply(this,arguments)}return l(n)||(r=n,n=null),r||(r={}),n||(n=r.Extends||t),r.Extends=n,n!==t&&a(s,n),e.call(s,r),i(s)},t.extend=function(e){return e||(e={}),e.Extends=this,t.create(e)},t.Mutators={Extends:function(t){var e=this.prototype,i=r(t.prototype);a(i,e),i.constructor=this,this.prototype=i,this.superclass=t.prototype},Implements:function(t){o(t)||(t=[t]);for(var e,i=this.prototype;e=t.shift();)a(i,e.prototype||e)},Statics:function(t){a(this,t)}};var r=Object.__proto__?function(t){return{__proto__:t}}:function(t){return n.prototype=t,new n},s=Object.prototype.toString,o=Array.isArray;o||(o=function(t){return"[object Array]"===s.call(t)});var l=function(t){return"[object Function]"===s.call(t)};return t}),define("app/core/app-attribute",["require","exports","module"],function(t,e){function i(t){return"[object String]"===c.call(t)}function n(t){return t&&"[object Object]"===c.call(t)&&"isPrototypeOf"in t}function a(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0}function r(t,e){var i,a;for(i in e)e.hasOwnProperty&&e.hasOwnProperty(i)&&(a=e[i],u(a)?a=a.slice():n(a)&&(a=r(t[i]||{},a)),t[i]=a);return t}function s(t){t=r({},t);for(var e in t){var i=t[e];n(i)&&function(t,e){for(var i=0,n=e.length;i<n;i++)if(t.hasOwnProperty(e[i]))return!0;return!1}(i,f)||(t[e]={value:i})}return t}function o(t,e,i,n){for(var a=0,r=t.length;a<r;a++){var s=t[a];if(s in i&&i.hasOwnProperty(s)){var o=i[s];e[s]=n?o.value:o}}}function l(t){return null==t||(i(t)||u(t))&&0===t.length||n(t)&&a(t)}function d(t,e){if(t===e)return!0;if(l(t)&&l(e))return!0;var i=c.call(t);if(i!=c.call(e))return!1;switch(i){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase;case"[object Array]":var a=t.toString(),r=e.toString();return-1===a.indexOf("[object")&&-1===r.indexOf("[object")&&a===r}if("object"!=typeof t||"object"!=typeof e)return!1;if(n(t)&&n(e)){if(!d(p(t),p(e)))return!1;for(var s in t)if(t[s]!==e[s])return!1;return!0}return!1}var h={};h.initAttrs=function(t){var e=this.propsInAttrs||[],i=function(t,e){for(var i=[],n=t.constructor.prototype;n;)n.hasOwnProperty("attrs")||(n.attrs={}),o(e,n.attrs,n),a(n.attrs)||i.unshift(n.attrs),n=n.constructor.superclass;for(var l={},d=0,h=i.length;d<h;d++)l=r(l,s(i[d]));return l}(this,e);t&&r(i,s(t));for(l in i)if(i.hasOwnProperty(l)){var n=function(t){return"_onChange"+t.charAt(0).toUpperCase()+t.substring(1)}(l);this[n]&&this.on("change:"+l,this[n])}!function(t,e){for(var i in e)e.hasOwnProperty(i)&&e[i].value}(0,i),this.attrs=i;for(var l in i)if(i.hasOwnProperty(l)){var d=i[l];try{d.hasOwnProperty("value")&&d.setter&&d.setter.call(this,d.value,l),this.set(l,this.get(l))}catch(h){window.console&&console.log("A caught exception occurs: "+h)}}o(e,this,this.attrs,!0)},h.get=function(t){var e=this.attrs[t]||{},i=e.value;return e.getter?e.getter.call(this,i,t):i},h.set=function(t,e,a){var s={};i(t)?s[t]=e:(s=t,a=e),a||(a={});var o=this.__ready,l=!o||a.silent,h=this.attrs,c=this.__changedAttrs||(this.__changedAttrs={});for(t in s)if(s.hasOwnProperty(t)){var u=h[t]||(h[t]={});if(e=s[t],u.readOnly)throw"This attribute is readOnly: "+t;if(u.validator){var p=u.validator.call(this,e,t);if(!0!==p){a.error&&a.error.call(this,p);continue}}u.setter&&(e=u.setter.call(this,e,t));var f=o?this.get(t):null;n(f)&&n(e)&&(e=r(r({},f),e)),h[t].value=e,d(f,e)||(l?c[t]=[e,f]:this.trigger("change:"+t,e,f,t))}return this},h.change=function(){var t=this.__changedAttrs;if(t){for(var e in t)if(t.hasOwnProperty(e)){var i=t[e];this.trigger("change:"+e,i[0],i[1],e)}delete this.__changedAttrs}return this};var c=Object.prototype.toString,u=Array.isArray||function(t){return"[object Array]"===c.call(t)},p=Object.keys;p||(p=function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(i);return e});var f=["value","getter","setter","validator","readOnly"];return h}),define("app/core/app-events",[],function(){function t(){}function e(t,e,i){var n=!0;if(t){var a=0,r=t.length,s=e[0],o=e[1],l=e[2];switch(e.length){case 0:for(;a<r;a+=2)n=!1!==t[a].call(t[a+1]||i)&&n;break;case 1:for(;a<r;a+=2)n=!1!==t[a].call(t[a+1]||i,s)&&n;break;case 2:for(;a<r;a+=2)n=!1!==t[a].call(t[a+1]||i,s,o)&&n;break;case 3:for(;a<r;a+=2)n=!1!==t[a].call(t[a+1]||i,s,o,l)&&n;break;default:for(;a<r;a+=2)n=!1!==t[a].apply(t[a+1]||i,e)&&n}}return n}var i=/\s+/;t.prototype.on=function(t,e,n){var a,r;if(!e)return this;for(a=this.__events||(this.__events={}),t=t.split(i);r=t.shift();)(a[r]||(a[r]=[])).push(e,n);return this},t.prototype.once=function(t,e,i){var n=this,a=function(){n.off(t,a),e.apply(i||n,arguments)};return this.on(t,a,i)},t.prototype.off=function(t,e,a){var r,s,o,l;if(!(r=this.__events))return this;if(!(t||e||a))return delete this.__events,this;for(t=t?t.split(i):n(r);s=t.shift();)if(o=r[s])if(e||a)for(l=o.length-2;l>=0;l-=2)e&&o[l]!==e||a&&o[l+1]!==a||o.splice(l,2);else delete r[s];return this},t.prototype.trigger=function(t){var n,a,r,s,o,l,d=[],h=!0;if(!(n=this.__events))return this;for(t=t.split(i),o=1,l=arguments.length;o<l;o++)d[o-1]=arguments[o];for(;a=t.shift();)(r=n.all)&&(r=r.slice()),(s=n[a])&&(s=s.slice()),"all"!==a&&(h=e(s,d,this)&&h),h=e(r,[a].concat(d),this)&&h;return h},t.prototype.emit=t.prototype.trigger,t.prototype.hasBindEvent=function(t){var e=(this.__events||(this.__events={}))[t];return e&&e.length>1};var n=Object.keys;return n||(n=function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(i);return e}),t.mixTo=function(e){e=function(t){return"[object Function]"===Object.prototype.toString.call(t)}(e)?e.prototype:e;var i=t.prototype,n=new t;for(var a in i)i.hasOwnProperty(a)&&function(t){e[t]=function(){return i[t].apply(n,Array.prototype.slice.call(arguments)),this}}(a)},t}),define("app/core/app-base",["app/core/app-class","app/core/app-attribute","app/core/app-events"],function(t,e,i){return t.create({Implements:[e,i],initialize:function(t){this.initAttrs(t),function(t,e){for(var i in e)if(e.hasOwnProperty(i)){var n="_onChange"+function(t){return t.charAt(0).toUpperCase()+t.substring(1)}(i);t[n]&&t.on("change:"+i,t[n])}}(this,this.attrs)},destroy:function(){for(var t in this)this.hasOwnProperty(t)&&delete this[t]},bind:function(t,e){var i=e;1==arguments.length&&(i=t);for(var n in i)this.on(n,i[n])},unbind:function(t,e){if("string"==typeof e&&this.off(e),"array"==typeof e)for(var i=0,n=e.length;i<n;i++)this.off(e[i])}})}),define("app/core/app-options-helper",["app/core/app-base"],function(t){return ConfigHelper=t.extend({propsInAttrs:["configData","columns","buttons","editors"],attrs:{configData:{},columns:{},buttons:{},editors:{}},initialize:function(t){(t=t||{}).configData||(t={configData:t}),this.sourceData=t.configData||t,ConfigHelper.superclass.initialize.call(this,t),this.configData&&(this.configData.columns&&this.addColumns(this.configData.columns),this.configData.frozenColumns&&this.addColumns(this.configData.frozenColumns),this.configData.frozenColumnsRight&&this.addColumns(this.configData.frozenColumnsRight),this.configData.toolbar&&this.addButtons(this.configData.toolbar))},addColumns:function(t){if(t)for(var e=0;e<t.length;e++)for(var i=0;i<t[e].length;i++)this.columns[t[e][i].id]=t[e][i],t[e][i]&&t[e][i].buttons&&this.addButtons(t[e][i].buttons),t[e][i]&&t[e][i].editor&&this.addEditors(t[e][i].id,t[e][i].editor)},addEditors:function(t,e){e.options=e.options||{},this.editors[t]=e.options},addButtons:function(t){if(t){for(var e=[],i=0;i<t.length;i++)this.buttons[t[i].id]=t[i],$A.cehckPageComponensById(t[i].id)||e.push(i);for(i=0;i<e.length;i++)t.splice(e[i]-i,1)}},getButton:function(t){var e=this.buttons[t];return new ConfigHelper(e)},getColumn:function(t){var e=this.columns[t];return new ConfigHelper(e)},getEditor:function(t){var e=this.editors[t];return new ConfigHelper(e)},setAttr:function(t,e){this.sourceData[t]=e},setAttrs:function(t){if(t)for(var e in t)this.sourceData[e]=t[e]}}),ConfigHelper}),define("app/core/app-jquery",["jquery","app/core/app-core","base/pinyin","app/core/app-options-helper"],function(t,e,i,n){return t.emptyFunction=function(){},t.isEmpty=function(e,i){return null===e||e===undefined||t.isArray(e)&&!e.length||!i&&""===e},t.extend(t.fn,{escapeHtml:function(t){return t&&(t=(t=(t=(t=t.replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/"/g,"&quot;")).replace(/'/g,"&#039;")),t},unescapeHtml:function(t){return t&&(t=(t=(t=(t=t.replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&quot;/g,'"')).replace(/&#039;/g,"'")),t},initPageUI:function(){e.init(this)},clearAppJsObject:function(){t(this).removeAttr("__jsappobj"),t(this)[0].__jsappobj=null},setAppJsObject:function(e,i){t(this).attr("__jsappobj","true"),t(this)[0].__jsappobj={param:e,objs:i}},getAppJsObject:function(){var e=t(this),i=e.parents("[__jsappobj]"),n=e[0].__jsappobj,a=null,r=null;return null!=n&&"object"==typeof n&&t.isArray(n.param)&&t.isArray(n.objs)?(a=n.param,r=n.objs):(a=[],r=[]),i.each(function(){t(this);var e=this.__jsappobj;if(null!=e&&t.isArray(e.param)&&t.isArray(e.objs))for(var i=e.param,n=e.objs,s=0;s<i.length;s++)t.inArray(i[s],a)<0&&(a.push(i[s]),r.push(n[s]))}),0==a.length?null:{param:a.join(","),objs:r}},getJsFunction:function(e,i){var n=t(this).getAppJsObject();if(n){return new Function(n.param,"return function(){"+e+"};").apply(n,n.objs)}return new Function(e)},getJsonAttr:function(e){var i=t(this).getAppJsObject()||{param:"",objs:[]},a=t(this).attr(e),r=t(this).attr("id");a=new Function(i.param,"return ("+a+")").apply(this,i.objs);if(i.objs&&i.objs.length>0&&r){var s=i.objs[0];if(s.uiExtConfig){var o=s.uiExtConfig;o[r]&&t.isFunction(o[r])&&(a.beforeRender=function(t){var e=new n(t);o[r].call(this,e)})}}return a},getPageJsProperty:function(e,i){var n=t(this).getAppJsObject();if(n){return new Function(n.param,"if (typeof "+e+" !== 'undefined') return "+e+";").apply(n,n.objs)}return null},getJsCacheFunc:function(e,i){var n=t(this),a=n.data("jsfunction");return a||(a=n.getJsFunction(e,i),n.data("jsfunction",a),a)},getJsEvent:function(i){var n=t(this).getAppJsObject();if(n){return new Function(n.param,"var e = "+i+";return e;").apply(n,n.objs)}return e.jsonEval(i)},isTag:function(e){return!!e&&t(this)[0].tagName.toLowerCase()==e},hoverClass:function(e,i){var n=e||"hover";return this.each(function(){var e,a=t(this);a.hover(function(){e&&clearTimeout(e),a.addClass(n)},function(){e=setTimeout(function(){a.removeClass(n)},i||10)})})},focusClass:function(e){var i=e||"textInputFocus";return this.each(function(){t(this).focus(function(){t(this).addClass(i)}).blur(function(){t(this).removeClass(i)})})},isBind:function(e){var i=t(this).data("events");return i&&e&&i[e]},cssNum:function(e){var i=t(this).css(e);return 1*i.substring(0,i.indexOf("px"))},equalObject:function(t){if(0==this.length&&(null==t||0==t.length))return!0;if(null==t)return!1;if(this.length!=t.length)return!1;for(var e=0;e<t.length;e++)if(this[e]!=t[e])return!1;return!0},parseOptions:function(e,i){var n=t(e),a={},r=t(e).getAppJsObject()||{param:"",objs:[]},s=t.trim(n.attr("data-options"));if(s){"{"!=s.substring(0,1)&&(s="{"+s+"}");a=new Function(r.param,"return ("+s+")").apply(this,r.objs)}for(key in a)t.isEmpty(a[key])&&delete a[key];if(t.map(["width","height","left","top","minWidth","maxWidth","minHeight","maxHeight"],function(i){e.style||console.log(e);var n=t.trim(e.style[i]||"");n&&(-1==n.indexOf("%")&&(n=parseInt(n)||undefined),a[i]=n)}),i){for(var o={},l=0;l<i.length;l++){var d=i[l];if("string"==typeof d)o[d]=n.attr(d);else for(var h in d){var c=d[h];"boolean"==c?o[h]=n.attr(h)?"true"==n.attr(h):undefined:"number"==c&&(o[h]="0"==n.attr(h)?0:parseFloat(n.attr(h))||undefined,!o[h]&&a[h]&&(a[h]=parseFloat(a[h])))}}t.extend(a,o)}return a},_outerWidth:function(t){return t==undefined?this[0]==window?this.width()||document.body.clientWidth:this.outerWidth()||0:this._size("width",t)},_outerHeight:function(t){return t==undefined?this[0]==window?this.height()||document.body.clientHeight:this.outerHeight()||0:this._size("height",t)},_scrollLeft:function(e){return e==undefined?this.scrollLeft():this.each(function(){t(this).scrollLeft(e)})},parseValue:function(e,i,n,a){a=a||0;var r=t.trim(String(i||""));return"%"==r.substr(r.length-1,1)?(r=parseInt(r.substr(0,r.length-1)),r=e.toLowerCase().indexOf("width")>=0?Math.floor((n.width()-a)*r/100):Math.floor((n.height()-a)*r/100)):r=parseInt(r)||undefined,r},_size:function(e,i){function n(e,i,n){var a=t(e)[0],r=i[0],s=r.fcount||0;return n?(a.fitted||(a.fitted=!0,r.fcount=s+1,t(r).addClass("panel-noscroll"),"BODY"==r.tagName&&t("html").addClass("panel-fit")),{width:t(r).width()||1,height:t(r).height()||1}):(a.fitted&&(a.fitted=!1,r.fcount=s-1,0==r.fcount&&(t(r).removeClass("panel-noscroll"),"BODY"==r.tagName&&t("html").removeClass("panel-fit"))),!1)}function a(e,i,n,a){var r=t(e),o=i,l=o.substr(0,1).toUpperCase()+o.substr(1),d=s.parseValue("min"+l,a["min"+l],n),h=s.parseValue("max"+l,a["max"+l],n),c=s.parseValue(o,a[o],n),u=String(a[o]||"").indexOf("%")>=0;if(isNaN(c))r._size(o,""),r._size("min"+l,d),r._size("max"+l,h);else{var p=Math.min(Math.max(c,d||0),h||99999);u||(a[o]=p),r._size("min"+l,""),r._size("max"+l,""),r._size(o,p)}return u||a.fit}function r(e,i,n){function a(){return i.toLowerCase().indexOf("width")>=0?r.outerWidth()-r.width():r.outerHeight()-r.height()}var r=t(e);if(n==undefined)return n=parseInt(e.style[i]),isNaN(n)?undefined:(t._boxModel&&(n+=a()),n);""===n?r.css(i,""):(t._boxModel&&(n-=a())<0&&(n=0),r.css(i,n+"px"))}var s=this;return"string"==typeof e?"clear"==e?this.each(function(){t(this).css({width:"",minWidth:"",maxWidth:"",height:"",minHeight:"",maxHeight:""})}):"unfit"==e?this.each(function(){n(this,t(this).parent(),!1)}):i==undefined?r(this[0],e):this.each(function(){r(this,e,i)}):this.each(function(){i=i||t(this).parent(),t.extend(e,n(this,i,e.fit)||{});var r=a(this,"width",i,e),s=a(this,"height",i,e);r||s?t(this).addClass("app-fluid"):t(this).removeClass("app-fluid")})}}),t.extend(String.prototype,{isPositiveInteger:function(){return new RegExp(/^[1-9]\d*$/).test(this)},isInteger:function(){return new RegExp(/^\d+$/).test(this)},isNumber:function(t,e){return new RegExp(/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/).test(this)},trim:function(){return this.replace(/(^\s*)|(\s*$)|\r|\n/g,"")},trans:function(){return this.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"')},replaceAll:function(t,e){return this.replace(new RegExp(t,"gm"),e)},evalTm:function(t){return t?this.replace(RegExp("({[A-Za-z_]+[A-Za-z0-9_{\\\\\\.}]*})","g"),function(e){var i=t[e.replace(/[{}]+/g,"")];return i||e}):this},evalTmById:function(e){var i=e||t(document);return this.replace(RegExp("({[A-Za-z_]+[A-Za-z0-9_{\\\\\\.}]*})","g"),function(t){var e=i.find("#"+t.replace(/[{}]+/g,""));return e.size()>0?e.val():t})},evalTmByAttr:function(e){if(!e)return this.toString();var i=t(e);return this.replace(RegExp("({[A-Za-z_]+[A-Za-z0-9_{\\\\\\.}]*})","g"),function(t){var e=t.replace(/[{}]+/g,"");return("text"==e?i.text():"value"==e||"val"==e?i.val()||i.attr(e):i.attr(e))||t})},evalTemplate:function(i){if(this.isFinishedTm())return this.toString();var n=t(i),a=n.attr("evalTarget")||i||document,r=t(a),s=this.evalTmById(r);return!(s=this.evalTmByAttr(n.attr("evalTarget")||i)).isFinishedTm()&&n.attr("eval-warn")?(e.messager.error(n.attr("eval-warn")),!1):s},isFinishedTm:function(){return!new RegExp("{[A-Za-z_]+[A-Za-z0-9_]*}").test(this)},skipChar:function(t){return this&&0!==this.length?this.charAt(0)===t?this.substring(1).skipChar(t):this:""},isValidPwd:function(){return new RegExp(/^([_]|[a-zA-Z0-9]){6,32}$/).test(this)},isValidMail:function(){return new RegExp(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/).test(this.trim())},isSpaces:function(){for(var t=0;t<this.length;t+=1){var e=this.charAt(t);if(" "!=e&&"\n"!=e&&"\t"!=e&&"\r"!=e)return!1}return!0},isPhone:function(){return new RegExp(/(^([0-9]{3,4}[-])?\d{3,8}(-\d{1,6})?$)|(^\([0-9]{3,4}\)\d{3,8}(\(\d{1,6}\))?$)|(^\d{3,8}$)/).test(this)},isUrl:function(){return new RegExp(/^[a-zA-z]+:\/\/([a-zA-Z0-9\-\.]+)([-\w .\/?%&=:]*)$/).test(this)},isExternalUrl:function(){return this.isUrl()&&-1==this.indexOf("://"+document.domain)},toInitials:function(){return i.toInitials(this)},toUpperInitials:function(){return i.toUpperInitials(this)},toPinyin:function(){return i.toPinyin(this)},toCapPinyin:function(){return i.toCapPinyin(this)}}),t}),define("app/app-funcbase",["app/core/app-jquery","app/core/app-core"],function(t,e){return{openDialog:function(i){"string"==typeof i&&(i={url:i});var n=i.url;if(n){0!=n.indexOf(_contextPath)&&(0!=n.indexOf("/")&&(n="/"+n),n=_contextPath+n);var a=i.dialogId;a||(a="dialog"+e.nextId(),i.dialogId=a,i["data-target"]="#"+a),i.url=n,require(["app/widgets/window/app-dialog"],function(){t.openModalDialog(i)})}},editGridRowDialog:function(i){require(["app/widgets/window/app-dialog","app/widgets/window/app-messager"],function(n,a){var r=i.gridId;if(r){var s=e("#"+r);if(0!=s.length){var o=s.bsgrid("getSelectRowId");o?(i.params={id:o},t.openModalDialog(i)):a.warn("请选中一行数据后再编辑！")}else a.error("请指定列表对象！")}else a.error("请指定列表对象！")})},deleteGridSelRows:function(e){require(["app/widgets/window/app-messager","app/data/app-ajax"],function(i,n){var a=e.gridId;if(a){var r=t("#"+a);if(0!=r.length){var s=e.delUrl;if(s){s.startsWith("/")||(s="/"+s),s=_contextPath+s;var o=r.bsgrid("getSelectRowId");if(o&&o.length>0){var l={type:"POST",url:s,data:{ids:o},dataType:"json",cache:!1,beforeCall:"confirmPrompt",confirm:"确认删除这些数据吗？",afterCall:"refreshTable"};n.ajaxCall(l)}else i.warn("请选中需要删除的数据！")}else i.error("请指定删除数据的服务地址！")}else i.error("请指定列表对象！")}else i.error("请指定列表对象！")})},editSingleDataDialog:function(e){require(["app/widgets/window/app-dialog","app/widgets/window/app-messager"],function(i,n){var a=e.url;if(a){a.startsWith("/")||(a="/"+a),a=_contextPath+a;var r=e.id;r?(e.params={id:r},e.url=a,t.openModalDialog(e)):n.error("参数设置错误！")}else n.error("请指定加载表单数据的服务地址！")})},deleteSingleData:function(t){require(["app/widgets/window/app-messager","app/data/app-ajax"],function(e,i){var n=t.url;if(n){n.startsWith("/")||(n="/"+n),n=_contextPath+n;var a=t.id;if(a){var r={type:"POST",url:n,data:{id:a},dataType:"json",cache:!1,beforeCall:"confirmPrompt",confirm:t[confirm]||"确认删除这些数据吗？",afterCall:"refreshTable"};i.ajaxCall(r)}else e.error("参数设置错误！")}else e.error("请指定删除数据的服务地址！")})},saveFormDialog:function(i){"string"==typeof i&&(i={formId:i});var n=e.getContainer();require(["app/widgets/form/app-form"],function(){i.formId?t("#"+i.formId,n).submitForm(i):t("form",n).submitForm(i)})},transferGridColumn:function(t,e,i){return"1"==t?"<font color='green'>√</font>":""},transferGridColumn2:function(t,e,i){return t==undefined?"":"1"==t?"<font color='green'>√</font>":"<font style='color:red !Important'>╳</font>"},transferFormColumn:function(t){return"1"==t?"<font color='green'>√</font>":""},closeDialog:function(){e.dialog.closeCurrent()}}}),define("app/app-pagebase",["app/core/app-base"],function(t){return PageBase=t.extend({initialize:function(){PageBase.superclass.initialize.call(this),this.initUIExtConfig()},init:function(){this.bindEvents(),this.initPage(arguments[0])},initPage:function(t){},initUIExtConfig:function(){},listeners:{},contorlType:{button:"button",form:"form",menubutton:"menubutton",panel:"panel",jqgrid:"jqgrid",grid:"grid",textbox:"textbox",money:"money",number:"number","typeahead ":"typeahead",combobox:"combobox",combo:"combo",comboztree:"comboztree",reference:"reference",combogrid:"combogrid",suggest:"suggest",datetime:"datetime",checkbox:"checkbox",upload:"upload",appTabs:"appTabs",tabs:"tabs",ztree:"ztree",xquery:"xquery"},bindEvents:function(){for(var t in this.listeners){var e=this.listeners[t],i=$A("#"+t),n="";if(i||window.console&&console.log("id:"+t+"控件不在在"),i.data){for(var a in this.contorlType)if(i.data(a)!=undefined){n=this.contorlType[a];break}for(var r in e)if(n){var s={};s[r]=e[r],i[n]("unbind",r),i[n]("bind",s)}else i.off(r,e[r]),i.on(r,e[r])}else if(i.setting)for(var r in e)i.off(r,e[r]),i.on(r,e[r])}}}),PageBase}),define("app/widgets/app-frags",["app/core/app-core"],function(t){return t.frags={dialogFrag:'<div class="dialog" id="${dialogId}" ><div class="dialog-header" onselectstart="return false;" oncopy="return false;" onpaste="return false;" oncut="return false;"><div class="closebg"><a class="close">×</a></div><h5>${title}</h5></div></div>',dialogNoHeaderFrag:'<div class="dialog" id="${dialogId}" style="visibility:hidden;"></div>',dialogProxy:'<div id="dialogProxy" class="dialog dialogProxy"></div>',globalBodyFrag:'\x3c!--遮盖屏幕--\x3e<div id="_alertBackground" class="alertBackground"></div><div id="_dialogMask" class="dialog-mask"></div>',alertBoxFrag:'<div id="_alertMsgBox" class="alert"><div class="alertContent"><i class="${icon}"></i><span><a href="javascript:void(0)" onclick="$A.messager.toggleDetail();">${message}</a></span><tpl if="\'${detail}\'!=\'\'"><div id="__alertDetails" class="alertDetail" style="display:none;">${detail}</div></tpl></div><div class="alertFooter"><div class="btn-toolbar">${butFragment}</div></div></div>',alertBoxFrag_NoDetail:'<div id="_alertMsgBox" class="alert"><div class="alertContent"><i class="${icon}"></i><span>${message}</span><tpl if="\'${detail}\'!=\'\'"><div id="__alertDetails" class="alertDetail" style="display:none;">${detail}</div></tpl></div><div class="alertFooter"><div class="btn-toolbar">${butFragment}</div></div></div>',tipsBoxFrag:'<div id="_tipsMsgBox" class="tips"><div class="tipsContent"><i class="${icon}"></i><span><a href="javascript:void(0)">${message}</a></span></div></div>',alertButFrag:'<a class="btn #css#" rel="#callback#" onclick="$A.messager.close()" href="javascript:">#butMsg#</a>',navTabCM:'<ul id="navTabCM"><li rel="reload">刷新标签页</li><li rel="closeCurrent">关闭标签页</li><li rel="closeOther">关闭其它标签页</li><li rel="closeAll">关闭全部标签页</li></ul>',dialogCM:'<ul id="dialogCM"><li rel="closeCurrent">关闭弹出窗口</li><li rel="closeOther">关闭其它弹出窗口</li><li rel="closeAll">关闭全部弹出窗口</li></ul>',externalFrag:'iframe src="{url}" style="width:100%;height:{height};" frameborder="no" border="0" marginwidth="0" marginheight="0"></iframe>',statusCode_503:"服务器当前负载过大或者正在维护!",validateFormError:"提交数据不完整，{0}个字段有错误，请改正后再提交!",sessionTimout:"会话超时，请重新登录!",alertSelectMsg:"请选择信息!",forwardConfirmMsg:"继续下一步!",mainTabTitle:"我的主页"},t.frags}),define("app/widgets/window/app-messager",["app/core/app-jquery","app/core/app-core","app/widgets/app-frags",localeFile],function(t,e,i,n){var a=n.messager,r=null;return r={_boxId:"#_alertMsgBox",_tipsId:"#_tipsMsgBox",_bgId:"#_alertBackground",_closeTimer:null,_types:{error:"error",info:"info",warn:"warn",correct:"correct",confirm:"confirm"},_getTitle:function(t){return a[t.toUpperCase()]},_keydownOk:function(t){t.keyCode==e.keyCode.ENTER&&t.data.target.trigger("click")},_keydownEsc:function(t){t.keyCode!=e.keyCode.ESC&&t.keyCode!=e.keyCode.ENTER||t.data.target.trigger("click")},toggleDetail:function(){t("#__alertDetails").toggle(),this.relayout()},relayout:function(){var e=t(this._boxId),i=e.attr("pos");"top"==i?e.css({left:(t(window).width()-e.width())/2+"px",top:"0px"}):"bottom"==i?e.css({bottom:"0px",right:"0px"}):e.css({left:(t(window).width()-e.width())/2+"px",top:(t(window).height()-e.height())/2+"px"})},_open:function(n,a,s,o){t(this._boxId).remove();var l="";if(s)for(var d=0;d<s.length;d++){var h=s[d].call?"callback":"",c=s[d].css?s[d].css:"";l+=i.alertButFrag.replace("#butMsg#",s[d].name).replace("#callback#",h).replace("#css#",c)}var u,p=(u=null==(u="string"==typeof a?e.jsonEval(a):a).message&&null==u.detail?{type:n,icon:n,title:this._getTitle(n),message:a,butFragment:l}:t.extend({type:n,icon:n,title:this._getTitle(n),butFragment:l},u)).detail?i.alertBoxFrag:i.alertBoxFrag_NoDetail,f=$template(p,u);t(f).appendTo("body");var g=t(this._boxId);g.attr("pos",o),this.relayout(),this._closeTimer&&(clearTimeout(this._closeTimer),this._closeTimer=null),this._types.info==n||this._types.correct==n?this._closeTimer=setTimeout(function(){r.close()},3500):t(this._bgId).show();var m=t(this._boxId).find("a.btn"),v=m.filter("[rel=callback]"),b=t(document);for(d=0;d<s.length;d++)s[d].call&&v.eq(d).click(s[d].call),s[d].keyCode==e.keyCode.ENTER&&b.bind("keydown",{target:m.eq(d)},this._keydownOk),s[d].keyCode==e.keyCode.ESC&&b.bind("keydown",{target:m.eq(d)},this._keydownEsc);return g},close:function(e){t(document).unbind("keydown",this._keydownOk).unbind("keydown",this._keydownEsc),$msgBox=t(this._boxId),e?$msgBox.fadeOut(e,function(){$msgBox.remove()}):($msgBox.hide(),setTimeout(function(){$msgBox.remove()},500),t(this._bgId).hide())},error:function(t,e){this._alert(this._types.error,t,e)},info:function(t,e){this._alert(this._types.info,t,e,"bottom")},warn:function(t,e){this._alert(this._types.warn,t,e)},correct:function(t,e){this._tips(this._types.correct,t,e,"center")},_alert:function(i,n,r,s){var o={okName:a.OK,okCall:null,okCss:"btn-primary singlebtn"};t.extend(o,r);var l=[{name:o.okName,call:o.okCall,keyCode:e.keyCode.ENTER,css:o.okCss}],d=this._open(i,n,l,s);t("a",d).focus()},_tips:function(e,n,a,r){t(this._tipsId).remove();var s={icon:e,message:n},o=(a=a||{}).displayTime||1500,l=a.fadeSpeed||800,d=i.tipsBoxFrag,h=$template(d,s);t(h).appendTo("body");var c=t(this._tipsId);c.show(),c.attr("pos",r);"top"==(r=c.attr("pos"))?c.css({left:(t(window).width()-c.width())/2+"px",top:"0px"}):"bottom"==r?c.css({bottom:"0px",right:"0px"}):c.css({left:(t(window).width()-c.width())/2+"px",top:"45px"}),c.show(),setTimeout(function(){c.animate({top:"-=38",opacity:0},l,function(){c.remove()})},o)},confirm:function(i,n){var r={okName:a.OK,okCall:null,okCss:"btn-primary",cancelName:a.CANCEL,cancelCall:null,button:null};t.extend(r,n);var s=[{name:r.okName,call:r.okCall,css:r.button&&r.button==this.BUTTONS.OK?r.okCss:""},{name:r.cancelName,call:r.cancelCall,keyCode:e.keyCode.ESC,css:r.button&&r.button!=this.BUTTONS.CANCEL?"":r.okCss}];this._open(this._types.confirm,i,s)},BUTTONS:{OK:"OK",CANCEL:"CANCEL"}},e.messager=r,e.messager}),define("app/core/app-options",["app/core/app-core",localeFile],function(t,e){return t.options={appDefaults:{xquery:{className:"xquery"},XqueryBox:{className:"app-xquerybox"},Textbox:{value:"",text:"",maxLength:null,readonly:!1,disabled:!1,width:"",style:"",wrapstyle:"",multiline:!1,clearbtn:!1,tips:"",filter:null,forbidWord:null,permitWord:null,trim:!0,className:"app-textbox"},Combo:{valuefield:"id",textfield:"name",parameter:null,autoHideOpenBtn:!1,fadeout:!1,panelwidth:"",panelheight:265,customPanelHeight:0,customPanelPosition:"bottom",openbtn:!0,formatter:null,keyShowPanel:[{keyCode:t.keyCode.DOWN,ctrlKey:!0},{keyCode:t.keyCode.UP,ctrlKey:!0}],keyHidePanel:[t.keyCode.ESC,t.keyCode.TAB],keyNextNode:[t.keyCode.DOWN],keyPrevNode:[t.keyCode.UP],keyPickNode:[t.keyCode.ENTER],className:"app-combo"},Combobox:{url:"",multiple:!1,data:null,panelheight:242,keyNextNode:[t.keyCode.DOWN,t.keyCode.RIGHT],keyPrevNode:[t.keyCode.UP,t.keyCode.LEFT],usesuggest:!1,nodeDelete:!1,clearable:!0,className:"app-combobox"},Comboztree:{url:"",asyncUrl:"",onlyleaf:!1,checkBySelf:!1,async:!0,showIcon:!1,multiple:!1,idfield:null,pidfield:"pId",rootpidvalue:"",autoparam:null,otherParam:null,usesuggest:!1,panelheight:232,shrinkValue:!0,ignoreHalfCheck:!0,lazy:300,keyChildNode:[t.keyCode.RIGHT],keyParentNode:[t.keyCode.LEFT],className:"app-comboztree"},Reference:{valuefield:"id",textfield:"name",title:"对话框",hasheader:!0,digWidth:null,digHeight:null,clearbtn:!0,openbtn:!0,url:null,className:"app-reference"},Suggest:{panelheight:242,slt_area:30,suggest:"",suggestfield:"",remote:!1,lazy:500,multiple:!1,acceptText:!1,suggestClear:!1,keyNextSltNode:[t.keyCode.RIGHT],keyPrevSltNode:[t.keyCode.LEFT],className:"app-suggest"},Typeahead:{suggest:"",remote:!1,lazy:500,keyNextNode:[t.keyCode.DOWN,t.keyCode.RIGHT],keyPrevNode:[t.keyCode.UP,t.keyCode.LEFT],className:"app-typeahead"},Money:{precision:2,formatter:"thousand",filter:"number",prefix:"¥",className:"app-money"},Number:{min:null,max:null,varlen:!1,precision:0,prefix:"",suffix:"",filter:"number",formatter:null,zeroIsNull:!1,className:"app-number"},DateTime:{openbtn:!0,onlySelect:!1,type:"date",format:"yyyy-mm-dd",valueFormat:null,language:e.locale,weekStart:1,autoclose:!0,todayBtn:!0,todayHighlight:!0,startView:2,minView:2,className:"app-datetime"},Grid:{url:"",title:"",headRowHeight:28,striped:!0,toolbarHeight:33,toolbar:null,idField:"id",hiddenColumnInit:!1,width:null,height:null,follow:"all",halign:!1,checkbox:!1,radiobox:!1,multiSort:!1,remoteSort:!1,rownumbers:"none",view:{type:"GridView",region:"right",isDefault:!1},switchView:!1,footerRowNumber:!1,pager:"none",pagerToolbarIcon:{download:!1,print:!1},pageNumber:1,pageSize:10,pageList:[10,15,20,50,100,200],columns:null,frozenColumns:null,frozenColumnsRight:null,markChange:!1,editable:!0,jsonReader:{total:"totalRecords",rows:"data",footer:"footer"},queryParams:null,headerCustom:null,autoLoad:!0,fitColumns:"E",summary:null,summaryPos:"bottom",columnResizable:!0,autoBeginEdit:!0,autoEndEdit:!0,editorDelBtn:!0,mergeColumns:null,columnManager:!0,dblOnce:1e3,keyUpEditor:[t.keyCode.UP],keyDownEditor:[t.keyCode.DOWN],keyLeftEditor:[t.keyCode.LEFT],keyRightEditor:[t.keyCode.RIGHT],keySpecEnabled:!0,keyNextEditor:[t.keyCode.ENTER,t.keyCode.TAB],keyPrevEditor:[{keyCode:t.keyCode.TAB,shiftKey:!0}],keyAppendRow:[{keyCode:t.keyCode.PLUS,shiftKey:!0}],keyDeleteRow:[{keyCode:t.keyCode.MINUS,shiftKey:!0,ctrlKey:!0}]},Column:{field:null,title:null,formula:null,colspan:null,rowspan:null,width:100,printWidth:null,printType:"String",frozen:null,hidden:!1,align:"center",sortable:!1,sorter:null,styler:null,formatter:null,editor:null,buttons:null,showTitle:!1,summary:null,resizable:!0,rowHeader:!1,showTree:!0,lockTree:!1},Combogrid:{url:"",panelheight:297,multiple:!1,suggestfield:"",search:!1,lazy:500,usesuggest:!1,keyNextPage:[t.keyCode.RIGHT],keyPrevPage:[t.keyCode.LEFT],className:"app-combogrid",Grid:{pagerToolbar:!1,rownumbers:"repeat",follow:null,clickDelay:0}},Checkbox:{valuefield:"id",textfield:"name",checkedLen:0,orient:"horizontal"},progressbar:{width:"auto",value:0,height:"20px","background-color":"#4AAE98",color:"black",striped:!0,max:100},upload:{uploadUrl:"attachment/upload.do",requestFile:!1,fileUrl:"attachment/getFiles.do",deleteUrl:"attachment/delete.do",toolbarPosition:"top",style:"",css:"",fileWidth:"",canDelete:!1,exts:"",uploadBtnText:"上传文件",multiple:!0},Button:{id:null,disabled:!1,toggle:!1,selected:!1,group:null,plain:!1,text:"",iconCls:null,iconAlign:"left",size:"small",onClick:function(){}},MenuButton:{className:"app-menubutton",disabled:!1,plain:!0,menu:null,duration:100},Menu:{className:"app-menu",zIndex:11e4,left:0,top:0,alignTo:null,align:"left",minWidth:120,duration:100,hideOnUnhover:!0,onShow:function(){},onHide:function(){},onClick:function(t){}},Panel:{id:null,paddings:"0 0 0 0",margins:"0 0 0 0",title:null,width:"auto",height:"auto",left:null,top:null,cls:null,headerCls:null,bodyCls:null,style:{},href:null,cache:!0,fit:!1,border:!0,doSize:!0,noheader:!1,content:null,collapsible:!1,minimizable:!1,maximizable:!1,closable:!1,collapsed:!1,minimized:!1,maximized:!1,closed:!1,extractor:null,method:"get",queryParams:{},loader:function(){},tools:[],loadingMessage:"Loading...",onLoad:function(){},onBeforeOpen:function(){},onOpen:function(){},onBeforeClose:function(){},onClose:function(){},onBeforeDestroy:function(){},onDestroy:function(){},onResize:function(t,e){},onMove:function(t,e){},onMaximize:function(){},onRestore:function(){},onMinimize:function(){},onBeforeCollapse:function(){},onBeforeExpand:function(){},onCollapse:function(){},onExpand:function(){}}},zindexs:{droppanel:2e3,dialog:1001,dialogMask:1e3,dialogBack:999},dataTable:{iDisplayLength:20,aLengthMenu:[[20,50,100],[20,50,100]],bServerSide:!0,bProcessing:!1,bDeferRender:!1,sAjaxDataProp:"data",pageListLength:10},pagination:{pageSize:20,listLength:10,pageSizeMenu:[20,50,100]},flexigrid:{rpOptions:[20,50,100]},jqgrid:{pageList:[20,50,100]},simpletree:{selected:"selected",exp:"center_expandable",coll:"center_collapsable",firstExp:"first_expandable",firstColl:"first_collapsable",lastExp:"last_expandable",lastColl:"last_collapsable",expandIcon:"icon-folder-close",folderIcon:"icon-folder-open",oneExp:"one_expandable",oneColl:"one_collapsable",leafIcon:"icon-file",ck:"checked",unck:"unchecked"},getPlugins:function(){var t=[];for(var e in this.appDefaults)t.push({pluginName:e.toLowerCase(),className:this.appDefaults[e].className});return t}},t.options}),define("app/widgets/app-widget",["app/core/app-base","app/core/app-jquery"],function(t,e){var i=t.extend({propsInAttrs:["element","template","model","events"],element:null,template:"<div></div>",events:null,attrs:{},initialize:function(t){this.initAttrs(t),this.initProps(),this.setup()},parseElement:function(){var t=this.element;if(t?this.element=e(t):this.get("template")&&this.parseElementFromTemplate(),!this.element||!this.element[0])throw"mad-atom is invalid"},parseElementFromTemplate:function(){this.element=e(this.get("template"))},_parseDataAttrs:function(){},initProps:function(){},delegateEvents:function(t,e){},addEvents:function(t){if(this.events=this.events||{},"string"==typeof t)for(var i=arguments,n=i.length;n--;)this.events[i[n]]=this.events[i[n]]||!0,this.get(i[n])&&(this.off(i[n]),this.on(i[n],this.get(i[n]),this));else{for(var a in t)this.off(a),this.on(a,t[a],this);e.extend(this.events,t)}},undelegateEvents:function(t,e){},setup:function(){},render:function(){},destroy:function(){i.superclass.destroy.call(this)}});return i}),define("app/widgets/app-workspace",["app/core/app-jquery","app/core/app-core","app/core/app-options","app/widgets/app-widget"],function(t,e,i,n){var a=n.extend({initialize:function(t,e){e||(e={}),a.superclass.initialize.call(this,e)},getActionPage:function(){return null},addPage:function(t){}});return a}),define("app/core/app-main",["app/core/app-jquery","app/core/app-core","app/widgets/app-frags","app/widgets/window/app-messager",localeFile,"app/widgets/app-workspace"],function(t,e,i,n,a,r){var s=new r,o={portalets:[]};return t.extend(e,{_exfn:function(e,i){var n,a=this.getContainer();return e?(n=i&&a.has(i)?t(i,a).find(e):a.find(e)).isGrid&&n.isGrid()?n.getJqGrid():n.isZTree&&n.isZTree()?n.getAppZTree():n:i||a},getWorkSpace:function(){return s},setPortal:function(t){o=t},getPortal:function(){return o},getPortalet:function(t){if(o){var e=o.portalets;if(e)for(var i=0;i<e.length;i++){var n=e[i];if(n.code==t)return n}}},getCurrentNavTab:function(){return e.getWorkSpace().getActionPage()},registerWorkSpace:function(t){s=t},getCurrentDialog:function(){if(this.dialog&&this.dialog.getCurrent())return this.dialog.getCurrent()},getContainer:function(){var e;return this.getCurrentDialog&&(e=this.getCurrentDialog()),s&&(e&&0!=e.length||(e=s.getActionPage())),e&&0!=e.length||(e=t(document.body)),e},findContainer:function(e){var i=t(e);if(0==i.size)return null;var n=null;return 0==(n=i.is(t(document))||i.hasClass("dialog")||i.hasClass("tabpage")?i:i.parents("(.dialog,.tabpage):first")).size()&&(n=t(document)),n},pageLoad:function(e,i){e&&"function"==typeof e&&(i||(i=this.getContainer()),t(i).is(document)?t(document).ready(e):t(i).on(this.eventType.pageLoad,e))},loadLogin:function(){window.location=_contextPath+"/login.do"}}),e.regInitMethod("appmain",function(){if(t("body").append(i.globalBodyFrag),t.browser.msie&&/6.0/.test(navigator.userAgent))try{document.execCommand("BackgroundImageCache",!1,!0)}catch(n){}t.browser.msie&&window.setInterval("CollectGarbage();",1e4),e.regInitMethod("appmain")}),t(document).on("click","a[target=function]",function(e){e.preventDefault();var i=t(this),n=i.getJsonAttr("data_funcparam"),a=i.getJsonAttr("data_funcname");"function"==typeof a&&a(n)}),e}),define("app/util/app-localstorage",[],function(){var t=function(t){if(this.opts=t,!t.key)throw new Error("为设置key值，无法初始化LocalStorage");this.key=t.key};return t.prototype={get:function(){var t=this._get();if(t)return t.data},_get:function(){var t=localStorage.getItem(this.key);if(t)return JSON.parse(t)},put:function(t){if(t){var e=this._get(),i=$.isArray(t)?typeof t[0]:typeof t;if(e||(e={type:i,data:[]}),e.type!=i)throw new Error("与已存储的数据类型不匹配，无法完成存储");var n=t,a=null;if("object"==i&&(n=t.data,a=t.keyField),$.isArray(n))for(var r=0;r<n.length;r++)this._put(e,n[r],a);else this._put(e,n,a);localStorage.setItem(this.key,JSON.stringify(e))}},_put:function(t,e,i){var n=t.data;this._contain(n,e,i)||(n.length>=20&&n.pop(),n.unshift(e))},_contain:function(t,e,i){if(i){for(var n=0;n<t.length;n++)if(t[n][i]==e[i])return!0}else for(n=0;n<t.length;n++)if(t[n]==e)return!0;return!1}},t}),define("app/widgets/form/app-textbox",["app/core/app-jquery","app/core/app-core","app/core/app-options","app/core/app-base","app/util/app-localstorage"],function(t,e,i,n,a){"use strict";var r=n.extend({initialize:function(e,n){n||(n={}),n._=t.extend({},i.appDefaults.Textbox,n._),this.$input=t(e),this.$input.data("context",this),this.options=n,this._baseInit()},_baseInit:function(){this._baseInitOptions(),this._baseEventRegister(),this._wrapByDiv(),this.$element=this.$input.parent(),this.$element.data("context",this),this.$text=this.$element.find("[type=showValue]"),this.$value=this.$input,this.$clearBtn=this.$element.find(".wrapper-clear"),this.$openBtn=this.$element.find(".wrapper-open"),this._registWrapperEvents();var t=this.setting;this.setValue(t.value,!0),t.text&&this.setText(t.text),t.disabled&&this.disable(),t.readonly&&this.readonly(),t.autoHideOpenBtn&&this.$openBtn.hide(),this._textChangeEvent();var e=t.formatter;e&&"string"==typeof e&&e.indexOf("{")>=0&&(t.template=new Template(e)),this._afterRender()},_textChangeEvent:function(){var e=this;this.$text.on("change.textbox.api",function(){var i=this.value,n=e.$text.getCurPos();if(e.setting.trim&&(i=t.trim(i)),e.forbidReg){var a=i.match(e.forbidReg);a&&(n=i.indexOf(a[0])),i=i.replace(e.forbidReg,"")}if(e.permitReg){var r=i.match(e.permitReg);r&&(n=i.indexOf(r[0])),i=i.replace(e.permitReg,"")}e.$text.val(i),e.setValue(i),null!==n&&e.$text.setCurPos(n)})},_showTips:function(){var t=this.setting.tips,e=this.getText();t&&(""==e?(this.$text.addClass("wrapper-tips"),this.$text.val(t)):this.$text.removeClass("wrapper-tips"))},_baseInitOptions:function(){var i=t.extend(e.getAttrFromElement(this.$input),this.options);if(t.isFunction(i.beforeRender)&&i.beforeRender.call(this,i),this.customSetting=i,i.multiple&&(this.options._.clearbtn=!0),isNaN(i.panelheight)&&delete i.panelheight,this.setting=t.extend({},this.options._,i),delete this.options._,this.setting.url||(this.setting.url=this.setting.action),this.setting.parameter){var n=this.setting.parameter;"string"==typeof n&&(n=e.jsonEval(this.setting.parameter)),this.setParameter(n)}if(this.setting.otherParam&&"string"==typeof this.setting.otherParam&&(this.setting.otherParam=e.jsonEval(this.setting.otherParam)),this.setting.forbidWord&&(this.forbidReg=new RegExp("["+this.setting.forbidWord+"]","g")),this.setting.permitWord)this.permitReg=new RegExp("[^"+this.setting.permitWord+"]","g");else{var r=this.setting.filter,s="";"0-9"==r?s="0-9":"number"==r?s="0123456789\\-\\+\\.":"positiveNumber"==r&&(s="0123456789\\."),s&&(this.permitReg=new RegExp("[^"+s+"]","g"))}this.setting.historyKey&&(this._localStorage=new a({key:this.setting.historyKey,expire:7}))},_baseEventRegister:function(){var e=this.setting;t.isFunction(e.afterRender)&&this.on("afterRender",e.afterRender),t.isFunction(e.onBlur)&&this.on("onBlur",e.onBlur),t.isFunction(e.onChange)&&this.on("onChange",e.onChange),t.isFunction(e.onClearValue)&&this.on("onClearValue",e.onClearValue),t.isFunction(e.onClickOpen)&&this.on("onClickOpen",e.onClickOpen),t.isFunction(e.onFocus)&&this.on("onFocus",e.onFocus),t.isFunction(e.onReadonlyClick)&&this.on("onReadonlyClick",e.onReadonlyClick),t.isFunction(e.enterKeyDown)&&this.on("enterKeyDown",e.enterKeyDown)},_registWrapperEvents:function(){this.$element.on("mouseover.textbox.api",":not(.wrapper-readonly-mask,.wrapper-readonly-mask *)",t.proxy(this._mouseover$element,this)),this.$element.on("mouseout.textbox.api",t.proxy(this._mouseout$element,this)),this.$element.on("click.textbox.api",function(t){t.stopPropagation()}),this.$element.on("mousedown.textbox.api",".wrapper-btn.wrapper-open",function(t){t.stopPropagation(),t.preventDefault()}),this.$clearBtn.on("click.textbox.api",t.proxy(this._click$clearBtn,this)),this.$openBtn.on("mousedown.textbox.api",t.proxy(this._mousedown$openBtn,this)),this.$text.on("click.textbox.api",t.proxy(this._click$text,this)),this.$text.on("focus.textbox.api",t.proxy(this._focus$text,this)),this.$text.on("blur.textbox.api",t.proxy(this._blur$text,this)),this.$text.on("keydown."+this.setting.className+".api",t.proxy(this._keyManager,this)),(this.forbidReg||this.permitReg)&&(window.applicationCache?this.$text.on("input."+this.setting.className+".api",t.proxy(this._keyUpManager,this)):this.$text.on("keyup."+this.setting.className+".api",t.proxy(this._keyUpManager,this)))},_mouseover$element:function(){if(this.$element.addClass("app-wrapper-hover"),this._autoShowOpenBtn(),this.setting.clearbtn&&(this.getText()||this.getValue())){var t=28*this.$element.find("a.wrapper-btn:visible").length;this.$clearBtn.css({display:"block",right:t})}this.trigger("onMouseOver")},_mouseout$element:function(){this.$clearBtn.css("display","none"),this.$element.removeClass("app-wrapper-hover"),this._autoHideOpenBtn(),this.trigger("onMouseOut")},_click$clearBtn:function(){this.clearValue(),this.trigger("onClearValue")},_mousedown$openBtn:function(){this.togglePanel&&this.togglePanel(),this.focus(),this.trigger("onClickOpen")},_click$text:function(){this._setCursorSign(),this._isEditable()||this.togglePanel&&this.togglePanel()},_focus$text:function(){this._attchCounterTimer(),this._setCursorSign(),this.$element.addClass("app-wrapper-active"),this.$text.val()==this.setting.tips&&(this.$text.val(""),this.$text.removeClass("wrapper-tips")),this._autoShowOpenBtn(),this.trigger("onFocus")},_attchCounterTimer:function(){var t=this.$text,e=this.setting.maxLength;if(e>0){var i=this;this.counterTimer=setInterval(function(){var n=t.val();e-n.length>=0?t.off("keypress.textbox.counter.api"):t.on("keypress.textbox.counter.api",function(t){if(8!==t.keyCode)return!1}),setTimeout(function(){var n=t.val();e-n.length<0&&(i.showError("已按最大长度"+e+"进行截取",1200),t.val(t.val().substring(0,e)))},0)},500)}},_blur$text:function(){this._detachCounterTimer(),this.$element.removeClass("app-wrapper-active"),""==this.getText()&&this.setting.tips&&(this.setText(this.setting.tips),this.$text.addClass("wrapper-tips")),this._autoHideOpenBtn(),this.trigger("onBlur")},_detachCounterTimer:function(){this.counterTimer&&clearInterval(this.counterTimer)},_autoShowOpenBtn:function(){this.setting.autoHideOpenBtn&&this.$openBtn.show()},_autoHideOpenBtn:function(){this.setting.autoHideOpenBtn&&(this.isActive()||this.$openBtn.hide())},_keyManager:function(t){this._keyCursorPos(t)},_keyUpManager:function(){var t=this;setTimeout(function(){t.$text.trigger("change")},100)},_dealSysKey:function(i){if(i.keyCode==e.keyCode.TAB)return this._mainDivIsVisiable()&&this.hidePanel(),!0;if(i.ctrlKey&&(i.keyCode==e.keyCode.DELETE||i.keyCode==e.keyCode.BACKSPACE)&&!1!==this.setting.clearable)return this.clearValue(),!0;if(i.keyCode==e.keyCode.DELETE||i.keyCode==e.keyCode.BACKSPACE){if(!this._isEditable()&&!1!==this.setting.clearable)return this.clearValue(),!0}else{if(i.ctrlKey&&i.keyCode==e.keyCode.Z)return i.preventDefault(),!0;if(i.keyCode==e.keyCode.PgUp){if(this.$dropPanel)return this.$dropPanel.scrollTop(this.$dropPanel.scrollTop()-this.$dropPanel.outerHeight()),!0}else if(i.keyCode==e.keyCode.PgDn&&this.$dropPanel)return this.$dropPanel.scrollTop(this.$dropPanel.scrollTop()+this.$dropPanel.outerHeight()),!0}if(i.keyCode==e.keyCode.ENTER&&!i.shiftKey){var n=t(i.target),a=n.data("enterKeyTimeStamp");return(!a||a&&i.timeStamp-a>1e3)&&(this._mainDivIsVisiable()||(n.data("enterKeyTimeStamp",i.timeStamp),this.trigger("enterKeyDown"))),!0}return!1},_keyCursorPos:function(t){if(!this._dealSysKey(t)){var i=t.keyCode;if(this._isKeyCursorPos(i)){if(t.ctrlKey)return;switch(i){case e.keyCode.LEFT:case e.keyCode.HOME:case e.keyCode.UP:this._isEditable()&&(this._setCursorSign(),this._beforeFirstChar||t.stopPropagation());break;case e.keyCode.RIGHT:case e.keyCode.END:case e.keyCode.DOWN:this.getText().length;this._isEditable()&&(this._setCursorSign(),this._afterLastChar||t.stopPropagation())}}else this.setting.filter&&this._filterKeyDown(t),this._setCursorSign()}},_isKeyCursorPos:function(t){return t==e.keyCode.LEFT||t==e.keyCode.RIGHT||t==e.keyCode.HOME||t==e.keyCode.END},_setCursorSign:function(){var t=this;setTimeout(function(){var e=t._getSelection();0==e.start?t._beforeFirstChar=!0:t._beforeFirstChar=!1,e.end==t.getText().length?t._afterLastChar=!0:t._afterLastChar=!1},0)},_getSelection:function(){var t=this.$text[0],e={};if("selectionStart"in t)e.start=t.selectionStart,e.end=t.selectionEnd;else if("selection"in document){var i=t.value,n=document.selection.createRange().duplicate();n.moveEnd("character",i.length),e.start=""==n.text?i.length:i.lastIndexOf(n.text),(n=document.selection.createRange().duplicate()).moveStart("character",-i.length),e.end=n.text.length}return e},_filterKeyDown:function(i){var n=this.setting.filter,a=i.keyCode;if(t.isFunction(n))!1===n(i)&&i.preventDefault();else if("string"==typeof n){if(a==e.keyCode.DELETE||a==e.keyCode.BACKSPACE)return;"number"==n?a>=48&&a<=57||a>=96&&a<=105||(i.preventDefault(),a==e.keyCode.PLUS||a==e.keyCode.PLUS1?this._setNumberSign(""):a==e.keyCode.MINUS||a==e.keyCode.MINUS1?this._setNumberSign("-"):a!=e.keyCode.POINT&&a!=e.keyCode.POINT1||this._setNumberPoint()):"positiveNumber"==n?a>=48&&a<=57||a>=96&&a<=105||(i.preventDefault(),a!=e.keyCode.POINT&&a!=e.keyCode.POINT1||this._setNumberPoint()):"0-9"==n&&(a>=48&&a<=57||a>=96&&a<=105||i.preventDefault())}},_setNumberSign:function(t){var e="";(window.getSelection?""!=window.getSelection().toString():document.selection&&document.selection.createRange&&""!=document.selection.createRange().text)?(e="",this.setText(e)):e=this.getText(),0==e.indexOf("-")?this.setText(t+e.substring(1)):this.setText(t+e),function(t){if(t.createTextRange){var e=t.createTextRange();e.collapse(!0);var i=t.value.length;e.moveEnd("character",i),e.moveStart("character",i),e.select()}}(this.$text[0])},_setNumberPoint:function(){var t=this.getText();-1==t.indexOf(".")&&(0==t.length?this.setText("0."):this.setText(t+"."))},disable:function(){this._outReadonly();var e=this.$element.find(".wrapper-disabled-mask");e.length>0?(this.$disabledMask=e,this._setLabelText(),this.$disabledMask.show()):this.$disabledMask==undefined?(this.$disabledMask=t('<div class="wrapper-disabled-mask"><label></label></div>'),this.$element.append(this.$disabledMask),this._setLabelText()):this.$disabledMask.show(),this.$text.attr("tabindex",-1),this.$element.addClass("wrapper-disabled")},enable:function(){this.$disabledMask&&this.$disabledMask.hide(),this.$text.removeAttr("tabindex"),this.$element.removeClass("wrapper-disabled")},isEnabled:function(){return!this.$disabledMask||!this.$disabledMask.is(":visible")},_editable:function(t){t==undefined||1==t?this.$text.removeAttr("readonly"):this.$text.attr("readonly","readonly")},_isEditable:function(){return!this.$text.attr("readonly")},toggleEnable:function(){this.$disabledMask&&this.$disabledMask.is(":visible")?this.enable():this.disable()},readonly:function(t){t==undefined||1==t||"true"==t?this._intoReadonly():this._outReadonly()},isReadonly:function(){return!(!this.$readonlyMask||!this.$readonlyMask.is(":visible"))},_intoReadonly:function(){this.enable();var e=this.$element.find(".wrapper-readonly-mask");if(e.length>0)this.$readonlyMask=e,this._setLabelText(),this.$readonlyMask.show();else if(this.$readonlyMask==undefined){var i="";this.setting.style&&(i='style="text-align:left;'+this.setting.style+';display:block;"'),this.$readonlyMask=t('<div class="wrapper-readonly-mask" '+i+"><label></label></div>"),this.$element.append(this.$readonlyMask),this._setLabelText();var n=this.setting.onReadonlyClick;t.isFunction(n)&&n(this.$readonlyMask.find(">label"))}else this.$readonlyMask.show();this.$element.addClass("wrapper-readonly"),this.$text.attr("tabindex",-1)},_outReadonly:function(){this.$readonlyMask&&this.$readonlyMask.hide(),this.$element.removeClass("wrapper-readonly"),this.$text.removeAttr("tabindex")},toggleReadonly:function(){this.readonly(!this.isReadonly())},_setLabelText:function(){if(this.$readonlyMask){var t=this.getText();this.$readonlyMask.find("label").html(t).attr("title",t)}if(this.$disabledMask){t=this.getText();this.$disabledMask.find("label").html(t).attr("title",t)}},focus:function(){!this.isReadonly()&&this.isEnabled()&&this.$text.focus()},blur:function(t){!this.isReadonly()&&this.isEnabled()&&(this.$text.one("blur.textbox-one.api",t),this.$text.blur())},isActive:function(){return this.$element.hasClass("app-wrapper-active")},setParameter:function(t){t||(t={}),this.$input.data("_parameter",t)},getParameter:function(){var e=this.$input.data("_parameter");return t.isFunction(e)?e():e},setValue:function(t,e){this.setText(t),this._setValue(t,e)},setValueNoChange:function(t){this.setValue(t,!0)},_setValue:function(t,e){this.$value.val(t),e||this.$value.trigger("change"),this._triggerOnChange(t,e)},getValue:function(){return this.$value.val()},setText:function(t){this.$text.val(t),this._setLabelText(),this._showTips()},getText:function(){var t=this.$text.val();return t==this.setting.tips&&(t=""),t},setTips:function(e){if(this.$element.off("mouseenter.textbox-tips.api").off("mouseleave.textbox-tips.api").off("mousemove.textbox-tips.api"),e){var n=this;this.$element.on("mouseenter.textbox-tips.api",function(a){n.$tooltip=t('<div class="panel-tooltip">'+e+"</div>"),t.$appPanelContainer.append(n.$tooltip),n.$tooltip.css({top:a.pageY+20+"px",left:a.pageX+10+"px","z-index":i.zindexs.droppanel+1}).show("fast")}).on("mouseleave.textbox-tips.api",function(t){n.$tooltip&&n.$tooltip.remove()}).on("mousemove.textbox-tips.api",function(t){n.$tooltip&&n.$tooltip.css({top:t.pageY+20+"px",left:t.pageX+10+"px"})})}},clearValue:function(){this.setText(""),this.setValue("")},destroy:function(){this.$dropPanel&&this.$dropPanel.remove(),this._detachCounterTimer();var t=this.$element.data("errorWrapper");t&&t.remove(),this.$element.remove(),this.setting.usesuggest&&this._suggest&&this._suggest.$dropPanel.remove(),this.$input.removeData(this.setting.className.substr(4))},_triggerOnChange:function(t,e){var i=this.$input.data("oldVal");i!=t&&(this._makeHistory(),this.$input.data("oldVal",t),e||this.hasBindEvent("onChange")&&this.trigger("onChange",t,i))},_makeHistory:function(){if(this._localStorage){var e=null;(e=t.isFunction(this.getSelectedNode)?this.getSelectedNode():this.getValue())&&(e={data:e,keyField:this.setting.valuefield},this._localStorage.put(e))}},_wrapByDiv:function(t){if(!this.$input.parent().hasClass("app-wrapper")&&this.$input.is("input")){var e=this.$input,i=this.setting,n=this._initInnerHtml(),a="";if(i.width){var r=i.width+"";a="%"==r.charAt(r.length-1)?"width:"+r+";":"width:"+parseInt(r)+"px;"}i.wrapstyle&&(a+=i.wrapstyle),i.hiddencomp&&(a="display:none;"),a&&(a='style="'+a+'"'),e.css("display","none"),e.removeClass(i.className),e.wrap('<div class="app-wrapper '+i.className+'" '+a+"></div>").parent().append(n)}},_initInnerHtml:function(){var t="",e="",i=this.setting;return i.text&&(e+='value="'+i.text+'" '),i.showfield&&(e+=' name="'+i.showfield+'" field="'+i.showfield+'" '),"number"!=i.filter&&"0-9"!=i.filter||(i.style?i.style="ime-mode: disabled;"+i.style:i.style="ime-mode: disabled;"),i.style&&(e+=' style="'+i.style+'"'),t=i.multiline?'<textarea type="showValue" autocomplete="off" '+e+"/>":'<input type="showValue" autocomplete="off" '+e+"/>",t+='<span class="wrapper-btn wrapper-clear"><i></i></span>',i.openbtn&&(t+='<a class="wrapper-btn wrapper-open" tabindex="-1"><i></i></a>'),t},_mainDivIsVisiable:function(){return this.$dropPanel&&this.$dropPanel.is(":visible")},_afterRender:function(){var t=this,e=this.setting.className.substring(4);if(this.$element.hasClass(this.setting.className))var i=setInterval(function(){t.$input.data(e)&&(clearInterval(i),t.trigger("afterRender"))},1)},hideError:function(){var t=this.$element;t.removeClass("errorTarger");var e=t.data("errorWrapper");e&&(e.hide(),t.data("errorWrapper",null),e.remove(),t.off("mouseenter.textbox.err.api mouseleave.textbox.err.api"))},showError:function(e,i){function n(t){var e=t.data("errorWrapper");if(e&&e.text()){t.addClass("errorTarger");var i=t.offset(),n=t.offset().top;i.display="block",n<e.outerHeight()?(i.top=i.top+t.outerHeight(),e.addClass("up")):(i.top=i.top-e.outerHeight(),e.removeClass("up")),e.css(i)}}var a=this.$element;a.addClass("errorTarger");var r=a.data("errorWrapper");if(r)r.find("div>span").text(e);else{var s=t('<div class="errorWrapper"><div><div></div></div></div>');s.css("width",a.outerWidth()),s.appendTo(t.$appPanelContainer),a.data("errorWrapper",s);t('<span for="'+this.setting.id+'" generated="true" class="help-inline">'+e+"</span>").insertBefore(s.find("div div")),a.on("mouseenter.textbox.err.api",function(){n(t(this))}).on("mouseleave.textbox.err.api",function(){!function(t){t.removeClass("errorTarger");var e=t.data("errorWrapper");e&&e.hide()}(t(this))})}if(n(a),i){var o=this;setTimeout(function(){o.hideError()},i)}return r}});return t.fn.textbox=function(i,n){var a=undefined,s=arguments;return this.each(function(){var n=t(this);if(!n.is("input"))return!0;var o=e.getComponent(n,"textbox");if(!o){var l=i;"string"==typeof i&&(l=!1),o=new r(this,l),n.data("textbox",o)}if("string"==typeof i){var d=Array.prototype.slice.call(s,1);a=e.componentMethodApply(o,i,d)}}),a},t.fn.extend({getCurPos:function(){if(!t(this).is(":focus"))return null;var e="",i="";if(navigator.userAgent.indexOf("MSIE")>-1){"TEXTAREA"==t(this).get(0).tagName?(i=document.body.createTextRange()).moveToElementText(t(this).get(0)):i=t(this).get(0).createTextRange(),t(this).focus();var n=document.selection.createRange();n.moveEnd("character",-n.text.length),n.setEndPoint("StartToStart",i),e=n.text.length}else t(this).focus(),e=t(this).get(0).selectionStart;return e},setCurPos:function(e,i){if(i===undefined&&(i=e),navigator.userAgent.indexOf("MSIE")>-1){var n="";"TEXTAREA"==t(this).get(0).tagName?(n=document.body.createTextRange()).moveToElementText(t(this).get(0)):n=t(this).get(0).createTextRange(),t(this).focus(),n.moveStart("character",e),n.moveEnd("character",-(n.text.length-(i-e))),n.select()}else t(this).focus(),t(this).get(0).setSelectionRange(e,i)}}),function(){var e=t("body").find(".appPanelContainer");0==e.length&&(e=t('<div class="appPanelContainer" />'),t("body").append(e)),t.$appPanelContainer=e}(),r}),define("app/core/app-register",["app/core/app-jquery","app/core/app-core",localeFile,"app/core/app-options","app/widgets/form/app-textbox"],function(t,e,i,n){e.regInitMethod(function(e){var i=":not(.tab-content .lazy *)",n={},a=[],r=t(".jqgrid[init!=true]",e).filter(i);r.length>0&&(n.initJqGrid=r,a.push("app/widgets/app-jqgrid"));var s=t(".app-portlet",e);s.length>0&&(n.portlet=s,a.push("app/widgets/portlet/app-portlet"));var o=t(".app-textbox",e).filter(i);o.length>0&&(n.textbox=o,a.push("app/widgets/form/app-textbox"));var l=t(".app-money",e).filter(i);l.length>0&&(n.money=l,a.push("app/widgets/form/app-money"));var d=t(".app-number",e).filter(i);d.length>0&&(n.number=d,a.push("app/widgets/form/app-number"));var h=t(".app-typeahead",e).filter(i);h.length>0&&(n.typeahead=h,a.push("app/widgets/form/app-typeahead"));var c=t(".app-combo",e).filter(i);c.length>0&&(n.combo=c,a.push("app/widgets/form/app-combo"));var u=t(".app-combobox",e).filter(i);u.length>0&&(n.combobox=u,a.push("app/widgets/form/app-combobox"));var p=t(".app-comboztree",e).filter(i);p.length>0&&(n.comboztree=p,a.push("app/widgets/form/app-comboztree"));var f=t(".app-reference",e).filter(i);f.length>0&&(n.reference=f,a.push("app/widgets/form/app-reference"));var g=t(".app-combogrid",e).filter(i);g.length>0&&(n.combogrid=g,a.push("app/widgets/form/app-combogrid"));var m=t(".app-suggest",e).filter(i);m.length>0&&(n.suggest=m,a.push("app/widgets/form/app-suggest"));var v=t("input.app-datetime",e).filter(i);v.length>0&&(n.datetime=v,a.push("app/widgets/form/app-datetime"));var b=t("input.app-checkbox",e).filter(i);b.length>0&&(n.checkbox=b,a.push("app/widgets/form/app-checkbox"));var y=t(".app-upload",e).filter(i);y.length>0&&(n.upload=y,a.push("app/widgets/form/app-upload"));t("[data-toggle=dropdown]",e).filter(i).length>0&&a.push("bootstrap/bootstrap-dropdown");var w=t(".app-tabs",e).filter(i);w.length>0&&(n.tabs=w,a.push("app/widgets/tabs/app-tabs"));var _=t(".app-xquerybox",e).filter(i);_.length>0&&(n.xquerybox=_,a.push("app/widgets/form/app-xquerybox"));var $=t(".apptree",e).filter(i);$.length>0&&(n.initZTree=$,a.push("app/widgets/tree/app-ztree"));var x=t(".xquery",e).filter(i);x.length>0&&(n.initXquery=x,a.push("app/widgets/form/app-xquery"));var C=t(".app-datagrid",e).filter(i);C.length>0&&(n.datagrid=C,a.push("app/widgets/treegrid/app-datagrid"));var k=t(".app-treegrid",e).filter(i);k.length>0&&(n.treegrid=k,a.push("app/widgets/treegrid/app-treegrid"));var T=t("form.required-validate",e).filter(i);T.length>0&&T.find("input[validations]").length>0&&T.each(function(){t(this).validate({debug:!0,success:"valid",submitHandler:function(){alert("验证通过!")}})});var P=t("div.form>form",e).filter(i);P.length>0&&(n.initForm=P,a.push("app/widgets/form/app-form"));var S=t("[gearRules]",e).filter(i);S.length>0&&(a.push("app/widgets/form/app-rule"),n.gearRule=S);var D=t(".btnarea>div.button-state",e).filter(i);D.length>0&&(a.push("app/widgets/button/app-buttons"),n.initButtonState=D);var R=t(".app-button",e).filter(i);R.length>0&&(a.push("app/widgets/button/app-button"),n.button=R);var N=t(".app-menubutton",e).filter(i);N.length>0&&(a.push("app/widgets/button/app-menubutton"),n.menubutton=N);var E=t(".app-layout",e).filter(i);E.length>0&&(a.push("app/widgets/layout/app-layout2"),n.layout=E);(I=t(".app-vboxLayout",e).filter(i)).length>0&&(a.push("app/widgets/layout/app-boxlayout"),n.VBoxLayout=I);(I=t(".app-hboxLayout",e).filter(i)).length>0&&(a.push("app/widgets/layout/app-boxlayout"),n.HBoxLayout=I);var I;(I=t(".app-panel",e).filter(i)).length>0&&(a.push("app/widgets/panel/app-panel"),n.panel=I);var F=t(".app-grid",e).filter(i);F.length>0&&(n.grid=F,a.push("app/widgets/grid/app-grid"));var M=t(".app-menu",e).filter(i);M.length>0&&(a.push("app/widgets/menu/app-menu"),n.menu=M);var z=t(".scrollspy",e).filter(i);z.length>0&&(a.push("app/app-scroll"),n.scrollspy=z),n.initEvent=function(){t("[handle][handleType=JS]",e).filter(i).each(function(){var i=t(this),n=i.attr("handle");if(i.removeAttr("handle"),n){var a=null;try{a=e.getJsFunction(n)}catch(r){return}i.click(function(t){i.isTag("a")&&t.preventDefault(),i.attr("disabled")||i.hasClass("disabled")||a.call(i)})}}),t("[events][eventSelf!=true]",e).filter(i).each(function(){$this=t(this);var e=$this.attr("events");if(e){var i=$this.getJsEvent(e);$this.on(i)}})},a.length>0?require(a,function(){t.each(n,function(e){try{var i=n[e];t.isFunction(i)?i():i[e]()}catch(a){window.console&&console.log(a)}}),e.triggerHandler($A.eventType.pageLoad),t("#_tabmask").hide()}):(t.each(n,function(e){try{var i=n[e];t.isFunction(i)?i():i[e]()}catch(a){window.console&&console.log(a)}}),e.triggerHandler($A.eventType.pageLoad),t("#_tabmask").hide())})}),define("app/util/app-number-format",[],function(){var t={};return t.format=function(t,e){if(t==undefined)return"";var i="";if(e.indexOf(";;#")==e.length-3){if(0==t)return"";e=e.substr(0,e.length-3)}var n=e.indexOf("%")==e.length-1;n&&(t*=100,e=e.substr(0,e.length-1));var a=t?t.toString().split("."):["0"],r=e?e.split("."):[""],s=function(t,e){for(var i="",n=t[0],a=e[0],r=n.length-1,s=!1,o=a.length-1;o>=0;o--)switch(a.substr(o,1)){case"#":r>=0&&(i=n.substr(r--,1)+i);break;case"0":i=r>=0?n.substr(r--,1)+i:"0"+i;break;case",":s=!0,i=","+i}if(r>=0)if(s)for(var l=n.length;r>=0;r--)i=n.substr(r,1)+i,r>0&&(l-r)%3==0&&(i=","+i);else i=n.substr(0,r+1)+i;return i.replace(/^,+/,"").replace(/^(-,)/,"-")}(a,r),o=function(t,e){for(var i=t.length>1?t[1]:"",n=e.length>1?e[1]:"",a=0,r="",s=0;s<n.length;s++)switch(n.substr(s,1)){case"#":a<i.length&&(r+=i.substr(a++,1));break;case"0":a<i.length?r+=i.substr(a++,1):r+="0"}return r}(a,r);i="";return i=o?s+"."+o:s,n&&(i+="%"),i},t.toThousands=function(e,i,n){var a="#,##0";if(i>0){for(var r="",s=0;s<i;s++)r+=n?"#":"0";a+="."+r}return t.format(e,a)},t.toChinese=function(t){if(isNaN(t))return"";if(t>Math.pow(10,12))return"还未处理这么大的值";for(var e="零壹贰叁肆伍陆柒捌玖",i=new Array("拾佰仟","分角"),n=new Array("万亿",""),a=t.toString().split("."),r=new Array(a[0].length-1,2),s=0;s<a.length;s++){for(var o="",l=0;4*l<a[s].length;l++){var d=a[s].length-4*(l+1),h=a[s].substring(d,d+4),c=(r=s?2:h.length-1,function(t,n){return t=t.replace(/\d/g,function(t){return e.charAt(t)+i[n].charAt(r--%4?r%4:-1)})}(h,s));o=(c=c.replace(/(零.)+/g,"零").replace(/零+$/,""))+(c?n[s].charAt(l-1):"")+o}a[s]=o}return a[1]=a[1]?a[1]:"",a[0]=a[0]?a[0]+"元":a[0],a[1]=a[1].match(/分/)?a[1]:a[1]+"整",a[0]+a[1]},t}),define("app/util/app-xss-utils",[],function(){var t=/&\w+;|&#(\d+);/g,e={"&lt;":"<","&gt;":">","&amp;":"&","&nbsp;":" ","&quot;":'"'};String.prototype.xssDecode=function(i){return"string"!=typeof(i=i!=undefined?i:this.toString())?i:i.replace(t,function(t,i){var n=e[t];return n==undefined&&(n=isNaN(i)?t:String.fromCharCode(160==i?32:i)),n})}}),define("app/util/app-utils",["app/core/app-jquery","app/core/app-core","app/util/app-number-format","app/util/app-xss-utils"],function(t,e,i){function n(e,i){return(e.textContent||e.innerText||t(e).text()||"").toLowerCase()===(i||"").toLowerCase()}var a=function(t,e){var i=t.toString();if(i.length<e){for(var n=[e-i.length],a=0;a<n.length;a++)n[a]="0";i=n.join("")+i}else i.length>e&&(i=i.substring(i.length-e,i.length));return i};return e.utils={htmlencode:function(t){var e=document.createElement("div");return e.appendChild(document.createTextNode(t)),e.innerHTML},collectOptions:function(e,i){if(!i||!jQuery.isArray(i))return null;$el=t(e);for(var n={},a=0;a<i.length;a++){var r,s=i[a];if(s.indexOf(":")>-1){var o=s.split(":");r=$el.attr(o[0]),s=o[1]}else r=$el.attr(s);r&&(r.isInteger()?n[s]=parseInt(r,10):n[s]=r)}return n},evalElementAttr:function(e,i){var n=t(e),a=i||"href",r=this.attr(n,a);return!r||r.isFinishedTm()?r:r=r.evalTemplate(e)},attr:function(e,i){return i?"text"==i?t(e).text():"html"==i?t(e).html():"val"==i||"value"==i?t(e).val():t(e).attr(i):null},format:function(t,e){e=e||[];for(var i=t,n=0;n<e.length;n++)i=i.replace(new RegExp("\\{"+n+"\\}","g"),e[n]);return i},getMonthRange:function(t){var e=t.getFullYear(),i=t.getMonth(),n=new Date(e,i+1,0).getDate();return{begin:new Date(e,i,1),end:new Date(e,i,n)}},getYearRange:function(t){return{begin:new Date(t,0,1),end:new Date(t,11,31)}},getSeasonRange:function(t){var e=t.getFullYear(),i=0,n=0;switch(function(t){var e=0;return t<=3?e=1:t<=6?e=2:t<=9?e=3:t<=12&&(e=4),e}(t.getMonth()+1)){case 1:i=1,n=3;break;case 2:i=4,n=6;break;case 3:i=7,n=9;break;case 4:i=10,n=12}var a=new Date(e,n,0).getDate();return{begin:new Date(e,i-1,1),end:new Date(e,n-1,a)}},formatNumber:function(t,e){return e!=undefined&&"number"==typeof e||(e=2),i.toThousands(t,e)},formatNumberSpc:function(t,e){return i.toThousands(t,e,!0)},formatChinese:function(t){return i.toChinese(t)},parseDate:function(e,i){if(e){i||(i="yyyy-MM-dd");var n=[],a=[],r=i.replace(/[y|M|d|H|m|s]+/g,function(t){return n.push(t),"(\\d+)"}),s=new RegExp(r,"g");if(!s.test(e))return alert("解析日期时间出错"),null;e.replace(s,function(){a=t.makeArray(arguments).slice(1,n.length+1)});for(var o=new Date,l=0;l<n.length;l++){var d=n[l],h=parseInt(a[l],10);switch(d.charAt(0)){case"y":o.setFullYear(h);break;case"M":o.setMonth(h-1);break;case"d":o.setDate(h);break;case"H":o.setHours(h);break;case"m":o.setMinutes(h);break;case"s":o.setSeconds(h);break;case"S":o.setMilliseconds(h)}}return o}},formatDate:function(t,e){if(t){e||(e="yyyy-MM-dd");return e.replace(/[y|M|d|H|m|s]+/g,function(e){var i="",n=e.length;switch(e.charAt(0)){case"y":i=t.getFullYear();break;case"M":i=t.getMonth()+1;break;case"d":i=t.getDate();break;case"H":i=t.getHours();break;case"m":i=t.getMinutes();break;case"s":i=t.getSeconds();break;case"S":i=t.getMilliseconds()}return a(i,n)})}},isIDCard:function(t){return/^((1[1-5])|(2[1-3])|(3[1-7])|(4[1-6])|(5[0-4])|(6[1-5])|71|(8[12])|91)\d{4}((19\d{2}(0[13-9]|1[012])(0[1-9]|[12]\d|30))|(19\d{2}(0[13578]|1[02])31)|(19\d{2}02(0[1-9]|1\d|2[0-8]))|(19([13579][26]|[2468][048]|0[48])0229))\d{3}(\d|X|x)?$/.test(t)},isPlusInteger:function(t){return/^(0|[1-9][0-9]*)$/.test(t)&&t.length<11},isPhone:function(t){return/^(\d{3,4}-?)?[1-9]\d{6,7}([-|转]\d{2,4})?$/.test(t)},isMobile:function(t){return new RegExp(/^((\(\d{3}\))|(\d{3}\-))?1[358]\d{9}$/).test(t)},isMail:function(t){return new RegExp(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/).test(t)},isURL:function(t){return new RegExp(/^http:\/\/[A-Za-z0-9]+\.[A-Za-z0-9]+[\/=\?%\-&_~`@[\]\':+!]*([^<>\"\"])*$/).test(t)},isZipCode:function(t){return new RegExp(/^[1-9]\d{5}$/).test(t)},isDigits:function(t){return new RegExp(/^[0-9]*$/).test(t)&&t.length<=32},sort:function(i,n){var a=i.length;if(a<=1)return i;var r=Math.floor(a/2),s=i[r],o=[],l=[];return t(i).each(function(t,e){var i=n(s,e);i>=1?o.push(e):i<0?l.push(e):0==i&&t>r?l.push(e):0==i&&t<r&&o.push(e)}),e.utils.sort(o,n).concat(s,e.utils.sort(l,n))}},t.expr[":"].innerTextExactMatch=t.expr.createPseudo?t.expr.createPseudo(function(t){return function(e){return n(e,t)}}):function(t,e,i){return n(t,i[3])},String.prototype.gblen=function(){for(var t=0,e=0;e<this.length;e++)this.charCodeAt(e)>127||94==this.charCodeAt(e)?t+=2:t++;return t},e.NumberFormat=i,e.utils.addTreeBtn=function(e,i){var n=e.tId,a=n+"_"+i.id;if(!(t("#"+a).length>0)){var r=t('<span class="button '+i.icon+'" id="'+a+'" title="'+i.title+'"></span>');r.on("click",function(t){i.handler(e),t.stopPropagation()}),t("#"+n+"_span").after(r)}},e.utils}),define("app/data/app-json-result",["jquery"],function(t){var e=function(i,n){var a=null,r=null;a="string"===t.type(i)?t.parseJSON(i):t.isPlainObject(i)&&i.responseText?t.parseJSON(i.responseText):i,r=n?{code:e.SUCCESS,message:null}:{code:a.statusCode,message:a.message},this.code=parseInt(r.code,10),this.message=r.message,this.translator=a.translator,this.translateBodys=a.translateBodys,this.data=null;var s=n?a:a.data;t.isPlainObject(s)?(this.data={},t.extend(this.data,s)):this.data=s};return e.prototype={getCode:function(){return this.code},getMessage:function(){return this.message},getRawData:function(e){var i=this.data;if(t.isPlainObject(i)&&""!=e&&null!=e&&e!=undefined)for(var n=e.split("."),a=n.length,r=0;r<a&&(null!==(i=i[n[r]])&&i!==undefined);r++);return i},getData:function(e){var i=this.getRawData(e);return t.isPlainObject(i)&&i.totalPage&&(i.translator=this.translator,i.dicts=this.translateBodys),i}},e.SUCCESS=200,e.FAILURE=-1,e.WARN=1,e.UN_AUTHED=-999,e}),define("app/data/app-ajax",["app/core/app-jquery","app/core/app-core","app/util/app-utils","app/widgets/window/app-messager","app/core/app-options","app/data/app-json-result"],function($,$A,$utils,$messager,$options,JsonResult){function _callback(t,e,i){if(null!=t&&("string"==typeof t&&(t=t.split(",")),$.isArray(t)))for(var n=0;n<t.length;n++)$.isFunction($A.ajax.callbackFunctions[t[n]])&&$A.ajax.callbackFunctions[t[n]](e,i)}function _breforeCall(t){var e=t.toggle,i=t.beforeCall||(e?e.attr("ajax-before"):null);if(!i)return!0;i=i.split(",");for(var n=t._beforeCallIndex||0;n<i.length;n++){var a=$A.ajax.beforeCallFunctions[i[n]];if(t._beforeCallIndex=n+1,$.isFunction(a)&&!a(t))return!1}return!0}function ajaxDebugInfo(t,e,i){if(window.debugModel){var n=["请求地址："+t.url];n.push("请求处理状态："+i),n.push("请求处理结果："+e),alert(n.join("。"))}}var _ajaxProgressBar=$("#_ajaxProgressBar");0==_ajaxProgressBar.length&&($("body").prepend('<div id="_ajaxProgressBar" class="ajaxProgressBar" style="display:none;">\x3c!--<div class="ajaxProgressBarText">数据处理中..</div>--\x3e</div>'),_ajaxProgressBar=$("#_ajaxProgressBar")),$(document).ajaxStart(function(){_ajaxProgressBar.show()}).ajaxStop(function(){_ajaxProgressBar.hide()}).ajaxError(function(){_ajaxProgressBar.hide()}),$A.loadLogin=function(){window.location.reload()};var that={callbackFunctions:{refreshTable:function(t,e){var i=e.toggle;i&&i.attr("refreshTable")?$A(i.attr("refreshTable")).bsgrid("reload"):e.refreshTable?$A(e.refreshTable).bsgrid("reload"):$A(".jqgrid").bsgrid("reload")},refreshMainDetail:function(t,e){var i=t.params;i&&$(i).each(function(t,i){var n=$A(t);if(0!=n.length)if(n.isForm())n.refreshFormData(i);else if(n.isGrid()){if(!i)return;"all"==e.submitMode?n.bsgrid("refreshAllData",i):n.bsgrid("refreshEditData",i)}})},refreshAjaxPage:function(t,e){var i=e.toggle,n=t.refreshBox||e.refreshBox||i.attr("refreshBox")||i.attr("data-target"),a=$(n),r=t.url||e.refreshUrl||i.attr("refreshUrl")||a.attr("url");r&&a.length>0&&a.htmlAJAX({url:r})},refreshPage:function(t,e){window.location.reload()},reloadDataLoader:function(t,e){var i=e.toggle,n=t.dataloader||e.dataloader||(i?i.attr("dataloader"):null);$(n).dataloader("load")},forwardUrl:function(t,e){var i=e.toggle,n=t.forwardUrl||e.forwardUrl||(i?i.attr("forwardUrl"):null);window.location.href!=n&&(window.location=n)},closeSelf:function(t,e){var i=$A.getCurrentDialog();i&&i.length>0?$A.dialog.close(i):$A.navTab.closeCurrentTab()},switchTab:function(t,e){var i=t.tabId||e.tabId;$("#"+i,$A.getContainer()).tab("show")},callMethod:function(t,e){var i=e.toggle,n=t.method||e.callMethod||(i?i.attr("callMethod"):null);n&&(n=decodeURIComponent(n),setTimeout(new Function(methodName),100))}},beforeCallFunctions:{collectData:function(t){var e=t.toggle,i=t.collectFinder||(e?e.attr("collectFinder"):null),n=t.collectAttr||(e?e.attr("collectAttr"):"value"),a=t.collectParam||(e?e.attr("collectParam"):"checkId"),r=t.collectBox||(e?e.attr("collectBox"):document),s=$(r);if(!i)return!0;var o=[];if($(i,s).each(function(){o.push($(this).attr(n))}),o.length>0){1==o.length&&(o=o[0]);var l=t.data;l||(l=t.data={}),l[a]=o}return!0},confirmPrompt:function(t){var e=t.toggle,i=t.confirm||(e?e.attr("confirm"):null);if(i){if(!(i=i.evalTemplate(e)))return;return $messager.confirm(i,{okCall:function(e){return e&&$A.ajax.ajaxCall(t)}}),!1}return!0}},successCall:function(t,e){},respToResult:function(t){var e=null;if("string"===$.type(t))try{e=$.parseJSON(t)}catch(i){e=t}else if($.isPlainObject(t)&&t.responseText)try{e=$.parseJSON(t.responseText)}catch(i){try{e=$A.jsonEval(t.responseText)}catch(i){e=t.responseText}}else e=t;return e&&e.type&&"__bosssoft"==e.type?new JsonResult(e):e},ajaxCall:function(config){var _self=this,options=$.extend({type:"POST",dataType:"json",cache:!1,failure:function(t,e){$messager.error(e.getMessage())}},config);if(options.success||options.failure){var processSuccess=options.success||options.callback,processFailure=options.failure;processSuccess=$.isFunction(processSuccess)?processSuccess:$.noop,processFailure=$.isFunction(processFailure)?processFailure:$.noop,options.success=function(t,e){try{var i=_self.respToResult(t);_self.ajaxSuccess(i,e),i instanceof JsonResult?(code=i.getCode(),message=i.getMessage(),code===JsonResult.SUCCESS?processSuccess(i.getData(),i,e):processFailure(i.getData(),i,e)):processSuccess(i,e)}catch(n){window.console?window.console.log(n):$messager.error("系统繁忙！请稍后重试..."),ajaxDebugInfo(options,t,e)}}}if(options.error){var processError=options.error;options.error=function(t,e,i,n){var a=_self.respToResult(t);processError(a,t,e,i,n)}}else options.error=that.ajaxError;if(_breforeCall(options)){options.data&&"object"==$.type(options)&&(options.contentType&&options.contentType.indexOf("application/json")>-1?options.data=JSON.stringify(options.data):options.data=$.param(options.data,!0));var result=$.ajax(options);if(0==options.async)try{result=eval(result),"object"===$.type(result)&&result.statusCode&&$A.ajax.ajaxSuccess(result)}catch(e){}return result}},ajaxError:function(t,e,i,n){if("401"==t.status);else if("405"==t.status);else if("404"==t.status)$messager.error("找不到对应的URL地址");else{var a=that.respToResult(t);if(a instanceof JsonResult)$messager.error(a.getMessage());else{var r=a.message||"网络异常,请求出错!";$messager.error(r)}}this.errorHandle&&$.isFunction(this.errorHandle)&&this.errorHandle()},ajaxSuccess:function(t){t.statusCode==$A.statusCode.error||t.statusCode==$A.statusCode.internalError||t.statusCode==$A.statusCode.notFound?t.message&&$messager.error(t.message):t.statusCode==$A.statusCode.timeout?$messager.error(t.message,{okCall:$A.loadLogin}):t.message&&$messager.correct(t.message)}};return $A.ajax=that,$.fn.extend({loadUrl:function(t,e,i){$(this).htmlAJAX({url:t,data:e,callback:i})},loadAppURL:function(t){var e=$(this);$.fn.xheditor&&$("textarea.editor",e).xheditor(!1);var i={type:"POST",cache:!1,async:!0,init:!0,history:!1,title:window.title,complete:function(t,e,i,n){"404"==t.status&&$messager.error("找不到对应的URL地址")},success:function(n,a,r){var s;if(i.history){var o=this.title,l=this.url;History.pushState({title:o,url:l},o,l)}var d=$A.jsonEval(n);if(d.statusCode==$A.statusCode.timeout)d.message?$messager.error(d.message,{okCall:$A.loadLogin}):$A.loadLogin();else if(d.statusCode==$A.statusCode.error||d.statusCode==$A.statusCode.internalError||d.statusCode==$A.statusCode.notFound)d.message&&$messager.error(d),t.error&&$.isFunction(t.error)&&t.error.call(this,arguments);else{switch(e.css("visibility","hidden"),this.operator){case"append":e.append(n);break;case"prepend":e.prepend(n);break;case"before":e.before(n);break;case"after":e.after(n);break;case"replace":e=e.replaceWith(n);break;default:i.loading?(s=$('<div class="loadingPage-mask"></div>'),e.html(n),s.height(e.innerHeight()),s.width(e.innerWidth()),e.prepend(s)):e.html(n)}$.isFunction(this.beforePageInit)&&($A.resolveUiPageModel(e),this.beforePageInit(e,model)),this.onPageLoad?e.one($A.eventType.pageLoad,{pageLoadFunc:this.onPageLoad,uiPageModel:e.data("uiPageModel")},function(t){t.data.pageLoadFunc(e.data("uiPageModel")),s&&s.remove(),e.css("visibility","")}):e.one($A.eventType.pageLoad,function(){s&&s.remove(),e.css("visibility","")}),!1!==t.init&&e.initPageUI(),$.isFunction(this.callback)&&this.callback(n,e.data("uiPageModel"))}e.fadeIn()},error:function(i,n,a){t.error&&$.isFunction(t.error)&&t.error.call(this,arguments),"401"==i.status||"405"==i.status||(this.success(i.responseText),e.fadeIn())}};i=$.extend(i,$options.ajax,t),$.browser.webkit||i.url&&(i.url=encodeURI(i.url)),$.ajax(i)},appendAJAX:function(t){t.operator="append",$(this).loadAppURL(t)},prependAJAX:function(t){t.operator="prepend",$(this).loadAppURL(t)},breforeAJAX:function(t){t.operator="before",$(this).loadAppURL(t)},afterAJAX:function(t){t.operator="after",$(this).loadAppURL(t)},replaceAJAX:function(t){t.operator="replace",$(this).loadAppURL(t)},htmlAJAX:function(t){t.operator=null,$(this).loadAppURL(t)}}),$("body").on("click.data-api","[ajax-toggle='ajax']",function(t){t.preventDefault();var e=$(this),i=$utils.evalElementAttr(e);if(!i)return!1;that.ajaxCall({url:i,toggle:e})}),that}),define("app/data/app-result",function(){}),define("app/widgets/app-download",[],function(){return{download:function(t,e,i){var n=$('<form style="display:none;"></form>').attr("action",t).attr("method","post");i&&n.attr("target","_blank");for(var a in e)$('<input type="hidden" />').attr("name",a).val(e[a]).appendTo(n);$("body").append(n),n.submit(),n.remove()}}}),define("app/widgets/button/app-button",["app/core/app-jquery","app/core/app-core","app/core/app-options","app/widgets/app-widget"],function(t,e,i,n){var a=n.extend({initialize:function(e){e||(e={}),a.superclass.initialize.call(this,e),this.attrs=t.extend({},i.appDefaults.Button,this.parseOptions(),e),this.createButton()},parseOptions:function(){var e=t(this.element);return t.extend({},e.parseOptions(this.element,["id","iconCls","iconAlign","group",{plain:"boolean",toggle:"boolean",selected:"boolean"}]),{disabled:!!e.attr("disabled")||undefined,text:t.trim(e.html()),iconCls:e.attr("icon")||e.attr("iconCls")})},createButton:function(){var e=this,i=this.attrs,n=this.element,a=t(n).empty();a.addClass("l-btn").removeClass("l-btn-plain l-btn-selected l-btn-plain-selected"),a.removeClass("l-btn-small l-btn-medium l-btn-large").addClass("l-btn-"+i.size),i.plain&&a.addClass("l-btn-plain"),i.selected&&a.addClass(i.plain?"l-btn-selected l-btn-plain-selected":"l-btn-selected"),i.disabled&&t(n).attr("disabled",i.disabled),a.attr("group",i.group||""),a.attr("id",i.id||"");var r=t('<span class="l-btn-left"></span>').appendTo(a);i.text?t('<span class="l-btn-text"></span>').html(i.text).appendTo(r):t('<span class="l-btn-text l-btn-empty">&nbsp;</span>').appendTo(r),i.iconCls&&(t('<i class="l-btn-icon">&nbsp;</i>').addClass(i.iconCls).appendTo(r),r.addClass("l-btn-icon-"+i.iconAlign)),i.onClick&&e.on("click",i.onClick,n),a.unbind(".linkbutton").bind("focus.linkbutton",function(){i.disabled||t(this).addClass("l-btn-focus")}).bind("blur.linkbutton",function(){t(this).removeClass("l-btn-focus")}).bind("click.linkbutton",function(){i.disabled||(i.toggle&&(i.selected?t(this).linkbutton("unselect"):t(this).linkbutton("select")),e.trigger("click"))}),this._setSelected(i.selected),this._setDisabled(i.disabled)},options:function(){return this.attrs},_setDisabled:function(e){var i=this.element,n=this.attrs;if(t(i).removeClass("l-btn-disabled l-btn-plain-disabled"),e){n.disabled=!0;var a=t(i).attr("href");a&&(this.href=a,t(i).attr("href","javascript:void(0)")),n.plain?t(i).addClass("l-btn-disabled l-btn-plain-disabled"):t(i).addClass("l-btn-disabled")}else n.disabled=!1,this.href&&t(i).attr("href",this.href),t(i).attr("disabled",n.disabled)},enable:function(t){this._setDisabled(!1)},disable:function(t){this._setDisabled(!0)},select:function(){this._setSelected(!0)},unselect:function(){this._setSelected(this,!1)},_setSelected:function(e){var i=this.attrs,n=this.element;e?(i.group&&t('a.l-btn[group="'+i.group+'"]').each(function(){var e=t(this).linkbutton("options");e.toggle&&(t(this).removeClass("l-btn-selected l-btn-plain-selected"),e.selected=!1)}),t(n).addClass(i.plain?"l-btn-selected l-btn-plain-selected":"l-btn-selected"),i.selected=!0):i.group||(t(n).removeClass("l-btn-selected l-btn-plain-selected"),i.selected=!1)}});return t.fn.button=function(e,i){var n=undefined,r=this.each(function(){var r=t(this),s=r.data("button"),o=(r.data("linkbutton"),"object"==typeof e&&e);s?t.extend(s.attrs,o):(o=t.extend(o,{element:this}),r.data("button",s=new a(o)),t(this).removeAttr("disabled")),"string"==typeof e&&(n=s[e](r,i))});return n===undefined?r:n},t.fn.button.Constructor=a,a}),define("app/widgets/form/app-number",["app/core/app-jquery","app/core/app-core","app/core/app-options","app/widgets/form/app-textbox","app/util/app-utils"],function(t,e,i,n,a){"use strict";var r=n.extend({initialize:function(e,n){n||(n={}),n._=t.extend({},i.appDefaults.Number,n._),r.superclass.initialize.call(this,e,n),this._init()},_init:function(){var t=this.setting,e=this.customSetting;"chinese"==t.formatter?(e.prefix===undefined&&(t.prefix=""),e.suffix===undefined&&(t.suffix=""),e.precision===undefined&&(t.precision=2)):"thousand"==this.setting.formatter&&e.precision===undefined&&(t.precision=2),this._editable(),this._registEvents();var i=this.getValue();if(""!=i){var n=this._formatValue(i);this.setText(n)}},_textChangeEvent:function(){},getNumber:function(){return parseFloat(this.$input.val())},setValue:function(t,e){if("string"==typeof t&&""==t)return this.setText(""),void this._setValue("",e);var i=this._parseNumber(t);if(isNaN(i))this.setText(""),this._setValue("",!0);else{if(null!==this.setting.min&&i<this.setting.min)return void this.setValue(this.getValue(),!0);if(null!==this.setting.max&&i>this.setting.max)return void this.setValue(this.getValue(),!0);var n=this._formatValue(i);this.setText(n),0==i&&this.setting.zeroIsNull&&(i=""),this._setValue(i,e)}},_parseNumber:function(t){if(isNaN(t)){if(!t)return;if(t=t.replaceAll(",",""),isNaN(t))return}var e=this.setting,i=new String(t);if(e.varlen){var n=i.split(".")[1];return n&&n.length>e.precision?parseFloat(i).toFixed(e.precision):parseFloat(i)}return parseFloat(i).toFixed(e.precision)},_formatValue:function(e){if(0==e&&this.setting.zeroIsNull)return"";var i=this.setting,n=i.formatter,r=e;return n?t.isFunction(n)?r=n(e):"string"==typeof n&&("chinese"==n?r=a.formatChinese(e):"thousand"==n&&(r=a.formatNumber(e,i.precision))):r=this._parseNumber(e),i.prefix&&(r=i.prefix+r),i.suffix&&(r+=i.suffix),r},_registEvents:function(){var t=this;this.$text.on("blur.number.api",function(e){t.setValue(this.value)}),this.$text.on("focus.number.api",function(e){this.value=t.getValue(),0==this.value&&t.setting.zeroIsNull?this.value="":this.select()})}});return t.fn.number=function(i,n){var a=undefined,s=arguments;return this.each(function(){var n=t(this);if(!n.is("input"))return!0;var o=e.getComponent(n,"number");if("string"==typeof i)try{var l=Array.prototype.slice.call(s,1);a=e.componentMethodApply(o,i,l)}catch(d){e.throwCompMethodError(n,"number",i,d)}else o?e.throwCompInitError(n,"number"):(o=new r(this,i),n.data("number",o))}),a},r}),define("app/widgets/form/app-money",["app/core/app-jquery","app/core/app-core","app/core/app-options","app/widgets/form/app-number","app/util/app-utils"],function(t,e,i,n,a){"use strict";var r=n.extend({initialize:function(t,e){e||(e={}),e._=i.appDefaults.Money,r.superclass.initialize.call(this,t,e)}});return t.fn.money=function(i,n){var a=undefined,s=arguments;return this.each(function(){var n=t(this);if(!n.is("input"))return!0;var o=e.getComponent(n,"money");if("string"==typeof i)try{var l=Array.prototype.slice.call(s,1);a=e.componentMethodApply(o,i,l)}catch(d){e.throwCompMethodError(n,"money",i,d)}else o?e.throwCompInitError(n,"money"):(o=new r(this,i),n.data("money",o))}),a},r}),define("app/widgets/drag/app-droppanel",["app/core/app-jquery","app/core/app-core","app/core/app-options","app/core/app-class"],function(t,e,i,n){"use strict";function a(){return t.browser.msie?"CSS1Compat"==document.compatMode?document.documentElement.clientHeight:document.body.clientHeight:window.innerHeight}return n.create({_closeVisiblePanel:function(){var e=t.$appPanelContainer.find(">.drop-panel:visible,>.datetimepicker:visible");if(0!=e.length){var i=null;if(event){var n=event.currentTarget;n||(n=event.srcElement),i=t(n).closest(".drop-panel:visible,.datetimepicker:visible")}e.each(function(e,n){var a=t(n);if(i&&a.is(i))return!0;var r=a.data("context");r?r.hidePanel():a.hide()})}},_getDropPanelTop:function(t){t===undefined&&(t=this.$dropPanel);var e=this.$element.offset().top,i=this.$element.outerHeight(),n=parseInt(t.css("height"));return e+i+n<a()?e+i-1:e-n+1},_getDropPanelLeft:function(e){e===undefined&&(e=this.$dropPanel);var i=this.$element.offset().left,n=e.outerWidth();if(i+n<=(t.browser.msie?"CSS1Compat"==document.compatMode?document.documentElement.clientWidth:document.body.clientWidth:window.innerWidth))return i;return i-n+this.$element.outerWidth()+1},_isDropPanelUpside:function(t,e){t===undefined&&(t=this.$element),e===undefined&&(e=this.$dropPanel);return t.offset().top+t.outerHeight()+parseInt(e.css("height"))<a()},_onPanelResize:function(){var e=this;this.$dropPanel.on("mousemove.combo.api",t.proxy(this._r_$targetMouseMove,this)),this.$dropPanel.on("mousedown.combo.api",function(t){t.stopPropagation(),e._r_dir&&e._r_startDrag(t)})},_onPanelFadeOut:function(){this.setting.fadeout&&(this.$dropPanel.on("mouseleave.combo.api",t.proxy(this._fadeOut$DropPanel,this)),this.$dropPanel.on("mouseenter.combo.api",t.proxy(this._fadeIn$DropPanel,this)),this.$element.on("mouseout.combo.api",t.proxy(this._fadeOut$DropPanel,this)),this.$element.on("mouseover.combo.api",t.proxy(this._fadeIn$DropPanel,this)))},_fadeOut$DropPanel:function(){if(this._mainDivIsVisiable()){var t=10,e=this;this._hideTimer=setInterval(function(){t-=1,e.$dropPanel.css("opacity",.1*t),0==t&&(clearInterval(e._hideTimer),e.hidePanel(),e.$dropPanel.css("opacity",1))},130)}},_fadeIn$DropPanel:function(){this.$dropPanel.css("opacity",1),clearInterval(this._hideTimer)},_r_$targetMouseMove:function(t){this._r_dir=this._r_getDragDir(t),this._r_dir?this.$dropPanel.css("cursor",this._r_dir+"-resize"):this.$dropPanel.css("cursor").indexOf("-resize")>0&&this.$dropPanel.css("cursor","default")},_r_getDragDir:function(e){var i="",n=this.$dropPanel.offset(),a=this.$dropPanel.outerWidth(),r=this.$dropPanel.outerHeight(),s=e.pageX||e.screenX,o=e.pageY||e.screenY;return o>=n.top&&o<n.top+5?i+="n":o<=n.top+r&&o>n.top+r-5&&(i+="s"),s>=n.left&&s<n.left+5?i+="w":s<=n.left+a&&s>n.left+a-5&&(i+="e"),-1!=t.inArray(i,this._r_getAllowDragDir())?i:""},_r_getAllowDragDir:function(){return this.$dropPanel.offset().top>this.$text.offset().top?["s","se","e"]:["n","ne","e"]},_r_startDrag:function(e){this._r_create$proxy(),this.$resizeProxy.css({left:this.$dropPanel.offset().left,top:this.$dropPanel.offset().top,position:"absolute"}),this._r_current={dir:this._r_dir,left:this.$dropPanel.offset().left,top:this.$dropPanel.offset().top,startX:e.pageX||e.screenX,startY:e.pageY||e.clientY,width:this.$dropPanel.outerWidth(),height:this.$dropPanel.outerHeight()};var i=this;t(document).bind("selectstart.resizable",function(){return!1}),t(document).bind("mouseup.resizable",function(){i._r_stop.apply(i,arguments)}),t(document).bind("mousemove.resizable",function(){i._r_drag.apply(i,arguments)}),this.$resizeProxy.show()},_r_create$proxy:function(){this.$resizeProxy=t('<div class="panel-resize-proxy"></div>'),this.$resizeProxy.width(this.$dropPanel.outerWidth()).height(this.$dropPanel.outerHeight()),this.$resizeProxy.appendTo("body")},_r_remove$Proxy:function(){this.$resizeProxy&&(this.$resizeProxy.remove(),this.$resizeProxy=null)},_r_drag:function(t){if(this._r_current&&this.$resizeProxy){this.$resizeProxy.css("cursor",""==this._r_current.dir?"default":this._r_current.dir+"-resize");var e=t.pageX||t.screenX,i=t.pageY||t.screenY;this._r_current.diffX=e-this._r_current.startX,this._r_current.diffY=i-this._r_current.startY,this._r_applyResize(this.$resizeProxy)}},_r_stop:function(e){this._r_applyResize(),this._r_remove$Proxy(),t(document).unbind("selectstart.resizable"),t(document).unbind("mousemove.resizable"),t(document).unbind("mouseup.resizable"),this._endResize&&this._endResize()},_r_changeBy:{t:["n","ne","nw"],l:["w","sw","nw"],w:["w","sw","nw","e","ne","se"],h:["n","ne","nw","s","se","sw"]},_r_applyResize:function(e){var i={left:this._r_current.left,top:this._r_current.top,width:this._r_current.width,height:this._r_current.height},n=!1;e||(e=this.$dropPanel,n=!0,isNaN(parseInt(this.$dropPanel.css("top")))?i.top=0:i.top=parseInt(this.$dropPanel.css("top")),isNaN(parseInt(this.$dropPanel.css("left")))?i.left=0:i.left=parseInt(this.$dropPanel.css("left"))),t.inArray(this._r_current.dir,this._r_changeBy.l)>-1?(i.left+=this._r_current.diffX,this._r_current.diffLeft=this._r_current.diffX):n&&delete i.left,t.inArray(this._r_current.dir,this._r_changeBy.t)>-1?(i.top+=this._r_current.diffY,this._r_current.diffTop=this._r_current.diffY):n&&delete i.top,t.inArray(this._r_current.dir,this._r_changeBy.w)>-1?(i.width+=(-1==this._r_current.dir.indexOf("w")?1:-1)*this._r_current.diffX,this._r_current.newWidth=i.width):n&&delete i.width,t.inArray(this._r_current.dir,this._r_changeBy.h)>-1?(i.height+=(-1==this._r_current.dir.indexOf("n")?1:-1)*this._r_current.diffY,this._r_current.newHeight=i.height):n&&delete i.height,e.css(i)}})}),define("app/widgets/form/app-combo",["app/core/app-jquery","app/core/app-core","app/core/app-options","app/data/app-ajax","app/widgets/form/app-textbox","app/widgets/drag/app-droppanel"],function(t,e,i,n,a,r){"use strict";function s(t,e,i,n){var a=l.call(this),r=this.$dropPanelMain.scrollTop(),s=parseInt(r/a);e<0?this.$dropPanelMain.scrollTop((s+1)*a):this.$dropPanelMain.scrollTop((s-1)*a)}function o(){var t=this.$dropPanelMain[0],e=t.scrollTop,i=t.scrollHeight,n=t.clientHeight;if(0!=e){e=this.$dropPanelMain.scrollTop();var a=l.call(this);e=e+n>a*(this.$dropPanelMain.find("li:visible").length-.5)?i-n:parseInt(e/a)*a,this.$dropPanelMain.scrollTop(e)}else this.$dropPanelMain.scrollTop(0)}function l(){if(!this._rowHeight)if("app-comboztree"==this.setting.className){var e=t('<li style="visibility: hidden;"><a class="level0"><span></span></a></li>');this.$dropPanelMain.find(".ztree").append(e),this._rowHeight=e.outerHeight(),e.remove()}else this._rowHeight=this.$dropPanelMain.find("li:first").outerHeight();return this._rowHeight}var d=a.extend({Implements:r,initialize:function(e,n){n||(n={}),n._=t.extend({},i.appDefaults.Combo,n._),d.superclass.initialize.call(this,e,n),this._comboInit(),this._comboEventRegister()},_comboInit:function(){this.setting.rowHeight&&(this._rowHeight=this.setting.rowHeight),this._editable(!1),this._initDropPanel(),this.$dropPanel.data("context",this),this.setting.selectednode&&this.setSelectedNode(this.setting.selectednode),this._onPanelResize(),this._onPanelFadeOut()},_comboEventRegister:function(){var t=this.setting;t.afterDataRender&&this.on("afterDataRender",t.afterDataRender),t.beforeLoad&&this.on("beforeLoad",t.beforeLoad),t.beforeShowPanel&&this.on("beforeShowPanel",t.beforeShowPanel),t.onHidePanel&&this.on("onHidePanel",t.onHidePanel),t.onShowPanel&&this.on("onShowPanel",t.onShowPanel)},_textChangeEvent:function(){},_initDropPanel:function(){this.setting;var e=t('<div class="drop-panel"><div class="drop-panel-main"><div class="drop-panel-loading">正在努力加载中...</div><div class="drop-panel-empty">无符合条件的记录。</div></div><div class="drop-panel-custom"></div></div>');e.appendTo(t.$appPanelContainer),this.$dropPanel=e,this.$dropPanelMain=e.find(".drop-panel-main"),this.$dropPanelCustom=e.find(".drop-panel-custom"),this.$dropPanelLoading=e.find(".drop-panel-loading"),this.$dropPanelEmpty=e.find(".drop-panel-empty"),this.$dropPanelMain.on("mousewheel.combo.api",t.proxy(s,this)),this.$dropPanelMain.on("scroll.combo.api",t.proxy(o,this))},togglePanel:function(){this._mainDivIsVisiable()?this.hidePanel():this._showPanel()},_showPanel:function(e){(function(){if(!this.hasInitDropPanel){this.hasInitDropPanel=!0;var e=this.setting,i={height:e.panelheight};if(e.customPanelHeight&&!isNaN(e.customPanelHeight)){var n={};n.height=e.customPanelHeight,"bottom"==e.customPanelPosition?(n.bottom=0,n["border-top-width"]=1,i["padding-bottom"]=e.customPanelHeight):(n.top=0,n["border-bottom-width"]=1,i["padding-top"]=e.customPanelHeight),this.$dropPanelCustom.css(n),i["min-height"]=Number(e.customPanelHeight)+30}else i["min-height"]=30;var a=this.setting.panelwidth;""!=a?("string"==typeof a&&"%"==a.charAt(a.length-1)&&(a=this.$element.outerWidth()*parseFloat(a)/100),i.width=a):i.width=this.$element.outerWidth(),this.$dropPanel.css(i),this.$dropPanel.on("click.combo.api",t.proxy(this.focus,this))}}).call(this),!1!==this.trigger("beforeShowPanel")&&(this._closeVisiblePanel(),this.$dropPanel.show(),this.place(),t.isFunction(e)&&e.call(this),this.trigger("onShowPanel"))},place:function(){var e={top:this._getDropPanelTop(),left:this._getDropPanelLeft(),"z-index":i.zindexs.droppanel++};this.$dropPanel.css(e),t(document).on("mousedown.droppanel.api",t.proxy(this.hidePanel,this))},hidePanel:function(){var e=this._mainDivIsVisiable();this.$dropPanel.hide(),t.$appPanelContainer.find(".drop-panel,.datetimepicker").is(":visible")||t(document).off("mousedown.droppanel.api"),e&&this.trigger("onHidePanel")},focus:function(){this.$text.focus()},_stopSuggest:function(t){var e=this.$element.data("suggest");e&&(e.stopKeyEvent=t)},_isSuggestContext:function(){var t=this,e=this._suggest;return!(!e||(e.stopKeyEvent=!1,!e._mainDivIsVisiable()))&&(setTimeout(function(){""==e.getText()&&(e.stopKeyEvent=!0,t.showPanel())},10),!0)},_keyFilterSuggest:function(i){var n=i.keyCode,a=!1;if(n>=48&&n<=90)a=!0;else if(n>=96&&n<=105)a=!0;else{var r=[e.keyCode.BACKSPACE,e.keyCode.ENTER,e.keyCode.DELETE,229];a=t.inArray(n,r)>-1}return a},_keyShowPanel:function(t){t.keyCode,this.setting;this._mainDivIsVisiable()||(this.showPanel(),t.preventDefault(),t.stopPropagation())},_keyHidePanel:function(t){t.preventDefault(),this._stopSuggest(!0),this._mainDivIsVisiable()&&this.hidePanel()},suggest:function(){var t=this._suggest;t&&setTimeout(function(){t&&""!=t.getText()&&t.suggest()},10)},_findTextByValue:function(t){if(t===undefined||""===t)return"";for(var e=undefined,i=this.setting.data,n=this.setting.textfield,a=this.setting.valuefield,r=0;r<i.length;r++)if(i[r][a]==t){e=i[r][n];break}return e},_onBeforeLoad:function(){if(this.hasBindEvent("beforeLoad"))return this.trigger("beforeLoad",this.getParameter())},_ajax:function(t,e){if(t&&!1!==this._onBeforeLoad()){this.$dropPanelLoading.show(),this.$dropPanelEmpty.hide();var i=this;n.ajaxCall({url:t,data:this.getParameter(),dataType:"json",type:"POST",success:function(t){i.$dropPanelLoading.hide(),i._onLoadSuccess(t),e.call(i,t)}})}},_initData:function(){var e=this.getParameter();this.setting.url&&e?(this.lastParam!=JSON.stringify(e)&&this.reload(this.setting.url),this.lastParam=JSON.stringify(e)):this.onceRender||(t.isArray(this.setting.data)?this.loadData(this.setting.data):this.reload(this.setting.url,this.firstLoadSuccess),this.onceRender=!0)},_onLoadSuccess:function(t){this.trigger("onLoadSuccess",t)},getSelectedNode:function(){var t=this.$input.data("selectNode");return t||(t=null),t},setSelectedNode:function(t,e){this.$input.data("selectNode",t),1!=e&&this._setValueAndTextByNodes()},_setValueAndTextByNodes:function(){var e=this.getSelectedNode(),i="",n="",a=this.setting.valuefield,r=this.setting.textfield,s=this.setting.formatter;if(e)if(t.isArray(e)){for(var o=0;o<e.length;o++)i+=e[o][a]+",",n+=this._formatter(e[o],s,r)+",";n.length>0&&(n=n.substring(0,n.length-1)),i.length>0&&(i=i.substring(0,i.length-1))}else i=e[a]?e[a]:"",n=this._formatter(e,s,r);this.setText(n),this._setValue(i),!this.setting.acceptText&&this.isActive()&&this.$text[0].select()},_formatter:function(e,i,n){var a="";return i?t.isFunction(i)?a=i(e):"string"==typeof i&&(a=this.setting.template?this.setting.template.apply(e):e[i]):a=e[n],a},setValue:function(t,e){this._setValue(t,e),this._setTextByValue(t),this.setSelectedNode(null,!0)},_setTextByValue:function(t){if(t){if(this.setting.data){var e="";if(this.setting.multiple&&t){for(var i=t.split(","),n=0;n<i.length;n++)e+=this._findTextByValue(i[n])+",";e=e.substr(0,e.length-1)}else e=this._findTextByValue(t);e!=undefined&&""!=e&&this.setText(e)}}else this.setText("")},_afterDataRender:function(){this.trigger("afterDataRender")},getCustomPanel:function(){return this.$dropPanelCustom},getSuggestCustomPanel:function(){var t=this.$input.data("context");return t&&"app-suggest"==t.setting.className?this.getCustomPanel():this._suggest?this._suggest.getCustomPanel():void 0},getData:function(){return this.setting.data},_resetPanelHeight:function(t){var e=t*l.call(this)+this.$dropPanelCustom.height();e>this.setting.panelheight?e=this.setting.panelheight:e+=function(t){var e=0;return t[0].scrollWidth>t.width()&&(e+=18),e}(this.$dropPanelMain),this.$dropPanel.height(e)},_resetPanelWidth:function(t){var e=this.setting.panelwidth;if(!e){t||(t=this.$dropPanelMain);var i=function(t){var e=t[0].scrollWidth;return t[0].scrollHeight>t.height()&&(e+=18),e}(t),n=this.$element.outerWidth();i<n||(e=i<1.5*n?i+15:1.5*n,this.$dropPanel.width(e))}}});return t.fn.combo=function(i,n){var a=undefined,r=arguments;return this.each(function(){var n=t(this);if(!n.is("input"))return!0;var s=e.getComponent(n,"combo");if("string"==typeof i)try{var o=Array.prototype.slice.call(r,1);a=e.componentMethodApply(s,i,o)}catch(l){e.throwCompMethodError(n,"combo",i,l)}else s?e.throwCompInitError(n,"combo"):(s=new d(this,i),n.data("combo",s))}),a},d}),define("app/widgets/form/app-suggest",["app/core/app-jquery","app/core/app-core","app/core/app-options","app/data/app-ajax","app/widgets/form/app-combo"],function(t,e,i,n,a){"use strict";var r=a.extend({initialize:function(t,e){e||(e={}),e._=i.appDefaults.Suggest,r.superclass.initialize.call(this,t,e),this._init()},_init:function(){this._editable(),this._initOptions(),this._initPanelContent(),this._registEvents(),this._eventRegister()},_initOptions:function(){var t=this.setting;""!=t.suggest&&1!=t.suggest||!t.url||(t.suggest=t.url),0==t.suggest&&(t.suggest=""),!t.remote&&t.async&&(t.remote=!0),t.textfield==t.valuefield&&this.setText(t.value),t.suggestfield||(t.suggestfield=t.textfield),t.suggestClear&&!t.multiple?t.suggestClear=!0:t.suggestClear=!1},_initPanelContent:function(){(function(){var t=this.setting;if(t.customPanelHeight&&!isNaN(t.customPanelHeight)){var e={};e.height=t.customPanelHeight,"bottom"==t.customPanelPosition?(e.bottom=0,e["border-top-width"]=1):(e.top=0,e["border-bottom-width"]=1),this.$dropPanelCustom.css(e)}}).call(this),this.$dropPanelMain.append('<div class="suggest-list"><ul></ul></div>'),this.$suggest=this.$dropPanel.find(".suggest-list"),this.$suggestList=this.$suggest.find(">ul"),function(){this.$dropPanelCustom.before('<div class="selected-list"></div>'),this.$selectedList=this.$dropPanel.find(".selected-list");var t=0,e=this.setting;e.acceptText?t=0:e.slt_area&&(t=parseInt(e.slt_area),isNaN(t)&&(t=0)),this.$selectedList.css("height",t)}.call(this),function(){var t=this.$dropPanelCustom.height(),e=this.$selectedList.height();({})["min-height"]=t+e+30,"bottom"==this.setting.customPanelPosition?(this.$dropPanel.css("padding-bottom",t+e),this.$selectedList.css("bottom",t)):(this.$dropPanel.css("padding-bottom",e),this.$dropPanel.css("padding-top",t))}.call(this)},_eventRegister:function(){var e=this.setting;t.isFunction(e.afterSelected)&&this.on("afterSelected",e.afterSelected),t.isFunction(e.beforeSelected)&&this.on("beforeSelected",e.beforeSelected)},_registEvents:function(){this.$text.on("focus.suggest.api",t.proxy(this._textFocusEvent,this));var e=this;this.$element.hasClass("app-suggest")?(this.$openBtn.off("click.textbox.api"),this.$openBtn.on("click.suggest.api",function(t){e.$text.focus()})):this.$element.data("suggest",this),this.$suggestList.on("click.suggest.api","li",function(){e._suggestItemActive(t(this))}),this._onSelectedNodeDeleteEvent(),this._bindShowHistory()},_textChangeEvent:function(){if(this.setting.acceptText){var e=this;this.$text.on("change.textbox.api",function(){var i=e.getSelectedNode(),n=e._getSelectedNodeText(i),a=e.getText(),r=e.$text.getCurPos();if(e.setting.trim&&(a=t.trim(a)),e.forbidReg){var s=a.match(e.forbidReg);s&&(r=a.indexOf(s[0])),a=a.replace(e.forbidReg,"")}if(e.permitReg){var o=a.match(e.permitReg);o&&(r=a.indexOf(o[0])),a=a.replace(e.permitReg,"")}n!=a&&(i=e._createSelectedNode(a)),e.setSelectedNode(i),null!==r&&e.$text.setCurPos(r)})}},_textFocusEvent:function(){var t=this.$text;t.data("oriText",t.val())},_bindShowHistory:function(){if(this._localStorage){var i=this;this.$text.on("fucus.suggest.api click.suggest.api",function(){t.trim(i.getText())||i._showHistory()}).on("keyup.suggest.api",function(n){i._mainDivIsVisiable()||(n.keyCode!=e.keyCode.DOWN?t.trim(i.getText())||i._showHistory():i._showHistory())})}},_showHistory:function(){var t=this._localStorage.get();t&&(this._render$SuggestNode(t),this._showPanel())},_onSelectedNodeDeleteEvent:function(){var e=this;this.$selectedList.on("click.suggest.api",".sd-close-btn",function(){var i=t(this).parent(),n=e._getNode(i);e.$suggestList.find('.selected[_v="'+n[e.setting.valuefield]+'"]').removeClass("selected"),i.remove(),e._setSelectedNodeBySltArea()})},_keyManager:function(t){this.stopKeyEvent||this._dealSysKey(t)||(this._mainDivIsVisiable()?this._keyForVisiblePanel(t):this._keyForHiddenPanel(t))},_keyForVisiblePanel:function(t){t.keyCode;var i=this.setting;t.stopPropagation(),e.containKeyCode(t,i.keyNextNode)?this._keyNextNode(t):e.containKeyCode(t,i.keyPrevNode)?this._keyPrevNode(t):e.containKeyCode(t,i.keyPickNode)?this._keyPickNode(t):e.containKeyCode(t,i.keyNextSltNode)?this._keyNextSltNode(t):e.containKeyCode(t,i.keyPrevSltNode)?this._keyPrevSltNode(t):e.containKeyCode(t,i.keyHidePanel)?this._keyHidePanel(t):this._keyFilterSuggest(t)&&this.suggest()},_keyForHiddenPanel:function(t){var e=t.keyCode;this._isKeyCursorPos(e)?this._keyCursorPos(t):this._keyFilterSuggest(t)&&this.suggest()},_switchSuggest:function(){var e=this.$selectedList.find(".selected-item.current");if(e.length>0){e.removeClass("current");var i=this.$suggest.scrollTop(),n=this.$suggestList.find(">li"),a=t(n[0]).outerHeight(),r=Math.floor(i/a);t(n[r]).addClass("current")}},_keyPrevNode:function(t){t.preventDefault();var e=this.$suggestList;if(0!=e.find(">li").length){var i=e.find(".current"),n=i.prev();0==n.length&&(n=e.find("li:last-child")),this._switchSuggest(),i.removeClass("current"),n.addClass("current"),this._locateSuggest()}},_keyNextNode:function(t){t.preventDefault(),this._locateNextNode()},_locateNextNode:function(){var t=this.$suggestList;if(0!=t.find(">li").length){var e=t.find(".current"),i=e.next();0==i.length&&(i=t.find("li:first-child")),this._switchSuggest(),e.removeClass("current"),i.addClass("current"),this._locateSuggest()}},_keyPickNode:function(t){t.preventDefault();var e=this.$dropPanel.find(".current");0!=e.length&&(e.hasClass("selected-item")?(e.find(".sd-close-btn").click(),this._keyNextSltNode(t)):(this._suggestItemActive(e),this._locateNextNode()))},_locateSuggest:function(){var t=this.$suggestList.find("li.current");if(1==t.length){var e=t.offset().top+t.outerHeight()-this.$suggestList.offset().top,i=this.$suggest.outerHeight()-2,n=this.$suggest.scrollTop();e<=n?this.$suggest.scrollTop(e-t.outerHeight()):e>=n+i&&this.$suggest.scrollTop(e-i)}},_switchSelected:function(){this.$suggestList.find("li.current").removeClass("current")},_keyPrevSltNode:function(e){e.preventDefault();var i=this.$selectedList.find(">div");if(0!=i.length){var n=this.$selectedList.find(">div.current"),a=n.prev();0==a.length&&(a=t(i[i.length-1])),this._switchSelected(),n.removeClass("current"),a.addClass("current"),this._locateSelected()}},_keyNextSltNode:function(e){var i=this.$selectedList.find(">div");if(0!=i.length){var n=this.$selectedList.find(">div.current"),a=n.next();0==a.length&&(a=t(i[0])),this._switchSelected(),n.removeClass("current"),a.addClass("current"),this._locateSelected()}},_locateSelected:function(){var t=this.$selectedList.find(">div.current");if(1==t.length){var e=t.offset().top-t.parent().offset().top;this.$selectedList.scrollTop(e)}},suggest:function(){var t=this;this.hasBlur||(this.$text.one("blur.suggest.api",function(){var e=t.getSelectedNode();t.setSelectedNode(e)}),t.hasBlur=!0),clearTimeout(this.timeout),this.timeout=setTimeout(function(){t.$text.off("blur.suggest.api"),t.hasBlur=!1,t._suggestFunc()},this.setting.lazy)},_suggestFunc:function(){this.stopKeyEvent||(this.setting.suggestClear&&(this.setSelectedNode(null,!0),this._setValue("")),this.isActive()&&(this._mainDivIsVisiable()||this.setting.acceptText||this.showPanel(),this._preventSuggest()?this._selected$SuggestNode():(this.setting.acceptText&&this.$selectedList.html(""),!1!==this._onBeforeLoad()&&this.refreshSuggest())))},isSuggesting:function(){return this._mainDivIsVisiable()},refreshSuggest:function(){this.setting.remote?this._suggestByRemote():this._suggestByLocal()},_preventSuggest:function(){var e=this.getText(),i=!1;return t.trim(e)?this.prevKey&&(this.setting.acceptText||this.prevKey!=e||this.prevParameter!=JSON.stringify(this.getParameter())||(i=!0)):i=!0,this.prevParameter=JSON.stringify(this.getParameter()),this.prevKey=e,i},_suggestByRemote:function(){var e=this.setting.suggest,i=this.setting.onlyleaf,a=this;if(e){var r=t.extend({},this.getParameter());r._key=this.getText(),r.suggestfield=this.setting.suggestfield,this.$dropPanelLoading.show(),n.ajaxCall({url:e,data:r,dataType:"json",type:"POST",success:function(t){a.$dropPanelLoading.hide();var e=[];if(i)for(var n=0;n<t.length;n++)a._isLeaf(t,t[n])&&e.push(t[n]);else e=t;a._render$SuggestNode(e)}})}},_suggestByLocal:function(){if(this._initDataByParameter(),this.setting.data!=undefined){var t=this._filterByKey();this._render$SuggestNode(t)}else{var e=this.setting.suggest,i=this;e&&(this.$dropPanelLoading.show(),n.ajaxCall({url:e,data:this.getParameter(),dataType:"json",type:"POST",success:function(t){i.$dropPanelLoading.hide(),i.setting.data=t,i._suggestByLocal()}}))}},_initDataByParameter:function(){var t=this.getParameter();t&&(JSON.stringify(this.lastParam)!=JSON.stringify(t)&&(this.setting.data=undefined),this.lastParam=t)},_filterByKey:function(){var t=this.setting.data,e=this.getText().toUpperCase(),i=this.setting.suggestfield,n=this.setting.onlyleaf,a=[];i||(i=this.setting.textfield);for(var r=i.split(","),s=0;s<t.length;s++)for(var o=0;o<r.length;o++){var l=t[s][r[o]];if(l&&-1!=(l=l.toUpperCase()).indexOf(e)){if(n&&!this._isLeaf(t,t[s]))break;a.push(t[s]);break}}return a},_isLeaf:function(t,e){var i=this.setting.pidfield,n=this.setting.valuefield;if("true"==e.isParent||1==e.isParent)return!1;for(var a=0;a<t.length;a++)if(t[a][i]==e[n])return!1;return!0},_render$SuggestNode:function(e){this.$suggestList.html("");var i=this.setting.valuefield,n=this.setting.textfield,a=this.getText();0==e.length?this.$dropPanelEmpty.show():this.$dropPanelEmpty.hide();for(var r=0;r<e.length;r++){var s=e[r],o=t('<li _v="'+s[i]+'"><i class="icon-ok"></i>'+this._getSuggestText(s[n],a)+"</li>");this.$suggestList.append(o),this._setNode(o,s)}this._selected$SuggestNode(),1==e.length&&this._locateNextNode(),this.setting.acceptText&&(0==e.length?this.hidePanel():this.showPanel()),this._resetPanelWidth()},_getSuggestText:function(t,e){if(""==e)return t;var i=t.indexOf(e);if(-1==i&&-1==(i=t.toUpperCase().indexOf(e.toUpperCase())))return t;var n=e.length;return t.substring(0,i)+"<em>"+t.substring(i,i+n)+"</em>"+t.substring(n+i)},_selected$SuggestNode:function(){var e=this.getSelectedNode(),i=this.setting.valuefield;e?t.isArray(e)||(e=[e]):e=[];for(var n=0;n<e.length;n++){this.$suggestList.find('li[_v="'+e[n][i]+'"]').addClass("selected")}},togglePanel:function(){},showPanel:function(){this.context&&!this.setting.suggestCustomPanel&&(this.$dropPanelCustom.hide(),this.$dropPanel.append(this.context.$dropPanelCustom)),this._render$SelectedNode(),this._showPanel()},_render$SelectedNode:function(){this._resetRender(),this._reset$SelectedNode();var e=this.getSelectedNode();if(e)if(t.isArray(e))for(var i=0;i<e.length;i++)this._appendSelectedItem(e[i]);else this._appendSelectedItem(e)},_reset$SelectedNode:function(){if(!(d=this.getSelectedNode())){var t=this.getValue();if(t){var e=t.split(","),i=this.$text.data("oriText"),n=this.setting.valuefield,a=this.setting.textfield,r=this.setting.multiple,s=[];if(i)for(var o=i.split(","),l=0;l<e.length;l++){var d;(d={})[n]=e[l],d[a]=o[l],s.push(d)}else this._isLocalSuggest()&&(s=this._getSelectedNodeByValue(e));r?this.setSelectedNode(s,!0):this.setSelectedNode(s[0],!0)}}},_getSelectedNodeByValue:function(t){for(var e=[],i=this.setting.data,n=this.setting.valuefield,a=0;a<t.length;a++)for(var r=0;r<i.length;r++)t[a]!=i[r][n]||e.push(i[r]);return e},_isLocalSuggest:function(t){return this.setting.data!=undefined&&!this.setting.async},hidePanel:function(){this._mainDivIsVisiable()&&(this.$dropPanel.hide(),t(document).off("click.combo.api"),this.setting.acceptText||this.setSelectedNode(this.getSelectedNode()))},_createSelectedNode:function(t){var e={};return e[this.setting.textfield]=t,e[this.setting.valuefield]=t,e},_getSelectedNodeText:function(e){if(!e)return"";var i="",n=this.setting.textfield;if(t.isArray(e)){for(var a=0;a<e.length;a++)i+=e[a][n]+",";i.length>0&&(i=i.substring(0,i.length-1))}else i=e[n]?e[n]:"";return i},loadData:function(t){this.setting.data=t,this.setting.remote=!1},reload:function(t){if(t){var e=this;this.$dropPanelLoading.show(),n.ajaxCall({url:t,data:this.getParameter(),dataType:"json",type:"POST",success:function(t){e.$dropPanelLoading.hide(),e.loadData(t)}})}},clearValue:function(){this.setText(""),this.setValue(""),this._resetRender(),this.setSelectedNode(null)},_resetRender:function(){this.$suggestList.find("li.selected").removeClass("selected"),this.$selectedList.html("")},_setSelectedNodeBySltArea:function(){for(var e=this.$selectedList.children(),i=[],n=0;n<e.length;n++)i.push(this._getNode(t(e[n])));this.setting.multiple||(i=i[0])==undefined&&(i=null),this.setSelectedNode(i,!this.setting.acceptText)},_suggestItemActive:function(t){this._isSelected(t)?(this._unselect$SuggestNode(t),this._setSelectedNodeBySltArea()):this._select$SuggestNode(t)},_isSelected:function(t){return t.hasClass("selected")},_select$SuggestNode:function(t){if(!1!==this._active$NodeEvent("beforeSelected",t)){var e=this._getNode(t);this.setting.multiple?(t.addClass("selected"),this._appendSelectedItem(e),this._setSelectedNodeBySltArea()):(this.$suggestList.find("li.selected").removeClass("selected"),this.$selectedList.html(""),t.addClass("selected"),this._appendSelectedItem(e),this._setSelectedNodeBySltArea(),this.hidePanel()),this._active$NodeEvent("afterSelected",t)}},_unselect$SuggestNode:function(t){t.removeClass("selected");var e=this._getNode(t);this.$selectedList.find('.selected-item[_v="'+e[this.setting.valuefield]+'"]').remove()},_active$NodeEvent:function(t,e){if(this.hasBindEvent(t))return this.trigger(t,this._getNode(e))},_getNode:function(t){return t.data("node")},_setNode:function(t,e){t.data("node",e)},_appendSelectedItem:function(e){if(0==this.$selectedList.find('.selected-item[_v="'+e[this.setting.valuefield]+'"]').length){var i=t('<div class="selected-item" _v="'+e[this.setting.valuefield]+'">'+e[this.setting.textfield]+'<span class="sd-close-btn"></span></div>');this._setNode(i,e),this.$selectedList.append(i)}}});return t.fn.suggest=function(i,n){var a=undefined,s=arguments;return this.each(function(){var n=t(this);if(!n.is("input"))return!0;var o=e.getComponent(n,"suggest");if("string"==typeof i)try{var l=Array.prototype.slice.call(s,1);a=e.componentMethodApply(o,i,l)}catch(d){e.throwCompMethodError(n,"suggest",i,d)}else o?e.throwCompInitError(n,"suggest"):(o=new r(this,i),n.data("suggest",o))}),a},r}),define("app/widgets/form/app-combobox",["app/core/app-jquery","app/core/app-core","app/widgets/form/app-combo","app/core/app-options","app/widgets/form/app-suggest"],function(t,e,i,n,a){"use strict";var r=i.extend({initialize:function(t,e){e||(e={}),e._=n.appDefaults.Combobox,r.superclass.initialize.call(this,t,e),this._init()},_init:function(){this._initPanelContent(),this._registEvents(),this.mapData={},this.setting.usesuggest&&(this._suggest=new a(this.$input,this.options),this._suggest.context=this),this._eventRegister(),this.$input.data("context",this),t.isFunction(this.setting.onDeleteNode)&&(this.setting.nodeDelete=!0)},_eventRegister:function(){var e=this.setting;t.isFunction(e.afterSelected)&&this.on("afterSelected",e.afterSelected),t.isFunction(e.beforeSelected)&&this.on("beforeSelected",e.beforeSelected),t.isFunction(e.onDeleteBtnRender)&&this.on("onDeleteBtnRender",e.onDeleteBtnRender),t.isFunction(e.onDeleteNode)&&this.on("onDeleteNode",e.onDeleteNode),t.isFunction(e.onLoadSuccess)&&this.on("onLoadSuccess",e.onLoadSuccess),t.isFunction(e.addDiyDom)&&this.on("addDiyDom",e.addDiyDom),t.isFunction(e.addHoverDom)&&this.on("addHoverDom",e.addHoverDom),t.isFunction(e.removeHoverDom)&&this.on("removeHoverDom",e.removeHoverDom)},_registEvents:function(){var e=this;this.$list.on("click.combobox.api","li",function(){e._clickActive$Node(t(this))}),this.$list.on("click.combobox-delete.api",">li>.btn-delete",function(i){e._clickDelete$Node(t(this).parent()),i.stopPropagation()}),this.$list.on("mouseover",">li",function(i){if(e.hasBindEvent("addHoverDom")){var n=t(this);e.trigger("addHoverDom",n,e._getNode(n))}}),this.$list.on("mouseout",">li",function(i){if(e.hasBindEvent("removeHoverDom")){var n=t(this);if(t(i.toElement).closest("li").is(n))return;if(n.hasClass("selected")||n.hasClass("current"))return;e.trigger("removeHoverDom",n,e._getNode(n))}})},_initPanelContent:function(){var e=t('<ul class="combo-list"></ul>');e.appendTo(this.$dropPanelMain),this.$list=e},_keyManager:function(t){this._dealSysKey(t)||this._isSuggestContext()||(this._mainDivIsVisiable()?this._keyForVisiblePanel(t):this._keyForHiddenPanel(t))},_keyForVisiblePanel:function(t){t.keyCode;var i=this.setting;t.stopPropagation(),e.containKeyCode(t,i.keyNextNode)?this._keyNextNode(t):e.containKeyCode(t,i.keyPrevNode)?this._keyPrevNode(t):e.containKeyCode(t,i.keyPickNode)?this._keyPickNode(t):e.containKeyCode(t,i.keyHidePanel)?this._keyHidePanel(t):this._keyFilterSuggest(t)&&this.suggest()},_keyForHiddenPanel:function(t){var i=t.keyCode,n=this.setting;e.containKeyCode(t,n.keyShowPanel)?this._keyShowPanel(t):this._isKeyCursorPos(i)?this._keyCursorPos(t):this._keyFilterSuggest(t)&&this.suggest()},_keyPrevNode:function(t){t.preventDefault(),this._stopSuggest(!0);var e=this.$list;if(0!=e.find(">li").length){var i=e.find(".current"),n=i.prev();0==n.length&&(n=e.find("li:last-child")),i.removeClass("current"),n.addClass("current"),this.trigger("addHoverDom",n,this._getNode(n)),i.hasClass("selected")||i.hasClass("current")||this.trigger("removeHoverDom",i,this._getNode(i)),this._locateCurrent()}},_keyNextNode:function(t){t.preventDefault(),this._stopSuggest(!0);var e=this.$list;if(0!=e.find(">li").length){var i=e.find(".current"),n=i.next();0==n.length&&(n=e.find("li:first-child")),i.removeClass("current"),n.addClass("current"),this.trigger("addHoverDom",n,this._getNode(n)),i.hasClass("selected")||i.hasClass("current")||this.trigger("removeHoverDom",i,this._getNode(i)),this._locateCurrent()}},_keyPickNode:function(t){t.preventDefault(),this._stopSuggest(!0);var e=this.$list.find(".current");0!=e.length&&(this.setting.multiple&&this._keyNextNode(t),this._clickActive$Node(e))},_locateCurrent:function(){var t=this.$list.find("li.current");if(1==t.length){var e=t.offset().top+t.outerHeight()-this.$list.offset().top,i=this.$dropPanel.outerHeight()-2,n=this.$dropPanel.scrollTop();e<=n?this.$dropPanel.scrollTop(e-t.outerHeight()):e>=n+i&&this.$dropPanel.scrollTop(e-i)}},showPanel:function(){this._suggest&&this.$dropPanel.append(this.$dropPanelCustom),this._showPanel(function(){this._initData(),this._rendSelectedItems()})},togglePanel:function(){this._mainDivIsVisiable()?this.hidePanel():this.showPanel()},loadData:function(t){this.setting.data=t,this._suggest&&(this._suggest.setting.data=t,this._suggest.isSuggesting()&&this._suggest.refreshSuggest()),this._renderData(),this._mainDivIsVisiable()&&this.place()},appendNode:function(e){if(e&&!t.isArray(e)){this.$dropPanelEmpty.hide();var i=this._create$Node(e);this.$list.append(i),this.setting.data?t.merge(this.setting.data,[e]):this.setting.data=[e],this._suggest&&this._suggest.setting&&(this._suggest.setting.data?t.merge(this._suggest.setting.data,[e]):this._suggest.setting.data=[e]),this._mainDivIsVisiable()&&this.place()}},_renderData:function(){var e=this.setting.data==undefined?[]:this.setting.data;this.$list.empty();for(var i=0;i<e.length;i++){var n=t(this._create$Node(e[i]));this.$list.append(n),this.trigger("addDiyDom",n,e[i])}0==e.length?this.$dropPanelEmpty.show():this.$dropPanelEmpty.hide(),this._resetPanelHeight(e.length),this._resetPanelWidth(),this._rendSelectedItems(),this._afterDataRender()},_create$Node:function(t){var i=e.uuid();return this.mapData[i]=t,'<li id="'+i+'" _v="'+t[this.setting.valuefield]+'"><i class="icon-ok"></i>'+t[this.setting.textfield]+this._create$DeleteNode(t)+"</li>"},_create$DeleteNode:function(t){var e="";return this.hasBindEvent("onDeleteBtnRender")?!0===this.trigger("onDeleteBtnRender",t)&&(e='<i class="btn-delete"></i>'):e=this.hasBindEvent("onDeleteNode")?'<i class="btn-delete"></i>':"",e},_clickActive$Node:function(t){if(this._isSelected(t)&&this.setting.multiple)this._unselect$Node(t),this._setSelectedNodeBy$Node();else{if(!1===this._activeItemEvent("beforeSelected",t))return;this._select$Node(t),this._setSelectedNodeBy$Node(),this._activeItemEvent("afterSelected",t)}},_activeItemEvent:function(t,e){if(this.hasBindEvent(t))return this.trigger(t,this._getNode(e))},_isSelected:function(t){return t.hasClass("selected")},_clickDelete$Node:function(t){this.hasBindEvent("onDeleteNode")&&this.trigger("onDeleteNode",this._getNode(t),t.index())},deleteNode:function(t){var e=typeof t,i="";isNaN(t)?"string"==e?i='>li[_v="'+t+'"]':"object"==e&&(i='>li[_v="'+t[this.setting.valuefield]+'"]'):i=">li:eq("+t+")";var n=this.$list.find(i);1==n.length&&this._delete$Node(n),0==this.$list.find("li").length&&this.$dropPanelEmpty.show()},_delete$Node:function(t){this._isSelected(t)&&(this._unselect$Node(t),this._setSelectedNodeBy$Node());var e=this.mapData[t.attr("id")],i=this.setting.valuefield;if(this._suggest)for(var n=this._suggest.setting.data,a=0;a<n.length;a++)if(n[a][i]==e[i]){n.splice(a,1),this._suggest.prevKey=undefined;break}delete this.mapData[t.attr("id")],t.remove()},_select$Node:function(t){if(this.setting.multiple)t.addClass("selected");else{this.$list.find("li.selected").removeClass("selected"),t.addClass("selected"),this.hidePanel()}},_unselect$Node:function(t){t.removeClass("selected")},_setSelectedNodeBy$Node:function(){for(var e=null,i=[],n=this.$list.find("li.selected"),a=0,r=n.length;a<r;a++){var s=this._getNode(t(n[a]));i.push(s)}this.setting.multiple?e=i:(e=i[0])==undefined&&(e=null),this.setSelectedNode(e)},_getNode:function(t){return this.mapData[t.attr("id")]},_rendSelectedItems:function(){this._clearSelectedItems(),this._render$NodeByValue()},_render$NodeByValue:function(){for(var t=this.getValue().split(","),e=0;e<t.length;e++)this.$list.find('li[_v="'+t[e]+'"]').addClass("selected")},reload:function(t){this._ajax(t,function(t){this.loadData(t)})},clearValue:function(){this.setText(""),this.setValue(""),this._clearSelectedItems()},_clearSelectedItems:function(){this.$list.find("li.selected").removeClass("selected")}});return t.fn.combobox=function(i,n){var a=undefined,s=arguments,o="combobox";return this.each(function(){var n=t(this);if(!n.is("input"))return!0;var l=e.getComponent(n,o);if("string"==typeof i)try{var d=Array.prototype.slice.call(s,1);a=e.componentMethodApply(l,i,d),"on"==i&&l._suggest&&l._suggest.on.apply(l._suggest,d),"bind"==i&&l._suggest&&l._suggest.bind.apply(l._suggest,d)}catch(h){e.throwCompMethodError(n,o,i,h)}else l?e.throwCompInitError(n,o):(l=new r(this,i),n.data(o,l))}),a},t}),function(t){function e(){return new Date(Date.UTC.apply(Date,arguments))}var i=function(e,i){var r=this;this.element=t(e),i._datetime&&(this._datetime=i._datetime),this.language=i.language||this.element.data("date-language")||"en",this.language=this.language in n?this.language:"en",this.isRTL=n[this.language].rtl||!1,this.formatType=i.formatType||this.element.data("format-type")||"standard",this.format=a.parseFormat(i.format||this.element.data("date-format")||n[this.language].format||a.getDefaultFormat(this.formatType,"input"),this.formatType),this.isInline=!1,this.isVisible=!1,this.isInput=this.element.is("input"),this.bootcssVer=this.isInput?this.element.is(".form-control")?3:2:this.bootcssVer=this.element.is(".input-group")?3:2,this.component=!!this.element.is(".date")&&(3==this.bootcssVer?this.element.find(".input-group-addon .glyphicon-th, .input-group-addon .glyphicon-time, .input-group-addon .glyphicon-calendar").parent():this.element.find(".add-on .icon-th, .add-on .icon-time, .add-on .icon-calendar").parent()),this.componentReset=!!this.element.is(".date")&&(3==this.bootcssVer?this.element.find(".input-group-addon .glyphicon-remove").parent():this.element.find(".add-on .icon-remove").parent()),this.hasInput=this.component&&this.element.find("input").length,this.component&&0===this.component.length&&(this.component=!1),this.linkField=i.linkField||this.element.data("link-field")||!1,this.linkFormat=a.parseFormat(i.linkFormat||this.element.data("link-format")||a.getDefaultFormat(this.formatType,"link"),this.formatType),this.minuteStep=i.minuteStep||this.element.data("minute-step")||5,this.pickerPosition=i.pickerPosition||this.element.data("picker-position")||"bottom-right",this.showMeridian=i.showMeridian||this.element.data("show-meridian")||!1,this.initialDate=i.initialDate||new Date,this._attachEvents(),this.formatViewType="datetime","formatViewType"in i?this.formatViewType=i.formatViewType:"formatViewType"in this.element.data()&&(this.formatViewType=this.element.data("formatViewType")),this.minView=0,"minView"in i?this.minView=i.minView:"minView"in this.element.data()&&(this.minView=this.element.data("min-view")),this.minView=a.convertViewMode(this.minView),this.maxView=a.modes.length-1,"maxView"in i?this.maxView=i.maxView:"maxView"in this.element.data()&&(this.maxView=this.element.data("max-view")),this.maxView=a.convertViewMode(this.maxView),this.wheelViewModeNavigation=!1,"wheelViewModeNavigation"in i?this.wheelViewModeNavigation=i.wheelViewModeNavigation:"wheelViewModeNavigation"in this.element.data()&&(this.wheelViewModeNavigation=this.element.data("view-mode-wheel-navigation")),this.wheelViewModeNavigationInverseDirection=!1,"wheelViewModeNavigationInverseDirection"in i?this.wheelViewModeNavigationInverseDirection=i.wheelViewModeNavigationInverseDirection:"wheelViewModeNavigationInverseDirection"in this.element.data()&&(this.wheelViewModeNavigationInverseDirection=this.element.data("view-mode-wheel-navigation-inverse-dir")),this.wheelViewModeNavigationDelay=100,"wheelViewModeNavigationDelay"in i?this.wheelViewModeNavigationDelay=i.wheelViewModeNavigationDelay:"wheelViewModeNavigationDelay"in this.element.data()&&(this.wheelViewModeNavigationDelay=this.element.data("view-mode-wheel-navigation-delay")),this.startViewMode=2,"startView"in i?this.startViewMode=i.startView:"startView"in this.element.data()&&(this.startViewMode=this.element.data("start-view")),this.startViewMode=a.convertViewMode(this.startViewMode),this.viewMode=this.startViewMode,this.viewSelect=this.minView,"viewSelect"in i?this.viewSelect=i.viewSelect:"viewSelect"in this.element.data()&&(this.viewSelect=this.element.data("view-select")),this.viewSelect=a.convertViewMode(this.viewSelect),this.forceParse=!0,"forceParse"in i?this.forceParse=i.forceParse:"dateForceParse"in this.element.data()&&(this.forceParse=this.element.data("date-force-parse")),this.picker=t(3==this.bootcssVer?a.templateV3:a.template).appendTo(this.isInline?this.element:"body>.appPanelContainer").on({click:t.proxy(this.click,this),mousedown:t.proxy(this.mousedown,this)}),this.wheelViewModeNavigation&&(t.fn.mousewheel?this.picker.on({mousewheel:t.proxy(this.mousewheel,this)}):console.log("Mouse Wheel event is not supported. Please include the jQuery Mouse Wheel plugin before enabling this option")),this.isInline?this.picker.addClass("datetimepicker-inline"):this.picker.addClass("datetimepicker-dropdown-"+this.pickerPosition+" dropdown-menu"),this.isRTL&&(this.picker.addClass("datetimepicker-rtl"),3==this.bootcssVer?this.picker.find(".prev span, .next span").toggleClass("glyphicon-arrow-left glyphicon-arrow-right"):this.picker.find(".prev i, .next i").toggleClass("icon-arrow-left icon-arrow-right")),t(document).on("mousedown",function(e){0===t(e.target).closest(".datetimepicker").length&&r.hide()}),this.autoclose=!1,"autoclose"in i?this.autoclose=i.autoclose:"dateAutoclose"in this.element.data()&&(this.autoclose=this.element.data("date-autoclose")),this.keyboardNavigation=!0,"keyboardNavigation"in i?this.keyboardNavigation=i.keyboardNavigation:"dateKeyboardNavigation"in this.element.data()&&(this.keyboardNavigation=this.element.data("date-keyboard-navigation")),this.todayBtn=i.todayBtn||this.element.data("date-today-btn")||!1,this.todayHighlight=i.todayHighlight||this.element.data("date-today-highlight")||!1,this.weekStart=(i.weekStart||this.element.data("date-weekstart")||n[this.language].weekStart||0)%7,this.weekEnd=(this.weekStart+6)%7,this.startDate=-Infinity,this.endDate=Infinity,this.daysOfWeekDisabled=[],this.setStartDate(i.startDate||this.element.data("date-startdate")),this.setEndDate(i.endDate||this.element.data("date-enddate")),this.setDaysOfWeekDisabled(i.daysOfWeekDisabled||this.element.data("date-days-of-week-disabled")),this.fillDow(),this.fillMonths(),this.update(),this.showMode(),this.isInline&&this.show()};i.prototype={constructor:i,_events:[],_attachEvents:function(){this._detachEvents(),this.isInput?this._events=[[this.element,{focus:t.proxy(this.show,this),keyup:t.proxy(this.update,this),keydown:t.proxy(this.keydown,this)}]]:this.component&&this.hasInput?(this._events=[[this.element.find("input"),{focus:t.proxy(this.show,this),keyup:t.proxy(this.update,this),keydown:t.proxy(this.keydown,this)}],[this.component,{click:t.proxy(this.show,this)}]],this.componentReset&&this._events.push([this.componentReset,{click:t.proxy(this.reset,this)}])):this.element.is("div")?this.isInline=!0:this._events=[[this.element,{click:t.proxy(this.show,this)}]];for(var e,i,n=0;n<this._events.length;n++)e=this._events[n][0],i=this._events[n][1],e.on(i)},_detachEvents:function(){for(var t,e,i=0;i<this._events.length;i++)t=this._events[i][0],e=this._events[i][1],t.off(e);this._events=[]},show:function(e){this.picker.show(),this.height=this.component?this.component.outerHeight():this.element.outerHeight(),this.forceParse&&this.update(),this.place(),t(window).on("resize",t.proxy(this.place,this)),e&&(e.stopPropagation(),e.preventDefault()),this.isVisible=!0,this.element.trigger({type:"show",date:this.date})},hide:function(e){this.isVisible&&(this.isInline||(this.picker.hide(),t(window).off("resize",this.place),this.viewMode=this.startViewMode,this.showMode(),this.isInput||t(document).off("mousedown",this.hide),this.forceParse&&(this.isInput&&this.element.val()||this.hasInput&&this.element.find("input").val())&&this.setValue(),this.isVisible=!1,this.element.trigger({type:"hide",date:this.date,isPropagationStopped:function(){return!0}})))},remove:function(){this._detachEvents(),this.picker.remove(),delete this.picker,delete this.element.data().datetimepicker},getDate:function(){var t=this.getUTCDate();return new Date(t.getTime()+6e4*t.getTimezoneOffset())},getUTCDate:function(){return this.date},setDate:function(t){this.setUTCDate(new Date(t.getTime()-6e4*t.getTimezoneOffset()))},setUTCDate:function(t){t>=this.startDate&&t<=this.endDate?(this.date=t,this.setValue(),this.viewDate=this.date,this.fill()):this.element.trigger({type:"outOfRange",date:t,startDate:this.startDate,endDate:this.endDate})},setFormat:function(t){this.format=a.parseFormat(t,this.formatType);var e;this.isInput?e=this.element:this.component&&(e=this.element.find("input")),e&&e.val()&&this.setValue()},setValue:function(){var e=this.getFormattedDate();this.isInput?this.element.val(e):(this.component&&this.element.find("input").val(e),this.element.data("date",e)),this.linkField&&t("#"+this.linkField).val(this.getFormattedDate(this.linkFormat))},getFormattedDate:function(t){return t==undefined&&(t=this.format),a.formatDate(this.date,t,this.language,this.formatType)},setStartDate:function(t){this.startDate=t||-Infinity,this.startDate!==-Infinity&&(this.startDate=a.parseDate(this.startDate,this.format,this.language,this.formatType)),this.update(),this.updateNavArrows()},setEndDate:function(t){this.endDate=t||Infinity,this.endDate!==Infinity&&(this.endDate=a.parseDate(this.endDate,this.format,this.language,this.formatType)),this.update(),this.updateNavArrows()},setDaysOfWeekDisabled:function(e){this.daysOfWeekDisabled=e||[],t.isArray(this.daysOfWeekDisabled)||(this.daysOfWeekDisabled=this.daysOfWeekDisabled.split(/,\s*/)),this.daysOfWeekDisabled=t.map(this.daysOfWeekDisabled,function(t){return parseInt(t,10)}),this.update(),this.updateNavArrows()},place:function(){if(!this.isInline){var e=0;t("div").each(function(){var i=parseInt(t(this).css("zIndex"),10);i>e&&(e=i)});var i,n,a,r=e+10;this.component?(a=(i=this.component.offset()).left,"bottom-left"!=this.pickerPosition&&"top-left"!=this.pickerPosition||(a+=this.component.outerWidth()-this.picker.outerWidth())):a=(i=this.element.offset()).left,n="top-left"==this.pickerPosition||"top-right"==this.pickerPosition?i.top-this.picker.outerHeight():i.top+this.height,this.picker.css({top:n,left:a,zIndex:r})}},update:function(){var t,e=!1;arguments&&arguments.length&&("string"==typeof arguments[0]||arguments[0]instanceof Date)?(t=arguments[0],e=!0):("string"==typeof(t=this.element.data("date")||(this.isInput?this.element.val():this.element.find("input").val())||this.initialDate)||t instanceof String)&&(t=t.replace(/^\s+|\s+$/g,"")),t||(t=new Date,e=!1),this.date=a.parseDate(t,this.format,this.language,this.formatType),e&&this.setValue(),this.date<this.startDate?this.viewDate=new Date(this.startDate):this.date>this.endDate?this.viewDate=new Date(this.endDate):(this._setDateConvenient(),this.viewDate=new Date(this.date)),this.fill()},fillDow:function(){for(var t=this.weekStart,e="<tr>";t<this.weekStart+7;)e+='<th class="dow">'+n[this.language].daysMin[t++%7]+"</th>";e+="</tr>",this.picker.find(".datetimepicker-days thead").append(e)},fillMonths:function(){for(var t="",e=0;e<12;)t+='<span class="month">'+n[this.language].monthsShort[e++]+"</span>";this.picker.find(".datetimepicker-months td").html(t)},fill:function(){if(null!=this.date&&null!=this.viewDate){var i=new Date(this.viewDate),r=i.getUTCFullYear(),s=i.getUTCMonth(),o=i.getUTCDate(),l=i.getUTCHours(),d=i.getUTCMinutes(),h=this.startDate!==-Infinity?this.startDate.getUTCFullYear():-Infinity,c=this.startDate!==-Infinity?this.startDate.getUTCMonth():-Infinity,u=this.endDate!==Infinity?this.endDate.getUTCFullYear():Infinity,p=this.endDate!==Infinity?this.endDate.getUTCMonth():Infinity,f=new e(this.date.getUTCFullYear(),this.date.getUTCMonth(),this.date.getUTCDate()).valueOf(),g=new Date;if(this.picker.find(".datetimepicker-days thead th:eq(1)").text(n[this.language].months[s]+" "+r),"time"==this.formatViewType){var m=l%12?l%12:12,v=(m<10?"0":"")+m,b=(d<10?"0":"")+d,y=n[this.language].meridiem[l<12?0:1];this.picker.find(".datetimepicker-hours thead th:eq(1)").text(v+":"+b+" "+y.toUpperCase()),this.picker.find(".datetimepicker-minutes thead th:eq(1)").text(v+":"+b+" "+y.toUpperCase())}else this.picker.find(".datetimepicker-hours thead th:eq(1)").text(o+" "+n[this.language].months[s]+" "+r),this.picker.find(".datetimepicker-minutes thead th:eq(1)").text(o+" "+n[this.language].months[s]+" "+r);this.picker.find("tfoot th.today").text(n[this.language].today).toggle(!1!==this.todayBtn),this.updateNavArrows(),this.fillMonths();var w=e(r,s-1,28,0,0,0,0),_=a.getDaysInMonth(w.getUTCFullYear(),w.getUTCMonth());w.setUTCDate(_),w.setUTCDate(_-(w.getUTCDay()-this.weekStart+7)%7);var $=new Date(w);$.setUTCDate($.getUTCDate()+42),$=$.valueOf();for(var x,C=[];w.valueOf()<$;)w.getUTCDay()==this.weekStart&&C.push("<tr>"),x="",w.getUTCFullYear()<r||w.getUTCFullYear()==r&&w.getUTCMonth()<s?x+=" old":(w.getUTCFullYear()>r||w.getUTCFullYear()==r&&w.getUTCMonth()>s)&&(x+=" new"),this.todayHighlight&&w.getUTCFullYear()==g.getFullYear()&&w.getUTCMonth()==g.getMonth()&&w.getUTCDate()==g.getDate()&&(x+=" today"),w.valueOf()==f&&(x+=" active"),(w.valueOf()+864e5<=this.startDate||w.valueOf()>this.endDate||-1!==t.inArray(w.getUTCDay(),this.daysOfWeekDisabled))&&(x+=" disabled"),C.push('<td class="day'+x+'">'+w.getUTCDate()+"</td>"),w.getUTCDay()==this.weekEnd&&C.push("</tr>"),w.setUTCDate(w.getUTCDate()+1);this.picker.find(".datetimepicker-days tbody").empty().append(C.join("")),C=[];for(var k="",T="",P="",S=0;S<24;S++){x="",(D=e(r,s,o,S)).valueOf()+36e5<=this.startDate||D.valueOf()>this.endDate?x+=" disabled":l==S&&(x+=" active"),this.showMeridian&&2==n[this.language].meridiem.length?((T=S<12?n[this.language].meridiem[0]:n[this.language].meridiem[1])!=P&&(""!=P&&C.push("</fieldset>"),C.push('<fieldset class="hour"><legend>'+T.toUpperCase()+"</legend>")),P=T,k=S%12?S%12:12,C.push('<span class="hour'+x+" hour_"+(S<12?"am":"pm")+'">'+k+"</span>"),23==S&&C.push("</fieldset>")):(k=S+":00",C.push('<span class="hour'+x+'">'+k+"</span>"))}this.picker.find(".datetimepicker-hours td").html(C.join("")),C=[],k="",T="",P="";for(S=0;S<60;S+=this.minuteStep){var D;x="",(D=e(r,s,o,l,S,0)).valueOf()<this.startDate||D.valueOf()>this.endDate?x+=" disabled":Math.floor(d/this.minuteStep)==Math.floor(S/this.minuteStep)&&(x+=" active"),this.showMeridian&&2==n[this.language].meridiem.length?((T=l<12?n[this.language].meridiem[0]:n[this.language].meridiem[1])!=P&&(""!=P&&C.push("</fieldset>"),C.push('<fieldset class="minute"><legend>'+T.toUpperCase()+"</legend>")),P=T,k=l%12?l%12:12,C.push('<span class="minute'+x+'">'+k+":"+(S<10?"0"+S:S)+"</span>"),59==S&&C.push("</fieldset>")):(k=S+":00",C.push('<span class="minute'+x+'">'+l+":"+(S<10?"0"+S:S)+"</span>"))}this.picker.find(".datetimepicker-minutes td").html(C.join(""));var R=this.date.getUTCFullYear(),N=this.picker.find(".datetimepicker-months").find("th:eq(1)").text(r).end().find("span").removeClass("active");R==r&&N.eq(this.date.getUTCMonth()).addClass("active"),(r<h||r>u)&&N.addClass("disabled"),r==h&&N.slice(0,c).addClass("disabled"),r==u&&N.slice(p+1).addClass("disabled"),C="",r=10*parseInt(r/10,10);var E=this.picker.find(".datetimepicker-years").find("th:eq(1)").text(r+"-"+(r+9)).end().find("td");r-=1;for(S=-1;S<11;S++)C+='<span class="year'+(-1==S||10==S?" old":"")+(R==r?" active":"")+(r<h||r>u?" disabled":"")+'">'+r+"</span>",r+=1;E.html(C),this.place()}},updateNavArrows:function(){var t=new Date(this.viewDate),e=t.getUTCFullYear(),i=t.getUTCMonth(),n=t.getUTCDate(),a=t.getUTCHours();switch(this.viewMode){case 0:this.startDate!==-Infinity&&e<=this.startDate.getUTCFullYear()&&i<=this.startDate.getUTCMonth()&&n<=this.startDate.getUTCDate()&&a<=this.startDate.getUTCHours()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),this.endDate!==Infinity&&e>=this.endDate.getUTCFullYear()&&i>=this.endDate.getUTCMonth()&&n>=this.endDate.getUTCDate()&&a>=this.endDate.getUTCHours()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"});break;case 1:this.startDate!==-Infinity&&e<=this.startDate.getUTCFullYear()&&i<=this.startDate.getUTCMonth()&&n<=this.startDate.getUTCDate()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),this.endDate!==Infinity&&e>=this.endDate.getUTCFullYear()&&i>=this.endDate.getUTCMonth()&&n>=this.endDate.getUTCDate()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"});break;case 2:this.startDate!==-Infinity&&e<=this.startDate.getUTCFullYear()&&i<=this.startDate.getUTCMonth()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),this.endDate!==Infinity&&e>=this.endDate.getUTCFullYear()&&i>=this.endDate.getUTCMonth()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"});break;case 3:case 4:this.startDate!==-Infinity&&e<=this.startDate.getUTCFullYear()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),this.endDate!==Infinity&&e>=this.endDate.getUTCFullYear()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"})}},mousewheel:function(e){if(e.preventDefault(),e.stopPropagation(),!this.wheelPause){this.wheelPause=!0;var i=e.originalEvent.wheelDelta,n=i>0?1:0===i?0:-1;this.wheelViewModeNavigationInverseDirection&&(n=-n),this.showMode(n),setTimeout(t.proxy(function(){this.wheelPause=!1},this),this.wheelViewModeNavigationDelay)}},click:function(i){i.stopPropagation(),i.preventDefault();var n=t(i.target).closest("span, td, th, legend");if(1==n.length){if(n.is(".disabled"))return void this.element.trigger({type:"outOfRange",date:this.viewDate,startDate:this.startDate,endDate:this.endDate});switch(n[0].nodeName.toLowerCase()){case"th":switch(n[0].className){case"switch":this.showMode(1);break;case"prev":case"next":var r=a.modes[this.viewMode].navStep*("prev"==n[0].className?-1:1);switch(this.viewMode){case 0:this.viewDate=this.moveHour(this.viewDate,r);break;case 1:this.viewDate=this.moveDate(this.viewDate,r);break;case 2:this.viewDate=this.moveMonth(this.viewDate,r);break;case 3:case 4:this.viewDate=this.moveYear(this.viewDate,r)}this.fill();break;case"today":var s=new Date;(s=e(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),0))<this.startDate?s=this.startDate:s>this.endDate&&(s=this.endDate),this.viewMode=this.startViewMode,this.showMode(0),this._setDate(s),this.fill(),this.autoclose&&this.hide()}break;case"span":if(!n.is(".disabled")){var o=this.viewDate.getUTCFullYear(),l=this.viewDate.getUTCMonth(),d=this.viewDate.getUTCDate(),h=this.viewDate.getUTCHours(),c=this.viewDate.getUTCMinutes(),u=this.viewDate.getUTCSeconds();if(n.is(".month")?(this.viewDate.setUTCDate(1),l=n.parent().find("span").index(n),d=this.viewDate.getUTCDate(),this.viewDate.setUTCMonth(l),this.element.trigger({type:"changeMonth",date:this.viewDate}),this.viewSelect>=3&&this._setDate(e(o,l,d,h,c,u,0))):n.is(".year")?(this.viewDate.setUTCDate(1),o=parseInt(n.text(),10)||0,this.viewDate.setUTCFullYear(o),this.element.trigger({type:"changeYear",date:this.viewDate}),this.viewSelect>=4&&this._setDate(e(o,l,d,h,c,u,0))):n.is(".hour")?(h=parseInt(n.text(),10)||0,(n.hasClass("hour_am")||n.hasClass("hour_pm"))&&(12==h&&n.hasClass("hour_am")?h=0:12!=h&&n.hasClass("hour_pm")&&(h+=12)),this.viewDate.setUTCHours(h),this.element.trigger({type:"changeHour",date:this.viewDate}),this.viewSelect>=1&&this._setDate(e(o,l,d,h,c,u,0))):n.is(".minute")&&(c=parseInt(n.text().substr(n.text().indexOf(":")+1),10)||0,this.viewDate.setUTCMinutes(c),this.element.trigger({type:"changeMinute",date:this.viewDate}),this.viewSelect>=0&&this._setDate(e(o,l,d,h,c,u,0))),0!=this.viewMode){var p=this.viewMode;this.showMode(-1),this.fill(),p==this.viewMode&&this.autoclose&&this.hide()}else this.fill(),this.autoclose&&this.hide()}break;case"td":if(n.is(".day")&&!n.is(".disabled")){d=parseInt(n.text(),10)||1,o=this.viewDate.getUTCFullYear(),l=this.viewDate.getUTCMonth(),h=this.viewDate.getUTCHours(),c=this.viewDate.getUTCMinutes(),u=this.viewDate.getUTCSeconds();n.is(".old")?0===l?(l=11,o-=1):l-=1:n.is(".new")&&(11==l?(l=0,o+=1):l+=1),this.viewDate.setUTCFullYear(o),this.viewDate.setUTCMonth(l,d),this.element.trigger({type:"changeDay",date:this.viewDate}),this.viewSelect>=2&&this._setDate(e(o,l,d,h,c,u,0))}p=this.viewMode;this.showMode(-1),this.fill(),p==this.viewMode&&this.autoclose&&this.hide()}}},_setDate:function(t,e){e&&"date"!=e||(this.date=t),e&&"view"!=e||(this.viewDate=t),this.fill(),this.setValue();var i;this.isInput?i=this.element:this.component&&(i=this.element.find("input")),i&&(i.change(),this.autoclose),this.element.trigger({type:"changeDate",date:this.date})},moveMinute:function(t,e){if(!e)return t;var i=new Date(t.valueOf());return i.setUTCMinutes(i.getUTCMinutes()+e*this.minuteStep),i},moveHour:function(t,e){if(!e)return t;var i=new Date(t.valueOf());return i.setUTCHours(i.getUTCHours()+e),i},moveDate:function(t,e){if(!e)return t;var i=new Date(t.valueOf());return i.setUTCDate(i.getUTCDate()+e),i},moveMonth:function(t,e){if(!e)return t;var i,n,a=new Date(t.valueOf()),r=a.getUTCDate(),s=a.getUTCMonth(),o=Math.abs(e);if(e=e>0?1:-1,1==o)n=-1==e?function(){return a.getUTCMonth()==s}:function(){return a.getUTCMonth()!=i},i=s+e,a.setUTCMonth(i),(i<0||i>11)&&(i=(i+12)%12);else{for(var l=0;l<o;l++)a=this.moveMonth(a,e);i=a.getUTCMonth(),a.setUTCDate(r),n=function(){return i!=a.getUTCMonth()}}for(;n();)a.setUTCDate(--r),a.setUTCMonth(i);return a},moveYear:function(t,e){return this.moveMonth(t,12*e)},dateWithinRange:function(t){return t>=this.startDate&&t<=this.endDate},keydown:function(t){if(this.picker.is(":not(:visible)"))27==t.keyCode&&this.show();else{var e,i,n,a=!1;switch(t.keyCode){case 27:this.hide(),t.preventDefault();break;case 37:case 39:if(!this.keyboardNavigation)break;e=37==t.keyCode?-1:1,viewMode=this.viewMode,t.ctrlKey?viewMode+=2:t.shiftKey&&(viewMode+=1),4==viewMode?(i=this.moveYear(this.date,e),n=this.moveYear(this.viewDate,e)):3==viewMode?(i=this.moveMonth(this.date,e),n=this.moveMonth(this.viewDate,e)):2==viewMode?(i=this.moveDate(this.date,e),n=this.moveDate(this.viewDate,e)):1==viewMode?(i=this.moveHour(this.date,e),n=this.moveHour(this.viewDate,e)):0==viewMode&&(i=this.moveMinute(this.date,e),n=this.moveMinute(this.viewDate,e)),this.dateWithinRange(i)&&(this.date=i,this.viewDate=n,this.setValue(),this.update(),t.preventDefault(),a=!0);break;case 38:case 40:if(!this.keyboardNavigation)break;e=38==t.keyCode?-1:1,viewMode=this.viewMode,t.ctrlKey?viewMode+=2:t.shiftKey&&(viewMode+=1),4==viewMode?(i=this.moveYear(this.date,e),n=this.moveYear(this.viewDate,e)):3==viewMode?(i=this.moveMonth(this.date,e),n=this.moveMonth(this.viewDate,e)):2==viewMode?(i=this.moveDate(this.date,7*e),n=this.moveDate(this.viewDate,7*e)):1==viewMode?this.showMeridian?(i=this.moveHour(this.date,6*e),n=this.moveHour(this.viewDate,6*e)):(i=this.moveHour(this.date,4*e),n=this.moveHour(this.viewDate,4*e)):0==viewMode&&(i=this.moveMinute(this.date,4*e),n=this.moveMinute(this.viewDate,4*e)),this.dateWithinRange(i)&&(this.date=i,this.viewDate=n,this.setValue(),this.update(),t.preventDefault(),a=!0);break;case 13:if(0!=this.viewMode){var r=this.viewMode;this.showMode(-1),this.fill(),r==this.viewMode&&this.autoclose&&this.hide()}else this.fill(),this.autoclose&&this.hide();t.preventDefault();break;case 9:this.hide()}if(a){var s;this.isInput?s=this.element:this.component&&(s=this.element.find("input")),s&&s.change(),this.element.trigger({type:"changeDate",date:this.date})}}},showMode:function(t){if(t){var e=Math.max(0,Math.min(a.modes.length-1,this.viewMode+t));e>=this.minView&&e<=this.maxView&&(this.element.trigger({type:"changeMode",date:this.viewDate,oldViewMode:this.viewMode,newViewMode:e}),this.viewMode=e)}this.picker.find(">div").hide().filter(".datetimepicker-"+a.modes[this.viewMode].clsName).css("display","block"),this.updateNavArrows()},reset:function(t){this._setDate(null,"date")}},t.fn.datetimepicker=function(e){var n=Array.apply(null,arguments);return n.shift(),this.each(function(){var a=t(this),r=a.data("datetimepicker"),s="object"==typeof e&&e;r||a.data("datetimepicker",r=new i(this,t.extend({},t.fn.datetimepicker.defaults,s))),"string"==typeof e&&"function"==typeof r[e]&&r[e].apply(r,n)})},t.fn.datetimepicker.defaults={},t.fn.datetimepicker.Constructor=i;var n=t.fn.datetimepicker.dates={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],meridiem:["am","pm"],suffix:["st","nd","rd","th"],today:"Today"}},a={modes:[{clsName:"minutes",navFnc:"Hours",navStep:1},{clsName:"hours",navFnc:"Date",navStep:1},{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],isLeapYear:function(t){return t%4==0&&t%100!=0||t%400==0},getDaysInMonth:function(t,e){return[31,a.isLeapYear(t)?29:28,31,30,31,30,31,31,30,31,30,31][e]},getDefaultFormat:function(t,e){if("standard"==t)return"input"==e?"yyyy-mm-dd hh:ii":"yyyy-mm-dd hh:ii:ss";if("php"==t)return"input"==e?"Y-m-d H:i":"Y-m-d H:i:s";throw new Error("Invalid format type.")},validParts:function(t){if("standard"==t)return/hh?|HH?|p|P|ii?|ss?|dd?|DD?|mm?|MM?|yy(?:yy)?/g;if("php"==t)return/[dDjlNwzFmMnStyYaABgGhHis]/g;throw new Error("Invalid format type.")},nonpunctuation:/[^ -\/:-@\[-`{-~\t\n\rTZ]+/g,parseFormat:function(t,e){var i=t.replace(this.validParts(e),"\0").split("\0"),n=t.match(this.validParts(e));if(!i||!i.length||!n||0==n.length)throw new Error("Invalid date format.");return{separators:i,parts:n}},parseDate:function(a,r,s,o){if(a instanceof Date){var l=new Date(a.valueOf()-6e4*a.getTimezoneOffset());return l.setMilliseconds(0),l}if(/^\d{4}\-\d{1,2}\-\d{1,2}$/.test(a)&&(r=this.parseFormat("yyyy-mm-dd",o)),/^\d{4}\-\d{1,2}\-\d{1,2}[T ]\d{1,2}\:\d{1,2}$/.test(a)&&(r=this.parseFormat("yyyy-mm-dd hh:ii",o)),/^\d{4}\-\d{1,2}\-\d{1,2}[T ]\d{1,2}\:\d{1,2}\:\d{1,2}[Z]{0,1}$/.test(a)&&(r=this.parseFormat("yyyy-mm-dd hh:ii:ss",o)),/^[-+]\d+[dmwy]([\s,]+[-+]\d+[dmwy])*$/.test(a)){var d,h=/([-+]\d+)([dmwy])/,c=a.match(/([-+]\d+)([dmwy])/g);a=new Date;for(var u=0;u<c.length;u++)switch(g=h.exec(c[u]),d=parseInt(g[1]),g[2]){case"d":a.setUTCDate(a.getUTCDate()+d);break;case"m":a=i.prototype.moveMonth.call(i.prototype,a,d);break;case"w":a.setUTCDate(a.getUTCDate()+7*d);break;case"y":a=i.prototype.moveYear.call(i.prototype,a,d)}return e(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),0)}c=a&&a.match(this.nonpunctuation)||[],a=new Date(0,0,0,0,0,0,0);var p,f,g,m={},v=["hh","h","ii","i","ss","s","yyyy","yy","M","MM","m","mm","D","DD","d","dd","H","HH","p","P"],b={hh:function(t,e){return t.setUTCHours(e)},h:function(t,e){return t.setUTCHours(e)},HH:function(t,e){return t.setUTCHours(12==e?0:e)},H:function(t,e){return t.setUTCHours(12==e?0:e)},ii:function(t,e){return t.setUTCMinutes(e)},i:function(t,e){return t.setUTCMinutes(e)},ss:function(t,e){return t.setUTCSeconds(e)},s:function(t,e){return t.setUTCSeconds(e)},yyyy:function(t,e){if(e<1e4)return t.setUTCFullYear(e)},yy:function(t,e){return t.setUTCFullYear(2e3+e)},m:function(t,e){for(e-=1;e<0;)e+=12;for(e%=12,t.setUTCMonth(e);t.getUTCMonth()!=e;)t.setUTCDate(t.getUTCDate()-1);return t},d:function(t,e){return t.setUTCDate(e)},p:function(t,e){return t.setUTCHours(1==e?t.getUTCHours()+12:t.getUTCHours())}};if(b.M=b.MM=b.mm=b.m,b.dd=b.d,b.P=b.p,a=e(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds()),c.length==r.parts.length){u=0;for(var y=r.parts.length;u<y;u++){if(p=parseInt(c[u],10),g=r.parts[u],isNaN(p))switch(g){case"MM":f=t(n[s].months).filter(function(){var t=this.slice(0,c[u].length);return t==c[u].slice(0,t.length)}),p=t.inArray(f[0],n[s].months)+1;break;case"M":f=t(n[s].monthsShort).filter(function(){var t=this.slice(0,c[u].length);return t==c[u].slice(0,t.length)}),p=t.inArray(f[0],n[s].monthsShort)+1;break;case"p":case"P":p=t.inArray(c[u].toLowerCase(),n[s].meridiem)}m[g]=p}var w;for(u=0;u<v.length;u++)(w=v[u])in m&&!isNaN(m[w])&&b[w](a,m[w])}return a},formatDate:function(e,i,r,s){if(null==e)return"";var o;if("standard"==s)o={yy:e.getUTCFullYear().toString().substring(2),yyyy:e.getUTCFullYear(),m:e.getUTCMonth()+1,M:n[r].monthsShort[e.getUTCMonth()],MM:n[r].months[e.getUTCMonth()],d:e.getUTCDate(),D:n[r].daysShort[e.getUTCDay()],DD:n[r].days[e.getUTCDay()],p:2==n[r].meridiem.length?n[r].meridiem[e.getUTCHours()<12?0:1]:"",h:e.getUTCHours(),i:e.getUTCMinutes(),s:e.getUTCSeconds()},2==n[r].meridiem.length?o.H=o.h%12==0?12:o.h%12:o.H=o.h,o.HH=(o.H<10?"0":"")+o.H,o.P=o.p.toUpperCase(),o.hh=(o.h<10?"0":"")+o.h,o.ii=(o.i<10?"0":"")+o.i,o.ss=(o.s<10?"0":"")+o.s,o.dd=(o.d<10?"0":"")+o.d,o.mm=(o.m<10?"0":"")+o.m;else{if("php"!=s)throw new Error("Invalid format type.");(o={y:e.getUTCFullYear().toString().substring(2),Y:e.getUTCFullYear(),F:n[r].months[e.getUTCMonth()],M:n[r].monthsShort[e.getUTCMonth()],n:e.getUTCMonth()+1,t:a.getDaysInMonth(e.getUTCFullYear(),e.getUTCMonth()),j:e.getUTCDate(),l:n[r].days[e.getUTCDay()],D:n[r].daysShort[e.getUTCDay()],w:e.getUTCDay(),N:0==e.getUTCDay()?7:e.getUTCDay(),S:e.getUTCDate()%10<=n[r].suffix.length?n[r].suffix[e.getUTCDate()%10-1]:"",a:2==n[r].meridiem.length?n[r].meridiem[e.getUTCHours()<12?0:1]:"",g:e.getUTCHours()%12==0?12:e.getUTCHours()%12,G:e.getUTCHours(),i:e.getUTCMinutes(),s:e.getUTCSeconds()}).m=(o.n<10?"0":"")+o.n,o.d=(o.j<10?"0":"")+o.j,o.A=o.a.toString().toUpperCase(),o.h=(o.g<10?"0":"")+o.g,o.H=(o.G<10?"0":"")+o.G,o.i=(o.i<10?"0":"")+o.i,o.s=(o.s<10?"0":"")+o.s}e=[];for(var l=t.extend([],i.separators),d=0,h=i.parts.length;d<h;d++)l.length&&e.push(l.shift()),e.push(o[i.parts[d]]);return l.length&&e.push(l.shift()),e.join("")},convertViewMode:function(t){switch(t){case 4:case"decade":t=4;break;case 3:case"year":t=3;break;case 2:case"month":t=2;break;case 1:case"day":t=1;break;case 0:case"hour":t=0}return t},headTemplate:'<thead><tr><th class="prev"><i class="icon-arrow-left"/></th><th colspan="5" class="switch"></th><th class="next"><i class="icon-arrow-right"/></th></tr></thead>',headTemplateV3:'<thead><tr><th class="prev"><i class="glyphicon glyphicon-arrow-left"></i> </th><th colspan="5" class="switch"></th><th class="next"><i class="glyphicon glyphicon-arrow-right"></i> </th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>',footTemplate:'<tfoot><tr><th colspan="7" class="today"></th></tr></tfoot>'};a.template='<div class="datetimepicker"><div class="datetimepicker-minutes"><table class=" table-condensed">'+a.headTemplate+a.contTemplate+a.footTemplate+'</table></div><div class="datetimepicker-hours"><table class=" table-condensed">'+a.headTemplate+a.contTemplate+a.footTemplate+'</table></div><div class="datetimepicker-days"><table class=" table-condensed">'+a.headTemplate+"<tbody></tbody>"+a.footTemplate+'</table></div><div class="datetimepicker-months"><table class="table-condensed">'+a.headTemplate+a.contTemplate+a.footTemplate+'</table></div><div class="datetimepicker-years"><table class="table-condensed">'+a.headTemplate+a.contTemplate+a.footTemplate+"</table></div></div>",a.templateV3='<div class="datetimepicker"><div class="datetimepicker-minutes"><table class=" table-condensed">'+a.headTemplateV3+a.contTemplate+a.footTemplate+'</table></div><div class="datetimepicker-hours"><table class=" table-condensed">'+a.headTemplateV3+a.contTemplate+a.footTemplate+'</table></div><div class="datetimepicker-days"><table class=" table-condensed">'+a.headTemplateV3+"<tbody></tbody>"+a.footTemplate+'</table></div><div class="datetimepicker-months"><table class="table-condensed">'+a.headTemplateV3+a.contTemplate+a.footTemplate+'</table></div><div class="datetimepicker-years"><table class="table-condensed">'+a.headTemplateV3+a.contTemplate+a.footTemplate+"</table></div></div>",t.fn.datetimepicker.DPGlobal=a,t.fn.datetimepicker.noConflict=function(){return t.fn.datetimepicker=old,this},t(document).on("focus.datetimepicker.data-api click.datetimepicker.data-api",'[data-provide="datetimepicker"]',function(e){var i=t(this);i.data("datetimepicker")||(e.preventDefault(),i.datetimepicker("show"))}),t(function(){t('[data-provide="datetimepicker-inline"]').datetimepicker()})}(window.jQuery),define("bootstrap/bootstrap-datetimepicker",function(){}),define("app/widgets/form/app-datetime",["app/core/app-jquery","app/core/app-core",localeFile,"app/widgets/form/app-textbox","app/util/app-utils","app/core/app-options","app/widgets/drag/app-droppanel","bootstrap/bootstrap-datetimepicker"],function(t,e,i,n,a,r,s){"use strict";function o(t){var e=null,i=null;t.setting.datebegin?((e=$A("#"+t.setting.datebegin).data("datetime")).getText()&&(i=e.datetimepicker.getDate()),t.setStartDate(i)):t.setting.dateend&&((e=$A("#"+t.setting.dateend).data("datetime")).getText()&&(i=e.datetimepicker.getDate()),t.setEndDate(i))}var l=n.extend({Implements:s,initialize:function(e,i){i||(i={}),i._=t.extend({},r.appDefaults.Combo,r.appDefaults.DateTime),l.superclass.initialize.call(this,e,i);var n=this;setTimeout(function(){n._init(),n.tempStartDate&&(n.datetimepicker.setStartDate(n.tempStartDate),delete n.tempStartDate),n.tempEndDate&&(n.datetimepicker.setEndDate(n.tempEndDate),delete n.tempEndDate),n.tempValue&&(n.setValue(n.tempValue,n.tempNoTrigger),delete n.tempValue,delete n.tempNoTrigger),n.tempDate&&(n.setDate(n.tempDate),delete n.tempDate)},1)},_init:function(){this.setting.onlySelect&&this._editable(!1),this._translator(),this._setType(),this.setting._datetime=this,this.$text.datetimepicker(this.setting),this.datetimepicker=this.$text.data("datetimepicker"),this.datetimepicker._datetime=this,this.$dropPanel=this.datetimepicker.picker,this.$dropPanel.on("mousedown.datetime.api",function(t){t.stopPropagation()}),this.$dropPanel.on("click.datetime.api",t.proxy(this.focus,this)),this.setting.custom||(this.setting.custom=this.$input.getJsonAttr("custom")),this._initDateRange(),this.setting.value&&this.setValue(this.setting.value,!0),this._onPanelFadeOut()},_setType:function(){var t=this.customSetting,e=this.setting;switch(e.type){case"year":e.startView=4,e.minView=4,e.format="yyyy",e.todayBtn=!1;break;case"year-month":t.startView||(e.startView=3),e.minView=3,t.format||(e.format="yyyy-mm"),e.todayBtn=!1;break;case"month":e.startView=3,e.minView=3,e.format="mm",e.todayBtn=!1;break;case"date":t.startView||(e.startView=2),e.minView=2,t.format||(e.format="yyyy-mm-dd");break;case"datetime":t.startView||(e.startView=2),e.minView=0,t.format||(e.format="yyyy-mm-dd hh:ii");break;case"hour-minute":t.startView||(e.startView=1),e.minView=0,t.format||(e.format="hh:ii"),e.todayBtn=!1;break;case"hour":t.startView||(e.startView=1),e.minView=1,t.format||(e.format="hh"),e.todayBtn=!1;break;case"minute":t.startView||(e.startView=0),e.minView=0,t.format||(e.format="ii"),e.todayBtn=!1}},_translator:function(){var t=this.setting;null!=t.weekstart&&(t.weekStart=t.weekstart),null!=t.todaybtn&&(t.todayBtn=t.todaybtn),null!=t.todayhighlight&&(t.todayHighlight=t.todayhighlight),null!=t.startview&&(t.startView=parseFloat(t.startview)),null!=t.minview&&(t.minView=parseFloat(t.minview)),null!=t.forceparse&&(t.forceParse=t.forceparse),null!=t.minutestep&&(t.minuteStep=t.minutestep),null!=t.pickerposition&&(t.pickerPosition=t.pickerposition)},_initDateRange:function(){var e=this.setting.datebegin,i=this.setting.dateend;if(e||i){this.$rangeBtn=t('<a class="wrapper-btn wrapper-range" tabindex="-1"><i></i></a>'),this.$openBtn.addClass("wrapper-date"),this.$rangeBtn.insertBefore(this.$openBtn);var n=this.setting.custom;n&&n.onlyCustom?this.$dateRange=t('<div class="drop-panel"><ul class="date-range">'+this._getCustomRangeHtml()+"</ul></div>").appendTo(t.$appPanelContainer):this.$dateRange=t('<div class="drop-panel"><ul class="date-range"><li>昨天</li><li>上月</li><li>去年</li><li>当天</li><li>本月</li><li>本季</li><li>本年</li>'+this._getCustomRangeHtml()+"</ul></div>").appendTo(t.$appPanelContainer);var a=this;if(this.$rangeBtn.on("click.datetime.api",function(t){a.toggleDateRange()}),this.$dateRange.on("click.datetime-range.api","li",t.proxy(this._rangeClick,this)),this.$dateRange.on("click.datetime-range.api",function(t){t.stopPropagation()}),!this.setting.fadeout)return;this.$dateRange.on("mouseleave.datetime-range.api",t.proxy(this._fadeOut$DateRange,this)),this.$dateRange.on("mouseenter.datetime-range.api",t.proxy(this._fadeIn$DateRange,this)),this.$element.on("mouseout.datetime-range.api",t.proxy(this._fadeOut$DateRange,this)),this.$element.on("mouseover.datetime-range.api",t.proxy(this._fadeIn$DateRange,this))}},_fadeOut$DateRange:function(){if(this.$dateRange.is(":visible")){var t=10,e=this;this._hideTimer1=setInterval(function(){t-=1,e.$dateRange.css("opacity",.1*t),0==t&&(clearInterval(e._hideTimer1),e._hideRange(),e.$dateRange.css("opacity",1))},130)}},_fadeIn$DateRange:function(){this.$dateRange.css("opacity",1),clearInterval(this._hideTimer1)},_getCustomRangeHtml:function(){var t=this.setting.custom,e="";if(t){e+="<div/>",this.customHander=t.handle;for(var i=t.text.split(","),n=0;n<i.length;n++)e+="<li>"+i[n]+"</li>"}return e},setValue:function(e,i){if(!(e=t.trim(e)))return this.setText(""),void this._setValue("",i);var n=e,a=e,r=this.datetimepicker;if(r){var s=t.fn.datetimepicker.DPGlobal;r._setDateConvenient(e);a=n=r.getFormattedDate();if(this.setting.valueFormat){var o=s.parseFormat(this.setting.valueFormat,r.formatType);a=r.getFormattedDate(o)}}else this.tempValue=e,this.tempNoTrigger=i,i=!0;this.setText(n),this._setValue(a,i)},setDate:function(t){if(!(t instanceof Date))throw new Error("请设置日期对象");this.datetimepicker?(this.datetimepicker.viewDate=t,this.datetimepicker.setValue()):this.tempDate=t},togglePanel:function(){this._mainDivIsVisiable()?this.hidePanel():this.showPanel()},showPanel:function(){this._closeVisiblePanel(),this.datetimepicker.show(),t(document).on("mousedown.droppanel.api",t.proxy(this.hidePanel,this)),o(this)},hidePanel:function(){this.datetimepicker.hide(),t(document).off("mousedown.droppanel.api"),o(this)},toggleDateRange:function(){this.$dateRange.is(":visible")?this._hideRange():this._showRange()},_showRange:function(){this._closeVisiblePanel();var e={top:this._getDropPanelTop(this.$dateRange),left:this.$element.outerWidth()+this.$element.offset().left-this.$dateRange.outerWidth(),display:"block"};e["z-index"]=r.zindexs.droppanel++,this.$dateRange.css(e),t(document).on("click.date-range.api",t.proxy(this._hideRange,this))},_hideRange:function(){this.$dateRange.hide(),t(document).off("click.date-range.api")},_rangeClick:function(t){var e=this.setting.datebegin,i=this.setting.dateend,n=t.currentTarget.innerText,r=new Date,s=undefined;this._dateBegin||(e?(this._dateBegin=$A("#"+e).data("datetime"),this._dateEnd=this):(this._dateBegin=this,this._dateEnd=$A("#"+i).data("datetime")));var o=this.setting.custom;if(o&&o.onlyCustom)s=this.customHander(n);else switch(n){case"昨天":s={begin:r,end:new Date(r.setDate(r.getDate()-1))};break;case"上月":var l=new Date(r.setMonth(r.getMonth()-1));s=a.getMonthRange(l);break;case"去年":var d=r.getFullYear()-1;s=a.getYearRange(d);break;case"当天":s={begin:r,end:r};break;case"本月":var h=new Date(r.setMonth(r.getMonth()));s=a.getMonthRange(h);break;case"本季":s=a.getSeasonRange(r);break;case"本年":var c=r.getFullYear();s=a.getYearRange(c);break;default:s=this.customHander(n)}this._hideRange(),s.begin.setHours(8),s.end.setHours(8),this._dateBegin.setDate(s.begin),this._dateEnd&&this._dateEnd.setDate(s.end)},setStartDate:function(t,e){var i="";e?(i=t,this.setting.startDate=t):i=t||this.setting.startDate,this.datetimepicker?this.datetimepicker.setStartDate(i):this.tempStartDate=t},setEndDate:function(t,e){var i="";e?(i=t,this.setting.endDate=t):i=t||this.setting.endDate,this.datetimepicker?this.datetimepicker.setEndDate(i):this.tempEndDate=i},destroy:function(){this.$dropPanel&&this.$dropPanel.remove(),this.$dateRange&&this.$dateRange.remove(),this.$element.remove(),this.$input.removeData("datetime")}});t.fn.datetime=function(i,n){var a=undefined,r=arguments,s="datetime";return this.each(function(){var n=t(this);if(!n.is("input"))return!0;var o=e.getComponent(n,s);if("string"==typeof i)try{var d=Array.prototype.slice.call(r,1);a=e.componentMethodApply(o,i,d)}catch(h){e.throwCompMethodError(n,s,i,h)}else o?e.throwCompInitError(n,s):(o=new l(this,i),n.data(s,o))}),a},t.fn.datetimepicker.dates[i.locale]=i.datetimepicker;var d={_attachEvents:function(){this._detachEvents(),this.isInput?this._events=[[this.element,{keyup:t.proxy(this.update,this),keydown:t.proxy(this.keydown,this),blur:t.proxy(this._myblur,this)}]]:this.component&&this.hasInput?(this._events=[[this.element.find("input"),{focus:t.proxy(this.show,this),keyup:t.proxy(this.update,this),keydown:t.proxy(this.keydown,this)}],[this.component,{click:t.proxy(this.show,this)}]],this.componentReset&&this._events.push([this.componentReset,{click:t.proxy(this.reset,this)}])):this.element.is("div")?this.isInline=!0:this._events=[[this.element,{click:t.proxy(this.show,this)}]];for(var e,i,n=0;n<this._events.length;n++)e=this._events[n][0],i=this._events[n][1],e.on(i)},setValue:function(){var e=t.fn.datetimepicker.DPGlobal.formatDate(this.viewDate,this.format,this.language,this.formatType);this.isInput?(this.element.val(e),this._datetime&&this._datetime.setValue(e)):(this.component&&this.element.find("input").val(e),this.element.data("date",e)),this.linkField&&t("#"+this.linkField).val(this.getFormattedDate(this.linkFormat))},place:function(){if(!this.isInline){var t=s.prototype._isDropPanelUpside(this.element,this.picker);this.pickerPosition=t?"bottom-left":"top-left";var e,i,n,a=r.zindexs.droppanel++;this.component?(n=(e=this.component.offset()).left,"bottom-left"!=this.pickerPosition&&"top-left"!=this.pickerPosition||(n+=this.component.outerWidth()-this.picker.outerWidth())):n=(e=this.element.offset()).left,i="top-left"==this.pickerPosition||"top-right"==this.pickerPosition?e.top-this.picker.outerHeight():e.top+this.height,this.picker.css({top:i,left:n,zIndex:a})}},keydown:function(i){var n=i.keyCode;if(!this._datetime._dealSysKey(i))if(this.picker.is(":not(:visible)"))n>=48&&n<=57?this._datetime.showPanel():n>=96&&n<=105?this._datetime.showPanel():e.containKeyCode(i,this._datetime.setting.keyShowPanel)?(this._datetime.showPanel(),i.stopPropagation()):-1!=t.inArray(n,[e.keyCode.LEFT,e.keyCode.RIGHT,e.keyCode.UP,e.keyCode.DOWN])||(n==e.keyCode.DELETE||n==e.keyCode.BACKSPACE?this._datetime._isEditable()||this._datetime.clearValue():(67!=n&&86!=n||1!=i.ctrlKey)&&i.preventDefault());else{var a,r,s=!1,o="",l="";switch(n){case e.keyCode.ESC:this._setDateConvenient(),this.hide(),i.preventDefault();break;case e.keyCode.LEFT:case e.keyCode.RIGHT:if(!this.keyboardNavigation)break;a=37==n?-1:1,r=this.viewMode,i.ctrlKey?r+=2:i.shiftKey&&(r+=1),4==r?(o=this.moveYear(this.date,a),l=this.moveYear(this.viewDate,a)):3==r?(o=this.moveMonth(this.date,a),l=this.moveMonth(this.viewDate,a)):2==r?(o=this.moveDate(this.date,a),l=this.moveDate(this.viewDate,a)):1==r?(o=this.moveHour(this.date,a),l=this.moveHour(this.viewDate,a)):0==r&&(o=this.moveMinute(this.date,a),l=this.moveMinute(this.viewDate,a)),this.dateWithinRange(o)&&(this.date=o,this.viewDate=l,this.setValue(),this.update(),i.preventDefault(),s=!0),i.stopPropagation();break;case e.keyCode.UP:case e.keyCode.DOWN:if(!this.keyboardNavigation)break;a=38==n?-1:1,r=this.viewMode,i.ctrlKey?r+=2:i.shiftKey&&(r+=1),4==r?(o=this.moveYear(this.date,a),l=this.moveYear(this.viewDate,a)):3==r?(o=this.moveMonth(this.date,a),l=this.moveMonth(this.viewDate,a)):2==r?(o=this.moveDate(this.date,7*a),l=this.moveDate(this.viewDate,7*a)):1==r?this.showMeridian?(o=this.moveHour(this.date,6*a),l=this.moveHour(this.viewDate,6*a)):(o=this.moveHour(this.date,4*a),l=this.moveHour(this.viewDate,4*a)):0==r&&(o=this.moveMinute(this.date,4*a),l=this.moveMinute(this.viewDate,4*a)),this.dateWithinRange(o)&&(this.date=o,this.viewDate=l,this.setValue(),this.update(),i.preventDefault(),s=!0),i.stopPropagation();break;case e.keyCode.ENTER:if(0!=this.viewMode){var d=this.viewMode;this.showMode(-1),this.fill(),d==this.viewMode&&this.autoclose&&(this._setDateConvenient(),this.hide())}else this.fill(),this.autoclose&&(this._setDateConvenient(),this.hide());i.preventDefault(),i.stopPropagation();break;case e.keyCode.TAB:this._setDateConvenient(),this.hide()}if(s){var h=undefined;this.isInput?h=this.element:this.component&&(h=this.element.find("input")),h&&h.change(),this.element.trigger({type:"changeDate",date:this.date})}}},_myblur:function(){var t=this.element.val();if(t){var e=this._parseDate(t),i=this._parseDate(this._datetime.getValue());e&&i&&e.toString()==i.toString()||t!=this._datetime.setting.tips&&(this._setDateConvenient(t),this.setValue())}},_setDateConvenient:function(e){if(e===undefined&&(e=this.element.val()),this._datetime&&e!=t.trim(this._datetime.setting.tips)){var i=this._parseDate(e);i&&(this.date=i,this.viewDate=i)}},_parseDate:function(e){if(!(e=t.trim(e)))return null;var i=new Date;return function(t,e){e&&(e.year&&e.year<1e4&&t.setFullYear(e.year),t.setDate(1),e.month&&t.setMonth(e.month-1),e.date&&t.setDate(e.date),e.hours&&t.setHours(e.hours),e.minute&&t.setMinutes(e.minute),t.setHours(t.getHours()+8))}(i,this._specialCase(e,i.getFullYear()+"")),i},_specialCase:function(e,i){function n(t){return 1==t.length?"0"+t:t}if(!isNaN(e))return this._getDateInfos(e.substr(0,8),i);var a={},r=function(e){for(var i=[],n="",a=0;a<e.length;a++)isNaN(e[a])||" "==e[a]?t.trim(n)&&(i.push(n),n=""):n+=e[a];return i.push(n),i}(e);switch(r.length){case 1:return a;case 2:var s=parseFloat(r[0]),o=parseFloat(r[1]);if(isNaN(s)&&!isNaN(o))a.date=o;else if(!isNaN(s)&&isNaN(o))a.month=s;else if(4==r[1].length)t.extend(a,this._getDateInfos(r[0].substr(0,8),i)),a.hours=parseFloat(r[1].substr(0,2)),a.minute=parseFloat(r[1].substr(2,2));else if(e.indexOf(":")>-1)a.hours=parseFloat(r[0]),a.minute=parseFloat(r[1]);else if(4==r[0].length){var l=parseFloat(r[0].substr(0,2)),d=parseFloat(r[0].substr(2,2));o=parseFloat(r[1]);l<=12&&d<=31&&o<=24?(a.month=l,a.date=d,a.hours=o):o<=12&&(a.year=parseFloat(r[0]),a.month=o)}else a.month=parseFloat(r[0]),a.date=parseFloat(r[1]);return a;case 3:if(r[0].length<=4&&r[1].length<=2&&r[2].length<=2){var h=r[0]+n(r[1])+n(r[2]);return t.extend(a,this._getDateInfos(h,i)),a}case 4:if(r[0].length<=4&&r[1].length<=2&&r[2].length<=2){h=r[0]+n(r[1])+n(r[2]);return t.extend(a,this._getDateInfos(h,i)),r[3].length<=2?a.hours=parseFloat(r[3]):(a.hours=parseFloat(r[3].substr(0,2)),a.minute=parseFloat(r[3].substr(2,2))),a}default:if(r[0].length<=4&&r[1].length<=2&&r[2].length<=2){h=r[0]+n(r[1])+n(r[2]);return t.extend(a,this._getDateInfos(h,i)),a.hours=parseFloat(r[3]),a.minute=parseFloat(r[4]),a}}},_getDateInfos:function(t,e){var i=this._datetime.setting.format;if("i"==i||"ii"==i)return{minute:parseFloat(t)};if("h"==i||"hh"==i)return{hours:parseFloat(t)};if("dd"==i||"d"==i)return{date:parseFloat(t)};if("m"==i||"mm"==i)return{month:parseFloat(t)};if("yyyy"==i){var n=0,a=t.length;return n=a<=4?parseFloat(e.substr(0,4-a)+t):parseFloat(t.substr(0,4)),{year:n}}var r={},s=this._datetime.setting.minView;switch(t.length){case 1:case 2:var o=parseFloat(t);return 3==s?r.month=o:r.date=o,r;case 3:return 3==s?(r.year=parseFloat(e.substr(0,3)+t.substr(0,1)),r.month=parseFloat(t.substr(1,2))):(r.month=parseFloat(t.substr(0,1)),r.date=parseFloat(t.substr(1,2))),r;case 4:if(parseFloat(t.substr(0,2))>12)r.year=parseFloat(t);else{var l=parseFloat(t.substr(0,2)),d=parseFloat(t.substr(2,2));l<=12&&(r.month=l),d<=31&&(r.date=d)}return r;case 5:return r.year=parseFloat(t.substr(0,4)),r.month=parseFloat(t.substr(4,1)),r;case 6:return r.year=parseFloat(t.substr(0,4)),r.month=parseFloat(t.substr(4,2)),r;case 7:return r.year=parseFloat(t.substr(0,4)),r.month=parseFloat(t.substr(4,2)),r.date=parseFloat(t.substr(6,1)),r;default:return r.year=parseFloat(t.substr(0,4)),r.month=parseFloat(t.substr(4,2)),r.date=parseFloat(t.substr(6,2)),r}}};return t.extend(t.fn.datetimepicker.Constructor.prototype,d),l}),define("app/widgets/grid/app-grid-headerContextMenu",["app/core/app-class","app/core/app-jquery","app/core/app-options","app/core/app-core","jquery/jquery.ztree"],function(t,e,i,n){"use strict";function a(t){if(!t._contextMenuZtree){for(var i=t.getColumnTree(),n=t.$headerContextMenu.find(">div>ul"),a=[],l=0;l<i.length;l++)r(i[l],a);e.fn.zTree.init(n,function(t){t.setting;return{view:{selectedMulti:!1,dblClickExpand:!0,showLine:!0,showIcon:!1},data:{key:{name:"name"},simpleData:{enable:!0,idKey:"id",pIdKey:"parent",rootPId:""}},check:{enable:!0},callback:{onClick:function(e,i,n){t._contextMenuZtree.checkNode(n,!n.checked,!0,!0)},onCheck:function(e,i,n){n.checked?s(n.id,t):o(n.id,t)},beforeCheck:function(i,n){var a=n.level,r=t._contextMenuZtree.getNodesByFilter(function(t){return t.level==a&&"main"==t.viewPos&&t.checked});if("main"==n.viewPos&&1==r.length&&n.checked){var s=e("#"+n.tId+"_a")[0].getBoundingClientRect();return t.$headerContextMsg.css({left:s.left+s.width,top:s.top}),t.$headerContextMsg.show(),setTimeout(function(){t.$headerContextMsg.hide(500)},2e3),!1}return!0}}}}(t),a),t._contextMenuZtree=e.fn.zTree.getZTreeObj(n.attr("id"))}}function r(t,e){if(!t.sysCol&&t.showTree){var i={};i.chkDisabled=t.lockTree,i.checked=!t.hidden,i.id=t._cid,t.parentColumn&&(i.parent=t.parentColumn._cid),i.name=t.title,i.open=!0,i.viewPos=t.viewPos,e.push(i);var n=t.children;if(n)for(var a=0;a<n.length;a++)r(n[a],e)}}function s(t,e){var i=e._column[t];if(i.children)for(var n=i.children,a=0;a<n.length;a++){var r=n[a];r.children?s(r._cid,e):e.showColumn(r.field)}else e.showColumn(i.field)}function o(t,e){var i=e._column[t];if(i.children)for(var n=i.children,a=0;a<n.length;a++){var r=n[a];r.children?o(r._cid,e):e.hideColumn(r.field)}else e.hideColumn(i.field)}return t.create({_initContextMenu:function(){if(this.setting.columnManager){var t=e('<div class="grid-column-tree" oncontextmenu="return false"><div><ul id="'+n.uuid("app_ztree_")+'" class="ztree"></ul></div></div>').appendTo(e.$appPanelContainer),r=e('<div class="grid-tree-msg">主视图区域至少保留一个列</div>').appendTo(e.$appPanelContainer);this.$headerContextMenu=t,this.$headerContextMsg=r;var s=this;this.$tableHeader.on("mouseup.grid.api",">div,td",function(e){if(2===e.button){var n={left:(e.pageX||e.screenX)-1,top:(e.pageY||e.screenY)-1,"z-index":i.zindexs.droppanel++,display:"block"};t.css(n),a(s)}}),this.$headerContextMenu.on("mouseleave.grid-context-menu.api",function(e){var i=10;t.hideTimer=setInterval(function(){i-=1,t.css("opacity",.1*i),0==i&&(t.hide(),clearInterval(t.hideTimer))},130)}),this.$headerContextMenu.on("mouseenter.grid-context-menu.api",function(e){clearInterval(t.hideTimer),t.css("opacity",1)})}}})}),define("app/widgets/grid/app-grid-editor",["app/core/app-class","app/core/app-jquery","app/core/app-options","app/core/app-core"],function(t,e,i,n){"use strict";return t.create({_initEditor:function(){var t=this.setting,i=[],n=this.editor,a=this;this._gatherViewEditor(t.frozenColumns),this._gatherViewEditor(t.frozenColumnsRight),this._gatherViewEditor(t.columns);for(var r in n){var s="app/widgets/form/app-"+n[r].type;-1==e.inArray(s,i)&&i.push(s)}require(i,function(){for(var t in n){var e=n[t];e.$editor[e.type](e.options),e.editor=e.$editor.data(e.type)}a._linkEditor()}),this._registEditorEvent()},_gatherViewEditor:function(t){for(var e=0;e<t.length;e++)for(var i=0;i<t[e].length;i++){var n=t[e][i],a=n.editor;a&&(this._initEditorOptions(a,n),this.$rowEditor.append(a.$editor),this.editor[n.field]=a,this.setting.hasEditor=!0)}},_initEditorOptions:function(t,i){t.$editor=e("<input/>"),t.column=i,t.type||(t.type="textbox"),t.options||(t.options={}),"combobox"!=t.type||t.options.panelwidth||(t.options.panelwidth="100%");var n=this;t.options.editorField=i.field,t.options.onFocus=function(){var t=this.setting.editorField,e=n.$tableHeaderMain.find("[field="+t+"]");if(0!=e.length){var i=n.$tableHeaderMain.outerWidth()+3,a=n.$tableHeaderMain.scrollLeft(),r=e.offset().left-n.$tableHeaderMain.offset().left+a,s=r+e.outerWidth();r<=a?n.$xProxyScroll.scrollLeft(r):s>=a+i&&n.$xProxyScroll.scrollLeft(s-i)}},this.setting.editorDelBtn&&(t.options.onMouseOver=function(){if(this.$proxyDelBtn==undefined){var t=this;this.$proxyDelBtn=e('<span class="proxy-delete-btn"><i></i></span>'),this.$proxyDelBtn.on("mouseup",function(e){t.clearValue(),e.stopPropagation()}),this.$proxyDelBtn.on("mouseover",function(t){e(this).show()}),this.$proxyDelBtn.on("mouseout",function(t){e(this).hide()}),this.$proxyDelBtn.appendTo(n.$absoluteComp)}if(this.getValue()||this.getText()){var i=this.$element.position();i.left+=this.$element.outerWidth(),this.$proxyDelBtn.css(i),this.$proxyDelBtn.show()}},t.options.onMouseOut=function(){this.$proxyDelBtn&&this.$proxyDelBtn.hide()})},_linkEditor:function(){function t(t){t.lastEditor._next=t.firstEditor,t.firstEditor._prev=t.lastEditor}if(this.setting.hasEditor){var e=this._linkEditorForView(this.frozenColumns),i=this._linkEditorForView(this.columns),n=this._linkEditorForView(this.frozenColumnsRight);(e||i||n)&&(!e||i||n?!i||e||n?!n||e||i?(e&&i&&(e.lastEditor._next=i.firstEditor,i.firstEditor._prev=e.lastEditor),i&&n&&(i.lastEditor._next=n.firstEditor,n.firstEditor._prev=i.lastEditor),e&&n?(e.firstEditor._next=n.lastEditor,n.lastEditor._prev=e.firstEditor):e&&i?(e.firstEditor._prev=i.lastEditor,i.lastEditor._next=e.firstEditor):i&&n&&(i.firstEditor._prev=n.lastEditor,n.lastEditor._next=i.firstEditor)):t(n):t(i):t(e))}},_linkEditorForView:function(t){for(var e=null,i=null,n=0;n<t.length;n++){var a=t[n].editor;if(a){var r=this._getNextEditor(t,n+1);r&&(a._next=r,r._prev=a),null==e&&(e=a),i=a}}return e?{firstEditor:e,lastEditor:i}:null},_getNextEditor:function(t,e){for(var i=null,n=e;n<t.length&&!(i=t[n].editor);n++);return i},_registEditorEvent:function(){this.setting._hasOperator&&(this.$tableHeader.on("click.grid.operator.api","td>div>.rowBtn",e.proxy(this._onRowOperatorBtnClick,this)),this.$tableBody.on("click.grid.operator.api","td>div>.rowBtn",e.proxy(this._onRowOperatorBtnClick,this))),this.setting.hasEditor&&(this.$tableBody.on("click.grid-edit.api","td",e.proxy(this._onAutoBeginEdit,this)),this.$element.on("mouseup.grid-edit.api",e.proxy(this._onAutoEndEdit,this)),this.$tableBody.on("keydown.grid-edit.api","td",e.proxy(this._onTdKeyDown,this)))},_onAutoBeginEdit:function(t){if("A"!=t.target.tagName){var i=e(t.currentTarget),n=i.parent().index();if(this.setting.autoBeginEdit){this.beginEdit(n);var a=i.attr("field"),r=this.editor[a];r&&r.editor.focus()}}},_onAutoEndEdit:function(t){if(!(e(t.target).closest(".grid-body-content").length>0)&&this.setting.autoEndEdit&&this._currentEditRowId){var i=this._convertRowIdToRowIndex(this._currentEditRowId);this.endEdit(i)}},_onTdKeyDown:function(t){var e=this.setting;n.containKeyCode(t,e.keyLeftEditor)?this._keyLeftEditor(t):n.containKeyCode(t,e.keyRightEditor)?this._keyRightEditor(t):n.containKeyCode(t,e.keyUpEditor)?this._keyUpEditor(t):n.containKeyCode(t,e.keyDownEditor)&&this._keyDownEditor(t),e.keySpecEnabled&&(n.containKeyCode(t,e.keyPrevEditor)?this._keyPrevEditor(t):n.containKeyCode(t,e.keyNextEditor)?this._keyNextEditor(t):n.containKeyCode(t,e.keyAppendRow)?this._keyAppendRow(t):n.containKeyCode(t,e.keyDeleteRow)&&this._keyDeleteRow(t))},_editorBlur:function(t,e){t.editor.blur(e)},_editorFocus:function(t){setTimeout(function(){t.editor.isActive()||t.editor.focus()},0)},_keyLeftEditor:function(t){var i=this.editor[e(t.currentTarget).attr("field")],n=this;this._editorBlur(i,function(){for(var t=i._prev;t.editor.isReadonly()||!t.editor.isEnabled()||!n.columnIsVisible(t.column.field);)t=t._prev;n._editorFocus(t)}),t.preventDefault()},_keyRightEditor:function(t){var i=this.editor[e(t.currentTarget).attr("field")],n=this;this._editorBlur(i,function(){for(var t=i._next;t.editor.isReadonly()||!t.editor.isEnabled()||!n.columnIsVisible(t.column.field);)t=t._next;n._editorFocus(t)}),t.preventDefault()},_keyUpEditor:function(t){var i=this.editor[e(t.currentTarget).attr("field")],n=this.getCurrentEditRowIndex(),a=this._getPrevVisibleRowIndex(n),r=this;this._editorBlur(i,function(){r.beginEdit(a),r.locateRow(r._currentEditRowId),r._editorFocus(i)}),t.preventDefault()},_keyDownEditor:function(t){var i=this.editor[e(t.currentTarget).attr("field")],n=this.getCurrentEditRowIndex(),a=this._getNextVisibleRowIndex(n),r=this;this._editorBlur(i,function(){r.beginEdit(a),r.locateRow(r._currentEditRowId),r._editorFocus(i)}),t.preventDefault()},_keyNextEditor:function(t){var i=this.editor[e(t.currentTarget).attr("field")],n=this;this._editorBlur(i,function(){if(n._isLastEditor(i)){var e=n.getCurrentEditRowIndex(),a=n.$tableBodyMain.find("tr").length;if(e==a-1)n.appendRow(),n.beginEdit(a);else{var r=n._getNextVisibleRowIndex(e);n.beginEdit(r)}}n._keyRightEditor(t)})},_keyPrevEditor:function(t){var i=this.editor[e(t.currentTarget).attr("field")],n=this;this._editorBlur(i,function(){if(n._isFirstEditor(i)){var e=n.getCurrentEditRowIndex(),a=n._getPrevVisibleRowIndex(e);n.beginEdit(a)}n._keyLeftEditor(t)})},_keyAppendRow:function(t){var i=this.editor[e(t.currentTarget).attr("field")],n=this;this._editorBlur(i,function(){var t=n.$tableBodyMain.find("tr").length;n.appendRow(),n.beginEdit(t),n._editorFocus(i)}),t.preventDefault()},_keyDeleteRow:function(t){var i=this.editor[e(t.currentTarget).attr("field")],n=this.getCurrentEditRowIndex(),a=-1,r=this;this._editorBlur(i,function(){a=r.setting.markChange?r._getNextVisibleRowIndex(n):r._isLastEditorRow(n)?r._getPrevVisibleRowIndex(n):r._getNextVisibleRowIndex(n),r.beginEdit(a),r.deleteRow(n),r._editorFocus(i)}),t.preventDefault()},_getNextVisibleRowIndex:function(t){for(var e=t+1,i=this.$tableBodyMain.find("tr").length;e!=i;){if(1==this.$tableBodyMain.find("tr:eq("+e+"):visible").length)break;e++}if(e==i)for(e=0;e!=t;){if(1==this.$tableBodyMain.find("tr:eq("+e+"):visible").length)break;e++}return e},_getPrevVisibleRowIndex:function(t){for(var e=t-1,i=this.$tableBodyMain.find("tr").length;-1!=e;){if(1==this.$tableBodyMain.find("tr:eq("+e+"):visible").length)break;e--}if(-1==e)for(e=i;e!=t;){if(1==this.$tableBodyMain.find("tr:eq("+e+"):visible").length)break;e--}return e},_isLastEditor:function(t){var e=this.$tableBody.find(".app-wrapper:not(.wrapper-disabled):not(.wrapper-readonly):last");return!!t.editor.$element.is(e)},_isFirstEditor:function(t){var e=this.$tableBody.find(".app-wrapper:not(.wrapper-disabled):not(.wrapper-readonly):first");return!!t.editor.$element.is(e)},_isLastEditorRow:function(t){return this.$tableBodyMain.find("tr:visible:last").index()==t},_convertRowIndexToRowId:function(t){return isNaN(t)?t:this.$tableBodyMain.find("tr:eq("+t+")").attr("id")},_convertRowIdToRowIndex:function(t){return isNaN(t)?this.$tableBodyMain.find("tr#"+t).index():t},beginEdit:function(t){if(0!=this.setting.editable){var i=this._convertRowIndexToRowId(t);if(i!=undefined&&i!=this._currentEditRowId){var n=this._getRowExpr(i),a=this.$tableBody.find(n),r=this._rowData[i],s=this._getUpdateRowForBegin(i,r);if(s&&(null==this._currentEditRowId||1==this.endEdit(this._currentEditRowId))&&(this._resetEditorValue(),!1!==this.trigger("beforeBeginEdit",s,t))){this._currentEditRowId=i;for(var o=0;o<a.length;o++)for(var l=e(a[o]).find(">td"),d=0;d<l.length;d++)this._cellIntoEdit(e(l[d]),s);(function(t){var e=this.editor;for(var i in e)e[i].hasSet||(e[i].hasSet=!0,e[i].editor.setValue(t[i],!0))}).call(this,s),this._fixXProxyScroll(),this.$tableBodyMain.find(n).addClass("currEdit"),this.trigger("onBeginEdit",s,t)}}}},_getUpdateRowForBegin:function(t,e){if(i=this._newData.updated[t])return i;var i;return(i=this._newData.inserted[t])||e},_cellIntoEdit:function(t,i){var n=this._column[t.attr("_cid")],a=n.field,r=this.editor[a];if(n&&r){var s=r.editor,o=t.find(">div:first-child");o.css("display","none"),t.css("width",o.outerWidth());var l=e.trim(t.text()),d=i[a];if(s.setValue(d,!0),s.setText(l),r.hasSet=!0,e.isFunction(s.setSelectedNode)&&d){var h={};e.isFunction(s.setting.createNode)?h=s.setting.createNode(i,l):(h[s.setting.valuefield]=d,h[s.setting.textfield]=l),s.setSelectedNode(h,!0)}t.append(s.$element)}},endEdit:function(t){if(e(document).trigger("mousedown.droppanel.api"),0!=this.setting.editable){var i;if(t===undefined){if(null==this._currentEditRowId)return;i=this._currentEditRowId}else if((i=this._convertRowIndexToRowId(t))!=this._currentEditRowId)return;var n=this._getRowExpr(i);if(this.$tableBodyMain.find(n).hasClass("currEdit")&&!1!==this._beforeEndEdit(i)){var a={$trs:this.$tableBody.find(this._getRowExpr(i))},r=this._rowData[i],s=!0;return a.oriRowData=r,a.newRowData=this._getUpdateRowForEnd(i,r),r?(this._endEditOri(a),a.realChange||(this._cancelUpdateRow(i),s=!1)):this._endEditNew(a),this._restoreEditor(),this.trigger("onDataChange"),this.$tableBodyMain.find(n).removeClass("currEdit"),s&&this._onEndEdit(t,r,a.newRowData),this._currentEditRowId=null,e(document).off("mousedown.grid-edit.api"),!0}}},_beforeEndEdit:function(t){var e=this._convertRowIdToRowIndex(t),i=this._rowData[t];return i||(i=this._newData[t]),this.trigger("beforeEndEdit",i,e)},_onEndEdit:function(t,e,i){this.trigger("onEndEdit",e,i,t)},_resetEditorValue:function(){var t=this.editor;for(var e in t){var i=t[e].editor;i.setValue("",!0),i.setText(""),t[e].hasSet=!1,i.setSelectedNode&&i.setSelectedNode(null,!0)}},_restoreEditor:function(){var t=this.editor;for(var e in t)if(t[e].editor){var i=t[e].editor.$element;i.parent().css("width","auto"),this.$rowEditor.append(i)}},_getUpdateRowForEnd:function(t,i){var n=this._newData.updated[t];return n||(n=i?this._newData.updated[t]=e.extend({},i):this._newData.inserted[t]),n},_endEditOri:function(t){t.$trs;var e=this;t.realChange=!1,t.callback=function(t){t.newRowData[t.col.field]=t.value,t.value!=t.oriRowData[t.col.field]&&(e._markEditDisplay(t.$td),t.realChange=!0)},this._cellApplyEdit(t)},_endEditNew:function(t){t.$trs;t.callback=function(t){t.newRowData[t.col.field]=t.value},this._cellApplyEdit(t)},_markEditDisplay:function(t){this.setting.markChange&&t.addClass("updated")},_cellApplyEdit:function(t){var e=this.editor;for(var i in e){var n=e[i],a=n.editor.getText(),r=n.editor.getValue(),s=t.$trs.find("td[_cid="+n.column._cid+"]");if(1==s.length){var o=s.find(">div:first-child");o.text(a),o.css("display","block"),t.$td=s}t.col=n.column,t.value=r,t.callback&&t.callback(t)}},cancelEdit:function(t){if(0!=this.setting.editable){var e=this._convertRowIndexToRowId(t);e==this._currentEditRowId&&(this._restoreEditor(),this._currentEditRowId=null),this._cancelUpdateRow(e),this._cancelEditDisplay(e)}},_cancelEditDisplay:function(t){var e=this._rowData[t];e||(e=this._newData.inserted[t]),this._applyRowEditDisplay(t,e),this.$tableBodyMain.find(this._getRowExpr(t)).removeClass("currEdit")},_applyRowEditDisplay:function(t,i){for(var n=this._getRowExpr(t),a=this.$tableBody.find(n),r=this._convertRowIdToRowIndex(t),s=0;s<a.length;s++)for(var o=e(a[s]).find(">td"),l=0;l<o.length;l++)this._applyCellEditDisplay(e(o[l]),i,r)},_applyCellEditDisplay:function(t,e,i){var n=this._column[t.attr("_cid")],a=this.editor[n.field];if(n&&a){var r=t.find(">div:first-child"),s=this._getFormatText(n,e,i);r.text(s),r.css("display","block"),this._unmarkEditDisplay(t)}},_unmarkEditDisplay:function(t){this.setting.markChange&&t.removeClass("updated")},_cancelUpdateRow:function(t){delete this._newData.updated[t]},getEditor:function(t){return this.editor[t].$editor},enableEdit:function(){this.setting.editable=!0},disableEdit:function(){this.setting.editable=!1},getEditable:function(){return this.setting.editable},toggleEdit:function(){0==this.setting.editable?this.setting.editable=!0:this.setting.editable=!1},_insertRow:function(t,e){this._newData.inserted[t]=e,this.trigger("onDataChange")},deleteRow:function(t){if(0!=this.setting.editable){var e=this._convertRowIndexToRowId(t);this._deleteRow(e),this._toggleMessage()}},_markDeleteDisplay:function(t){this.setting.markChange?(this.$tableBodyLeft.find(t).addClass("deleted"),this.$tableBodyMain.find(t).addClass("deleted"),this.$tableBodyRight.find(t).addClass("deleted")):(this.$tableBodyLeft.find(t).hide(),this.$tableBodyMain.find(t).hide(),this.$tableBodyRight.find(t).hide())},_deleteRow:function(t){this._rowData[t]?this._newData.deleted[t]=this._rowData[t]:this._cancleInsertRow[t],this._deleteRowDisplay(t),this.trigger("onDataChange")},_deleteRowDisplay:function(t){var e=this._getRowExpr(t);null!=this._newData.inserted[t]?(t==this._currentEditRowId&&this._restoreEditor(),this.$tableBodyLeft.find(e).remove(),this.$tableBodyMain.find(e).remove(),this.$tableBodyRight.find(e).remove(),this._footerFollow(),this._fixYProxyScrollHeight()):this._markDeleteDisplay(e),t==this._currentEditRowId&&delete this._currentEditRowId,this._reOrderNumber(),this._pagerDeleteRow()},_cancleInsertRow:function(t){delete this._newData.inserted[t]},cancelDelete:function(t){var e=this._convertRowIndexToRowId(t);this._unmarkDeleteDisplay(e),this._cancelDeleteRow(e)},_unmarkDeleteDisplay:function(t){var e=this._getRowExpr(t);this.setting.markChange?(this.$tableBodyLeft.find(e).removeClass("deleted"),this.$tableBodyMain.find(e).removeClass("deleted"),this.$tableBodyRight.find(e).removeClass("deleted")):(this.$tableBodyLeft.find(e).show(),this.$tableBodyMain.find(e).show(),this.$tableBodyRight.find(e).show())},_cancelDeleteRow:function(t){delete this._newData.deleted[t]},acceptChanges:function(){var t=this.getChanges(),e=t.deleted,i=t.inserted,n=t.updated;if(e)for(var a in e){var r=this._convertRowIdToRowIndex(a);this.acceptChange(r)}if(i)for(var a in i){r=this._convertRowIdToRowIndex(a);this.acceptChange(r)}if(n)for(var a in n){r=this._convertRowIdToRowIndex(a);this.acceptChange(r)}},getChanges:function(t){return t?e.extend({},this._newData[t]):e.extend({},this._newData)},acceptChange:function(t){var e=this.getChange(t);if(e)switch(e.type){case"updated":this._acceptUpdated(t,e.data);break;case"inserted":this._acceptInserted(t,e.data);break;case"deleted":this._acceptDeleted(t,e.data)}},getChange:function(t){var i=this._convertRowIndexToRowId(t);i==this._currentEditRowId&&this.endEdit(i);var n=this._newData.deleted[i],a={};return n?(a.type="deleted",a.data=e.extend({},n),a):(n=this._newData.updated[i])?(a.type="updated",a.data=e.extend({},n),a):(n=this._newData.inserted[i])?(a.type="inserted",a.data=e.extend({},n),a):a},_acceptUpdated:function(t,i){var n=this._convertRowIndexToRowId(t);e.extend(this._rowData[n],i),this._applyRowEditDisplay(n,i),this._cancelUpdateRow(n)},_acceptInserted:function(t,e){var i=this._convertRowIndexToRowId(t);0==t?this.getRows().unshift(e):this.getRows()[t]=e,this._rowData[i]=e,this._cancleInsertRow(i),this._acceptInsertDisplay(i)},_acceptInsertDisplay:function(t){if(this.setting.markChange){var e=this._getRowExpr(t);this.$tableBody.find(e).removeClass("inserted")}},_acceptDeleted:function(t,e){var i=this._convertRowIndexToRowId(t);this.getRows().splice(t,1),delete this._rowData[i],this._cancelDeleteRow(i),this._cancelUpdateRow(i),this._acceptDeletedDisplay(i)},_acceptDeletedDisplay:function(t){var e=this._getRowExpr(t);this.$tableBody.find(e).remove(),this._reOrderNumber(),this._footerFollow(),this._fixYProxyScrollHeight()},setCellInvalid:function(t){var e=this._findTdByInfo(t);e.addClass("invalid"),this._initInvalidMsg(e,t.msg)},_findTdByInfo:function(t){var e=this.$tableBodyMain.find("tr:eq("+t.rowIndex+') td[field="'+t.field+'"]');return 0==e.length&&0==(e=this.$tableBodyLeft.find("tr:eq("+t.rowIndex+') td[field="'+t.field+'"]')).length&&(e=this.$tableBodyRight.find("tr:eq("+t.rowIndex+') td[field="'+t.field+'"]')),e},setCellValid:function(t){var e=this._findTdByInfo(t);e.removeClass("invalid"),this._hideInvalidMsg(e)},_hideInvalidMsg:function(t){if(1==t.length){var i=t.data("invalidMsg");i&&i.hide()}else t.each(function(){var t=e(this).data("invalidMsg");t&&t.hide()})},setRowInvalid:function(t){var e=t.rowIndex,i=this.$tableBodyLeft.find("tr:eq("+e+")"),n=this.$tableBodyMain.find("tr:eq("+e+")"),a=this.$tableBodyRight.find("tr:eq("+e+")");i.addClass("invalid"),n.addClass("invalid"),a.addClass("invalid"),this._initInvalidMsg(n,t.msg),i.data("invalidMsg",n.data("invalidMsg")),a.data("invalidMsg",n.data("invalidMsg"))},setRowValid:function(t){var e=t;isNaN(t)&&(e=t.rowIndex);var i=this.$tableBodyLeft.find("tr:eq("+e+")"),n=this.$tableBodyMain.find("tr:eq("+e+")"),a=this.$tableBodyRight.find("tr:eq("+e+")"),r=this.$tableBodyLeft.find("tr:eq("+e+")>td.invalid"),s=this.$tableBodyMain.find("tr:eq("+e+")>td.invalid"),o=this.$tableBodyRight.find("tr:eq("+e+")>td.invalid");i.removeClass("invalid"),n.removeClass("invalid"),a.removeClass("invalid"),r.removeClass("invalid"),s.removeClass("invalid"),o.removeClass("invalid"),this._hideInvalidMsg(n),this._hideInvalidMsg(r),this._hideInvalidMsg(s),this._hideInvalidMsg(o)},clearAllInvalid:function(){this.$tableBody.find("tr.invalid").removeClass("invalid"),this.$tableBody.find("td.invalid").removeClass("invalid"),this.$absoluteComp.find(">div").hide()},_initInvalidMsg:function(t,i){var n=t.data("invalidMsg");n?(n.find(">div>span").html(i),n.show()):(n=e('<div class="errorWrapper"><div><span>'+i+"</span><div></div></div></div>"),this.$absoluteComp.append(n),this._initInvalidMsgCss(t,n),t.data("invalidMsg",n))},_initInvalidMsgCss:function(t,e){var i=t.position(),n={display:"block",left:i.left,top:i.top-42};e.css(n),this.$element.offset().top>e.offset().top?(n.top+=t.outerHeight()+e.outerHeight(),e.css(n),e.addClass("up")):e.removeClass("up")},_bindInvalidMsgEvent:function(){var t=this;this.$tableBody.on("mousemove.grid.api","td.invalid,tr.invalid>td",function(i){var n=e(this),a=(n.position(),null);n.find("div>.rowBtn").length>0||(a=n.hasClass("invalid")?n.data("invalidMsg"):n.parent().data("invalidMsg"))&&t._initInvalidMsgCss(n,a)}),this.$tableBody.on("mouseout.grid.api",".invalid",function(t){var i=e(this).data("invalidMsg");i&&i.hide()})},saveRow:function(t){var e=t.rowIndex,i=t.command,n=null,a=this.setting.idField;n=t.rowData&&"object"==typeof t.rowData?t.rowData:t,e==undefined&&n[a]!=undefined&&(e=-1==(e=this.$tableBodyMain.find('tr[_v="'+n[a]+'"]').index())?undefined:e);var r=this.$tableBodyMain.find("tr").length-1;if(e==undefined||e>r)this.appendRow(n),t.manualCommit||this.acceptChange(r+1);else if("del"==i){var s=this._convertRowIndexToRowId(e);this._deleteRow(s),t.manualCommit||this.acceptChange(e)}else this._updateRow(e,n),t.manualCommit||this.acceptChange(e)},_updateRow:function(t,e){var i=this.data[this.setting.jsonReader.rows];if(!(i.length<t)){i[t]=e;var n=this._convertRowIndexToRowId(t);this._newData.updated[n]=e,this._updateRowDisplay(t,e),this.trigger("onDataChange")}},_updateRowDisplay:function(t,i){function n(n){e.isFunction(r.setting.rowCheckable)&&(!1===r.setting.rowCheckable(i,t)?n.addClass("row-uncheckable"):n.removeClass("row-uncheckable"));n.find("td").each(function(){!function(t){var n=a[t.attr("_cid")];if(!n)return;if("_rownumbers"==n.field)return;if(n._html)return;1==t.find(".app-wrapper").length&&n.editor.editor.setValue(i[n.field]);var s="";s=n.buttons?r._getBtnHtml(n,i):r._getFormatText(n,i);if(void 0!==t.attr("title")){var o=s;if("string"==typeof s){var l=e("<div>"+s+"</div>");0!=l.children().length&&(o=l.text())}t.attr("title",o)}t.find("div:first").html(s);var d="";e.isFunction(n.styler)?d=n.styler(i[n.field],i):n.styler&&(d=n.styler);d&&t.attr("style",d)}(e(this))})}var a=this._column,r=this;n(this.$tableBodyLeft.find("tr:eq("+t+")")),n(this.$tableBodyMain.find("tr:eq("+t+")")),n(this.$tableBodyRight.find("tr:eq("+t+")"))}})}),define("app/widgets/grid/app-grid-formatter",["app/util/app-utils"],function(t){var e=function(){this.formatterPool={}};e.prototype={add:function(t,e,i){if(this.formatterPool[t])throw new Error("已经存在编码为["+t+"]的格式化函数，请更换编码");this.formatterPool[t]={name:i,func:e}},remove:function(t){this.formatterPool[t]},get:function(t){var e=this.formatterPool[t];return e&&$.isFunction(e.func)?e.func:null},formatter:function(t,e,i,n,a){var r=this.get(t);return e=r?r(e,i,n,a):i[t]},getNameList:function(){var t=[],e=this.formatterPool;for(var i in e){var n=e[i].name;n&&t.push({name:n,id:i})}return t}};var i=new e;return i.add("thousandsFormatter",function(t,e,i){return $A.NumberFormat.format(t,"#,##0.00;;#")},"千分格式化(0不显示)"),i.add("thousand",function(t,e,i){return $A.NumberFormat.format(t,"#,##0.00")},"千分格式化"),i.add("###,###(0)",function(t,e,i){return $A.NumberFormat.format(t,"#,##0;;#")},"###,###(0不显示)"),i.add("yyyy-MM-dd",function(t,e,i){return t?8==t.length?t.substr(0,4)+"-"+t.substr(4,2)+"-"+t.substr(6,2):t:""},"yyyy-MM-dd"),i.add("yyyy年MM月dd日",function(t,e,i){return t?8==t.length?t.substr(0,4)+"年"+t.substr(4,2)+"月"+t.substr(6,2)+"日":t:""},"yyyy年MM月dd日"),i.add("oneYesZeroNo",function(t,e,i){return"1"==t?"是":"否"},"1是0否"),i.add("numberFormatter",function(t,e,i,n){return n.formatPattern?$A.NumberFormat.format(t,n.formatPattern):t}),i}),define("bs-http-plugin/config-ext",["app/core/app-core"],function(t){return{"bs-client-config":{downloadUrl:t.getHostUrl()+"static/print/bsnetfun/bosssoft-assistant.exe",initUpdate:!0,updateUrl:t.getHostUrl()}}}),define("bs-http-plugin/config",["app/core/app-jquery","app/core/app-core","bs-http-plugin/config-ext"],function(t,e,i){var n={version:"1.0",url:"http://127.0.0.1:13526/",guardUrl:"http://127.0.0.1:13528/controlMainApp",heartbeat:"heart",update:"update",startUrl:"BosssoftAssistant://",cookies:window._cookies||"no-cookies",timeout:2e3,sliceSize:1024},a=i["bs-client-config"];return a&&$.extend(n,a),n}),define("bs-http-plugin/util/uuid",[],function(){return function t(e,i,n){function a(s,o){if(!i[s]){if(!e[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(r)return r(s,!0);var d=new Error("Cannot find module '"+s+"'");throw d.code="MODULE_NOT_FOUND",d}var h=i[s]={exports:{}};e[s][0].call(h.exports,function(t){var i=e[s][1][t];return a(i||t)},h,h.exports,t,e,i,n)}return i[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)a(n[s]);return a}({1:[function(t,e,i){var n=t("./v1"),a=t("./v4"),r=a;r.v1=n,r.v4=a,e.exports=r},{"./v1":4,"./v4":5}],2:[function(t,e,i){for(var n=[],a=0;a<256;++a)n[a]=(a+256).toString(16).substr(1);e.exports=function(t,e){var i=e||0,a=n;return a[t[i++]]+a[t[i++]]+a[t[i++]]+a[t[i++]]+"-"+a[t[i++]]+a[t[i++]]+"-"+a[t[i++]]+a[t[i++]]+"-"+a[t[i++]]+a[t[i++]]+"-"+a[t[i++]]+a[t[i++]]+a[t[i++]]+a[t[i++]]+a[t[i++]]+a[t[i++]]}},{}],3:[function(t,e,i){(function(t){var i,n=t.crypto||t.msCrypto;if(n&&n.getRandomValues){var a=new Uint8Array(16);i=function(){return n.getRandomValues(a),a}}if(!i){var r=new Array(16);i=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),r[e]=t>>>((3&e)<<3)&255;return r}}e.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(t,e,i){var n=t("./lib/rng"),a=t("./lib/bytesToUuid"),r=n(),s=[1|r[0],r[1],r[2],r[3],r[4],r[5]],o=16383&(r[6]<<8|r[7]),l=0,d=0;e.exports=function(t,e,i){var n=e&&i||0,r=e||[],h=void 0!==(t=t||{}).clockseq?t.clockseq:o,c=void 0!==t.msecs?t.msecs:(new Date).getTime(),u=void 0!==t.nsecs?t.nsecs:d+1,p=c-l+(u-d)/1e4;if(p<0&&void 0===t.clockseq&&(h=h+1&16383),(p<0||c>l)&&void 0===t.nsecs&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");l=c,d=u,o=h;var f=(1e4*(268435455&(c+=122192928e5))+u)%4294967296;r[n++]=f>>>24&255,r[n++]=f>>>16&255,r[n++]=f>>>8&255,r[n++]=255&f;var g=c/4294967296*1e4&268435455;r[n++]=g>>>8&255,r[n++]=255&g,r[n++]=g>>>24&15|16,r[n++]=g>>>16&255,r[n++]=h>>>8|128,r[n++]=255&h;for(var m=t.node||s,v=0;v<6;++v)r[n+v]=m[v];return e||a(r)}},{"./lib/bytesToUuid":2,"./lib/rng":3}],5:[function(t,e,i){var n=t("./lib/rng"),a=t("./lib/bytesToUuid");e.exports=function(t,e,i){var r=e&&i||0;"string"==typeof t&&(e="binary"==t?new Array(16):null,t=null);var s=(t=t||{}).random||(t.rng||n)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,e)for(var o=0;o<16;++o)e[r+o]=s[o];return e||a(s)}},{"./lib/bytesToUuid":2,"./lib/rng":3}]},{},[1])(1)}),define("bs-http-plugin/data-transmit/message",["jquery"],function(t){var e=function(){var e=this;e.msgStack={},t(window).on("message",function(i){var n=i.originalEvent.data;n=t.parseJSON(n);var a=e.get(n.id);a&&a.call({},n)})};return e.prototype={constructor:e,set:function(t,e){this.msgStack[t]=e},get:function(t){var e=this.msgStack[t];return e&&delete this.msgStack[t],e}},new e}),define("base/dotpl-js",[],function(){var dotpl=function(){function _diving(t,e){var i=t.split("."),n=0;do{if(null==(e=e[i[n++]]))break}while(n<i.length&&"object"==typeof e);return e}function _applyMapTpl(t,e,i,n,a){return t.replace(/\${1}\{([^\}]+?)\}/gi,function(t,r){try{var s=_diving(r,e);if(s=null==s?"":s,"function"==typeof i){var o=i.call(this,r,s,e,n,a);return null==o?s:o}return s}catch(l){return alert(r||l.message||l),null}})}function _request(t,e,i){var n=null;(n=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).onreadystatechange=function(){if(4==n.readyState)try{e.call(this,n.responseText,n.status)}catch(t){return alert(t.message||t),null}};try{n.open("GET",t,!!i),n.send()}catch(a){return alert(a.message||a),null}return n}function _applyTpl(tpl,data,renderer,pk,parent){var regx=/<(tpl\d?)\s+(\w+)\s*=\s*(['|"]{1})([^\3]+?)\3\s*>([\s\S]+?)<\/\1>/gi;return regx.test(tpl)&&(tpl=tpl.replace(regx,function($0,$1,$2,$3,$4,$5){var output="";if(null!=$2)if("FOR"==$2.toUpperCase()){var arr=data;"."!=$4&&(arr=_diving($4,data));for(var i=0;null!=arr&&i<arr.length;i++){var item={};"object"!=typeof arr[i]?item.__val=arr[i]:item=arr[i],item.__offset=i,output+=_applyTpl($5,item,renderer,$4,arr)}}else if("IF"==$2.toUpperCase())try{if(eval(applyTpl($4,data)))return _applyTpl($5,data,renderer,pk,parent)}catch(e){alert($4||e.message||e)}return output})),_applyMapTpl(tpl,data,renderer,pk,parent)}return function(){return this.diving=_diving,this.applyTpl=_applyTpl,this.applyRTpl=function(t,e,i,n){_request(t,function(a,r){200==r?i.call(this,_applyTpl(a,e,n)):alert("Error "+r+":"+t)})},this}}()();return window.dotpl=dotpl,dotpl}),function(t){"use strict";var e,i=t.Base64;if("undefined"!=typeof module&&module.exports)try{e=require("buffer").Buffer}catch(_){}var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=function(t){for(var e={},i=0,n=t.length;i<n;i++)e[t.charAt(i)]=i;return e}(n),r=String.fromCharCode,s=function(t){if(t.length<2){return(e=t.charCodeAt(0))<128?t:e<2048?r(192|e>>>6)+r(128|63&e):r(224|e>>>12&15)+r(128|e>>>6&63)+r(128|63&e)}var e=65536+1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320);return r(240|e>>>18&7)+r(128|e>>>12&63)+r(128|e>>>6&63)+r(128|63&e)},o=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,l=function(t){return t.replace(o,s)},d=function(t){var e=[0,2,1][t.length%3],i=t.charCodeAt(0)<<16|(t.length>1?t.charCodeAt(1):0)<<8|(t.length>2?t.charCodeAt(2):0);return[n.charAt(i>>>18),n.charAt(i>>>12&63),e>=2?"=":n.charAt(i>>>6&63),e>=1?"=":n.charAt(63&i)].join("")},h=t.btoa?function(e){return t.btoa(e)}:function(t){return t.replace(/[\s\S]{1,3}/g,d)},c=e?function(t){return(t.constructor===e.constructor?t:new e(t)).toString("base64")}:function(t){return h(l(t))},u=function(t,e){return e?c(String(t)).replace(/[+\/]/g,function(t){return"+"==t?"-":"_"}).replace(/=/g,""):c(String(t))},p=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),f=function(t){switch(t.length){case 4:var e=((7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3))-65536;return r(55296+(e>>>10))+r(56320+(1023&e));case 3:return r((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return r((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},g=function(t){return t.replace(p,f)},m=function(t){var e=t.length,i=e%4,n=(e>0?a[t.charAt(0)]<<18:0)|(e>1?a[t.charAt(1)]<<12:0)|(e>2?a[t.charAt(2)]<<6:0)|(e>3?a[t.charAt(3)]:0),s=[r(n>>>16),r(n>>>8&255),r(255&n)];return s.length-=[0,0,2,1][i],s.join("")},v=t.atob?function(e){return t.atob(e)}:function(t){return t.replace(/[\s\S]{1,4}/g,m)},b=e?function(t){return(t.constructor===e.constructor?t:new e(t,"base64")).toString()}:function(t){return g(v(t))},y=function(t){return b(String(t).replace(/[-_]/g,function(t){return"-"==t?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))};if(t.Base64={VERSION:"2.1.9",atob:v,btoa:h,fromBase64:y,toBase64:u,utob:l,encode:u,encodeURI:function(t){return u(t,!0)},btou:g,decode:y,noConflict:function(){var e=t.Base64;return t.Base64=i,e}},"function"==typeof Object.defineProperty){var w=function(t){return{value:t,enumerable:!1,writable:!0,configurable:!0}};t.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",w(function(){return y(this)})),Object.defineProperty(String.prototype,"toBase64",w(function(t){return u(this,t)})),Object.defineProperty(String.prototype,"toBase64URI",w(function(){return u(this,!0)}))}}t.Meteor&&(Base64=t.Base64),"undefined"!=typeof module&&module.exports&&(module.exports.Base64=t.Base64),"function"==typeof define&&define.amd&&define("base/base64",[],function(){return t.Base64})}("undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:this),define("bs-http-plugin/data-transmit/socket",["jquery","bs-http-plugin/util/uuid","bs-http-plugin/config","bs-http-plugin/data-transmit/message","base/dotpl-js","base/base64"],function(t,e,i,n){var a=i.sliceSize,r={pending:{code:0,name:"pending",msg:"准备阶段"},sendData:{code:1,name:"sendData",msg:"发送数据"},sendDataCompleted:{code:2,name:"sendDataCompleted",msg:"发送数据完成"},invoking:{code:3,name:"invoking",msg:"dll调用"},invoked:{code:4,name:"invoked",msg:"dll调用完成并返回结果"},state:function(e,i){return t.extend(!0,{},r[e],i)},register:function(e,i){"undefined"===t.type(e)&&(e={});var n=t(e),a=t.isFunction(i)?i:t.noop;return n.on("stateChange",a),n.trigger("stateChange",[r.state("pending")]),n},trigger:function(e,i,n){"undefined"===t.type(n)&&(n=[]),e.trigger("stateChange",[r.state(i)].concat([].slice.call(n,0)))}},s=function(){return this.ret.ret_msg},o=function(){};o.prototype={constructor:o,get:function(e){var i=r.register({},e.stateChange);e.success=t.isFunction(e.success)?e.success:t.noop,e.error=t.isFunction(e.error)?e.error:t.noop;var n=e.data;n="undefined"===t.type(n)?{}:n,n=JSON.stringify(n),n=this.encodeURI(n);var s=e.sliceSize?e.sliceSize:a,o=t.extend(!0,{},e);delete o.data.payload;if(e.url.length+JSON.stringify(o.data).length+s>2e3)throw new Error("url 长度超过超过可发送最大长度，请重新设置sliceSize!");var l=this.sliceData(n,s),d=this.generateAjaxArray(e,l),h=d.dataSendCompletedAjaxConfig,c=d.ajaxConfig,u=d.deferreds;t(c).each(function(e,i){t.ajax(i).done(i.success).fail(i.error)}),r.trigger(i,"sendData");var p=t.Deferred();return t.when.apply(t,u).done(function(){p.resolve.apply(t,arguments),r.trigger(i,"sendDataCompleted"),h.success=function(t){r.trigger(i,"invoked",arguments),e.success.apply(e,arguments)},h.error=function(t){r.trigger(i,"invoked",arguments),e.error.apply(e,arguments)},r.trigger(i,"invoking")}).fail(function(){p.reject.apply(t,arguments),r.trigger(i,"invoked",arguments),e.error.apply(e,arguments)}),p},post:function(i){var n=r.register({},i.stateChange);i.success=t.isFunction(i.success)?i.success:t.noop,i.error=t.isFunction(i.error)?i.error:t.noop;var a=i.data;a="undefined"===t.type(a)?{}:a,i.data={id:e.v4().replace(/-/g,"")},a=JSON.stringify(a),a=this.base64Encode(a),i.crossDomain=!0,i.data.payload=a,i.contentType="application/x-www-form-urlencoded; charset=utf-8",i.dataType="json",i.type="POST",t.support.cors=!0,t.when(t.ajax(i)).done(function(){r.trigger(n,"invoked",arguments),i.success.apply(i,arguments)}).fail(function(){r.trigger(n,"invoked",arguments),i.error.apply(i,arguments)}),r.trigger(n,"invoking")},sendByIframe:function(e){var i=t.Deferred(),a=e["-operateDefer"];"undefined"===t.type(a)&&(a=t.Deferred(),e["-operateDefer"]=a);var o=r.register({},e.stateChange);e.success=t.isFunction(e.success)?e.success:t.noop,e.error=t.isFunction(e.error)?e.error:t.noop;var l=this.createIframe(e),d=this.createForm(e);n.set(e.data.id,function(n){"undefined"===t.type(n)&&(n={}),n.getResult=s;try{var o=[n.getResult(),r.state("invoked")];i.resolve.apply(i,o),e.success.apply(this,o),"0"===n.ret.ret_code?(e.success.apply(e,o),a.resolve.apply(a,o)):(e.error.apply(e,o),a.reject.apply(a,o)),d.remove(),l.remove()}catch(h){if(o.push(h),e.error.apply(this,o),!window.console)throw h;window.console.error(h)}}),setTimeout(function(){d.submit()},0);var h=e.timeout?e.timeout:3e5,c=new Date,u=setInterval(function(){var t=new Date;"pending"===i.state()?t-c>h&&(e.error.apply(this,[{code:"timeout",msg:"超时"}]),i.reject({code:"timeout",msg:"超时"}),clearInterval(u)):clearInterval(u)},800);return r.trigger(o,"invoking"),i},createIframe:function(e){var i=t(dotpl.applyTpl('<iframe                                 id="socketIframe${id}"                                 name="socketIframe${id}"                                 style="position:absolute; top:-9999px; left:-9999px">                            </iframe>',e));return i.appendTo("body"),i},createForm:function(e){e.func?(e.invokeType="func",e.invokeValue=e.func):(e.invokeType="proc",e.invokeValue=e.proc);var i=t(dotpl.applyTpl('<form id="socketForm${id}" name="socketForm${id}"                 target="socketIframe${id}"                 action="${url}"                 method="post"                 accept-charset="UTF-8"                 >                 </form>',e));if("object"===t.type(e.data))for(field in e.data){var n=t('<input type="hidden" name="" value="" />');n.prop("name",field),n.prop("value",e.data[field]),i.append(n)}return i.appendTo("body"),i},sliceData:function(e,i){var n=[],a="";a="string"===t.type(e)?e:JSON.stringify(e);for(var r=Math.ceil(a.length/i),s=0,o=0;s<r;s++,o+=i)n.push(a.substr(o,i));return n},generateAjaxArray:function(e,i){var n=[],a=[],r={};t.extend(!0,r,e),delete r.data.payload;var s=i.length;0===s&&(s=1),r.data.sum=s;for(var o={url:e.url,timeout:r.timeout?r.timeout:5e3,contentType:"application/x-www-form-urlencoded; charset=utf-8",dataType:"jsonp",jsonp:"jsonp",type:"GET"},l=0;l<s;l++){var d={},h=t.Deferred();a.push(h.promise()),t.extend(!0,d,r.data),d.curr=l,"undefined"!=typeof i[l]&&(d.payload=i[l]);var c=t.extend(!0,{},o);c.success=function(t){return function(e){t.resolve()}}(h),c.error=function(t){return function(e){t.reject()}}(h),c.data=d,n.push(c)}return{dataSendCompletedAjaxConfig:t.extend(!0,{},o,r,{data:{res:1},timeout:0}),ajaxConfig:n,deferreds:a}},encodeURI:function(t){return encodeURIComponent(t)},base64Encode:function(t){return Base64.encode(t)}};return new o}),define("app/widgets/drag/app-drag",["app/core/app-jquery","app/core/app-core"],function(t,e){return t.fn.drager=function(i){return"string"==typeof i&&"destroy"==i?this.each(function(){t(this).unbind("mousedown",e.dragTool.start),t.data(this,"app/widgets/drag/app-dragdata",null)}):this.each(function(){var n=t(this);if(t.data(e.dragTool,"app/widgets/drag/app-dragdata",{options:t.extend({el:n,obj:n},i)}),i.event)e.dragTool.start(i.event);else{var a=i.selector;t(a,obj).bind("mousedown",e.dragTool.start)}})},e.dragTool={start:function(i){document.onselectstart=function(t){return!1};var n=t.data(this,"app/widgets/drag/app-dragdata"),a=n.options.el[0];t.data(a,"app/widgets/drag/app-dragdata",{options:n.options}),e.dragTool.current||(e.dragTool.current={el:a,oleft:parseInt(a.style.left)||0,otop:parseInt(a.style.top)||0,ox:i.pageX||i.screenX,oy:i.pageY||i.screenY},t(document).bind("mouseup",e.dragTool.stop).bind("mousemove",e.dragTool.drag))},drag:function(i){if(!i)i=window.event;var n=e.dragTool.current,a=t.data(n.el,"app/widgets/drag/app-dragdata"),r=n.oleft+(i.pageX||i.clientX)-n.ox,s=n.otop+(i.pageY||i.clientY)-n.oy;if(s<1&&(s=0),"horizontal"==a.options.move)a.options.minW&&r>=t(a.options.obj).cssNum("left")+a.options.minW&&a.options.maxW&&r<=t(a.options.obj).cssNum("left")+a.options.maxW?n.el.style.left=r+"px":a.options.scop&&(a.options.relObj?r-parseInt(a.options.relObj.style.left)>a.options.cellMinW&&(n.el.style.left=r+"px"):n.el.style.left=r+"px");else if("vertical"==a.options.move)n.el.style.top=s+"px";else{var o=a.options.selector?t(a.options.selector,a.options.obj):t(a.options.obj);r>=2*-o.outerWidth()/3&&s>=0&&r+o.outerWidth()/3<t(window).width()&&s+o.outerHeight()<t(window).height()&&(n.el.style.left=r+"px",n.el.style.top=s+"px")}return a.options.drag&&a.options.drag.apply(n.el,[n.el]),e.dragTool.preventEvent(i)},stop:function(i){var n=e.dragTool.current,a=t.data(n.el,"app/widgets/drag/app-dragdata");return t(document).unbind("mousemove",e.dragTool.drag).unbind("mouseup",e.dragTool.stop),a.options.stop&&a.options.stop.apply(n.el,[n.el]),e.dragTool.current=null,document.onselectstart=function(t){return!0},e.dragTool.preventEvent(i)},preventEvent:function(t){return t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),!1}},e.dragTool}),define("app/widgets/drag/app-dialogdrag",["app/core/app-jquery","app/core/app-core","app/data/app-ajax","app/widgets/drag/app-drag"],function(t,e,i){var n=".dialog-header,.dlg-box-head";t.fn.dialogDrag=function(i){return n=i&&i.dragTarget?i.dragTarget:".dialog-header,.dlg-box-head","string"==typeof i&&"destroy"==i?this.each(function(){t(n,this).unbind("mousedown")}):this.each(function(){var i=t(this);t(n,i).mousedown(function(n){var a=t(n.target);if(!(a.is("label")||a.is("input")||a.is("a")||a.parents("a").size()>0))return e.dialog.switchDialog(i),i.data("task",!0),setTimeout(function(){i.data("task")&&t.dialogDrag.start(i,n)},100),t(document).on("mouseup",{$dlg:i},function(e){return i.data("task",!1),t(document).unbind("mouseup",arguments.callee),!0}),!0})})},t.dialogDrag={_init:function(i){var a=t("#dialogProxy");a.size()||(a=t(e.frags.dialogProxy),t("body").append(a)),t("h5",a).html(t(n+" h5",i).html())},start:function(e,i){this._init(e);var a=t("#dialogProxy");return a.css({left:e.css("left"),top:e.css("top"),marginLeft:e.css("marginLeft"),height:e.css("height"),width:e.css("width"),zIndex:parseInt(e.css("zIndex"))+1}).show(),t("div.dialog-content",a).css("height",t("div.dialog-content",e).css("height")),a.data("dialog",e),a.drager({selector:n,stop:this.stop,event:i}),!1},stop:function(){var e=t(arguments[0]);e.data("dialog").css({left:e.css("left"),top:e.css("top")}),e.hide()}}}),define("app/widgets/window/app-dialog",["app/core/app-jquery","app/core/app-core","app/data/app-ajax","app/core/app-options","app/widgets/drag/app-dialogdrag"],function(t,e,i,n){function a(i,a){if(a.mask){var s=t("#_dialogMask");0==s.size()&&t("body").append("<div id='_dialogMask' class='dialog-mask'></div>"),s.css("zIndex",n.zindexs.dialogMask),t("#_dialogMask").show()}var o=t("div.dialog-header h5,div.dlg-box-head h5",i);if(o.length>0&&!o.html()){var l=t("title",i),d=l.html();l.remove(),d||(d=a.title||"对话框");var h=l.attr("icon")||a.icon;h&&(d='<i class="'+h+'"></i><span>'+d+"</span>"),o.html(d)}i.one("hide",function(){a.src&&t(a.src).focus();var e=a.closeCallback;e&&t.isFunction(e)&&e(i,a)}),t("body").height()<i.height()&&i.height(t("body").height());var c=t(".dialog-content",i),u=t(".dialog-header,.dlg-box-head",i);u.on("selectstart",function(){return!1}),u.on("copy",function(){return!1}),u.on("paste",function(){return!1}),u.on("cut",function(){return!1});var p=t(".dialog-footer",i),f=(Math.min(i.height(),t(document).height()),i.outerHeight()-u.outerHeight()-p.outerHeight());c.innerHeight(f),a.width&&c.outerWidth()>a.width&&i.width(c.outerWidth()),e.dialog.relayout(i),e.dialog.setCurrent(i);var g=a.callback;g&&t.isFunction(g)&&g(i,a),a&&a.afterShow&&a.afterShow.call(this,i),"url"==a.mode?i.on(e.eventType.pageLoad,function(){timeout=setTimeout(function(){i.css("visibility",""),i.show()},50)}):(i.css("visibility",""),i.show()),i.data(r.TAG,r.OPENED)}var r={OPENING:0,OPENED:1,TAG:"_dialog_open_statue"};return e.dialog={_op:{hasheader:!0,mask:!0,dragTarget:null,drawable:!0,reload:!0,mode:"url",beforShow:function(){},afterShow:function(){},afterClose:function(){}},_current:[],_zIndex:42,getCurrent:function(){return 0==this._current.length?null:this._current[this._current.length-1]},getDialog:function(t){for(var e=0,i=this._current.length;e<i;e++)if(this._current[e].is("#"+t))return this._current[e];return null},relayout:function(e){e||(e=this.getCurrent()),e.css("left",Math.max((t(window).width()-e.width())/2,0)+"px"),e.css("top",Math.max((document.body.clientHeight-e.height())/2,0)+"px")},reload:function(i,n){var s=n.dialogId&&t("#_dialogs #"+n.dialogId)||this.getCurrent();if(s&&0!=s.size()){var o=t.extend({},s.data("options"),n);if(s.data("options",o),o.hasheader&&s.find(">:not(:first)").remove(),s.data("url",i),o.reload?s.attr("reload","true"):s.removeAttr("reload"),"url"==n.mode){var l={type:"POST",url:i,data:o.params,history:!1,operator:o.operator?o.operator:"append",callback:function(i){t(".btn.close",s).click(function(){return e.dialog.close(s),!1}),o.dragTarget?s.dialogDrag(o):o.drawable&&!o.hasheader&&s.dialogDrag(o),e.dialog.setCurrent(s),n&&n.beforShow&&n.beforShow.call(this,s),a(s,o)},error:function(){s.data(r.TAG,"")}};n.onPageLoad&&(l.onPageLoad=n.onPageLoad),n.beforePageInit&&(l.beforePageInit=n.beforePageInit),s.loadAppURL(l)}else"html"==n.mode?(s.append(i),t(".btn.close",s).click(function(){return e.dialog.close(s),!1}),n&&n.beforShow&&n.beforShow.call(this,s),s.one(e.eventType.pageLoad,{$dlg:s},function(t){e.dialog.relayout(t.data.$dlg)}),s.initPageUI(),a(s,o)):"node"==n.mode&&(n.hasheader?s.find(">:not(.dialog-header)").remove():s.empty(),s.append(t(i)),t(".btn.close",s).click(function(){return e.dialog.close(s),!1}),n.onPageLoad&&s.one(e.eventType.pageLoad,{$dlg:s},function(t){n.onPageLoad(n,s)}),s.initPageUI(),n&&n.beforShow&&n.beforShow.call(this,s),s.dialogDrag(n),a(s,o))}},open:function(i,n,s,o){var l=t("#_dialogs");0==l.size()&&(t("body").append('<div id="_dialogs"></div>'),l=t("#_dialogs")),"object"==typeof i?(i=(o=i).url,n=o.dialogId,s=o.title):"object"==typeof n?(n=(o=n).dialogId,s=o.title):"object"==typeof s&&(s=(o=s).title);var d=t("#"+n,l);if(0!=d.size()||"#"!=i){n||(n="dialog"+e.nextId()),o.dialogId=n,o.title=s;var h=t.extend({},e.dialog._op,o);if(!(d.size()>0)){if(h.hasheader){var c=$template(e.frags.dialogFrag,h);l.append(t(c.toString()))}else{c=$template(e.frags.dialogNoHeaderFrag,h);l.append(t(c.toString()))}(d=t(">.dialog:last-child",l)).data(r.TAG,r.OPENING),h.bindData&&d.data("bindData",h.bindData),t.fn.bgiframe&&d.bgiframe();var u=h[e.eventType.pageLoad];return"function"==typeof u?d.on(e.eventType.pageLoad,u):!1===h.pageLoad&&d.unbind(e.eventType.pageLoad),d.find(".dialog-header").find("h5").html(s),o.width&&d.css("width",o.width),o.height&&d.innerHeight(o.height),h.mask||d.click(function(){e.dialog.switchDialog(d)}),h.drawable&&h.hasheader&&d.dialogDrag(),t("a.close",d).click(function(t){return e.dialog.close(d,t),!1}),d.attr("reload",h.reload),this.reload(i,h),d}d.data(r.TAG)!==r.OPENING&&(d.data(r.TAG,r.OPENING),h.reload||i!=d.data("url")?this.reload(i,h):a(d,h),d.removeData("bindData"),h.bindData&&d.data("bindData",h.bindData))}},setCurrent:function(t){var e=this.getCurrent();e&&e.is(t)||(t.css("zIndex",n.zindexs.dialog),this._current.push(t),e&&e.css("zIndex",n.zindexs.dialogBack))},switchDialog:function(e){if(null!=e&&0!=e.length&&!e.is(this.getCurrent())){var i=e.css("zIndex");if(this.getCurrent()){var n=t(this.getCurrent()).css("zIndex");t(this._current).css("zIndex",i),e.css("zIndex",n);for(var a=0;a<this._current.length;a++)e.equalObject(this._current[a])&&this._current.splice(a,1);this._current.push(e)}}},close:function(i,a){if(i){var r=i.data("options");if(r&&r.beforeClose&&!1===r.beforeClose.call(this,i,a))return}if("string"==typeof i&&(i=t("#_dialogs #"+i)),null!=i&&0!=i.length){i.css("display","none");for(var s=0;s<this._current.length;s++)i.equalObject(this._current[s])&&this._current.splice(s,1);var o=this.getCurrent();null!=o?o.css("zIndex",n.zindexs.dialog):t("#_dialogMask").hide(),i.trigger("hide"),"true"==i.attr("reload")&&(e.destroyDom(i),i.trigger(e.eventType.pageDestroy).remove()),r&&r.afterClose&&r.afterClose.call(this,i)}},closeCurrent:function(){this.close(this.getCurrent())},getBindData:function(t){return t||(t=this.getCurrent()),t.data("bindData")},checkTimeout:function(){var i=t(".dialog-content",this.getCurrent()),n=e.jsonEval(i.html());n&&n.statusCode==e.statusCode.timeout&&this.closeCurrent()}},t.fn.closeDialog=function(){e.dialog.close(t(this))},t.fn.showDialog=function(){e.dialog.setCurrent(t(this)),t(this).show()},t.closeDialog=function(t){t?t.closeDialog():e.dialog.closeCurrent()},t.openModalDialog=function(t){return e.dialog.open(t)},t(document).on("click","a[target=dialog]",function(e){e.preventDefault();var i=t(this).getJsonAttr("_dialog_options");t.openModalDialog(i)}),e.dialog}),define("bs-http-plugin/base-pluginvoke",["app/core/app-class","app/core/app-attribute","app/core/app-events","bs-http-plugin/config","bs-http-plugin/data-transmit/socket","bs-http-plugin/util/uuid","app/widgets/window/app-dialog","app/widgets/window/app-messager","base/dotpl-js","app/app-funcbase","base/base64"],function(t,e,i,n,a,r){var s=t.create({Implements:[e,i],module:"",config:{appId:"bosssoft"},isShowHelp:!0,downloadUrl:n.downloadUrl,functions:[],processes:[],initialize:function(t){if($.extend(this,t),n.initUpdate&&s.clientUpdate(n.updateUrl),this.addConfig("version",n.version),"undefined"==typeof this.module)throw new Error("请设置module属性!");this.initMethods(this.functions,"func"),this.initMethods(this.processes,"proc"),this.initStateDefer=this.init()},initMethods:function(t,e){var i=this;$.isArray(t)&&$(t).each(function(t,n,a){"undefined"==typeof i[n]&&i.generateFun(n,e)})},operateConfig:function(t,e){var i=this;if(!$.isFunction(i[t]))throw new Error(t+" 不是函数...");return e["-isOptions-"]=!0,function(){var n=[].slice.apply(arguments);return n.unshift(e),i[t].apply(i,n)}},generateFun:function(t,e){var i=this,n="",a="";if("string"===$.type(t))n=a=t;else if("object"===$.type(t)&&(n=t.jsName,a=t.dllName,"string"===$.type(n)&&"undefined"===$.type(a)&&(a=n),"undefined"===$.type(n)&&"string"===$.type(a)&&(n=a),"undefined"===$.type(n)&&"undefined"===$.type(a)))throw new Error("必须定义一个jsName 或者 dllName");var r={module:i.module};r[e]=a,i[n]=function(e){var n=i._initArgs(arguments);$.extend(!0,n,r);var a=i.newOperation(n),s=function(){return i.operate.apply(i,[n])};return!1===t.initRequired?(s(),a):($.when(i.initStateDefer).done(function(){s()}).fail(function(){a.reject.apply(a,arguments),i.isShowHelp&&i.showHelp()}),a)}},_initArgs:function(t){var e=[].slice.apply(t,[1]),i=t[0];return"object"===$.type(i)&&!0===i["-isOptions-"]||(i={},e=[].slice.apply(t)),i.data=e,i},newOperation:function(t){return t["-operateDefer"]=$.Deferred()},setOperation:function(t){return t["-operateDefer"]?t["-operateDefer"]:t["-operateDefer"]=$.Deferred()},getInitState:function(){return this.initStateDefer},init:function(){var t=$.Deferred();return t.resolve(),t},onError:function(t,e,i){},operate:function(t){var e=this,i=e.setOperation(t),o=r.v4().replace(/-/g,""),l={id:o,payload:Base64.encode(JSON.stringify({config:e.config,data:t.data}))};t.func?l.func=t.func:t.proc&&(l.proc=t.proc);var d=$.extend({},t,{id:o,url:n.url+e.module,data:l,sliceSize:t.sliceSize}),h=a.sendByIframe(d),c=[s.heartbeat().fail(function(){e.getInitState().reject.apply(e.getInitState(),arguments),e.isShowHelp&&e.showHelp()}),i,h];return $.when.apply($,c).fail(function(){var n=[];n=n.concat([].slice.call(arguments,0)),e.onError.apply(e,n),i.rejectWith(t,n)}),i},addConfig:function(t,e){"string"===$.type(t)&&(this.config[t]=e)},removeConfig:function(t){delete this.config[t]},destroy:function(){for(var t in this)this.hasOwnProperty(t)&&delete this[t]},bind:function(t,e){this.on(t,e,this)},unbind:function(t){"string"==typeof t&&this.off(t,null,this)},enableShowHelp:function(t){this.setDownloadUrl(t),this.isShowHelp=!0},disableShowHelp:function(){this.isShowHelp=!1},setDownloadUrl:function(t){"string"===$.type(t)&&(this.downloadUrl=t)},showHelp:function(){if(!$("#bsClientHelpDlg").length){var t=$(dotpl.applyTpl('                    <div class="dlg-box-head" id="unInstallControl_dialog" style="height:50px;">                    <div class="dlg-box-head-left" id="dragTarget" style="height:40px;width:480px;display:inline;">                      <span class="dlg-box-head-title" style="font-size:18px">控件提示</span> <span class="dlg-box-head-text"></span>                        </div>                    <div class="dlg-box-head-right" style="width:60px;float:right;display:inline;">                    </div>                    </div>\t                    <div class="dialog_content" style="height: 210px;">                    <div style="box-sizing: border-box;height:100px;padding:40px 20px 20px 20px;;font-size:16px;font-weight:normal;text-align:center;">本系统需要安装    <span style="color:red;">财务云助手</span>   才能保证正常运行</div>                     <div style="height:60px;padding:20px 20px;font-size:16px;font-weight:normal;text-align:center;">                     <a id="startBtn" class="app-button l-btn l-btn-small" style="height:35px;background:#449d44;color:#fff;margin-right:20px;filter:none;">                            <span class="l-btn-left">                                <span class="l-btn-text" style="font-size:14px;padding-top:3px;">启动财务云助手</span>                            </span>                        </a>                    <a id="handlerStartBtn" data-url="${startUrl}" class="app-button l-btn l-btn-small" style="height:35px;background: rgba(206, 52, 38, 0.8);color:#fff;margin-right:20px;filter:none;display:none;">                            <span class="l-btn-left">                                <span class="l-btn-text" style="font-size:14px;padding-top:3px;">手动启动财务云助手</span>                            </span>                        </a>                    <a id="downBtn" data-url="${downloadUrl}" class="app-button l-btn l-btn-small" style="height:35px;background:#ec971f;color:#fff;margin-right:20px;filter:none;">                            <span class="l-btn-left">                                <span class="l-btn-text" style="font-size:14px;padding-top:3px;">下载财务云助手</span>                            </span>                        </a>                    <a id="closeBtn" class="app-button l-btn l-btn-small" style="height:35px;background:#e6e6e6;color:#333;margin-right:20px;">                            <span class="l-btn-left">                                <span class="l-btn-text" style="font-size:14px;padding-top:3px;">关闭提示</span>                            </span>                        </a>                    </div>                     </div>',{downloadUrl:this.downloadUrl,startUrl:n.startUrl}));t.find("#downBtn").on("click",function(){window.open($(this).data("url"),"下载财务云助手")}),t.find("#handlerStartBtn").on("click",function(){window.open($(this).data("url"),"通过浏览器手动启动财务云助手")}),t.find("#startBtn").on("click",function(){a.get({url:n.guardUrl+"?ct=2",timeout:1e4,data:{payload:{}}}).done(function(){$("#bsClientHelpDlg").fadeOut(1e3),$A.messager.correct("启动成功!",3e3),setTimeout(function(){$("#bsClientHelpDlg").closeDialog(),n.initUpdate&&s.clientUpdate(n.updateUrl)},2500)}).fail(function(){$A.messager.warn("启动失败，请尝试手动启动或重新安装财务云助手..."),$("#startBtn").hide(),$("#handlerStartBtn").css("display","inline-block")}).always(function(){})}),t.find("#closeBtn").bind("click",function(){$("#bsClientHelpDlg").closeDialog()});var e={dialogId:"bsClientHelpDlg",hasheader:!1,height:"260px",width:"200px",mode:"node",url:t,beforeClose:function(){},onPageLoad:function(){}};$.openModalDialog(e)}},Statics:{create:function(t){return new s(t)},heartbeat:function(t){$.isNumeric(t)||(t=n.timeout);var e=$.Deferred(),i="heartbeat_"+r.v4().replace(/-/g,"");window[i]=function(){e.resolve()};var a=document.getElementsByTagName("head")[0],s=document.createElement("script");s.type="text/javascript",s.charset="utf-8",s.async=!0,s.src=n.url+n.heartbeat+"?jsonp="+i;var o=t/2,l=0,d=setInterval(function(){(l+=o)>=t&&(window[i]=undefined,clearInterval(d),"pending"==e.state()&&e.reject({code:"timeout",msg:"超时"}))},o);return a.appendChild(s),e},clientUpdate:function(t,e){return $.isNumeric(e)||(e=n.timeout),a.get({url:n.url+n.update,timeout:e,data:{url:t,payload:{}}}).done(function(){}).fail(function(){})}}});return s}),define("bs-http-plugin/util/img-lazyload",["jquery"],function(t){!function(t){function e(e,i,n,a){var r=e.find(i);r=r.filter(function(e,i){return!t(i).attr("lazyloaded")}),t(r).each(function(i,r){var s=t(r);if(r.offsetTop<parseInt(e.height())+parseInt(e.scrollTop())&&s.attr("src")===n){s.attr("lazyloaded",!0);var o=s.attr("data-src"),l=t(document.createElement("img"));l.attr("src",o),t("body").append(l),l.hide(),function(t,e){var i=setInterval(function(){t.complete&&(e(t),clearInterval(i))},500)}(l[0],function(){s.attr("src",o),l.remove(),a(s)})}})}t.fn.extend({imgLazyLoad:function(i,n,a){var r=t(this);a=t.isFunction(a)?a:t.noop,r.find(i).each(function(e,i){t(i).attr("lazyloaded")||t(i).attr("src",n)}),r.scroll(function(t,e,i,n){var a,r=new Date;return function(s){var o=this,l=new Date;e.push(s),clearTimeout(a),l-r>=n?(t.apply(o,e),r=l):a=setTimeout(function(){t.apply(o,e)},i)}}(e,[r,i,n,a],500,1e3)),e(r,i,n,a)}})}(t)}),define("bs-http-plugin/bs-print",["bs-http-plugin/base-pluginvoke","bs-http-plugin/data-transmit/socket","bs-http-plugin/config","bs-http-plugin/util/img-lazyload"],function(t,e,i){var n=t.extend({module:"print",functions:[{jsName:"initParams",dllName:"initParams",initRequired:!1},"doPrintRemoteImage","getTemplateList","getDefaultTemplete","getLocal","setLocal","getPrinter","setPrinter","getPrintSet","getTemplatePath","getPrintPreviewImage","doDesign","doPreview","printReport","doPrintMultiSubReport","doCoordinate","doCustomPrint","openFile","exportMedia"],init:function(){var t=this.initOptions,e=$.Deferred();return this.initParams(t).done(function(t,i,n){e.resolve()}).fail(function(t,i,n){e.reject({code:-1,msg:"初始化失败！！！！"})}),e},template:{printPreViewDialog:'                <div class="dlg-box-head">                    <div class="dlg-box-head-left">                        <span class="dlg-box-head-title">打印预览</span>                        <span class="pre-view-msg"></span>                    </div>                    <div class="dlg-box-head-right">                        <div class=" btnarea menubar btn-dlg-toolbar">                        </div>                    </div>                </div>                <div class="dialog-content print-pre-view" style="padding: 30px;">                </div>',printDialog:'            <div class="dlg-box-head">                <div class="dlg-box-head-left">                    <span class="dlg-box-head-title">打印</span>                </div>            </div>            <div class="dialog-content print-pre-view">                <span class="print-view-msg"></span>            </div>'},exportMedia:function(t){var e=this;return e.openFile().then(function(i){return t.ExportPath=i,e.operate({data:[t],func:"exportMedia"})})},doPreview:function(){var t=this,e=t._initArgs(arguments),i=$.Deferred();return $.when(t.initStateDefer).done(function(){function n(e,a){e.func="doPreview";var s=a+u;s>c&&(s=c),t.setItem(e,"PrintData",h.slice(a,s));var o={index:0==s?1:s,total:0==c?1:c};a=s,t.newOperation(e),$.when(t.operate(e)).done(function(t){var r=f(t,a,c),s="(${index}/${total})";if(s=dotpl.applyTpl(s,o),d?(m=m.concat(t.list),$(t.list).each(function(e,i){var n=$('<img style="display: block;margin: 100px auto;" />');n.attr("data-src",t.url+"?fn="+i),_.append(n)}),_.imgLazyLoad("img",l,function(t){t.addClass("print-img-loaded"),t.attr("style","")}),s="正在生成预览图片"+s):s=g.getDoingMsg()+s,"undefined"!==$.type(r)&&(s=r),x.text(s),a==c)return d?(w.find("#btnPrint").css("display","inline-block"),x.fadeOut(600,function(){x.remove()})):setTimeout(function(){x.removeClass("print-view-msg").addClass("print-view-msg-success").text(g.getSuccessMsg()),w.fadeOut(2600,function(){w.closeDialog()})},800),void i.resolve.apply(i,arguments);n(e,a)}).fail(function(){i.reject.apply(i,arguments),r&&(x.removeClass("print-view-msg").addClass("print-view-msg-success").text(g.getErrorMsg()),w.fadeOut(2600,function(){w.closeDialog()}))})}var a=t.getItem(e,"DialogOptions");a="undefined"===$.type(a)?{}:a;var r=t.getItem(e,"ShowForm"),s=t.getItem(e,"PrintPreview"),o=t.getItem(e,"MessageDialog"),l=t.getItem(e,"DefImg");"undefined"===$.type(o)&&(o=!0),r=!1!==r||r,t.setItem(e,"ShowForm",r);var d=!r&&s,h=t.getItem(e,"PrintData"),c=(h=$.isArray(h)?h:[h]).length,u=t.getItem(e,"PrintSize");u=$.isNumeric(u)?u:c;var p=t.getItem(e,"PrintCallBack");p=t.isFunction(p);var f=t.getItem(e,"ProcessChange");f=t.isFunction(f),l||(l=$A.getHostUrl()+"resources/common/themes/images/print/default.gif");var g={printSuccessMsg:"打印成功！",printErrorMsg:"预览失败！",preViewSuccessMsg:"预览成功！",preViewErrorMsg:"预览成功！",printDoingMsg:"正在打印",preViewDoingMsg:"正在预览",getSuccessMsg:function(){return s?this.preViewSuccessMsg:this.printSuccessMsg},getErrorMsg:function(){return s?this.preViewErrorMsg:this.printErrorMsg},getDoingMsg:function(){return s?this.preViewDoingMsg:this.printDoingMsg}};$.extend(g,t.getItem(e,"Message"));var m=[],v=$(document.body).css("overflow");$(document.body).css("overflow","hidden");var b="",y={dialogId:"_dlgdoPreViewImg",hasheader:!1,title:" ",height:"75%",width:"60%",mode:"node",buttons:[{id:"btnPrint",text:"打印",visible:!1,click:function(){e.func="doPrintImage",t.newOperation(e),t.setItem(e,"PrintData",m);var n=$.extend(!0,{},y);n.dialogId="_printDlg",n.beforeClose=$.noop,n.url=dotpl.applyTpl(t.template.printDialog,{msg:g.printDoingMsg+"请稍后..."}),n.width="600px",n.height="200px",o&&$.openModalDialog(n);var a=$("#"+n.dialogId);$.when(t.operate(e)).done(function(t){a.find(".print-view-msg").removeClass("print-view-msg").addClass("print-view-msg-success").text(g.printSuccessMsg),a.fadeOut(2600,function(){a.closeDialog()}),i.resolve.apply(i,arguments)}).fail(function(t){i.resolve.apply(i,arguments),a.find(".print-view-msg").removeClass("print-view-msg").addClass("print-view-msg-success").text(g.printErrorMsg)}),p()}},{id:"btnClose",text:"关闭",click:function(){$("#"+y.dialogId).closeDialog()}}],buttonsExt:[],buttonGen:function(){var t=$("#"+y.dialogId).find(".dlg-box-head-right>div"),e=this.buttons.concat(this.buttonsExt);$(e).each(function(e,i){var n=$(dotpl.applyTpl('<a id="${id}" class="app-button hidden l-btn l-btn-large l-btn-plain">                                        <span class="l-btn-left l-btn-icon-top">                                            <span class="l-btn-text">${text}</span>                                            <i class="l-btn-icon add48">&nbsp;</i>                                        </span>                                    </a>',i));n.on("click",i.click),!1===i.visible&&n.hide(),t.append(n)})},beforeClose:function(){$(document.body).css("overflow",v)}};d?b=t.template.printPreViewDialog:(b=t.template.printDialog,y.height="220px",y.width="600px"),$.extend(!0,y,a),y.url=$(b),$("#"+y.dialogId).length&&$("#"+y.dialogId).closeDialog(),o&&$.openModalDialog(y),y.buttonGen();var w=$("#"+y.dialogId),_=w.find(".dialog-content"),x=d?w.find(".pre-view-msg"):w.find(".print-view-msg");n(e,0)}).fail(function(){}),i},doImage:function(){var t=this,e=$.Deferred(),i=t._initArgs(arguments);return $.when(t.initStateDefer).done(function(){t.setItem(i,"ShowForm",!1),t.setItem(i,"PrintPreview",!0);var n=t.getItem(i,"PrintData");$.isArray(n)||(n=[n],t.setItem(i,"PrintData",n)),i.func="doPreview",t.newOperation(i),t.operate(i).done(function(){e.resolveWith(i,arguments)}).fail(function(t){e.rejectWith(i,arguments)})}).fail(function(){e.reject()}),e},getItem:function(t,e){return t.data[0][e]},setItem:function(t,e,i){return t.data[0][e]=i},isFunction:function(t){return $.isFunction(t)?t:function(){}},Statics:{getDefInstance:function(t){var e={initOptions:{Cookie:i.cookies,HostUrl:$A.getHostUrl(),DownLoadUrl:"undefined",QueryTempListUrl:"undefined",QueryTempNameUrl:"undefined"}};return"undefined"===$.type(t)&&(t={}),$.extend(!0,t,e),this.instance&&"rejected"!==this.instance.getInitState().state()||(this.instance=new n(t)),this.instance},getInstance:function(t){return this.instance&&"rejected"!==this.instance.getInitState().state()||(this.instance=new n(t)),this.instance}}});return n}),define("app/widgets/grid/app-grid-print",["app/core/app-class","app/core/app-jquery","app/core/app-core","app/data/app-ajax","app/widgets/grid/app-grid-formatter","bs-http-plugin/bs-print"],function(t,e,i,n,a,r){"use strict";function s(t,e,i){if(function(){return"none"==this.setting.pager||this.getCurrentPageSize()>=this.data[this.setting.jsonReader.total]}.call(this))o.call(this,t,e,i);else{var n=this,a=this.data[this.setting.jsonReader.total];a>=h?$messager.confirm('当前内容总数[<strong style="color:red;">'+a+"</strong>]超过["+h+"]条，</br>数据处理需要较多时间，确认继续？",{okCall:function(){t||(t={}),t.ReportDetail||(t.ReportDetail={}),t.ReportDetail.DetailLoader?t.ReportDetail.DetailLoader.LimitRowNum=a:t.ReportDetail.DetailLoader={LimitRowNum:a},o.call(n,t,e,i,!0)}}):o.call(this,t,e,i,!0)}}function o(t,i,n,a){var s=d.call(this,t,a);if(i=function(t,i){var n=null;if(!e.isFunction(e.getDefaultPrintPaperSet))return i;if(!(n=e.getDefaultPrintPaperSet(t)))return i;i||(i={});i.Pager||(i.Pager=n.Pager);i.Direction||(i.Direction=n.Direction);i.MarginUp==undefined&&(isNaN(n.MarginUp)||(i.MarginUp=n.MarginUp));i.MarginDown==undefined&&(isNaN(n.MarginDown)||(i.MarginDown=n.MarginDown));i.MarginLeft==undefined&&(isNaN(n.MarginLeft)||(i.MarginLeft=n.MarginLeft));i.MarginRight==undefined&&(isNaN(n.MarginRight)||(i.MarginRight=n.MarginRight));i.OffsetX==undefined&&(isNaN(n.OffsetX)||(i.OffsetX=n.OffsetX));i.OffsetY==undefined&&(isNaN(n.OffsetY)||(i.OffsetY=n.OffsetY));return i}(s,i),s.PageFooter||(s.PageFooter={Center:{Title:"第[#SystemVar(PageNumber)#]页 共[#SystemVar(PageCount)#]页"}}),i)l.call(this,s,i,n,a);else{var o=this,h=r.getDefInstance().getPrintSet({ModuleId:"00000000"});$A.showWaitScreen("正在获取打印设置..."),e.when(h).done(function(t){l.call(o,s,t,n,a)}).fail(function(){$a.hideWaitScreen()})}}function l(t,e,i,n){var a={PrintData:t,PrintSet:e};"FastPrint"==i||("Print"==i?a.ShowPrintSet=!0:"Preview"==i?a.PrintPreview=!0:a.ExportFile=i),$A.showWaitScreen("正在打印中..."),r.getDefInstance().doCustomPrint(a).done(function(){$a.hideWaitScreen()}).fail(function(t){$A.hideWaitScreen(),t&&"timeout"==t.code||($A.messager.error("打印插件调用异常"),window.console&&window.console.log("打印插件调用异常",arguments))})}function d(t,i){var n={};return n.ReportDetail=function(t){function i(t){for(var e=0,n=0;n<t.length;n++){var a=t[n];a.SubHeaders?e+=i(a.SubHeaders):"left"==a.Frozen&&e++,delete a.Frozen}return e}function n(t){return t||(t=this.data[this.setting.jsonReader.rows]),function(t){var i=this._fieldColumns,n={},r=[];for(var s in i){var o=i[s],l=o.formatter;if(l){if(-1!=o.printType.indexOf("Number"))continue;if(o.template){n[s]=o.template;continue}e.isFunction(l)||(l=a.get(o.formatter)),e.isFunction(l)&&(n[s]=l)}}for(var d=0;d<t.length;d++){var h=e.extend({},t[d]);delete h.__rowId,r.push(h);for(var s in n)if(e.isFunction(n[s])){var c=n[s](h[s],h,d,i[s]);h[s]=function(t){var i=e("<span>"+t+"</span>").children();if(i.length>=1)return i.attr("printText")||i.attr("title")||i.text();return t}(c)}else h[s]=n[s].apply(h)}return r}.call(this,t)}var r={};r.DetailHeaders=function(){function t(i){if(i&&0!=i.length){for(var n=[],a=0;a<i.length;a++){var r={},s=i[a];if(!s.sysCol&&!s.hidden){n.push(r),r.Name=s.field,r.Title=s.title,r.Align=c[s.align],r.Frozen=s.viewPos,s.printWidth&&(r.Width=s.printWidth/10);var o=e.grid.getColumnFormatPattern(s);o&&(r.Format=o,r.DataType="Number"),s.summary&&(s.summary.text?r.Summary={Text:s.summary.text}:r.Summary={Function:u[s.summary.type]}),s.children&&(r.SubHeaders=t(s.children),r.Name=$a.uuid())}}return n}}return t(this.getColumnTree())}.call(this),r.FixCols=i(r.DetailHeaders),"none"!=this.setting.rownumbers&&r.FixCols++;e.isArray(t)?r.DetailDatas=n.call(this,t):t&&this.data[this.setting.jsonReader.total]>0?r.DetailLoader={Url:"http://"+window.location.host+window._contextPath+"/"+this.setting.url,QueryParam:JSON.stringify(this._getQueryParam()),JsonReader:{Total:"totalRecords",Rows:"data",Footer:"footer"}}:r.DetailDatas=n.call(this);r.HAlign=this.setting.halign,r.Nowrap=!0,"normal"==this.setting.rownumbers&&(r.RowNumber={SummaryText:""});return r}.call(this,i),e.extend(!0,n,t),n}e.grid||(e.grid={}),e.grid.getColumnFormatPattern=function(t){if(t.formatPattern)return t.formatPattern;var e=t.format;if(e&&"["==e.charAt(0)&&"]"==e.charAt(e.length-1))return e.substr(1,e.length-2);if(t.printType&&-1!=t.printType.indexOf("Number")){var i=parseInt(t.printType.substring("6")),n="#,##0";if(i>0){n+=".";for(var a=0;a<i;a++)n+="0"}return n}return"thousandsFormatter"==t.formatter?"#,##0.00;;#":"thousand"==t.formatter?"#,##0.00":"###,###(0)"==t.formatter?"#,##0;;#":void 0};var h=5e3,c={left:4,center:5,right:6},u={sum:1,avg:2,count:3,min:4,max:5};return t.create({print:function(t,e,i){o.call(this,t,e,"Print",i)},fastPrint:function(t,e){o.call(this,t,e,"FastPrint")},printPreview:function(t,e,i){o.call(this,t,e,"Preview",i)},exportExcel:function(t,e){o.call(this,t,e,"Excel")},printAll:function(t,e){s.call(this,t,e,"Print")},fastPrintAll:function(t,e){s.call(this,t,e,"FastPrint")},printPreviewAll:function(t,e){s.call(this,t,e,"Preview")},exportAllExcel:function(t,e){s.call(this,t,e,"Excel")},getPrintModel:function(t,e){return d.call(this,t,e)}})}),define("app/widgets/grid/app-grid-sort",["app/core/app-class","app/core/app-jquery","app/core/app-core","app/data/app-ajax"],function(t,e,i,n){"use strict";function a(t,e){return e=function(t,e){var i=this._sort;1==i.length&&""==e&&(e="asc");if(this.setting.multiSort){for(var n=!0,a=0;a<i.length;a++)if(i[a].col==t){i.splice(a,1),e&&i.push({col:t,order:e}),n=!1;break}n&&i.push({col:t,order:e})}else this._sort=[{col:t,order:e}],this.$tableHeader.find("td.asc").removeClass("asc"),this.$tableHeader.find("td.desc").removeClass("desc");return e}.call(this,t,e),this.setting.remoteSort?function(){var t=this;this._ajax(function(e){t._loadPagers(1,e[t.setting.jsonReader.total]),t._loadData(e,1),t.trigger("onSortColumn")})}.call(this):function(){this._sort.length>0?r.call(this,this.getRows()):this._setRows(this._oriRows.slice(0));this._rownumbers=this._rownumbers-this.getRows().length,this._loadBody(this.getRows(),this._rownumbers),this.$yProxyScroll&&this.$yProxyScroll.scrollTop(0);this._checkSummary(),this.trigger("onSortColumn")}.call(this),e}function r(t){this._oriRows||(this._oriRows=t.slice(0)),t.sort(e.proxy(s,this))}function s(t,i){function n(t,i,a,r){var s=a[r];if(!s)return 0;var o=s.col,l=s.order,d=0;if(r++,o){if(e.isFunction(o.sorter))d=o.sorter(t,i);else{var h=o.field,c=t[h],u=i[h];if(isNaN(c)||isNaN(u)||(c=parseFloat(c),u=parseFloat(u)),o.printType&&o.printType.indexOf("Number")>=0){if(isNaN(c)&&isNaN(u))return 0;if(isNaN(c))return-1;if(isNaN(u))return 1}d=c>u?1:c==u?0:-1}return"desc"==l&&(d=-d),0==d?n.call(this,t,i,a,r):d}return d}return n.call(this,t,i,this._sort,0)}return t.create({_appendSortable:function(t,i){if(t.sortable&&!(t.colspan>1)){var n=this;e('<span class="grid-header-sort"></span>').appendTo(i.find(">div")),i.css("cursor","pointer"),i.on("click.grid.api",function(){var t=e(this),i=t.attr("_cid"),r=n._column[i],s="",o="";t.hasClass("asc")?(s="asc",o="desc"):t.hasClass("desc")?(s="desc",o=""):(s="",o="asc"),!1!==n.trigger("beforeSortColumn",r.field,o)&&(o=a.call(n,r,o),t.removeClass(s),t.addClass(o))})}},_initSort:function(){(function(){var t=this.setting.sort;if(e.isArray(t)){var i=[],n=this;e(t).each(function(){var t=n._fieldColumns[this.field],e=n.$tableHeader.find("[_cid="+t._cid+"]");1==e.length&&(i.push({col:t,order:this.order}),e.addClass(this.order))}),this._sort=i}else this._sort=[]}).call(this);var t=this.setting.data;if(this._sort.length>0&&t){var i=null;i=e.isArray(t)?t:t[this.setting.jsonReader.rows],r.call(this,i)}},getCurrentSort:function(){var t=this._sort,e=[];if(0==t.length)return e;for(var i=0;i<t.length;i++)t[i].order&&e.push({field:t[i].col.field,order:t[i].order});return e},_sortData:function(){if(!this.setting.remoteSort){var t=this.getRows();t&&0!=t.length&&(delete this._oriRows,this._sort.length>0&&r.call(this,t))}}})}),define("app/widgets/grid/app-grid-summary",["app/core/app-class","app/core/app-jquery","app/core/app-core","app/data/app-ajax"],function(t,e,i,n){"use strict";function a(t,e,i){if(e.summary){var n=i[e.field];n||(n=0),function(t,e,i,n){if(e.text)return void(t[i]=e.text);n||(n=0);switch(e.type){case"sum":t[i]==undefined?t[i]=n:t[i]=r(t[i],n);break;case"avg":t[i]==undefined?(t["__"+i]=n,t["__count"+i]=1):(t["__"+i]=r(t["__"+i],n),t["__count"+i]++),t[i]=t["__"+i]/t["__count"+i];break;case"min":t[i]==undefined?t[i]=n:n<t[i]&&(t[i]=n);break;case"max":t[i]==undefined?t[i]=n:n>t[i]&&(t[i]=n);break;case"count":t[i]==undefined?t[i]=1:t[i]++}}(t,e.summary,e.field,parseFloat(n))}}function r(t,e){var i,n,a;try{i=t.toString().split(".")[1].length}catch(r){i=0}try{n=e.toString().split(".")[1].length}catch(r){n=0}return a=Math.pow(10,Math.max(i,n)),(Math.round(t*a)+Math.round(e*a))/a}return t.create({_appendSummary:function(){this._appendDefinedSummary(),this._appendCustomSummary()},_appendDefinedSummary:function(){if(0!=this._sumCols.length){var t=this.getRows();this.summaryRow=this._summary(t),this.summaryRow&&this._appendFooter([this.summaryRow])}},_appendCustomSummary:function(){var t=this.setting;if(t.summary&&t.summary._template){var e=null;e=t.summary.method?t.summary.method(this.getData()):this.getData();var i=t.summary._template.apply(e);this.$tableFooterCustom.append(i),this.$tableFooter.css("display","block"),this._fixHeight(),this._footerFollow()}},_summary:function(t){var e=this._sumCols;if(0==e.length)return null;var i={};if(t.length>0)for(var n=0;n<t.length;n++)for(var r=0;r<e.length;r++)a(i,e[r],t[n]);else for(r=0;r<e.length;r++){var s=e[r],o=s.summary;o&&(o.text?i[s.field]=o.text:i[s.field]=0)}return i}})}),define("app/widgets/grid/app-grid-ext",["app/core/app-class","app/core/app-jquery","app/core/app-core"],function(t,e,i){"use strict";function n(t,e){t._setFooterRows(e);for(var i in e){var n=t._fieldColumns[i];if(n){var a=t._getFormatText(n,e);t.$tableFooter.find('td[field="'+i+'"]>div').text(a)}}}var a=1;return t.create({_fitWordColumn:function(){if("Content"==this.setting.fitColumns){var t=this.$tableBodyMain.css("font-size"),i=function(t){var e={};for(var i in t){var n=t[i];n.sysCol||n.hidden||(e[i]=0)}return e}(this._fieldColumns);for(var n in i){this.$table.find("[field="+n+"]").each(function(){var a=e(this).text();if(a){var r=function(t,i){var n=e('<div style="font-size:'+i+';display: none;">'+t+"</div>");n.appendTo("body");var a=n.width();return n.remove(),a}(a,t);r>i[n]&&(i[n]=r)}})}for(var n in i){var r=this.$tableHeader.find('td[field="'+n+'"]'),s=r.outerWidth(),o=i[n]-s+20,l=r.attr("_cid"),d=r.outerWidth()-a+o;this.$table.find("td[_cid="+l+"]>div:not(.app-wrapper)").css("width",d),this._column[l].width=d}this._resetViewWidth(),this._footerFollow(),this._fixHeight(),function(t){var e=t.$tableHeaderMain.width()-t.$tableHeaderMain.find(">div>table").width();if(e>0){var i=t._getLast$Td(),n=i.attr("_cid"),r=i.outerWidth()-a+e;t.$table.find("td[_cid="+n+"]>div:not(.app-wrapper)").css("width",r),t._column[n].width=r;var s=i.data("freeWidth");s!=undefined&&(e+=s),i.data("freeWidth",e)}}(this)}},_onCheckSummary:function(){this.setting.checkSummary&&(this.$tableHeaderLeft.on("click.grid.api",'td[field="_rownumbers"]',e.proxy(this._checkSummary,this)),this.$tableHeaderLeft.on("click.grid.api",'td[field="_checkbox"]',e.proxy(this._checkSummary,this)),this.$tableHeaderLeft.on("click.grid.api",'td[field="_checkbox"] input',e.proxy(this._checkSummary,this)),this.$tableBodyLeft.on("click.grid.api",'td[field="_checkbox"]',e.proxy(this._checkSummary,this)),this.$tableBodyLeft.on("click.grid.api",'td[field="_checkbox"] input',e.proxy(this._checkSummary,this)),this.$tableBody.on("click.grid-row-check.api","tr.data-row td",e.proxy(this._checkSummary,this)))},_checkSummary:function(){var t=this.getSelections();0==t.length&&(t=this.getRows()),this.summaryRow=this._summary(t),e.isEmptyObject(this.summaryRow)||n(this,this.summaryRow)},resetSummary:function(){this.setting.checkSummary?this._checkSummary():(this.summaryRow=this._summary(this.getRows()),e.isEmptyObject(this.summaryRow)||n(this,this.summaryRow))}})}),define("app/widgets/grid/app-grid-pager",["app/core/app-class"],function(t){"use strict";return t.create({_initPagination:function(){var t=this.setting;if("none"!=t.pager){var e=this._initPagerElement();"all"!=t.pager&&"up"!=t.pager||(!t.title&&t.toolbar&&t.toolbar.length>0?e.appendTo(this.$toolbar):e.appendTo(this.$title)),"all"!=t.pager&&"down"!=t.pager||e.clone().appendTo(this.$element),this.$pagers=this.$element.find(".grid-pager"),this.$pagerUp=this.$element.find(".grid-header-title>.grid-pager"),this.$pagerDown=this.$element.find(">.grid-pager"),this.$switchView=this.$element.find(".grid-switchview"),this._bindPagerEvents()}},_initPagerElement:function(){var t=this.setting,e=t.pageNumber*t.pageSize,i=e-t.pageSize+1,n="",a="",r="";return t.pagerToolbarIcon&&t.pagerToolbarIcon.download&&(n='<td><span class="icon icon-download"></span></td>'),t.pagerToolbarIcon&&t.pagerToolbarIcon.print&&(a='<td><span class="icon icon-print"></span></td>'),t.switchView&&(r='<td><span title="网格视图" class="icon icon-gridview grid-switchview"></span></td><td><span class="icon icon-cardview grid-switchview"  title="卡片视图"></span></td>'),$('<div class="grid-pager"><div class="pager-infos"> <label>'+i+"</label> - <label>"+e+'</label>　共 <label>0</label> 条</div><table class="pager-tool" cellspacing="0" cellpadding="0"><tbody><tr><td><span class="icon icon-seek-first"></span></td><td><span class="icon icon-seek-prev"></span></td><td style="width: 4px;"><span class="separator"></span></td><td><input tabindex="-1" class="currPage" value="'+t.pageNumber+'"/>共<label class="totalPages">1</label>页</td><td style="width: 4px;"><span class="separator"></span></td><td><span class="icon icon-seek-next"></span></td><td><span class="icon icon-seek-end"></span></td><td><span class="icon icon-refresh"></span></td>'+n+a+r+"<td>"+this._getPageSizeSltHtml()+"</td></tr></tbody></table></div>")},getCurrentPageSize:function(){var t=this.$pagers.find(".pager-pagesize input").val();return t?Number(t):-1},_getPageSizeSltHtml:function(){(function(){for(var t=this.setting.pageList,e=this.setting.pageSize,i=0,n=0;n<t.length;n++){var a=t[n];if(a==e)return;e>a&&(i=n)}i>=0&&this.setting.pageList.splice(i,0,e)}).call(this);for(var t=this.setting,e='<div class="pager-pagesize"><select tabindex="-1" class="currPageSize">',i=0;i<t.pageList.length;i++){var n=t.pageList[i];e+='<option value="'+n+'"'+(t.pageSize==n?'selected="selected"':"")+">"+n+"</option>"}return e+='</select><input value="'+t.pageSize+'"/></div>'},_bindPagerEvents:function(){var t=this,e=this.$pagers,i=e.find(".currPage"),n=e.find(".totalPages");e.find(".currPageSize").on("change.grid.pagination.api",function(){var i=$(this).val();e.find(".currPageSize").val(i),e.find(".pager-pagesize input").val(i),t.loadForPage(1)}).on("click.grid.pagination.api",function(t){t.stopPropagation()}),e.find(".icon-seek-first").on("click.grid.pagination.api",function(){t.loadForPage(1)}),e.find(".icon-seek-prev").on("click.grid.pagination.api",$.proxy(this.prevPage,this)),i.on("focus.grid.pagination.api",function(t){var e=$(this);e.data("oriText",e.val()),e.one("blur.grid.pagination.api",function(t){var e=$(this);e.val(e.data("oriText"))})}).on("keydown.grid.pagination.api",function(e){var i=e.keyCode;if(i>=48&&i<=57||8==i||46==i)return!0;if(13==i){var a=$(this),r=parseInt(a.val()),s=parseInt(n.html());!isNaN(r)&&r>=1&&r<=s&&(a.data("oriText",r),t.loadForPage(r)),t._combogrid&&t._combogrid.focus()}}).on("click.grid.pagination.api",function(t){t.stopPropagation()}),e.find(".icon-seek-next").on("click.grid.pagination.api",$.proxy(this.nextPage,this)),e.find(".icon-seek-end").on("click.grid.pagination.api",function(){var e=n.html();"0"==e&&(e=1),t.loadForPage(e)}),e.find(".icon-refresh").on("click.grid.pagination.api",function(){t.reload()}),e.find(".icon-download").on("click.grid.pagination.api",function(){t.exportExcel()}),e.find(".icon-print").on("click.grid.pagination.api",function(){t.print()}),e.find(".pager-pagesize input").on("focus.grid.pagination.api",function(){var t=$(this);t.data("oriText",t.val()),t.one("blur.grid.pagination.api",function(t){var e=$(this);e.val(e.data("oriText"))})}).on("keydown.grid.pagination.api",function(i){var n=i.keyCode;if(n>=48&&n<=57||8==n||46==n)return!0;var a=$(this);if(13==n){var r=a.val(),s=parseInt(r,10);if(!isNaN(s)){s=parseInt(r,10);var o=function(){for(var e=t.setting.pageList,i=0,n=0;n<e.length;n++)e[n]>i&&(i=e[n]);return i}();s>o&&(s=o),e.find(".pager-pagesize input").val(s),e.find(".pager-pagesize input").data("oriText",s),e.find(".currPageSize").val(s),t.loadForPage(1)}}}),this.$switchView.on("click.grid.pagination.api",function(){var e=$(this);e.hasClass("icon-gridview")&&(t.viewType="GridView"),e.hasClass("icon-cardview")&&(t.viewType="CardView"),t._switchView(t.viewType,!0)})},prevPage:function(){if(this.$pagers&&this.$pagers.length>0){var t=this.$pagers.find(".currPage"),e=this.$pagers.find(".totalPages"),i=1,n=parseInt(t.val());0==(i=1==n?parseInt(e.html()):n-1)&&(i=1),this.loadForPage(i)}},nextPage:function(){if(this.$pagers&&this.$pagers.length>0){var t=this.$pagers.find(".currPage"),e=this.$pagers.find(".totalPages"),i=1,n=parseInt(t.val()),a=parseInt(e.html());i=n==a?1:n+1,0==a&&(i=1),this.loadForPage(i)}},loadForPage:function(t){if(!isNaN(t)){var e=this,i=function(){if(t>1)return e.getFooterRows()}();this._ajax(function(n){e._loadPagers(t,n[e.setting.jsonReader.total]),e._loadData(n,e._getStarRowNumber()),function(t){e.setting.keepFooter&&e.appendFooter(t)}(i)},{page:t})}},_loadPagers:function(t,e){if(this.$pagers&&0!=this.$pagers.length){var i=this.$pagers;if(i.find(".currPage").val(t),i){var n=parseInt(i.find(".pager-pagesize input").val()),a=t*n,r=this._rownumbers=a-n+1,s=i.find(".pager-infos>label:first");if(s.html(r),s.next().html(a),e!=undefined){var o=Math.ceil(e/n);i.find(".pager-tool .totalPages").html(o),s.next().next().html($A.utils.formatNumber(e,0)),"repeat"==this.setting.rownumbers&&(this._rownumbers=1)}}}},getCurrentPager:function(){if(this.$pagers&&this.$pagers.length>0){var t={};return t.page=parseInt(this.$pagers.find(".currPage").val()),t.rows=parseInt(this.$pagers.find(".pager-pagesize input").val()),t}return null},_pagerAddRow:function(){if(this.$pagers){var t=this.$pagers.find(".pager-infos label:last"),e=t.text();e=parseInt(e.replaceAll(",",""))+1,t.text($A.utils.formatNumber(e,0))}},_pagerDeleteRow:function(){if(this.$pagers){var t=this.$pagers.find(".pager-infos label:last"),e=t.text();e=parseInt(e.replaceAll(",",""))-1,t.text($A.utils.formatNumber(e,0))}},hidePager:function(){this.$pagers.hide(),this.resize()},showPager:function(){this.$pagers.show(),this.resize()},_hasPager:function(){return this.$pagers&&this.$pagers.length>0},_setPagerDownCss:function(t){this.$pagerDown&&this.$pagerDown.css(t)},_getPagerDownHeight:function(){return this.$pagerDown&&this.$pagerDown.is(":visible")?this.$pagerDown.outerHeight():0},getPageIndex:function(){return this.$pagers&&this.$pagers.length>0?this.$pagers.find(".currPage").val():-1},_getStarRowNumber:function(){var t=1;return"repeat"!=this.setting.rownumbers&&this.$pagers&&this.$pagers.length>0&&(t=parseInt(this.$pagers.find(".pager-infos>label:first").html())),t},_hasTitlePager:function(){return this.$title.find(".grid-pager").length>0}})}),define("app/widgets/grid/app-grid-merger",["app/core/app-class"],function(t){"use strict";function e(t){for(var e=null,i=null,n=1,a=this.$tableBody.find('td[field="'+t+'"]'),r=0;r<a.length;r++){var s=$(a[r]);0==r?(e=s,n=1):!function(t,e){var i=t.text();return""!=i&&i==e.text()}(i,s)?(e=s,n=1):(n++,s.addClass("grid-cell-merger"),e.attr("rowSpan",n)),i=s}}return t.create({mergeColumns:function(t){if($.isArray(t))if(this.setting.mergeGroup)(function(t){for(var e=null,i=null,n=1,a=t.length,r=function(t){for(var e=[],i=0;i<a;i++)e.push(this.$tableBody.find('td[field="'+t[i]+'"]'));return e}.call(this,t),s=0;s<r[0].length;s++){var o=function(t,e){for(var i=[],n=0;n<a;n++)i.push($(t[n][e]));return i}(r,s);0==s?(e=o,n=1):function(t,e){for(var i=0;i<e.length;i++){var n=e[i],a=t[i],r=n.text();if(a.text()!=r)return!1}return!0}(i,o)?function(t,e,i){for(var n=0;n<e.length;n++)e[n].addClass("grid-cell-merger"),t[n].attr("rowSpan",i)}(e,o,++n):(e=o,n=1),i=o}}).call(this,t);else for(var i=0;i<t.length;i++)e.call(this,t[i]);else e.call(this,t)}})}),define("app/widgets/menu/app-menu",["app/core/app-jquery","app/core/app-core","app/core/app-options","app/widgets/app-widget"],function($,$A,Options,Widget){var Menu=Widget.extend({initialize:function(t,e){Menu.superclass.initialize.call(this,e),e||(e={}),this.element=t,$.data(t,"menu",{options:$.extend({},Options.appDefaults.Menu,e,this.parseOptions(t))})},parseOptions:function(t){var e=$(t);return $.extend({},e.parseOptions(t,[{minWidth:"number",duration:"number",hideOnUnhover:"boolean"}]))},init:function(t){function e(i){var n=[];return i.addClass("menu"),n.push(i),i.hasClass("menu-content")||i.children("div").each(function(){var i=$(this).children("div");if(i.length){i.insertAfter(t),this.submenu=i;var a=e(i);n=n.concat(a)}}),n}var i=this;$(t).addClass("menu-top"),$(document).unbind(".menu").bind("mousedown.menu",function(t){$(t.target).closest("div.menu,div.combo-p").length||$("body>div.menu-top:visible").menu("hide")});for(var n=e($(t)),a=0;a<n.length;a++)!function(e){e.appendTo($A.getContainer());var n=$(e).parseOptions(e[0],["width","height"]);e[0].originalHeight=n.height||0,e.hasClass("menu-content")?e[0].originalWidth=n.width||e._outerWidth():(e[0].originalWidth=n.width||0,e.children("div").each(function(){var e=$(this),n=$.extend({},e.parseOptions(this,["name","iconCls","href",{separator:"boolean"}]),{disabled:!!e.attr("disabled")||undefined});if(n.separator&&e.addClass("menu-sep"),!e.hasClass("menu-sep")){e[0].itemName=n.name||"",e[0].itemHref=n.href||"";var a=e.addClass("menu-item").html();e.empty().append($('<div class="menu-text"></div>').html(a)),n.iconCls&&$('<div class="menu-icon"></div>').addClass(n.iconCls).appendTo(e),n.iconCls||e.addClass("menu-item-noico"),n.disabled&&i._setDisabled(t,e[0],!0),e[0].submenu&&$('<div class="menu-rightarrow"></div>').appendTo(e),i.bindMenuItemEvent(t,e)}}),$('<div class="menu-line"></div>').prependTo(e)),i._setMenuSize(t,e),e.hide(),i.bindMenuEvent(t,e)}(n[a])},_setMenuSize:function(t,e){t.length&&t.length>0&&(t=t[0]);var i=$.data(t,"menu").options,n=e.attr("style")||"";e.css({display:"block",left:-1e4,height:"auto",width:"auto",overflow:"hidden"});var a=e[0],r=a.originalWidth||0;r||(r=0,e.find("div.menu-text").each(function(){r<$(this)._outerWidth()&&(r=$(this)._outerWidth()),$(this).closest("div.menu-item")._outerHeight($(this)._outerHeight()+2)}),r+=12),r=Math.max(r,i.minWidth);var s=a.originalHeight||0;if(!s)if(s=e.outerHeight(),e.hasClass("menu-top")&&i.alignTo){var o=$(i.alignTo),l=o.offset().top-$(document).scrollTop(),d=$(window)._outerHeight()+$(document).scrollTop()-o.offset().top-o._outerHeight();s=Math.min(s,Math.max(l,d))}else s>$(window)._outerHeight()?(s=$(window).height(),n+=";overflow:auto"):n+=";overflow:hidden";var h=Math.max(a.originalHeight,e.outerHeight())-2;e._outerWidth(r)._outerHeight(s),e.children("div.menu-line")._outerHeight(h),n+=";width:"+a.style.width+";height:"+a.style.height,e.attr("style",n)},bindMenuEvent:function(t,e){var i=$(t).data("menu"),n=this;e.unbind(".menu").bind("mouseenter.menu",function(){i.timer&&(clearTimeout(i.timer),i.timer=null)}).bind("mouseleave.menu",function(){i.options.hideOnUnhover&&(i.timer=setTimeout(function(){n._hideAll(t)},i.options.duration))})},bindMenuItemEvent:function(t,e){if(e.hasClass("menu-item")){var i=this;e.unbind(".menu"),e.bind("click.menu",function(){if(!$(this).hasClass("menu-item-disabled")){if(!this.submenu){i._hideAll(t);var e=this.itemHref;e&&(location.href=e)}var n=$(t).menu("getItem",this);$.data(t,"menu").options.onClick.call(t,n)}}).bind("mouseenter.menu",function(n){if(e.siblings().each(function(){this.submenu&&i._hideMenu(this.submenu),$(this).removeClass("menu-active")}),e.addClass("menu-active"),$(this).hasClass("menu-item-disabled"))e.addClass("menu-active-disabled");else{var a=e[0].submenu;a&&$(t).menu("show",{menu:a,parent:e})}}).bind("mouseleave.menu",function(t){e.removeClass("menu-active menu-active-disabled");var n=e[0].submenu;n?t.pageX>=parseInt(n.css("left"))?e.addClass("menu-active"):i._hideMenu(n):e.removeClass("menu-active")})}},_hideAll:function(t){var e=$.data(t,"menu");return e&&$(t).is(":visible")&&(this._hideMenu($(t)),e.options.onHide.call(t)),!1},_showMenu:function(t,e){function i(t,e){return t+r.outerHeight()>$(window)._outerHeight()+$(document).scrollTop()&&(t=e?$(e).offset().top-r._outerHeight():$(window)._outerHeight()+$(document).scrollTop()-r.outerHeight()),t<0&&(t=0),t}var n,a,r=$((e=e||{}).menu||t);if(e.alignTo&&e.autoWidth){var s=$(e.alignTo);$(t).menu("setSize",{width:s.width()})}if($(t).menu("resize",r[0]),r.hasClass("menu-top")){var o=$.data(t,"menu").options;if($.extend(o,e),n=o.left,a=o.top,o.alignTo){var l;s=$(o.alignTo);n=(l=r.parent()[0]==s.parent()[0]?s.position():s.offset()).left,a=l.top+s._outerHeight(),"right"==o.align&&(n+=s.outerWidth()-r.outerWidth())}n+r.outerWidth()>$(window)._outerWidth()+$(document)._scrollLeft()&&(n=$(window)._outerWidth()+$(document).scrollLeft()-r.outerWidth()-5),n<0&&(n=0),a=i(a,o.alignTo)}else{var d=e.parent;(n=d.offset().left+d.outerWidth()-2)+r.outerWidth()+5>$(window)._outerWidth()+$(document).scrollLeft()&&(n=d.offset().left-r.outerWidth()+2),a=i(d.position().top-3)}r.css({left:n,top:a}),r.show(0,function(){r[0].shadow||(r[0].shadow=$('<div class="menu-shadow"></div>').insertAfter(r)),r[0].shadow.css({display:"block",zIndex:Options.appDefaults.Menu.zIndex++,left:r.css("left"),top:r.css("top"),width:r.outerWidth(),height:r.outerHeight()}),r.css("z-index",Options.appDefaults.Menu.zIndex++),r.hasClass("menu-top")&&$.data(r[0],"menu").options.onShow.call(r[0])})},hide:function(t){var e=this;return t.each(function(){e._hideAll(this)})},_hideMenu:function(t){var e=this;t&&(!function(t){t.stop(!0,!0),t[0].shadow&&t[0].shadow.hide(),t.hide()}(t),t.find("div.menu-item").each(function(){this.submenu&&e._hideMenu(this.submenu),$(this).removeClass("menu-active")}))},show:function(t,e){var i=this;return t.each(function(){i._showMenu(this,e)})},resize:function(t,e){var i=this;return t.each(function(){i._setMenuSize(this,$(e))})},findItem:function(t,e){function i(r){r.children("div.menu-item").each(function(){var r=$(t).menu("getItem",this),s=a.empty().html(r.text).text();e==$.trim(s)?n=r:this.submenu&&!n&&i(this.submenu)})}var n=null,a=$("<div></div>");return i($(t)),a.remove(),n},_setDisabled:function(t,e,i){var n=$(e);n.hasClass("menu-item")&&(i?(n.addClass("menu-item-disabled"),e.onclick&&(e.onclick1=e.onclick,e.onclick=null)):(n.removeClass("menu-item-disabled"),e.onclick1&&(e.onclick=e.onclick1,e.onclick1=null)))},appendItem:function(target,param){var menu=$(target);if(param.parent){if(!param.parent.submenu){var submenu=$('<div class="menu"><div class="menu-line"></div></div>').appendTo("body");submenu.hide(),param.parent.submenu=submenu,$('<div class="menu-rightarrow"></div>').appendTo(param.parent)}menu=param.parent.submenu}if(param.separator)var item=$('<div class="menu-sep"></div>').appendTo(menu);else{var item=$('<div class="menu-item"></div>').appendTo(menu);$('<div class="menu-text"></div>').html(param.text).appendTo(item)}param.iconCls&&$('<div class="menu-icon"></div>').addClass(param.iconCls).appendTo(item),param.id&&item.attr("id",param.id),param.name&&(item[0].itemName=param.name),param.href&&(item[0].itemHref=param.href),param.onclick&&("string"==typeof param.onclick?item.attr("onclick",param.onclick):item[0].onclick=eval(param.onclick)),param.handler&&(item[0].onclick=eval(param.handler)),param.disabled&&this._setDisabled(target,item[0],!0),this.bindMenuItemEvent(target,item),this.bindMenuEvent(target,menu),this._setMenuSize(target,menu)},removeItem:function(t,e){function i(t){if(t.submenu){t.submenu.children("div.menu-item").each(function(){i(this)});var e=t.submenu[0].shadow;e&&e.remove(),t.submenu.remove()}$(t).remove()}var n=$(e).parent();i(e),this._setMenuSize(t,n)},options:function(t){return $(t).data("menu").options},_setVisible:function(t,e,i){var n=$(e).parent();i?$(e).show():$(e).hide(),this._setMenuSize(t,n)},destroy:function(t){this._destroyMenu(this.element)},_destroyMenu:function(t){var e=this;$(t).children("div.menu-item").each(function(){e.removeItem(t,this)}),t.shadow&&t.shadow.remove(),$(t).remove()},setText:function(t,e){return t.each(function(){$(e.target).children("div.menu-text").html(e.text)})},setIcon:function(t,e){return t.each(function(){$(e.target).children("div.menu-icon").remove(),e.iconCls&&$('<div class="menu-icon"></div>').addClass(e.iconCls).appendTo(e.target)})},getItem:function(t,e){var i=$(e),n={target:e,id:i.attr("id"),text:$.trim(i.children("div.menu-text").html()),disabled:i.hasClass("menu-item-disabled"),name:e.itemName,href:e.itemHref,onclick:e.onclick},a=i.children("div.menu-icon");if(a.length){for(var r=[],s=a.attr("class").split(" "),o=0;o<s.length;o++)"menu-icon"!=s[o]&&r.push(s[o]);n.iconCls=r.join(" ")}return n},enableItem:function(t,e){var i=this;return t.each(function(){i._setDisabled(this,e,!1)})},disableItem:function(t,e){var i=this;return t.each(function(){i._setDisabled(this,e,!0)})},showItem:function(t,e){var i=this;return t.each(function(){i._setVisible(this,e,!0)})},hideItem:function(t,e){var i=this;return t.each(function(){i._setVisible(this,e,!1)})},_setSize:function(t,e){var i=$.data(t,"menu").options;e&&(e.width&&(i.width=e.width),e.height&&(i.height=e.height)),i.width&&$(t).outerWidth(i.width),i.height&&$(t).outerHeight(i.height)},setSize:function(t,e){var i=this;return t.each(function(){i._setSize(this,e)})}});return $.fn.menu=function(t,e){var i=undefined,n=this.each(function(){var n=$(this),a=n.data("menuObj"),r=n.data("menu"),s="object"==typeof t&&t;r?$.extend(r.options,s):(n.data("menuObj",a=new Menu(this,s)),a.init(this)),"string"==typeof t&&(i=a[t](n,e))});return i===undefined?n:i},$.fn.menu.Constructor=Menu,Menu}),define("app/widgets/button/app-menubutton",["app/core/app-jquery","app/core/app-core","app/core/app-options","app/widgets/menu/app-menu","app/widgets/button/app-button"],function(t,e,i,n,a){var r=a.extend({initialize:function(e){e||(e={}),a.superclass.initialize.call(this,e),this.attrs=t.extend({},i.appDefaults.MenuButton,e,this.parseOptions()),this.init()},parseOptions:function(){var e=t(this.element);return t.extend({},e.parseOptions(this.element,{disabled:"true"==t(this).attr("disabled"),plain:"false"!=t(this).attr("plain"),menu:t(this).attr("menu"),duration:parseInt(t(this).attr("duration"))||100}))},init:function(){function e(){var e=r.offset().left;e+t(a.menu).outerWidth()+5>t(window).width()&&(e=t(window).width()-t(a.menu).outerWidth()-5),t(".menu-top").menu("hide"),t(a.menu).menu("show",{alignTo:r,autoWidth:!0,menuAlign:a.menuAlign}),r.blur()}function i(){return t(n).button("options").disabled}var n=this.element,a=this.attrs;"string"==typeof a.menu&&a.menu&&a.menu.indexOf("#")<0&&(a.menu="#"+a.menu);var r=t(n);r.removeClass("m-btn-active m-btn-plain-active").addClass("m-btn"),r.button(a);var s=r.find(".l-btn-left");if(t("<span></span>").addClass("m-btn-downarrow").appendTo(s),t("<span></span>").addClass("m-btn-line").appendTo(s),a.menu&&t(a.menu).menu({onShow:function(){r.addClass(1==a.plain?"m-btn-plain-active":"m-btn-active")},onHide:function(){r.removeClass(1==a.plain?"m-btn-plain-active":"m-btn-active")}}),r.unbind(".menubutton"),a.menu){r.bind("click.menubutton",function(){if(!i())return e(),!1});var o=null;r.bind("mouseenter.menubutton",function(){if(!i())return o=setTimeout(function(){e()},a.duration),!1}).bind("mouseleave.menubutton",function(){o&&clearTimeout(o),t(a.menu).triggerHandler("mouseleave")})}},_setDisabled:function(e,i){var n=this.attrs;e=this.element;i?(n.disabled=!0,t(e).button("disable")):(n.disabled=!1,t(e).enable("enable"))},enable:function(t){this._setDisabled(!1)},disable:function(t){this._setDisabled(!0)},destroy:function(){var e=this.attrs;e.menu&&t(e.menu).length&&t(e.menu).data("menuObj").destroy()}});return t.fn.menubutton=function(e){var i=undefined,n=this.each(function(){var n=t(this),a=n.data("menubuttonObj"),s=(n.data("menubutton"),"object"==typeof e?e:{});a?t.extend(a.attrs,s):(s=t.extend({},s,{element:this}),n.data("menubuttonObj",a=new r(s)),t(this).removeAttr("disabled")),"string"==typeof e&&(i=a[e](n))});return i===undefined?n:i},r}),define("app/widgets/grid/app-grid-toolbar",["app/core/app-class","app/core/app-core","app/widgets/button/app-menubutton"],function(t,e){"use strict";return t.create({_initToolbar:function(){var t=this.setting.toolbar;if(t&&0!=t.length)for(var i=this.$toolbar.find(">ul"),n=0;n<t.length;n++){var a=t[n],r=null;a.id||(a.id=e.uuid()),r=a.children&&a.children.length>0?function(t){var i=$('<a id="'+t.id+'" >'+t.text+"</a>");return t.menuId=e.uuid(),function(t){for(var i=t.children,n=$('<div id="'+t.menuId+'" style="'+t.menuStyle+';display:none;"></div>'),a=0;a<i.length;a++){var r=i[a];r.menuSep?n.append('<div class="menu-sep"></div>'):function(t){t.id||(t.id=e.uuid());var i=$('<div id="'+t.id+'" '+function(t){var e="";return t.iconCls&&(e+="iconCls:'"+t.iconCls+"'"),e&&(e='data-options="'+e+'"'),e}(t)+">"+t.text+"</div>");n.append(i),i.on("click.grid.toolbar.api",function(e){t.handler&&t.handler()})}(r)}$.$appPanelContainer.append(n)}(t),i.menubutton({iconCls:t.iconCls,onClick:t.handler,plain:!1,menu:t.menuId,menuStyle:t.style?t.style:"width:150px"}),i}(a):function(t){var e=$('<a id="'+t.id+'" >'+t.text+"</a>");return e.button({iconCls:t.iconCls,onClick:t.handler}),e}(a),i.append($("<li>").append(r))}},disableToolbarBtn:function(t){this.$toolbar.find("#"+t).button("disable")},enableToolbarBtn:function(t){this.$toolbar.find("#"+t).button("enable")}})}),define("app/widgets/grid/app-grid",["app/core/app-base","app/core/app-jquery","app/core/app-options","app/core/app-core","app/data/app-ajax","app/widgets/grid/app-grid-headerContextMenu","app/widgets/grid/app-grid-editor","app/widgets/grid/app-grid-formatter","app/widgets/grid/app-grid-print","app/widgets/grid/app-grid-sort","app/widgets/grid/app-grid-summary","app/widgets/grid/app-grid-ext","app/widgets/grid/app-grid-pager","app/widgets/grid/app-grid-merger","app/widgets/grid/app-grid-toolbar","jquery/jquery.mousewheel"],function(Base,$,Options,App,AppAjax,GridHeaderContextMenu,GridEditor,Formatter,GridPrint,GridSort,GridSummary,GridExt,GridPager,GridMerger,GridToolbar){"use strict";function atOnceMoment(t,e,i){var n=i._ts[e];return i._ts[e]=t.timeStamp,!!n&&t.timeStamp-n<Options.appDefaults.Grid.dblOnce}function escapeHtml(t){return $("<div>"+t+"</div>").text()}function updateColumnTitle(){var t=this._titleVarColumns,e=this.getParameter();if(t&&e)for(var i in t){var n=t[i],a=resolveTitleVar(n.titleVar,e);n.title=a||n.oriTitle,this.$tableHeader.find("td[_cid="+n._cid+"]>div:first").text(n.title)}}function resolveTitleVar(exp,params){var result="",expReg=/\{([\w-]+)\}/g;if(expReg.test(exp))if(result=exp.replace(expReg,function(t,e){var i=params[e];return i=i!==undefined?params[e]:"{"+e+"}"}),expReg.test(result))result="";else try{result=eval(result)}catch(e){}else result=params[exp];return result}function setDataRowHeight(){if(!this._rowHeight){if("normal"==this.setting.rownumbers||"repeat"==this.setting.rownumbers)this._rowHeight=this.$tableBodyLeft.find("tr:eq(0)").outerHeight();else if(this.setting.mergeColumns&&this.setting.mergeColumns.length>0){var t=$("<tr><td><div></div></td></tr>");this.$tableBodyMain.find("table").prepend(t),this._rowHeight=t.outerHeight(),t.remove()}else this._rowHeight=this.$tableBodyMain.find("tr:eq(0)").outerHeight();window.ActiveXObject||"ActiveXObject"in window||(this._rowHeight+=1)}}function headBtnTdClick(t){var e=$(this).find("a");1==e.length&&e.trigger("click")}var scrollBarWidth=18,cellBorderWidth=1,minWidth=20,currentRowCls="row-mad-biz-relt-unit",hoverRowCls="row-hover",selectedRowCls="row-selected",checkedRowCls="row-checked",loading="正在努力加载中...",empty="无记录",error="数据加载出错",IE8_TD_EMPTY=" ",VIEW_TYPE={GRID_VIEW:"GridView",CARD_VIEW:"CardView"},Grid=Base.extend({Implements:[GridHeaderContextMenu,GridEditor,GridPrint,GridSort,GridSummary,GridExt,GridPager,GridMerger,GridToolbar],initialize:function(t,e){this.$t=$(t).css({display:"none"}),this.$t.removeClass("app-grid"),this.options=$.extend(!0,{},e),this._init()},_init:function(){this._initOptions(),this._eventRegister(),this._initElement(),this._initToolbar(),this._initPagination(),this._initHeaderHtml(),this._switchView(this.viewType,!1),this._fixHeight(),this._initData(),this._fit(),this._registEvents(),this._initEditor(),this._initContextMenu()},_switchView:function(t,e){if(this.$tableBodyMain.find(">div>table>tbody").html(""),t==VIEW_TYPE.GRID_VIEW&&(this.$tableBody.removeClass("grid-card-view"),this.$tableHeader.show(),this.setting.view&&this.setting.view.region&&this.$cardRegion[this.setting.view.region].find(".grid-body-card-form").hide(),this.setting.view.cardListTpl)){if(this.$cardRegion.center.find(".grid-card-view-list").length>0){var i=this.$cardRegion.center.find(".grid-body-content"),n=i.children();i.append(this.$cardRegion.center.find(".grid-view")),n.remove()}this.$cardRegion.center.find(".grid-view").show()}if(t==VIEW_TYPE.CARD_VIEW){if(this.$cardRegion[this.setting.view.region].find(".grid-body-card-form").show(),this.setting.view.formEl&&(this.setting.view.loadForm||("string"==typeof this.setting.view.formEl?(this.$cardRegion[this.setting.view.region].find(".grid-body-card-form").append($A("#"+this.setting.view.formEl)),this.setting.view.formEl=$A("#"+this.setting.view.formEl)):this.$cardRegion[this.setting.view.region].find(".grid-body-card-form").append(this.setting.view.formEl),this.setting.view.loadForm=!0),this.setting.view.formEl.show()),this.$tableBody.addClass("grid-card-view"),this.setting.view.cardListTpl&&0==this.$cardRegion.center.find(".grid-card-view-list").length){var a=$(this.setting.view.cardListTpl);this.$cardRegion.center.find(".grid-body-content").append(a),a.find(".grid-card-view-list").append(this.$cardRegion.center.find(".grid-view"))}this.$tableHeader.hide(),this.$tableBodyMessage.hide()}e&&(this._loadData(this.data,1),this.resize())},_initOptions:function(){var t=$.extend(this._getAttrOptions(),this.options);$.isFunction(t.beforeRender)&&t.beforeRender.call(this,t);var e=this.setting=$.extend({},Options.appDefaults.Grid,t);if(this.setting.columnManager=!1,this._column={},this._fieldColumns={},this._operator={},this._rowData={},this._ts={},this._newData={updated:{},inserted:{},deleted:{}},this.editor={},e.id||(e.id=App.uuid()),0==e.headRowHeight&&(e.headRowHeight=Options.appDefaults.Grid.headRowHeight),e.url||(e.url=e.action),"push"!=e.height&&(t.follow||(e.follow="none"),this.$t.parent().addClass("app-grid-wrap")),e.checkbox=e.checkbox||1==e.multiple,this.data={},this.data[this.setting.jsonReader.rows]=[],e.columns||(e.columns=[[]]),e.frozenColumns||(e.frozenColumns=[[]]),e.frozenColumnsRight||(e.frozenColumnsRight=[[]]),this._splitColumns(),e.queryParams&&this.setParameter(e.queryParams),e.fixedParams&&this.setFixedParameter(e.fixedParams),this._sumCols=[],this._sumColMap={},this._initSystemCol(),this._initFormula(),this._initViewColumns(),this._markChildrenAndParent(),this._rownumbers=1,e.summary&&e.summary.template&&(e.summary._template=new Template(e.summary.template)),!$.isArray(e.columns[0])||e.columns[0].length<1)throw new Error("columns非二维数组，或无实体列存在");this.setting.view&&this.setting.view.isDefault?this.viewType=this.setting.view.type:this.viewType=VIEW_TYPE.GRID_VIEW},_splitColumns:function(){function t(t,e,i){if(t.length<=i)for(var n=0;n<=i;n++)$.isArray(t[i])||t.push([]);t[i].push(e)}for(var e=this.setting,i=e.columns,n=0;n<i.length;n++)for(var a=0;a<i[n].length;a++){"left"==(r=i[n][a]).frozen?t(e.frozenColumns,r,n):"right"==r.frozen&&t(e.frozenColumnsRight,r,n)}for(n=0;n<i.length;n++)for(a=0;a<i[n].length;a++){var r;"left"!=(r=i[n][a]).frozen&&"right"!=r.frozen||(i[n].splice(a,1),a--)}},_eventRegister:function(){var t=this.setting;$.isFunction(t.afterDataRender)&&this.on("afterDataRender",t.afterDataRender),$.isFunction(t.beforeBeginEdit)&&this.on("beforeBeginEdit",t.beforeBeginEdit),$.isFunction(t.beforeEndEdit)&&this.on("beforeEndEdit",t.beforeEndEdit),$.isFunction(t.beforeLoad)&&this.on("beforeLoad",t.beforeLoad),$.isFunction(t.beforeSelect)&&this.on("beforeSelect",t.beforeSelect),$.isFunction(t.beforeSortColumn)&&this.on("beforeSortColumn",t.beforeSortColumn),$.isFunction(t.onBeginEdit)&&this.on("onBeginEdit",t.onBeginEdit),$.isFunction(t.onClickCell)&&this.on("onClickCell",t.onClickCell),$.isFunction(t.onClickRow)&&this.on("onClickRow",t.onClickRow),$.isFunction(t.onDataChange)&&this.on("onDataChange",t.onDataChange),$.isFunction(t.onDblClickCell)&&this.on("onDblClickCell",t.onDblClickCell),$.isFunction(t.onDblClickRow)&&this.on("onDblClickRow",t.onDblClickRow),$.isFunction(t.onEndEdit)&&this.on("onEndEdit",t.onEndEdit),$.isFunction(t.onLoadSuccess)&&this.on("onLoadSuccess",t.onLoadSuccess),$.isFunction(t.onSelect)&&this.on("onSelect",t.onSelect),$.isFunction(t.onSelectAll)&&this.on("onSelectAll",t.onSelectAll),$.isFunction(t.onSortColumn)&&this.on("onSortColumn",t.onSortColumn),$.isFunction(t.onUnselect)&&this.on("onUnselect",t.onUnselect),$.isFunction(t.onUnselectAll)&&this.on("onUnselectAll",t.onUnselectAll),$.isFunction(t.rowCls)&&this.on("rowCls",t.rowCls)},_getAttrOptions:function(){var t=App.getAttrFromElement(this.$t),e=this._getColumnOptions();return e.length>0&&(t.columns=e),t},_getColumnOptions:function(){var t=[];return this.$t.find(">thead>tr").each(function(){var e=[];$(this).find(">th").each(function(){var t=App.getAttrFromElement($(this));t.title=this.innerHTML,e.push(t)}),t.push(e)}),t},_initSystemCol:function(){var t=this.setting;if(t.checkbox){var e={};e.sysCol=!0,e.resizable=!1,e.field="_checkbox",e.title='<input type="checkbox" />',e._html=e.title,e.width=30,e.showTree=!1,e.rowspan=t.columns.length,t.frozenColumns[0].unshift(e)}else if(t.radiobox){var i={};i.sysCol=!0,i.resizable=!1,i.field="_radiobox",i.title='<input name="'+App.uuid()+'" type="radio"/>',i._html=i.title,i.width=30,i.showTree=!1,i.rowspan=t.columns.length,t.frozenColumns[0].unshift(i)}if("normal"==t.rownumbers||"repeat"==t.rownumbers){var n={};n.sysCol=!0,n.resizable=!1,n.field="_rownumbers",n.title="序号",n.cls="grid-row-head",n.width=30,n.showTree=!1,n.rowspan=t.columns.length,t.frozenColumns[0].unshift(n)}},_initFormula:function(){var t=this.setting;t.formulaContainer=[],this._initFormulaColumn(t.frozenColumns),this._initFormulaColumn(t.frozenColumnsRight),this._initFormulaColumn(t.columns)},_initFormulaColumn:function(t){for(var e=0;e<t.length;e++)for(var i=0;i<t[e].length;i++){var n=t[e][i];if(n.field&&n.formula){var a=n.formula;a=(a=a.replace(new RegExp("getNum\\('","gm"),"formulaHelper.getNum(__obj__, '")).replace(new RegExp("getStr\\('","gm"),"formulaHelper.getStr(__obj__, '");try{new Function([],"return ("+a+");"),this.setting.formulaContainer.push({field:n.field,formula:a})}catch(r){this.setting.formulaContainer.push({field:n.field,formula:'"表达式错误"'})}}}},_initViewColumns:function(){var t=this.setting;t.viewLeftWidth=this._initColumnsGroup(t.frozenColumns,"left"),t.viewRightWidth=this._initColumnsGroup(t.frozenColumnsRight,"right"),t.viewMainWidth=this._initColumnsGroup(t.columns,"main")-cellBorderWidth},_initColumnsGroup:function(t,e){var i=0;if(t)for(var n=0;n<t.length;n++)for(var a=0;a<t[n].length;a++){var r=t[n][a];r.hidden&&(r.lockTree==undefined&&(r.lockTree=!0),r.showTree==undefined&&(r.showTree=!1)),r=t[n][a]=$.extend({},Options.appDefaults.Column,r),this._initColumn(r),i+=function(t){var e=0;return t.field&&(e=t.width+cellBorderWidth),t.hidden&&(e=0),e}(r),r.viewPos=e}return i},_initColumn:function(t){var e=t.buttons;if(e){t.sysCol=!0,this.setting._hasOperator=!0;for(var i=!1,n=0;n<e.length;n++){var a=e[n];a.id||(a.id=App.uuid()),$.isFunction(a.disabled)&&(i=!0),this._operator[a.id]=a.handler}if(function(t,e){var i=t.title+"";if(!isNaN(i.replaceAll(",",""))){for(var n=i.split(","),a="",r=0;r<n.length;r++){var s=e[n[r]];if(!s)return;a+=this._createRowBtn(s)}for(n.sort(),r=n.length-1;r>=0;r--)e.splice(n[r],1);t._isBtn=!0,t.title=a}}.call(this,t,e),!i){t._html="";for(n=0;n<e.length;n++)t._html+=this._createRowBtn(e[n])}}t.colspan&&t.colspan>1?delete t.field:t.field&&"string"==typeof t.width&&(t.width=parseInt(t.width));var r=t.formatter;r&&"string"==typeof r&&r.indexOf("{")>=0&&(t.template=new Template(r)),t.summary&&!this._sumColMap[t.field]&&(this._sumCols.push(t),this._sumColMap[t.field]=t),t.rowHeader&&(t.cls=" grid-row-head"),t.cls?t.cls+=" grid-cell-"+t.align:t.cls=" grid-cell-"+t.align,t.title||(t.title=t.field),t._cid=App.uuid(),this._column[t._cid]=t,this._fieldColumns[t.field]=t,t.titleVar&&(this._titleVarColumns||(this._titleVarColumns={}),t.oriTitle=t.title,this._titleVarColumns[t._cid]=t),function(t){if(t.field){var e='_cid="'+t._cid+'"';t.editor&&(!t.editor.options||t.editor.options&&!t.editor.options.readonly)&&(t.cls=t.cls?t.cls+" grid-td-editable":"grid-td-editable"),t.field&&(e+=' field="'+t.field+'"'),t.buttons&&(e+=' opts="true"'),t.bodyTdAttrExp=e}}(t),function(t){if(t.field){var e='_cid="'+t._cid+'"';t.field&&(e+=' field="'+t.field+'"'),t.buttons&&(e+=' opts="true"'),t.footerTdAttrExp=e}}(t)},_createRowBtn:function(t,e,i){var n="";return $.isFunction(t.disabled)?t.disabled(e,i)&&(n=" disabled"):!0===t.disabled&&(n=" disabled"),'<a id="'+t.id+'" class="rowBtn'+n+'" tab-index="-1"><i class="'+t.iconCls+'" title="'+t.text+'"></i></a>'},_onRowOperatorBtnClick:function(t){var e=$(t.currentTarget);if(e.hasClass("disabled"))t.stopPropagation();else{var i=e.attr("id"),n=e.closest("tr"),a=n.index(),r=this._converRowToData(n)[0];this._renderRow(a),this._operator[i]&&(this._operator[i].call(this,r,a),t.stopPropagation())}},_markChildrenAndParent:function(){function t(t){if(t)for(var n=function(t){for(var i=[],n=0;n<e;n++)i.push([]);if(e>1&&1==t.length)for(var n=0;n<t[0].length;n++)t[0][n].rowspan=e;for(var n=0;n<t.length;n++)for(var a=0;a<t[n].length;a++){var r=t[n][a];!function(t,e,i){for(var n=t.rowspan==undefined?1:t.rowspan,a=t.colspan==undefined?1:t.colspan,r=0,s=0;s<n;s++)for(var o=0;o<a;o++){var l=t._cid;0==s&&0==o&&(l=t),s>0?i[e+s][r]=l:r=function(t,e){var i=0;for(;t[i]!=undefined;)i++;return t[i]=e,i}(i[e+s],l)}}(r,n,i)}return function(t){for(var e=0;e<t.length-1;e++)if(t[e].length!=t[e+1].length)throw $a.messager.warn("列的colspan或rowspan设置错误"),new Error("列的colspan或rowspan设置错误")}(i),i}(t),a=1;a<n.length;a++)for(var r=0;r<n[a].length;r++){var s=n[a-1][r],o=n[a][r];if("string"!=typeof o){"string"==typeof s&&(s=i[s]),o.parentColumn=s;var l=s.children;l||(l=s.children=[]),l.push(o),delete s.field}}}var e=this.setting.columns.length,i=this._column;try{t(this.setting.frozenColumns)}catch(n){throw new Error("左固定列设置错误："+n)}try{t(this.setting.columns)}catch(n){throw new Error("主视图列设置错误："+n)}try{t(this.setting.frozenColumnsRight)}catch(n){throw new Error("右固定列设置错误："+n)}},disableRowBtn:function(t,e){var i=this._getRowExpr(t);if(i){this.$tableBodyRight.find(i).find("#"+e).addClass("disabled")}},enableRowBtn:function(t,e){var i=this._getRowExpr(t);if(i){this.$tableBodyRight.find(i).find("#"+e).removeClass("disabled")}},_initElement:function(){this._initElementStruct();var t=this.$element,e=this;t.data("grid",this),this.$wrap=t.parent(),this.$rowEditor=t.find(".grid-row-editor"),this.$absoluteComp=t.find(".grid-absolute-comp"),this.$focusInput=t.find(".focusInput"),this.$focusInput.on("keydown.grid-proxy-focus.api",$.proxy(this._keyLocateCell,this)),this.$focusInput.on("focus.grid-proxy-focus.api",function(){e.$table.addClass("table-active"),e._fixXProxyScroll()}),this.$focusInput.on("blur.grid-proxy-focus.api",function(){e.$table.removeClass("table-active"),e.$focusInput.css("position","absolute"),e.$focusInput.appendTo(e.$absoluteComp)}),this.$header=t.find(".grid-header"),this.$title=this.$header.find(".grid-header-title"),this.$toolbar=this.$header.find(".grid-header-toolbar"),this.$headerCustom=this.$header.find(".grid-header-custom"),this.$table=t.find(".grid-table"),this.$tableHeader=t.find(".grid-table-header"),this.$tableHeaderLeft=this.$tableHeader.find(".grid-header-left"),this.$tableHeaderMain=this.$tableHeader.find(".grid-header-main"),this.$tableHeaderRight=this.$tableHeader.find(".grid-header-right"),this.$tableBody=t.find(".grid-table-body"),this.$tableBodyMessage=t.find(".grid-table-message"),this.$tableBodyLeft=this.$tableBody.find(".grid-body-left"),this.$tableBodyMain=this.$tableBody.find(".grid-body-main"),this.$tableBodyRight=this.$tableBody.find(".grid-body-right"),this.$tableFooter=t.find(".grid-table-footer"),this.$tableFooterLeft=this.$tableFooter.find(".grid-footer-left"),this.$tableFooterMain=this.$tableFooter.find(".grid-footer-main"),this.$tableFooterRight=this.$tableFooter.find(".grid-footer-right"),this.$tableFooterCustom=this.$tableFooter.find(".grid-footer-custom"),this.$cardRegion={left:this.$tableBodyLeft,right:this.$tableBodyRight,center:this.$tableBodyMain},this.setting.headerCustom&&this.$headerCustom.append($A(this.setting.headerCustom))},_showMessage:function(t){this.$tableBodyMessage.html(t).show()},_hideMessage:function(){this.$tableBodyMessage.hide()},setGridMinWidth:function(t){var e=0;this._hasPager()&&(e=400),t<e&&(t=e),this.$element.css("min-width",t)},_initElementStruct:function(){var t=this.setting,e='<div class="grid-table-footer"><div><div class="grid-footer-left"><div><table cellpadding="0" cellspacing="0"><tbody></tbody></table></div></div><div class="grid-footer-right"><div><table cellpadding="0" cellspacing="0"><tbody></tbody></table></div></div><div class="grid-footer-main"><div><table cellpadding="0" cellspacing="0"><tbody></tbody></table></div></div></div><div class="grid-footer-custom"></div></div>';this.$element=$('<div class="app-grid"><div class="grid-header"><div class="grid-header-title"><span>'+t.title+'</span></div><div class="grid-header-toolbar" style="max-height:'+t.toolbarHeight+'px;"><ul></ul></div><div class="grid-header-custom"></div></div><div class="grid-table'+("push"==t.height?" autoHeight":" fixHeight")+'"><div class="row-dragging-mask"></div><div class="grid-table-header" oncontextmenu="return false"><div class="col-resize-proxy"></div><div class="grid-header-left"><div><table cellpadding="0" cellspacing="0"><tbody></tbody></table></div></div><div class="grid-header-right"><div><table cellpadding="0" cellspacing="0"><tbody></tbody></table></div></div><div class="grid-header-main"><div><table cellpadding="0" cellspacing="0"><tbody></tbody></table></div></div>'+("top"==this.setting.summaryPos?e:"")+'</div><div class="grid-table-body'+(t.striped?" useStriped":"")+'"><div class="grid-table-message"></div><div class="grid-body-left" ><div class="grid-body-content"><table cellpadding="0"  class="grid-view" cellspacing="0"><tbody></tbody></table><div class="grid-body-card-form" style="display:none"></div></div></div><div class="grid-body-right" ><div class="grid-body-content"><table cellpadding="0"  class="grid-view" cellspacing="0"><tbody></tbody></table><div class="grid-body-card-form form" style="display:none"></div></div></div><div class="grid-body-main"><div class="grid-body-content"><table cellpadding="0"  class="grid-view" cellspacing="0"><tbody></tbody></table></div></div><div class="grid-row-editor"></div><div class="grid-absolute-comp"><input class="focusInput" style="position:absolute;"/></div></div>'+("bottom"==this.setting.summaryPos?e:"")+"</div></div>").insertAfter(this.$t)},_resetColumnsInOrder:function(){this.frozenColumns=this._getColumnsInTable(this.$tableHeaderLeft.find(">div>table")),this.frozenColumnsRight=this._getColumnsInTable(this.$tableHeaderRight.find(">div>table")),this.columns=this._getColumnsInTable(this.$tableHeaderMain.find(">div>table"))},_getColumnsInTable:function(t){for(var e=t.find(">tbody>tr"),i=e.length,n=[],a=i-1;a>=0;a--){var r=$(e[a]).find(">td");if(a==e.length-1)for(var s=0;s<r.length;s++){var o=$(r[s]).attr("_cid");n.push(this._column[o])}else for(s=0;s<r.length;s++){var l=$(r[s]).attr("rowspan");if((l=l==undefined?1:parseInt(l))+a==i){var d=this._getColumnOrder(s,r);o=$(r[s]).attr("_cid");n.splice(d,0,this._column[o])}}}return function(t){if(!(t<=1))for(var e=1;e<n.length;e++)n[e].__prev=n[e-1]}(n),n},_getColumnOrder:function(t,e){for(var i=0,n=0;n<t;n++){var a=$(e[n]).attr("colspan");i+=a=a==undefined?1:parseInt(a)}return i},_initHeaderHtml:function(){this.gridHeadHeight=this.setting.columns.length*(this.setting.headRowHeight+1),this._initFrozenViewHtml(),this._initFrozenRightViewHtml(),"E"!=this.setting.fitColumns&&"ES"!=this.setting.fitColumns||(this._setColumnPercent(),this._fitMainViewWidth()),this._initMainViewHtml(),this._resetColumnsInOrder()},_setColumnPercent:function(){var t=this.setting,e=t.columns,i=this._getColumnsWidth(e);if("E"==t.fitColumns||"ES"==t.fitColumns)for(var n=0;n<e.length;n++)for(var a=0;a<e[n].length;a++){var r=e[n][a];r.field&&!r.hidden&&(r.percent=parseFloat((r.width/i).toFixed(4)))}},_getColumnsWidth:function(t){for(var e=0,i=0;i<t.length;i++)for(var n=0;n<t[i].length;n++){var a=t[i][n];a.hidden||a.field&&(e+=a.width)}return e},_fitMainViewWidth:function(){if(this.viewType==VIEW_TYPE.CARD_VIEW){var t=(n=this.$element.outerWidth())-this.setting.view.cardWidth;this.$cardRegion[this.setting.view.region].find(".grid-body-card-form").outerWidth(t)}var e=this.setting,i=0;if(this.$element.is(":visible")){var n=this.$element.outerWidth(),a=this._getYProxyScrollWidth();i=n-this.$tableHeaderLeft.outerWidth()-this.$tableHeaderRight.outerWidth()-a}else i=this.setting.viewMainWidth;"ES"==e.fitColumns?this._fitMainColumnsWidth(i):"E"==e.fitColumns&&i>=e.viewMainWidth-scrollBarWidth&&this._fitMainColumnsWidth(i)},_getYProxyScrollWidth:function(){var t=1;if("push"==this.setting.height){this.$wrap.scrollTop(1);1==this.$wrap.scrollTop()&&(t+=scrollBarWidth)}else this._hasYProxyScroll()&&(this.setting.autoScroll||(t+=scrollBarWidth));return t},_fitMainColumnsWidth:function(t){for(var e=this.setting.columns,i=0,n=0;n<e.length;n++)for(var a=0;a<e[n].length;a++){var r=e[n][a];r.field&&!r.hidden&&(r.width=parseInt((r.percent*t).toFixed()),i+=r.width,r.width-=1)}r.width+=t-i,this.setting.viewMainWidth=t},_initFrozenViewHtml:function(){var t=this.setting,e=(t.viewLeftWidth,t.frozenColumns);e&&(this.$tableHeaderLeft.find(">div>table>tbody").append(this._initHeaderTrHtml(e)),this.$tableHeaderLeft.height(this.gridHeadHeight),this.$tableHeaderLeft.css("overflow","hidden"))},_initFrozenRightViewHtml:function(){var t=this.setting,e=(t.viewRightWidth,t.frozenColumnsRight);e&&(this.$tableHeaderRight.find(">div>table>tbody").append(this._initHeaderTrHtml(e)),this.$tableHeaderRight.height(this.gridHeadHeight),this.$tableHeaderRight.css("overflow","hidden"))},_initMainViewHtml:function(){var t=this.setting,e=(t.viewMainWidth,this._initHeaderTrHtml(t.columns));!function(t){if(1!=t.length)for(var e=1;e<t.length;e++)$(t[e]).find("td:last-child").addClass("show-right-border")}(e),this.$tableHeaderMain.find(">div>table>tbody").append(e),this.$tableHeaderMain.height(this.gridHeadHeight),this.$tableHeaderMain.css("overflow","hidden"),this.$focusInput.appendTo(this.$tableHeaderMain.find("td:visible:first>div"))},_initHeaderTrHtml:function(t){for(var e=this,i=[],n=this.setting.headRowHeight,a='<tr style="height:'+n+"px;line-height:"+n+'px;"></tr>',r=0;r<t.length;r++){for(var s=$(a),o=0;o<t[r].length;o++){var l=function(t){var i=$("<td "+function(t){var i="";if(t.rowspan&&t.rowspan>1){var n=e.setting.headRowHeight*t.rowspan+(t.rowspan-1);i+="height:"+n+"px;line-height:"+n+"px;"}return i&&(i='style="'+i+'" '),i}(t)+function(){function i(t){var e=0,n=t.children;if(n&&n.length>0)for(var a=0;a<n.length;a++)e+=i(n[a]);else t.hidden||(e=1);return e}var n='_cid="'+t._cid+'"',a=t.cls;e.setting.halign||(a=(a=a.replace("grid-cell-left","grid-cell-center")).replace("grid-cell-right","grid-cell-center")),t.hidden&&(a+=" grid-cell-hidden"),n+=' class="'+a+'"',t.field&&(n+=' field="'+t.field+'"'),t.buttons&&(n+=' opts="true"');var r=i(t);return 0==r&&(r=1),n+=' colspan="'+r+'"',t.rowspan&&(n+=' rowspan="'+t.rowspan+'"'),t._isBtn&&(n+=' isBtn="true"'),n}()+"><div "+function(t){var e="";return t.field&&(e='style="width:'+t.width+'px;"'),e}(t)+">"+t.title+"</div></td>");if(e._appendSortable(t,i),t.headerBtns)for(var n=t.headerBtns,a=0;a<n.length;a++)!function(t,e){var i=$('<span class="'+e.iconCls+' grid-header-btn"></span>');e.title&&i.attr("title",e.title),i.on("click",function(t){t.stopPropagation(),e.handler()}),e.hoverShow&&(i.hide(),t.on("mouseenter",function(t){i.show()}).on("mouseleave",function(){i.hide()})),t.find(">div").append(i)}(i,n[a]);return i}(t[r][o]);s.append(l)}i.push(s)}return i},_registEvents:function(){this.$tableBody.on("click.grid-cell.api","tr.data-row td",$.proxy(this._onClickCell,this)),this.$tableBody.on("mouseup.grid-cell.api","tr.data-row td",$.proxy(this._onMouseUpCell,this)),this.$tableBody.on("dblclick.grid-cell.api","tr.data-row td",$.proxy(this._onDblClickCell,this)),this.$tableBody.on("click.grid-row.api","tr.data-row td",$.proxy(this._onClickRow,this)),this.$tableBody.on("dblclick.grid-row.api","tr.data-row td",$.proxy(this._onDblClickRow,this)),this.$tableBody.on("mousewheel.grid.api",$.proxy(this._onMouseWheel,this)),this.$tableBody.on("mouseover.grid.api","tr.data-row",$.proxy(this._onBodyTrMouseOver,this)),this.$tableBody.on("mouseleave.grid.api","tr.data-row",$.proxy(this._onBodyTrMouseLeave,this)),this.$tableHeader.on("click.grid.api",'td[isbtn="true"]',headBtnTdClick),this.setting.checkbox&&(this.$tableHeaderLeft.on("click.grid.api",'td[field="_rownumbers"]',$.proxy(this._onHeaderRowNumberTdClick,this)),this.$tableHeaderLeft.on("click.grid.api",'td[field="_checkbox"]',$.proxy(this._onHeaderCheckboxTdClick,this)),this.$tableHeaderLeft.on("click.grid.api",'td[field="_checkbox"] input',$.proxy(this._onHeaderCheckboxClick,this)),this.$tableBodyLeft.on("click.grid.api",'td[field="_checkbox"]',$.proxy(this._onBodyCheckboxTdClick,this)),this.$tableBodyLeft.on("click.grid.api",'td[field="_checkbox"] input',$.proxy(this._onBodyCheckboxClick,this))),this._registResizeColumnProxy(),this._bindInvalidMsgEvent(),this._bindResize(),this.onMouseEvent(),this._onCheckSummary()},_onMouseWheel:function(t,e,i,n){if(this._hasYProxyScroll()){setDataRowHeight.call(this);var a=this._rowHeight,r=this.$yProxyScroll.scrollTop(),s=parseInt(r/a);e<0?this.$yProxyScroll.scrollTop((s+1)*a):this.$yProxyScroll.scrollTop((s-1)*a)}},_onClickCell:function(t){var e=$(t.currentTarget),i=e.parent(),n=this._getDataByRowId(i.attr("id")),a=i.index(),r=e.attr("field");this.trigger("onClickCell",n,a,r,t)},_onMouseUpCell:function(t){if(""==(window.getSelection?window.getSelection().toString():document.selection&&document.selection.createRange?document.selection.createRange().text:"")){var e=$(t.currentTarget);this.setting.hasEditor||this._focusProxyInput(e)}},_focusProxyInput:function(t){this.setCurrentRow(t.parent().index());try{this.$focusInput[0].focus()}catch(e){}},_keyLocateCell:function(t){t.preventDefault(),t.stopPropagation();switch(t.keyCode){case App.keyCode.LEFT:this.$xProxyScroll.scrollLeft(this.$xProxyScroll.scrollLeft()-35);break;case App.keyCode.RIGHT:this.$xProxyScroll.scrollLeft(this.$xProxyScroll.scrollLeft()+35);break;case App.keyCode.UP:this.prevRow(),this.locateCurrent();break;case App.keyCode.DOWN:this.nextRow(),this.locateCurrent();break;case App.keyCode.ENTER:this.toggleSelectCurrent()}},_onDblClickCell:function(t){if(!atOnceMoment(t,"onDblClickCell",this)){var e=$(t.currentTarget),i=e.parent(),n=this._getDataByRowId(i.attr("id")),a=i.index(),r=e.attr("field");this.trigger("onDblClickCell",n,a,r,t)}},_onClickRow:function(t){var e=$(t.currentTarget).parent(),i=e.attr("id"),n=this._convertRowIdToRowIndex(i),a=this._getDataByRowId(i);this.setCurrentRow(n),e.hasClass("row-uncheckable")||(this.isSelectedRow(n)?this.unselectRow(n):this.selectRow(n)),this.trigger("onClickRow",a,n,t)},_onDblClickRow:function(t){if(!atOnceMoment(t,"onDblClickRow",this)){var e=$(t.currentTarget).parent(),i=e.attr("id"),n=this._convertRowIdToRowIndex(i),a=this._getDataByRowId(i);e.hasClass("row-uncheckable")||(this.isSelectedRow(n)?this.unselectRow(n):this.selectRow(n)),this.trigger("onDblClickRow",a,n,t)}},_onBodyTrMouseOver:function(t){this._setRowClass(t.currentTarget.id,hoverRowCls)},_onHeaderRowNumberTdClick:function(t){this._onHeaderCheckboxTdClick(t)},_onHeaderCheckboxTdClick:function(t){var e=this.$tableHeaderLeft.find('td[field="_checkbox"] input')[0];e.checked=!e.checked,this._onHeaderCheckboxClick(t)},_onHeaderCheckboxClick:function(t){this.$tableHeaderLeft.find('td[field="_checkbox"] input')[0].checked?this.selectAll():this.unselectAll(),t.stopPropagation()},_onBodyCheckboxTdClick:function(t){var e=$(t.currentTarget),i=e.find("input")[0],n=e.closest("tr")[0].id;i.checked?this.unselectRow(n):this.selectRow(n),t.stopPropagation()},_onBodyCheckboxClick:function(t){var e=t.currentTarget,i=$(t.currentTarget).closest("tr")[0].id;e.checked?this.selectRow(i):this.unselectRow(i),t.stopPropagation()},_fit:function(){var t=this.setting;t.title||this._hasTitlePager()||this.$title.css("display","none"),t.toolbar&&0!=t.toolbar.length||(this.$toolbar.css("display","none"),this.$title.css("border-bottom-width",0)),this._initProxyScroll(),this._fixHeight(),t.width&&this.$element.css({width:t.width}),this.setGridMinWidth(t.viewLeftWidth+t.viewRightWidth+30)},_initProxyScroll:function(){this._initXProxyScroll(),this._initYProxyScroll(),this._bindWrapYScrollEvent()},_initXProxyScroll:function(){this.$xProxyScroll=$('<div class="grid-body-xscrollproxy" style="margin-left:'+this.$tableHeader.find(".grid-header-left>div").outerWidth()+"px; margin-right:"+this.$tableHeader.find(".grid-header-right>div").outerWidth()+'px;"><div style="width:'+(this.$tableHeader.find(".grid-header-main>div>table").outerWidth()-3)+'px;"></div></div>'),this.$xProxyScroll.insertAfter(this.$tableBody);var t=this;this.$xProxyScroll.scroll(function(){t.$tableHeaderMain.scrollLeft($(this).scrollLeft()),t.$tableBodyMain.scrollLeft($(this).scrollLeft()),t.$tableFooterMain.scrollLeft($(this).scrollLeft())}),this._setFooterBorderTop()},_hasXProxyScroll:function(){return this.$xProxyScroll&&this.$xProxyScroll.outerWidth()<this.$xProxyScroll.find(">div").outerWidth()},_initYProxyScroll:function(){if(!this.setting.autoScroll){this.$yProxyScroll=$('<div class="grid-body-yscrollproxy" style="height:'+this.$tableBody.find(".grid-body-main").outerHeight()+"px;margin-top:"+this.$tableHeader.outerHeight()+'px"><div style="height:'+this.$tableBody.find(".grid-body-main>div").outerHeight()+'px;"></div></div>'),this.$yProxyScroll.insertBefore(this.$tableHeader);var t=this;this.$yProxyScroll.scroll(function(){setDataRowHeight.call(t);var e=t.$yProxyScroll[0],i=e.scrollTop,n=e.scrollHeight,a=e.clientHeight;if(0==i)return t.$tableBodyLeft.scrollTop(0),t.$tableBodyMain.scrollTop(0),void t.$tableBodyRight.scrollTop(0);i=$(this).scrollTop();var r=t._rowHeight;i=i+a>r*(t.getAllData().length-.5)?n-a:parseInt(i/r)*r,t.$tableBodyLeft.scrollTop(i),t.$tableBodyMain.scrollTop(i),t.$tableBodyRight.scrollTop(i)})}},_hasYProxyScroll:function(){return!!this.$yProxyScroll&&("none"!=this.$yProxyScroll.css("display")&&this.$yProxyScroll.outerHeight()<this.$yProxyScroll.find(">div").outerHeight())},_bindWrapYScrollEvent:function(){var t=this,e=this.setting;"all"==e.follow?this.$wrap.scroll(function(){t._headerFollow(),t._footerFollow()}):"header"==e.follow?this.$wrap.scroll(function(){t._headerFollow()}):"footer"==e.follow&&this.$wrap.scroll(function(){t._footerFollow()})},_fixHeight:function(){"push"!=this.setting.height&&(this._fixGridHeight(),this._fixYProxyScrollHeight())},_fixGridHeight:function(){var t=0;this.$element.is(":visible")&&(t=this.setting.height?parseInt(this.setting.height):this.$element.parent().height(),t-=this.$header.outerHeight()+1,this.viewType&&this.viewType==VIEW_TYPE.GRID_VIEW&&("top"==this.setting.summaryPos?t-=this.$tableHeader.outerHeight():t-=this.$tableHeader.outerHeight()+this.$tableFooter.outerHeight()),t-=this._getPagerDownHeight(),this._hasXProxyScroll()&&(t-=16),this.$tableBodyLeft.css({height:t}),this.$tableBodyRight.css({height:t}),this.$tableBodyMain.css({height:t}))},_fixYProxyScrollHeight:function(){if(this.$yProxyScroll&&"push"!=this.setting.height){var t=this.$yProxyScroll[0].scrollHeight>this.$yProxyScroll.outerHeight(),e=this.$tableBody.outerHeight(),i=this.$tableBody.find(".grid-body-main>div").outerHeight();this.$yProxyScroll.css("height",e).css("margin-top",this.$tableHeader.outerHeight()),this.$yProxyScroll.find(">div").css("height",i);var n=i>this.$yProxyScroll.outerHeight();if(n!=t){if(n){(a={}).width=scrollBarWidth,a.display="block",a["overflow-y"]="scroll",this.$yProxyScroll.css(a),"bottom"==this.setting.summaryPos&&this.$tableFooterRight.css("margin-right",scrollBarWidth)}else this.$yProxyScroll.css("display","none"),"bottom"==this.setting.summaryPos&&this.$tableFooterRight.css("margin-right",0);this.resize()}else if(n&&0==this.$yProxyScroll.outerWidth()){var a;(a={}).width=scrollBarWidth,a.display="block",a["overflow-y"]="scroll",this.$yProxyScroll.css(a),"bottom"==this.setting.summaryPos&&this.$tableFooterRight.css("margin-right",scrollBarWidth)}}},_fixXProxyScroll:function(){this._hasXProxyScroll()&&this.$xProxyScroll.scroll()},_headerFollow:function(){var t=this.$element.offset().top,e=this.$wrap.offset().top,i=this.$tableBodyMain.outerHeight(),n={top:e-t};n.top<0?n.top=0:n.top>i&&(n.top=i),this.$header.css(n),this.$tableHeader.css(n)},_footerFollow:function(){if("all"==this.setting.follow||"footer"==this.setting.follow){var t=this.$wrap.offset().top,e=this.$element.offset().top+this.$element.outerHeight(),i=this.$wrap.outerHeight(),n=this.$tableBody.outerHeight(),a={top:t-e+i};a.top>0?a.top=0:a.top<-n&&(a.top=-n),this.$xProxyScroll&&this.$xProxyScroll.css(a),this.$tableFooter.css(a),this._setPagerDownCss(a),0!=a.top?this.$tableFooter.addClass("relativeFooter"):this.$tableFooter.removeClass("relativeFooter")}},_initData:function(){var t=this.setting;this._initSort(),t.data?(this._loadPagers(1,t.data[t.jsonReader.total]),this._loadData(t.data),updateColumnTitle.call(this)):t.url&&t.autoLoad&&this.load(t.url)},_ajax:function(t,e){if(!1!==this.trigger("beforeLoad")){var i=this.setting.url,n=this;if(i){var a=this.getRows();a&&a.length>0&&this._loadData([],null,!0),this._showMessage(loading),AppAjax.ajaxCall({url:i,data:this._getQueryParam(e),dataType:"json",type:"POST",success:function(e){updateColumnTitle.call(n),n._hideMessage(),n.trigger("onLoadSuccess",e),e||(e=[]),t(e)},errorHandle:function(){n._showMessage(error)}})}}},_getQueryParam:function(t){var e={};if(this.setting.remoteSort){var i=this.getCurrentSort();e={__sort__:JSON.stringify(i)}}return $.extend({},this.getFixedParameter(),this.getParameter(),this.getCurrentPager(),e,t)},setFixedParameter:function(t){this._FixedParameter=t},getFixedParameter:function(){return this._FixedParameter},setParameter:function(t){this._parameter=t},getParameter:function(){return this._parameter?this._parameter:null},load:function(t){"string"==typeof t?this.setting.url=t:"object"==typeof t&&this.setParameter(t);var e=this,i=null;this._hasPager()&&(i={page:1}),this._ajax(function(t){e._loadPagers(1,t[e.setting.jsonReader.total]),e._loadData(t,1)},i)},query:function(t){this.setParameter(t),this.load()},reload:function(t){"string"==typeof t?this.setting.url=t:"object"==typeof t&&this.setParameter(t);var e=this;this._ajax(function(t){e._loadPagers(e.getPageIndex(),t[e.setting.jsonReader.total]),e._loadData(t,e._getStarRowNumber())})},loadData:function(t){this._loadData(t,1),this._newData={updated:{},inserted:{},deleted:{}}},reflashData:function(){this._loadData(this.getRows(),this._getStarRowNumber()),this._newData={updated:{},inserted:{},deleted:{}}},_loadData:function(t,e,i){var n=this,a=null,r=null;n._newData.updated={},n._newData.inserted={},n._newData.deleted={},$.isArray(t)?(a=t,this._setRows(a)):(a=t[this.setting.jsonReader.rows],r=t[this.setting.jsonReader.footer],this.data=t,t.dicts&&(this.dicts?$.extend(!0,this.dicts,t.dicts):this.dicts=t.dicts),this._setRows(a),r?this._setFooterRows(r):this._setFooterRows([])),this._calculateData(this.getRows()),this._sortData(),this._loadBody(a,e),this.loadFooter(r),this._fitWordColumn(),i||this._afterDataRender(t),setTimeout(function(){n.resize()},100)},setDicts:function(t){this.dicts=t},getDicts:function(){return this.dicts},_initCalcFunc:function(t){var e=this.setting.formulaContainer;if(e[0].func==undefined&&t.length>0){var i=t[0],n=[];n.push("__obj__");for(var a in i)-1==a.indexOf("|")&&n.push(a);for(var r=0;r<e.length;r++){var s=e[r];s.func=new Function(n,"return ("+s.formula+");")}}},_calculateData:function(t){var e=this.setting.formulaContainer;if(0!=e.length){this._initCalcFunc(t);for(var i=0;i<t.length;i++)for(var n=0;n<e.length;n++)this._calculateRow(e[n],t[i])}},_calculateRow:function(t,e){var i=[];i.push(e);for(var n in e)i.push(e[n]);e[t.field]=t.func.apply(e,i)},_loadBody:function(t,e){t&&(isNaN(e)||(this._rownumbers=e),this._clearBodyHtml(),t.length>0?this._hideMessage():this._showMessage(empty),this._loadBodyHtml(t),this.trigger("onDataChange"))},_clearBodyHtml:function(){this._currentEditRowId=null,this._restoreEditor(),this.$tableBodyLeft.find(">div>table>tbody").html(""),this.$tableBodyRight.find(">div>table>tbody").html(""),this.$tableBodyMain.find(">div>table>tbody").html(""),this.$cardRegion.center&&this.$cardRegion.center.find(".grid-view>tbody").html("")},_loadBodyHtml:function(t){this.viewType==VIEW_TYPE.GRID_VIEW?(this._fixRowNumberWidth(t),this._loadBodyHtmlSimpleRow(t)):this._loadBodyCardRow(t),this.$tableHeaderLeft.find('td[field="_checkbox"] input').prop("checked",!1)},_loadBodyCardRow:function(t){this._hideMessage();for(var e=[],i="",n=t.length,a=0;a<n;a++){var r=t[a],s=App.uuid();r.__rowId=s,i=this._createRowTr(r,a),e.push(i+this._createViewRow(r,a)+"</tr>"),this._rowData[s]=r,this._rownumbers++}this.$cardRegion.center.find(".grid-view>tbody").append(e.join("")),this._footerFollow(),this._fixXProxyScroll(),this._fixYProxyScrollHeight()},_createViewRow:function(t,e){var i=this.setting.view,n="<td>";return $.isFunction(i.rowRender)&&(n+=i.rowRender.call(this,t)),n+"</td>"},_loadBodyHtmlSimpleRow:function(t){for(var e="",i="",n="",a="",r=t.length,s=0;s<r;s++){var o=t[s],l=App.uuid();o.__rowId=l,e+=(a=this._createRowTr(o,s))+this._initRowTrInnerHtml(this.frozenColumns,o)+"</tr>",i+=a+this._initRowTrInnerHtml(this.columns,o)+"</tr>",n+=a+this._initRowTrInnerHtml(this.frozenColumnsRight,o)+"</tr>",this._rowData[l]=o,this._rownumbers++}this.$tableBodyLeft.find(">div>table>tbody").append(e),this.$tableBodyRight.find(">div>table>tbody").append(n),this.$tableBodyMain.find(">div>table>tbody").append(i),this._footerFollow(),this._fixXProxyScroll(),this._fixYProxyScrollHeight()},_createRowTr:function(t,e){var i="",n="";$.isFunction(this.setting.rowCheckable)&&!1===this.setting.rowCheckable(t,this._rownumbers)&&(n="row-uncheckable");var a="";if(this.hasBindEvent("rowCls")&&(a=" "+this.__events.rowCls[0](t,e)),"subtotal"==t._rowType)n+=" subtotal"+a,i='<tr id="'+t.__rowId+'" class="'+n+'">';else{n+=" data-row "+(e%2==0?"even":"odd")+a;var r=t[this.setting.idField]?'_v="'+t[this.setting.idField]+'"':"";i='<tr id="'+t.__rowId+'" '+r+' class="'+n+'">'}return i},_fixRowNumberWidth:function(t){if("normal"==this.setting.rownumbers||"repeat"==this.setting.rownumbers){var e=0;"normal"==this.setting.rownumbers?e+=this._rownumbers+t.length:e+=t.length;var i=30;e>99&&e<999?i=38:e>999&&e<9999?i=47:e>9999&&e<99999?i=56:e>99999&&e<999999?i=64:e>999999&&e<9999999&&(i=73);var n=this._hasXProxyScroll();if(Math.abs(this.$tableHeaderLeft.find('td[field="_rownumbers"]').outerWidth()-i)>5){var a=this.$tableHeader.find('td[field="_rownumbers"]').attr("_cid"),r=this.$tableHeader.find("table").outerWidth()+(i-this._column[a].width);this.$xProxyScroll&&this.$xProxyScroll.css("margin-left",r),this._setFooterBorderTop(),this.$table.find("td[_cid="+a+"]>div").css("width",i),this._column[a].width=i,this.setting.fitColumns&&!n&&this.resize()}}},_afterDataRender:function(t){this.setting.mergeColumns&&this.mergeColumns(this.setting.mergeColumns),this.trigger("afterDataRender",t)},_clearCurrent:function(){this.$tableBodyLeft.find(">div>table tr."+currentRowCls).removeClass(currentRowCls),this.$tableBodyRight.find(">div>table tr."+currentRowCls).removeClass(currentRowCls),this.$tableBodyMain.find(">div>table tr."+currentRowCls).removeClass(currentRowCls)},_initRowTrInnerHtml:function(t,e){for(var i="",n=0;n<t.length;n++)i+=this._initCellHtml(t[n],e);return i},_initCellHtml:function(t,e){if(t.hidden)return"";var i="",n="",a="",r="",s=this._getFormatText(t,e);return t.showTitle&&s&&(i='title="'+escapeHtml(s)+'"'),"subtotal"==e._rowType&&t.subtotalText&&(a=t.subtotalCss,r=t.subtotalCls,e[t.field]=t.subtotalText),e[t.field+"_style"]&&(n+=e[t.field+"_style"]),"<td "+this._getBodyTdExp(t,e,a)+t.bodyTdAttrExp+this._getTdClassAttr(t,r)+i+'><div style="width:'+t.width+"px;"+n+'">'+this._initTdInnerHtml(t,e,s)+"</div></td>"},_getBodyTdExp:function(t,e){var i="";if($.isFunction(t.styler)){var n=t.styler(e[t.field],e);n&&(i+=n)}else t.styler&&(i+=t.styler);return i&&(i='style="'+i+'" '),i},_getTdClassAttr:function(t,e){var i="";return t.cls&&(i=t.cls),e&&(i+=" "+e),t.hidden&&(i+=" grid-cell-hidden"),i&&(i=' class="'+i+'"'),i},_initTdInnerHtml:function(t,e,i){var n="";return t.sysCol?("_rownumbers"==t.field?n=this._rownumbers+"":t._html?n=t._html:t.buttons&&(n=this._getBtnHtml(t,e)),n):i!=IE8_TD_EMPTY?i:this._getFormatText(t,e)},_getBtnHtml:function(t,e){for(var i="",n=t.buttons,a=0;a<n.length;a++){var r=n[a];i+=this._createRowBtn(r,e,this._rownumbers)}return i},_getFormatText:function(t,e){var i=e[t.field],n=t.formatter;if(t.formatPattern&&(n="numberFormatter"),n)$.isFunction(n)?i=n(i,e,this._rownumbers,t):"string"==typeof n&&(t.formatPattern||"["==n.charAt(0)&&"]"==n.charAt(n.length-1)&&(t.formatPattern=n.substr(1,n.length-2),n="numberFormatter"),i=t.template?t.template.apply(e):Formatter.formatter(n,i,e,this._rownumbers,t));else if(this.dicts){var a=this.dicts[t.field];a&&(i=a[i])}return function(t){if(t==undefined)t=IE8_TD_EMPTY;else if("string"==typeof t){var e=(t=t.replace(/<script/g,"&lt;script")).match(/^[ ]*/);if(e&&e[0]){for(var i="&nbsp;",n=e[0].length,a=1;a<n;a++)i+="&nbsp;";t=t.replace(/^[ ]*/,i)}}return t}(i)},loadFooter:function(t){this.clearFooter(),this._appendSummary(),this.appendFooter(t)},clearFooter:function(){this.$tableFooterLeft.find(">div>table>tbody").html(""),this.$tableFooterRight.find(">div>table>tbody").html(""),this.$tableFooterMain.find(">div>table>tbody").html(""),this.$tableFooterCustom.html(""),this._frowsnumber=1,this._setFooterRows([]),this._footerFollow(),this._fixHeight(),this.$tableFooter.css("display","none")},appendFooter:function(t){t&&(this._appendFooter(t),this._appendFooterData(t))},_appendFooter:function(t){if(!$.isArray(t)&&t&&(t=[t]),0!=t.length){for(var e="",i="",n="",a=0;a<t.length;a++)e+=this._initFootRowHtml(this.frozenColumns,t[a]),i+=this._initFootRowHtml(this.frozenColumnsRight,t[a]),n+=this._initFootRowHtml(this.columns,t[a]),this._frowsnumber++;this.$tableFooterLeft.find(">div>table>tbody").append(e),this.$tableFooterRight.find(">div>table>tbody").append(i),this.$tableFooterMain.find(">div>table>tbody").append(n),this.$tableFooter.css("display","block"),this._fixHeight(),this._footerFollow(),this._fixXProxyScroll()}},_appendFooterData:function(t){var e=this.getFooterRows();e?$.isArray(t)?$.merge(e,t):e.push(t):this._setFooterRows(t)},_initFootRowHtml:function(t,e,i){for(var n="<tr>",a=0;a<t.length;a++)n+=this._initFootCellHtml(t[a],e,i);return n+"</tr>"},_initFootCellHtml:function(t,e,i){var n="",a="",r="",s="";t.totalText&&(r=t.totalCss,s=t.totalCls,e[t.field]=t.totalText);var o=this._getFormatText(t,e);return t.showTitle&&o&&(n=' title="'+escapeHtml(o)+'"'),e[t.field+"_style"]&&(a+=e[t.field+"_style"]),'<td style="'+this._getBodyTdExp(t,e,r)+'" '+t.footerTdAttrExp+this._getTdClassAttr(t,s)+n+'><div style="width:'+t.width+"px;"+a+'">'+this._initFooterTdInnerHtml(t,e,i,o)+"</div></td>"},_initFooterTdInnerHtml:function(t,e,i,n){var a="";if(t.sysCol)"_rownumbers"==t.field&&(a=this.setting.footerRowNumber?this._frowsnumber+"":e._rownumbers?this._getFormatText(t,e,i):"合计");else{if(n)return n;a=this._getFormatText(t,e,i)}return a},getData:function(){return this.data},isValid:function(){return!(this.$tableBody.find(".invalid").length>0)},getAllData:function(t){for(var e=this.$tableBodyMain.find("tr"),i=[],n=0;n<e.length;n++){var a=this._getDataByRowId(e[n].id);a&&(t&&delete(a=$.extend(!0,{},a)).__rowId,i.push(a))}return i},getCurrentEditRowData:function(){return this._getDataByRowId(this._currentEditRowId)},getCurrentEditRowIndex:function(){return null==this._currentEditRowId?-1:this._convertRowIdToRowIndex(this._currentEditRowId)},_getDataByRowId:function(t){var e=this._newData.deleted[t];if(e)return null;if(e=this._newData.updated[t]){var i=$.extend(!0,{},this._rowData[t],e);return $.extend(!0,e,i)}return(e=this._newData.inserted[t])?e:e=this._rowData[t]},getRows:function(){return this.data[this.setting.jsonReader.rows]},_setRows:function(t){this.data[this.setting.jsonReader.rows]=t},getFooterRows:function(){return this.data[this.setting.jsonReader.footer]},getSummaryRow:function(){return this.summaryRow},_setFooterRows:function(t){this.data[this.setting.jsonReader.footer]=t},getDataByRowIndex:function(t){var e=this._convertRowIndexToRowId(t);return this._getDataByRowId(e)},selectRow:function(t){var e=this._getRowExpr(t),i=this.$tableBodyMain.find(e).is(":not(.row-uncheckable)"),n=this.getDataByRowIndex(t);i&&!1===this.trigger("beforeSelect",n,t)||(this._renderRow(t,n),i&&this.trigger("onSelect",n,t))},isCheckable:function(t){var e=this._getRowExpr(t);return!this.$tableBodyMain.find(e).hasClass("row-uncheckable")},checkable:function(t){var e=this._getRowExpr(t);this.$tableBodyLeft.find(e).removeClass("row-uncheckable"),this.$tableBodyMain.find(e).removeClass("row-uncheckable"),this.$tableBodyRight.find(e).removeClass("row-uncheckable")},uncheckable:function(t){var e=this._getRowExpr(t);this.$tableBodyLeft.find(e).addClass("row-uncheckable"),this.$tableBodyMain.find(e).addClass("row-uncheckable"),this.$tableBodyRight.find(e).addClass("row-uncheckable")},_renderRow:function(t){var e=this._getRowExpr(t);e&&(this.setting.checkbox||this._renderUnselectRow("tr."+selectedRowCls),this._renderSelectRow(e),this._renderBoxValue(e,!0))},getRowByParam:function(t,e){for(var i=this.getRows(),n=0;n<i.length;n++){var a=i[n];if(a[t]==e)return a}return null},getRowByFilter:function(t){if(!$.isFunction(t))throw new Error("类型错误：getRowByFilter方法要传入一个过滤函数");for(var e=this.getRows(),i=0;i<e.length;i++){var n=e[i];if(!0===t(n))return n}return null},getRowIndex:function(t){if(!t)throw new Error("无法获取空值");if(!t.__rowId)throw new Error("该对象不是内部对象，无法获取行号");return this.$tableBodyMain.find("#"+t.__rowId).index()},_getRowExpr:function(t){var e=typeof t,i="";return isNaN(t)?"string"==e?i="tr#"+t:"object"==e&&(t.type&&"id"!=t.type||(i='tr[_v="'+t.value+'"]')):i="tr:eq("+t+")",i},unselectRow:function(t){var e=this._getRowExpr(t),i=this.$tableBodyMain.find(e).is(":not(.row-uncheckable)");if(e&&(this._renderUnselectRow(e),this._renderBoxValue(e,!1),i)){var n=this.getDataByRowIndex(t);this.trigger("onUnselect",n,t)}},toggleSelectRow:function(t){var e=this._getRowExpr(t);e||(e="tr"),this._renderToggleSelectRow(e),this._renderToggleBoxValue(e)},selectAll:function(){this._renderSelectRow(">div>table>tbody>tr"),this._renderBoxValue("",!0),this.trigger("onSelectAll")},unselectAll:function(){this._renderUnselectRow(">div>table>tbody>tr"),this._renderBoxValue("",!1),this.trigger("onUnselectAll")},_renderSelectRow:function(t){function e(t){i?t.filter(":not(.row-uncheckable)").addClass(checkedRowCls):t.addClass(selectedRowCls)}var i=this.setting.checkbox;e(this.$tableBodyLeft.find(t)),e(this.$tableBodyMain.find(t)),e(this.$tableBodyRight.find(t))},_renderUnselectRow:function(t){function e(t){i?t.filter(":not(.row-uncheckable)").removeClass(checkedRowCls):t.removeClass(selectedRowCls)}var i=this.setting.checkbox;e(this.$tableBodyLeft.find(t)),e(this.$tableBodyMain.find(t)),e(this.$tableBodyRight.find(t))},_renderToggleSelectRow:function(t){function e(t){i&&t.filter(":not(.row-uncheckable)").toggleClass(checkedRowCls)}var i=this.setting.checkbox;i||this.unselectAll(),e(this.$tableBodyLeft.find(t)),e(this.$tableBodyMain.find(t)),e(this.$tableBodyRight.find(t))},_renderBoxValue:function(t,e){if(this.setting.checkbox){this.$tableBodyLeft.find(t);this.$tableBodyLeft.find(t+':not(.row-uncheckable) td[field="_checkbox"] input').each(function(){this.checked=e})}else this.setting.radiobox&&this.$tableBodyLeft.find(t+' td[field="_radiobox"] input').each(function(){this.checked=e});this._renderTopCheckboxValue()},_renderToggleBoxValue:function(t){this.setting.checkbox?this.$tableBodyLeft.find(t+':not(.row-uncheckable) td[field="_checkbox"] input').each(function(){this.checked=!this.checked}):this.setting.radiobox&&this.$tableBodyLeft.find(t+' td[field="_radiobox"] input').each(function(){this.checked=!this.checked}),this._renderTopCheckboxValue()},_renderTopCheckboxValue:function(){var t=this.$tableBodyMain.find("tr."+checkedRowCls).length,e=this.$tableBodyMain.find("tr:not(.row-uncheckable)").length;0!=e&&(t==e?this.$tableHeaderLeft.find('td[field="_checkbox"] input').prop("checked",!0):this.$tableHeaderLeft.find('td[field="_checkbox"] input').prop("checked",!1))},isSelectedRow:function(t){return this.$tableBodyMain.find("tr:eq("+t+")").hasClass(selectedRowCls)||this.$tableBodyMain.find("tr:eq("+t+")").hasClass(checkedRowCls)},getSelectedRowIndex:function(){var t;return t=this.setting.radiobox?this.$tableBodyLeft.find('td[field="_radiobox"] input:checked').closest("tr"):this.$tableBodyMain.find("tr."+selectedRowCls+":first"),t.index()},getSelected:function(){var t,e=null;return t=this.setting.radiobox?this.$tableBodyLeft.find('td[field="_radiobox"] input:checked').closest("tr"):this.$tableBodyMain.find("tr."+selectedRowCls+":first"),(e=this._converRowToData(t)[0])==undefined?null:e},getSelections:function(){var t;return t=this.setting.checkbox?this.$tableBodyMain.find("tr."+checkedRowCls):this.$tableBodyMain.find("tr."+selectedRowCls),this._converRowToData(t)},_converRowToData:function(t){var e=[],i=this;return t.each(function(){var t=i._getDataByRowId(this.id);e.push(t)}),e},nextRow:function(){var t=this.getCurrentRowIndex(),e=this.$tableBodyMain.find("tr").length;t=-1==t?0:++t%e,this.setCurrentRow(t)},prevRow:function(){var t=this.getCurrentRowIndex(),e=this.$tableBodyMain.find("tr").length;t=-1==t?0:(--t+e)%e,this.setCurrentRow(t)},getCurrentRowIndex:function(){var t=this.$tableBodyMain.find("tr."+currentRowCls);return 1==t.length?t.index():-1},setCurrentRow:function(t){this._setRowClass(t,currentRowCls)},_setRowClass:function(t,e){var i=this._getRowExpr(t);this._removeRowClass(e),this.$tableBodyLeft.find(i).addClass(e),this.$tableBodyMain.find(i).addClass(e),this.$tableBodyRight.find(i).addClass(e)},_onBodyTrMouseLeave:function(){this._removeRowClass(hoverRowCls)},_removeRowClass:function(t){var e="tr."+t;this.$tableBodyLeft.find(e).removeClass(t),this.$tableBodyMain.find(e).removeClass(t),this.$tableBodyRight.find(e).removeClass(t)},getCurrentRowData:function(){var t=this.getCurrentRowIndex();return t>-1?this.getRows()[t]:null},selectCurrent:function(){var t=this.getCurrentRowIndex();-1!=t&&this.selectRow(t)},unselectCurrent:function(){var t=this.getCurrentRowIndex();-1!=t&&this.unselectRow(t)},toggleSelectCurrent:function(){var t=this.getCurrentRowIndex();-1!=t&&this.toggleSelectRow(t)},locateCurrent:function(){var t=this.getCurrentRowIndex();-1!=t&&this.locateRow(t)},locateRow:function(t){var e=this.$tableBodyMain.find(this._getRowExpr(t));0!=e.length&&this._scroll_yProxyScroll(e)},_scroll_yProxyScroll:function(t){if("push"==this.setting.height){for(var e=this.$wrap.outerHeight()-this.$header.outerHeight()-this.$tableHeader.outerHeight()-this.$tableFooter.outerHeight()-this._getPagerDownHeight(),i=0,n=this.$wrap.children(),a=0;a<n.length;a++){var r=$(n[a]);if(r.is(this.$element))break;i+=r.outerHeight()}this.$wrap.scrollTop(t.position().top+i-e)}else if(this.$yProxyScroll){var s=this.$tableBodyMain.outerHeight()+3,o=this.$tableBodyMain.scrollTop(),l=t.offset().top+t.outerHeight()-this.$tableBodyMain.offset().top+o;l<=o?this.$yProxyScroll.scrollTop(l-t.outerHeight()):l>=o+s&&this.$yProxyScroll.scrollTop(l-s)}},_registResizeColumnProxy:function(){var t=this;this.$table.on("mousemove.grid-column.resizable.api",".grid-table-header td",function(e){var i=$(this);if(!0===t._preventColumnResize(i)){var n=t._getCursor(i,e);n?i.css("cursor",n):i.css("cursor","default")}}).on("mousedown.grid-column.resizable.api",".grid-table-header td",function(e){if(t._isLeftMouseKey(e)){var i=$(this);!0===t._preventColumnResize(i)&&t._getCursor(i,e)&&(t.$targetTd=i,t._onStartResizeColumn(e))}}),this.$columnResizeProxy=this.$element.find(".col-resize-proxy")},_isLeftMouseKey:function(t){var e=!1;return $.browser.msie&&8==document.documentMode?1===t.button&&(e=!0):0===t.button&&(e=!0),e},_getCursor:function(t,e){var i=t.offset().left,n=t.width(),a=e.pageX||e.screenX,r=t.attr("colspan"),s="";return a<=i+n&&a>i+n-5&&(r==undefined||1==r)&&t.attr("field")&&(s="e-resize"),s},_preventColumnResize:function(t){if(!this.setting.columnResizable)return!1;return this._column[t.attr("_cid")].resizable},_onStartResizeColumn:function(t){var e=this,i=e.$targetTd;i.oriX=i.position().left+i.outerWidth()-1,e.$columnResizeProxy.css({left:i.oriX,display:"block"}),$(document).bind("selectstart.grid-column.resizable.api",function(){return!1}),$(document).bind("mouseup.grid-column.resizable.api",function(){e._onStopResizeColumn()}),$(document).bind("mousemove.grid-column.resizable.api",function(t){e._onResizeColumn(t)})},_onResizeColumn:function(t){var e=(t.pageX||t.screenX)-this.$tableHeader.offset().left;this.$columnResizeProxy.css({left:e,cursor:"e-resize"}),this.$targetTd.diffX=parseInt(this.$columnResizeProxy.css("left"))-this.$targetTd.oriX},_onStopResizeColumn:function(){this._applyResizeColumn(),this.$columnResizeProxy.hide(),$(document).unbind("selectstart.grid-column.resizable.api"),$(document).unbind("mousemove.grid-column.resizable.api"),$(document).unbind("mouseup.grid-column.resizable.api")},_applyResizeColumn:function(){this.$targetTd.diffX=parseInt(this.$targetTd.diffX),isNaN(this.$targetTd.diffX)&&(this.$targetTd.diffX=0);var t=this.$targetTd.outerWidth();parseInt(t+this.$targetTd.diffX)<minWidth&&(this.$targetTd.diffX=minWidth-t),this._setColumnWidth(this.$targetTd,this.$targetTd.diffX),this._fullAfterResizeColumn()},_fullAfterResizeColumn:function(){if(!this._fullFreeWidth()){var t=this._getLast$Td(),e=this.$targetTd;e.attr("_cid")!=t.attr("_cid")&&(e.diffX<0||this._shinkFreeWidth())}},_shinkFreeWidth:function(){if("E"==this.setting.fitColumns||"ES"==this.setting.fitColumns){var t=this.$tableHeaderMain.find(">div>table").width()-this.$tableHeaderMain.width();if(!(t<=0))for(var e=this.columns,i=e.length-1;i>=0;i--){var n=e[i];if(!n.hidden){var a=this.$tableHeader.find('td[_cid="'+n._cid+'"]'),r=a.data("freeWidth");if(r!=undefined){if(r>t)return a.data("freeWidth",r-t),void this._setColumnWidth(a,-t);t-=r,a.removeData("freeWidth"),this._setColumnWidth(a,-r)}}}}},_fullFreeWidth:function(){if("E"==this.setting.fitColumns||"ES"==this.setting.fitColumns){var t=this.$tableHeaderMain.width()-this.$tableHeaderMain.find(">div>table").width();if(t>0){var e=this._getLast$Td();this._setColumnWidth(e,t);var i=e.data("freeWidth");return i!=undefined&&(t+=i),e.data("freeWidth",t),!0}}},_getLast$Td:function(){for(var t=this.columns.length-1;this.columns[t].hidden&&t>=0;)t--;var e=this.columns[t]._cid;return this.$tableHeader.find('td[_cid="'+e+'"]')},setColumnWidth:function(t){var e=this.$tableHeader.find('td[field="'+t.field+'"]'),i=e.outerWidth(),n=t.width-i;this._setColumnWidth(e,n)},_setColumnWidth:function(t,e){var i=t.attr("_cid");this._setFooterBorderTop();var n=t.outerWidth()-cellBorderWidth+e;this.$table.find("td[_cid="+i+"]>div:not(.app-wrapper)").css("width",n),this._column[i].width=n,this._setColumnPercent(),this._refitColumnWidth()},hideColumn:function(t){function e(t){if(t.parentColumn){var i=n.$tableHeader.find('td[_cid="'+t.parentColumn._cid+'"]');if(i.length>0){var a=i.attr("colspan");a>1?i.attr("colspan",a-1):i.css("display","none")}e(t.parentColumn)}}var i=this._fieldColumns[t],n=this;if(!i.lockTree&&!this._fieldColumns[t].hidden){var a=this.$table.find('td[field="'+t+'"]:not(.grid-cell-merger)');a.hide(),i.hidden=!0,e(i),this._setViewSize(a,function(t,e){t.hasClass("grid-header-left")?(this.setting.viewMainWidth+=e,this.setting.viewLeftWidth-=e):t.hasClass("grid-header-right")&&(this.setting.viewMainWidth+=e,this.setting.viewRightWidth-=e)}),this._refitColumnWidth(),this._fullFreeWidth()}},columnIsVisible:function(t){return"none"!=this.$tableHeader.find('td[field="'+t+'"]').css("display")},_setViewSize:function(t,e){if(!this.$element.is(":visible")){var i=t[0];if(i){var n=$(i),a=n.closest("div").parent(),r=parseInt(n.css("width"));e.call(this,a,r)}}},showColumn:function(t){function e(t){if(t.parentColumn){var i=n.$tableHeader.find('td[_cid="'+t.parentColumn._cid+'"]');if(i.length>0){if("none"==i.css("display"))i.css("display","table-cell");else{var a=i.attr("colspan");a||(a=1),i.attr("colspan",parseInt(a)+1)}}e(t.parentColumn)}}var i=this._fieldColumns[t],n=this;if(!i.lockTree&&i.hidden){i.hidden=!1,function(t){if(!(this.$tableBody.find("td[_cid="+t._cid+"]").length>0)){for(var e=t.__prev;e&&!(this.$tableBody.find("td[_cid="+e._cid+"]").length>0);)e=e.__prev;var i=this.getRows();i.length>0&&function(t,e,i){var n=this.$tableBodyMain;"left"==e.viewPos?n=this.$tableBodyLeft:"right"==e.viewPos&&(n=this.$tableBodyRight);for(var a=0;a<t.length;a++){var r=this._initCellHtml(e,t[a]);i?n.find("tr:eq("+a+") td[_cid="+i._cid+"]").after(r):n.find("tr:eq("+a+")").prepend(r)}}.call(this,i,t,e),this._setColumnPercent()}}.call(this,i);var a=this.$table.find('td[field="'+t+'"]:not(.grid-cell-merger)');a.show(),e(i),this._setViewSize(a,function(t,e){t.hasClass("grid-header-left")?(this.setting.viewMainWidth-=e,this.setting.viewLeftWidth+=e):t.hasClass("grid-header-right")&&(this.setting.viewMainWidth-=e,this.setting.viewRightWidth+=e)}),this._refitColumnWidth(),this._shinkFreeWidth()}},_refitColumnWidth:function(){this._resetViewWidth(),this.resize()},resize:function(){var t=this;if(this.hasTriggerResize)return this.resizeTimeout&&clearTimeout(this.resizeTimeout),void(this.resizeTimeout=setTimeout(function(){t.resize(),delete t.resizeTimeout},120));if(this.hasTriggerResize=!0,setTimeout(function(){delete t.hasTriggerResize},110),"E"==this.setting.fitColumns||"ES"==this.setting.fitColumns){var e=this.columns;if(e==undefined)return;this._fitMainViewWidth();for(var i=0;i<e.length;i++){var n=e[i];n.field&&!n.hidden&&this.$table.find("td[_cid="+e[i]._cid+"]>div:not(.app-wrapper)").css("width",n.width)}}this._resetViewWidth(),this._fixHeight(),this._footerFollow()},_resetViewWidth:function(){var t=0,e=0,i=0;this.$element.is(":visible")?(t=this.$tableHeaderLeft.find(">div>table").outerWidth(),e=this.$tableHeaderMain.find(">div>table").outerWidth()-2,i=this.$tableHeaderRight.find(">div>table").outerWidth()):(t=this.setting.viewLeftWidth,e=this.setting.viewLeftWidth-2,i=this.setting.viewRightWidth);var n={};n["margin-left"]=t,n["margin-right"]=i,this._hasXProxyScroll()&&(this.$xProxyScroll.css(n),this.$xProxyScroll.find(">div").css("width",e)),this._setFooterBorderTop(),this._footerFollow()},_setFooterBorderTop:function(){this._hasXProxyScroll()?this.$tableFooter.addClass("splitBorder"):this.$tableFooter.removeClass("splitBorder")},prependRow:function(t){0!=this.setting.editable&&(t==undefined&&(t={}),$.isArray(t)||(this._prependOneRowToBody(t),this._reOrderNumber(),this.locateCurrent(),this._toggleMessage(),this._pagerAddRow()))},prependRowThenSelect:function(t){this.prependRow(t),this.selectRow(0)},appendRow:function(t,e){0!=this.setting.editable&&(t==undefined&&(t={}),$.isArray(t)||(this._appendOneRowToBody(t,e),this._reOrderNumber(),this.locateCurrent(),this._toggleMessage(),this._pagerAddRow()))},appendRowThenSelect:function(t){this.appendRow(t);var e=this.$tableBodyMain.find(">div>table>tbody>tr").length;this.selectRow(e-1)},_toggleMessage:function(){this.$tableBodyMain.find("tr").length>0?this._hideMessage():this._showMessage(empty)},_prependOneRowToBody:function(t){var e=currentRowCls;this._clearCurrent(),this.setting.markChange&&(e+=" inserted");var i=App.uuid(),n='<tr id="'+i+'" '+(t[this.setting.idField]?'_v="'+t[this.setting.idField]+'"':"")+' class="data-row '+(this._rownumbers%2==0?"odd":"even")+" "+e+'">',a=n+this._initRowTrInnerHtml(this.frozenColumns,t)+"</tr>",r=n+this._initRowTrInnerHtml(this.columns,t)+"</tr>",s=n+this._initRowTrInnerHtml(this.frozenColumnsRight,t)+"</tr>";t.__rowId=i,this.$tableBodyLeft.find(">div>table>tbody").prepend(a),this.$tableBodyRight.find(">div>table>tbody").prepend(s),this.$tableBodyMain.find(">div>table>tbody").prepend(r),this._insertRow(i,t),this._rownumbers++,this._footerFollow(),this._fixXProxyScroll(),this._fixYProxyScrollHeight()},_appendOneRowToBody:function(t,e){var i=currentRowCls;this._clearCurrent(),this.setting.markChange&&(i+=" inserted");var n=App.uuid(),a='<tr id="'+n+'" '+(t[this.setting.idField]?'_v="'+t[this.setting.idField]+'"':"")+' class="data-row '+(this._rownumbers%2==0?"odd":"even")+" "+i+'">',r=a+this._initRowTrInnerHtml(this.frozenColumns,t)+"</tr>",s=a+this._initRowTrInnerHtml(this.columns,t)+"</tr>",o=a+this._initRowTrInnerHtml(this.frozenColumnsRight,t)+"</tr>";t.__rowId=n,isNaN(e)?(this.$tableBodyLeft.find(">div>table>tbody").append(r),this.$tableBodyRight.find(">div>table>tbody").append(o),this.$tableBodyMain.find(">div>table>tbody").append(s)):(this.$tableBodyLeft.find(">div>table tr:eq("+e+")").after(r),this.$tableBodyRight.find(">div>table tr:eq("+e+")").after(o),this.$tableBodyMain.find(">div>table tr:eq("+e+")").after(s)),this._insertRow(n,t),this._rownumbers++,this._footerFollow(),this._fixXProxyScroll(),this._fixYProxyScrollHeight()},_reOrderNumber:function(){if(0!=this.$tableHeaderLeft.find("td[field=_rownumbers]").length){var t=this.$tableBodyLeft.find("tr:visible>td[field=_rownumbers]>div"),e=this._getStarRowNumber();this._rownumbers=e+t.length,t.each(function(){$(this).text(e++)})}},showCustom:function(){this.$headerCustom.children().show(),this._fixHeight(),this._footerFollow()},hideCustom:function(){this.$headerCustom.children().hide(),this._fixHeight(),this._footerFollow()},toggleCustom:function(){this.$headerCustom.children().is(":visible")?this.hideCustom():this.showCustom()},updateFooter:function(t){t&&($.isArray(t)||(t=[t]),this.clearFooter(),this.appendFooter(t))},_bindResize:function(){var t=this;this.$element.on("_resize.grid.api",function(){t.resize()})},setGridInterval:function(t,e){return this.autoReflashTimer=setInterval(t,e),this.autoReflashTimer},clearGridInterval:function(t){t||(t=this.autoReflashTimer),clearInterval(t)},onMouseEvent:function(){if(this.setting.autoScroll){this.startScroll();var t=this;this.$tableBody.on("mouseenter",function(){t.stopScroll()}).on("mouseleave",function(){t.startScroll()})}},startScroll:function(){if(!this._scrollRunning){var t=this.$tableBodyMain,e=this.$tableBodyLeft,i=this.$tableBodyRight;"upward"==this.setting.autoScroll?(this.autoScrollTimer=setInterval(function(){if(t.is(":visible"))if(t.scrollTop()+t[0].clientHeight>=t[0].scrollHeight)t.scrollTop(0),e.scrollTop(0),i.scrollTop(0);else{var n=t.scrollTop()+5;t.scrollTop(n),e.scrollTop(n),i.scrollTop(n)}},200),this._scrollRunning=!0):"downward"==this.setting.autoScroll&&(this.autoScrollTimer=setInterval(function(){if(t.is(":visible"))if(t.scrollTop()<=0)t.scrollTop(t[0].scrollHeight),e.scrollTop(t[0].scrollHeight),i.scrollTop(t[0].scrollHeight);else{var n=t.scrollTop()-5;t.scrollTop(n),e.scrollTop(n),i.scrollTop(n)}},200),this._scrollRunning=!0)}},stopScroll:function(){this._scrollRunning&&(clearInterval(this.autoScrollTimer),this._scrollRunning=!1,delete this.autoScrollTimer)},getColumns:function(){var t={};return t.left=this.setting.frozenColumns,t.center=this.setting.columns,t.right=this.setting.frozenColumnsRight,t},getColumnTree:function(){function t(t,e){var i=e[0];if($.isArray(i))for(var n=0;n<i.length;n++)t.push(i[n])}var e=[];return t(e,this.setting.frozenColumns),t(e,this.setting.columns),t(e,this.setting.frozenColumnsRight),e},destroy:function(){this.clearGridInterval(this.autoReflashTimer),this.stopScroll();var t=this.editor;for(var e in t)t[e].editor&&t[e].editor.destroy();this.$headerContextMenu&&(this.$headerContextMenu.remove(),this.$headerContextMsg.remove()),this.$t.removeData("grid"),this.$element.remove()}});return $.fn.grid=function(t){var e=undefined,i=arguments;return this.each(function(){var n=$(this),a=n.data("grid");if("string"==typeof t)try{var r=Array.prototype.slice.call(i,1);e=App.componentMethodApply(a,t,r)}catch(o){throw(s=n.attr("id"))||(s=n[0].outerHTML),new Error("组件grid["+s+"]调用"+t+"方法:"+o)}else{if(a){var s;throw(s=n.attr("id"))||(s=n[0].outerHTML),new Error("组件grid["+s+"]无法重复初始化")}a=new Grid(this,t),n.data("grid",a)}}),e},window.formulaHelper={getNum:function(t,e){var i=t[e];return i==undefined&&(i=0),i},getStr:function(t,e){var i=t[e];return i==undefined&&(i=""),i}},Grid}),define("app/widgets/form/app-combogrid",["app/core/app-jquery","app/core/app-core","app/data/app-ajax","app/widgets/form/app-combo","app/core/app-options","app/widgets/grid/app-grid"],function(t,e,i,n,a,r,s){"use strict";var o=n.extend({initialize:function(e,i){i||(i={}),i._=t.extend({},a.appDefaults.Combogrid,i._),o.superclass.initialize.call(this,e,i),this._init()},_init:function(){this._initOptions(),this._initPanelContent(),this._registEvents(),this._eventRegister(),this.$input.data("context",this)},_initOptions:function(){var t=this.setting;t.multiple=t.checkbox||t.multiple,t.suggestfield||(t.suggestfield=this.setting.textfield),(this.setting.search||this.setting.usesuggest)&&(this.setting.search=!0),this.$dropPanelMain.css("overflow","hidden")},_initPanelContent:function(){this.$grid=t("<table></table>"),this.$grid.appendTo(this.$dropPanelMain)},_eventRegister:function(){var e=this.setting;this.$dropPanelMain.off("mousewheel.combo.api"),this.$dropPanelMain.off("scroll.combo.api"),t.isFunction(e.afterSelected)&&this.on("afterSelected",e.afterSelected),t.isFunction(e.beforeSelected)&&this.on("beforeSelected",e.beforeSelected)},_registEvents:function(){this.setting.search&&(this._editable(),this.$text.on("click.combogrid-local.api",t.proxy(this._textFocusEvent,this)))},_textFocusEvent:function(){var e=this;this.$text[0].select(),this.$text.data("oriText",this.getText()),this.$text.on("blur.combogrid-local.api",function(){if(e._grid){var i=e._grid.getSelections(),n=t(this);0==i.length&&n.val(n.data("oriText"))}})},setParameter:function(t){t||(t={}),this.$input.data("_parameter",t),this._grid&&this._grid.setParameter(this.getParameter())},reload:function(t){var e=this._grid;e?e.load(t):this.setting.url=t},loadData:function(t){this._grid.loadData(t),this._rendSelectedItems(),this._mainDivIsVisiable()&&this.place()},_keyManager:function(t){this._dealSysKey(t)||(this._mainDivIsVisiable()?this._keyForVisiblePanel(t):this._keyForHiddenPanel(t))},_keyForVisiblePanel:function(t){t.keyCode;var i=this.setting;t.stopPropagation(),e.containKeyCode(t,i.keyNextNode)?this._keyNextNode(t):e.containKeyCode(t,i.keyPrevNode)?this._keyPrevNode(t):e.containKeyCode(t,i.keyPickNode)?this._keyPickNode(t):e.containKeyCode(t,i.keyNextPage)?this._keyNextPage(t):e.containKeyCode(t,i.keyPrevPage)?this._keyPrevPage(t):e.containKeyCode(t,i.keyHidePanel)?this._keyHidePanel(t):this._keyFilterSuggest(t)&&this.suggest()},_keyForHiddenPanel:function(t){var i=t.keyCode,n=this.setting;if(e.containKeyCode(t,n.keyShowPanel))this._keyShowPanel(t);else if(this._isKeyCursorPos(i))this._keyCursorPos(t);else if(this._keyFilterSuggest(t)){if(t.keyCode==e.keyCode.ENTER)return;this.suggest()}},_keyPickNode:function(t){t.preventDefault();var e=this._grid,i=e.getCurrentRowIndex(),n=(e.getCurrentRowData(),e.isSelectedRow(i));-1!=i&&(n?(e.unselectRow(i),this._setBySelections()):(e.selectRow(i),this._setBySelections()))},_keyPrevNode:function(t){t.preventDefault(),this._grid.prevRow(),this._grid.locateCurrent()},_keyNextNode:function(t){t.preventDefault(),this._grid.nextRow(),this._grid.locateCurrent()},_keyPrevPage:function(t){t.preventDefault(),this._grid.prevPage()},_keyNextPage:function(t){t.preventDefault(),this._grid.nextPage()},suggest:function(){if(this.setting.search){this._mainDivIsVisiable()||this.showPanel(),clearTimeout(this.timeout);var t=this;this.timeout=setTimeout(function(){t._suggestFunc()},this.setting.lazy)}},_suggestFunc:function(){if(!this._preventSuggest()){var t=this.getText();this._grid.$pagers&&this._grid.$pagers.length>0?this._suggestByRemote(t):this._suggestByLocal(t)}},_backDataSource:function(){this.setting.search&&this.isSuggestData&&(this._grid.$pagers&&this._grid.$pagers.length>0?this._suggestByRemote(""):this._suggestByLocal(""),this.isSuggestData=!1)},_preventSuggest:function(){var t=this.getText(),e=this._grid.getData()[this._grid.setting.jsonReader.rows];return this.prevKey==t||(!(!(this.prevKey&&t.length>=this.prevKey.length&&0==t.indexOf(this.prevKey))||e!=undefined&&0!=e.length)||(this.prevKey=t,!1))},_suggestByRemote:function(t){if(this.setting.url){var e=this.getParameter();e?e._key=t:e={_key:t},this.isSuggestData=!0,e.suggestfield=this.setting.suggestfield,this._grid.setParameter(e),this._grid.load()}},_suggestByLocal:function(t){this._cachePageData();var e=this._filterByKey(t);this.isSuggestData=!0,this._grid.loadData(e)},_cachePageData:function(){this.dataSource||(this.dataSource=this._grid.getData()[this._grid.setting.jsonReader.rows])},_filterByKey:function(t){var e=this.dataSource,i=t.toUpperCase(),n=[],a=this.setting.suggestfield.split(",");if(1==a.length){a=a[0];for(var r=0;r<e.length;r++){-1!=e[r][a].toUpperCase().indexOf(i)&&n.push(e[r])}}else for(r=0;r<e.length;r++)for(var s=0;s<a.length;s++){if(-1!=e[r][a[s]].toUpperCase().indexOf(i)){n.push(e[r]);break}}return n},showPanel:function(){this._showPanel(function(){this._initGrid(),this._rendSelectedItems(),this._backDataSource()})},_initGrid:function(){if(this._grid)this._initData();else{var e=this.setting,i=this;this.option?e.innerGrid=t.extend({},a.appDefaults.Grid,a.appDefaults.Combogrid.Grid,e,this.option):e.innerGrid=t.extend({},a.appDefaults.Grid,a.appDefaults.Combogrid.Grid,e),delete e.innerGrid.width,e.innerGrid.height=e.panelheight,isNaN(e.customPanelHeight)||(e.innerGrid.height-=e.customPanelHeight),e.innerGrid.beforeSelect=function(t,e){return i._activeItemEvent("beforeSelected",t,e)},e.innerGrid.onSelect=function(t,e){i._setBySelections(),i._activeItemEvent("afterSelected",t,e)},e.innerGrid.afterDataRender=function(){i._resetPanelWidth(this.$xProxyScroll),i.place(),i._rendSelectedItems(),i._locateRowAfterRender(),i._afterDataRender()},e.innerGrid.queryParams=this.getParameter(),e.innerGrid.columnManager=!1,this.lastParam=e.innerGrid.queryParams,this.$grid.grid(e.innerGrid),this._grid=this.$grid.data("grid"),this._grid._combogrid=this,this.onceRender=!0,this._setMinSize()}},_setMinSize:function(){var t={},e=this.setting,i=0,n=30;"down"==this._grid.setting.pager?(i+=90,i+=this._grid.$pagerDown.find(".pager-infos").outerWidth(),i+=this._grid.$pagerDown.find(".pager-tool").outerWidth(),n+=this._grid.$pagerDown.outerHeight()):"up"==this._grid.setting.pager?(i+=this._grid.$title.find(">span").outerWidth(),i+=this._grid.$title.find(".grid-pager").outerWidth()):i=this.$element.outerWidth(),isNaN(e.customPanelHeight)||(n+=e.customPanelHeight),n+=this._grid.$title.outerHeight(),n+=this._grid.$tableHeader.outerHeight(),n+=this._grid.$tableFooter.outerHeight(),t["min-width"]=i,t["min-height"]=n,this.$dropPanel.css(t)},_locateRowAfterRender:function(){var t=this._grid,e=t.getSelectedRowIndex();e>=0?(t.setCurrentRow(e),t.locateRow(e)):(t.setCurrentRow(0),t.locateRow(0))},_activeItemEvent:function(t,e,i){return this.trigger(t,e,i)},togglePanel:function(){this._mainDivIsVisiable()?this.hidePanel():this.showPanel()},getTable:function(){return this.$grid},_setBySelections:function(){var t=this._grid.getSelections();this.setting.multiple?(this._grid.nextRow(),this._grid.locateCurrent()):(t=t[0])&&this.hidePanel(),this.setSelectedNode(t)},_rendSelectedItems:function(){this._grid.unselectAll();var t=this.getValue();if(t)for(var e=t.split(","),i={type:"id"},n=0;n<e.length;n++)i.value=e[n],this._grid._renderRow(i)},_endResize:function(){var t=this.setting;this._grid.setting.height=this.$dropPanel.outerHeight(),isNaN(t.customPanelHeight)||(this._grid.setting.height-=t.customPanelHeight),this._grid._fixHeight()}});return t.fn.combogrid=function(i,n){var a=undefined,r=arguments,s="combogrid";return this.each(function(){var n=t(this);if(!n.is("input"))return!0;var l=e.getComponent(n,s);if("string"==typeof i)try{var d=Array.prototype.slice.call(r,1);a=e.componentMethodApply(l,i,d)}catch(h){e.throwCompMethodError(n,s,i,h)}else l?e.throwCompInitError(n,s):(l=new o(this,i),n.data(s,l))}),a},o}),define("app/widgets/form/app-comboztree",["app/core/app-jquery","app/core/app-core","app/data/app-ajax","app/widgets/form/app-combo","app/core/app-options","jquery/jquery.ztree","app/widgets/form/app-suggest"],function(t,e,i,n,a,r,s){"use strict";function o(t){var e=null,i=this.setting.idfield;if(this.setting.multiple){if(e=[],t)for(var n=0;n<t.length;n++){var a=t[n][i];this._mapData[a]?e.push(this._mapData[a]):e.push(t[n])}}else if(t&&t[0]){a=t[0][i];e=this._mapData[a]?this._mapData[a]:t[0]}this.setSelectedNode(e)}var l=n.extend({initialize:function(t,e){e||(e={}),e._=a.appDefaults.Comboztree,l.superclass.initialize.call(this,t,e),this._init()},_init:function(){this._initOptions(),this._initPanelContent(),this._eventRegister(),this.setting.usesuggest&&(this._suggest=new s(this.$input,this.options),this._suggest.context=this),this.$input.data("context",this)},_eventRegister:function(){var e=this.setting;t.isFunction(e.afterSelected)&&this.on("afterSelected",e.afterSelected),t.isFunction(e.beforeSelected)&&this.on("beforeSelected",e.beforeSelected)},_initOptions:function(){var t=this.setting;null==t.autoparam?t.autoparam=[t.valuefield]:t.autoparam=t.autoparam.split(","),t.idfield||(t.idfield=t.valuefield)},_initPanelContent:function(){var i=t('<div class="combo-ztree"><ul id="'+e.uuid("app_ztree_")+'" class="ztree"></ul></div>');i.appendTo(this.$dropPanelMain),this.$ztreeDiv=i.find(".combo-ztree"),this.$ztree=i.find("ul")},_keyManager:function(t){if(!this._dealSysKey(t)){t.keyCode,this.setting;this._isSuggestContext()||(this._mainDivIsVisiable()?this._keyForVisiblePanel(t):this._keyForHiddenPanel(t),this.focus())}},_keyForVisiblePanel:function(t){t.keyCode;var i=this.setting;t.stopPropagation(),e.containKeyCode(t,i.keyNextNode)?this._keyNextNode(t):e.containKeyCode(t,i.keyPrevNode)?this._keyPrevNode(t):e.containKeyCode(t,i.keyPickNode)?this._keyPickNode(t):e.containKeyCode(t,i.keyParentNode)?this._keyParentNode(t):e.containKeyCode(t,i.keyChildNode)?this._keyChildNode(t):e.containKeyCode(t,i.keyHidePanel)?this._keyHidePanel(t):this._keyFilterSuggest(t)&&this.suggest()},_keyForHiddenPanel:function(t){var i=t.keyCode,n=this.setting;e.containKeyCode(t,n.keyShowPanel)?this._keyShowPanel(t):this._isKeyCursorPos(i)?this._keyCursorPos(t):this._keyFilterSuggest(t)&&this.suggest()},_keyPrevNode:function(t){t.preventDefault(),this._stopSuggest(!0);var e=this._getCurrentNode();if(e){if(this._z.getNodesByParam("level",e.level,e.getParentNode()).length<=1)return void this._switchParentNode(e)}this._switchPrevNode(e)},_keyNextNode:function(t){if(t.preventDefault(),this._stopSuggest(!0),this._mainDivIsVisiable()||this.showPanel(),this._z){var e=this._getCurrentNode();if(e){if(this._z.getNodesByParam("level",e.level,e.getParentNode()).length<=1)return void(e.isParent?this._switchChildNode(e):this._switchParentNode(e))}this._switchNextNode(e)}},_keyParentNode:function(t){t.preventDefault(),this._stopSuggest(!0);var e=this._getCurrentNode();e&&e.getParentNode()?this._switchParentNode(e):this._switchPrevNode(e)},_keyChildNode:function(t){t.preventDefault(),this._stopSuggest(!0);var e=this._z.getSelectedNodes()[0];e&&e.isParent?this._switchChildNode(e):this._switchNextNode(e)},_keyPickNode:function(t){t.preventDefault(),this._stopSuggest(!0);var e=this._z.getSelectedNodes()[0];e&&this._onSelect(e)},_getCurrentNode:function(){return this._z.getSelectedNodes()[0]},_switchPrevNode:function(t){var e=null;if(t){if((e=t.getPreNode())==undefined){(i=this._z.getNodesByParam("level",t.level,t.getParentNode())).length>0&&(e=i[i.length-1])}}else{var i;(i=this._z.getNodes()).length>0&&(e=i[i.length-1])}this._focusCurrentNode(t,e)},_switchNextNode:function(t){var e=null;if(t){if((e=t.getNextNode())==undefined){(i=this._z.getNodesByParam("level",t.level,t.getParentNode())).length>0&&(e=i[0])}}else{var i;(i=this._z.getNodes()).length>0&&(e=i[0])}this._focusCurrentNode(t,e)},_switchParentNode:function(t){var e=null;if(!t){var i=this._z.getNodes();i.length>0&&(t=i[0])}t&&(e=t.getParentNode()),e&&this._z.expandNode(e,!1,!1,!1),this._focusCurrentNode(t,e)},_switchChildNode:function(t){var e=null;if(!t){(i=this._z.getNodes()).length>0&&(t=i[0])}if(t&&t.isParent){this._z.expandNode(t,!0,!1,!1,!0);var i;(i=this._z.getNodesByParam("level",t.level+1,t)).length>0&&(e=i[0])}this._focusCurrentNode(t,e)},_focusCurrentNode:function(t,e){e&&(this._z.cancelSelectedNode(t),this._z.selectNode(e),this.focus())},_otherKeyDown:function(){var t=this.$element.data("suggest");t&&(t.stopKeyEvent=!1),this.hidePanel()},togglePanel:function(){this._mainDivIsVisiable()?this.hidePanel():this.showPanel()},showPanel:function(){this._suggest&&this.$dropPanel.append(this.$dropPanelCustom),this._showPanel(function(){this._initData(),this._rendSelectedItems(),this.focus()})},loadData:function(t){this.setting.data=t,this._suggest&&(this._suggest.setting.data=t,this._suggest.isSuggesting()&&this._suggest.refreshSuggest()),this._renderData(),this._mainDivIsVisiable()&&this.place()},setParameter:function(t){t||(t={}),this.$input.data("_parameter",t),this._injectParam()},_injectParam:function(){var e=this.getParameter();this._z&&e&&(this._z.setting.async.otherParam?t.extend(this._z.setting.async.otherParam,e):this._z.setting.async.otherParam=e)},_renderData:function(){this._resetZtree(),this._resetPanelWidth(),this._rendSelectedItems(),this._afterDataRender()},_resetZtree:function(){var e=this.setting.data==undefined?[]:this.setting.data;if(this._z&&this._z.destroy(),0==e.length){var i={};i[this.setting.valuefield]="__ROOTID__",i[this.setting.textfield]="无对应结果",t.fn.zTree.init(this.$ztree,this._getZtreeSetting(),[i])}else t.fn.zTree.init(this.$ztree,this._getZtreeSetting(),e),function(e){if(this._mapData={},e)for(var i=this.setting.idfield,n=0;n<e.length;n++){var a=t.extend(!0,{},e[n]);this._mapData[a[i]]=a}}.call(this,e);this._z=t.fn.zTree.getZTreeObj(this.$ztree.attr("id")),this._injectParam(),0==e.length?(this._z.refresh(),this.$dropPanelEmpty.show()):this.$dropPanelEmpty.hide()},_getZtreeSetting:function(){var t=this.setting,e={view:{selectedMulti:!1,dblClickExpand:!1,showLine:!1,showIcon:t.showIcon,fontCss:function(t,e){return e.highlight?{color:"#A60000","font-weight":"bold"}:{color:"#333","font-weight":"normal"}},addHoverDom:t.addHoverDom,removeHoverDom:t.removeHoverDom,addDiyDom:t.addDiyDom},data:{key:{name:t.textfield},simpleData:{enable:!0,idKey:t.idfield,pIdKey:t.pidfield,rootPId:t.rootpidvalue}}};if(t.async){var i=t.url;t.asyncUrl&&(i=t.asyncUrl),e.async={enable:!0,url:i,autoParam:t.autoparam,otherParam:t.otherParam}}return t.multiple?(e.check={enable:!0},t.onlyleaf&&(e.check.chkboxType={Y:"",N:""}),t.checkBySelf&&(e.check.chkboxType={Y:"",N:""})):e.selectedMulti=!1,e.callback=this._getZtreeCallback(),e},_getZtreeCallback:function(){var e={},i=this;return e.onClick=function(t,e,n){i._onSelect(n)},e.beforeCheck=function(t,e){if(i.setting.onlyleaf&&e.isParent)return!1},e.beforeClick=e.beforeCheck,e.onCheck=function(t,e,n){i._onCheck(n)},e.onAsyncSuccess=function(e,n,a,r){i._onAsyncSuccess(e,n,a,r),function(e){var i=JSON.parse(e);if(i)for(var n=this.setting.idfield,a=0;a<i.length;a++){var r=t.extend(!0,{},i[a]);this._mapData[r[n]]=r}}.call(i,r)},e.onExpand=function(t,e,n){i._onExpand(t,e,n),i.place()},e.onCollapse=function(t,e,n){i.place()},e},_onSelect:function(t){if(this.setting.multiple)if(t.checked)this._z.checkNode(t,!1,!0),this._setSelectedNodes();else{if(!1===this.trigger("beforeSelected",t))return;this._z.checkNode(t,!0,!0),this._setSelectedNodes(),this.trigger("afterSelected",t)}else{if(!1===this.trigger("beforeSelected",t))return;this._z.selectNode(t),this._setSelectedNodes(),this.trigger("afterSelected",t)}},_onCheck:function(t){if(t.checked)this._setSelectedNodes();else{if(!1===this.trigger("beforeSelected",t))return;this._setSelectedNodes(),this.trigger("afterSelected",t)}},_setSelectedNodes:function(){if(this.setting.multiple){var t=this._z.getCheckedNodes(!0);this.setting.shrinkValue?(t=this._removeHalfCheckNode(t),t=this._removeRepeat(t)):this.setting.ignoreHalfCheck&&(t=this._removeHalfCheckNode(t)),o.call(this,t)}else{(t=this._z.getSelectedNodes()).length>=1&&o.call(this,t),this.hidePanel()}},_removeHalfCheckNode:function(t){for(var e=[],i=0;i<t.length;i++){var n=t[i];1!=n.check_Child_State&&e.push(n)}return e},_removeRepeat:function(e){for(var i=t.extend([],e),n=0;n<e.length;n++){var a=e[n];2==a.check_Child_State&&(i=this._removeRepeatChildren(i,a))}return i},_removeRepeatChildren:function(t,e){for(var i=[],n=0;n<t.length;n++){this._z.getNodeByParam("tId",t[n].tId,e)||i.push(t[n])}return i},_onAsyncSuccess:function(t,e,i,n){this._rendSelectedItems()},_onExpand:function(t,e,i){var n=null;if(i&&i.isParent){var a=this._z.getNodesByParam("level",i.level+1,i);a.length>0&&(n=a[0])}n?(this._z.cancelSelectedNode(i),this._z.selectNode(n)):this._z.selectNode(i),this.focus()},reload:function(e,i){e||(e=this.setting.url),this._ajax(e,function(e){this.loadData(e),t.isFunction(i)&&i.call(this,e)})},clearValue:function(){this.setText(""),this.setValue(""),null!=this._z&&this._rendSelectedItems()},_rendSelectedItems:function(){this._clearSelectedNodes();var t=this.getValue(),e=this._z;if(t&&e){var i=this._getNodesByValue();if(this.setting.multiple)for(var n=0;n<i.length;n++)this.setting.shrinkValue||this.setting.ignoreHalfCheck?e.checkNode(i[n],!0,!0):e.checkNode(i[n]);else 1==i.length&&e.selectNode(i[0])}},_getNodesByValue:function(){for(var e=[],i=this._z,n=this.setting.valuefield,a=this.getValue().split(","),r=0;r<a.length;r++)for(var s=i.getNodesByParam(n,a[r]),o=0;o<s.length;o++)e.push(s[o]);return t(e)},_clearSelectedNodes:function(){var t=this._z;if(null!=t)if(this.setting.multiple)t.checkAllNodes(!1);else{var e=t.getSelectedNodes();1==e.length&&t.cancelSelectedNode(e[0])}}});return t.fn.comboztree=function(i,n){var a=undefined,r=arguments,s="comboztree";return this.each(function(){var n=t(this);if(!n.is("input"))return!0;var o=e.getComponent(n,s);if("string"==typeof i)try{var d=Array.prototype.slice.call(r,1);a=e.componentMethodApply(o,i,d),"on"==i&&o._suggest&&o._suggest.on.apply(o._suggest,d),"bind"==i&&o._suggest&&o._suggest.bind.apply(o._suggest,d)}catch(h){e.throwCompMethodError(n,s,i,h)}else o?e.throwCompInitError(n,s):(o=new l(this,i),n.data(s,o))}),a},l}),define("app/widgets/form/app-reference",["app/core/app-jquery","app/core/app-core","app/widgets/window/app-dialog","app/core/app-options","app/widgets/form/app-textbox","app/widgets/form/app-suggest","app/widgets/drag/app-droppanel"],function(t,e,i,n,a,r,s){"use strict";var o=a.extend({Implements:s,initialize:function(t,e){e||(e={}),e._=n.appDefaults.Reference,o.superclass.initialize.call(this,t,e),this._init()},_init:function(){this._initOptions(),this.setting.usesuggest?new r(this.$input,this.options):t.isFunction(this.setting.onClickOpen)&&this.$text.on("click.reference.api",t.proxy(this._mousedown$openBtn,this)),this._registEvents(),this.$input.data("context",this)},_textChangeEvent:function(){},_initOptions:function(){this.setting.url||(this.setting.url=_contextPath+"/ref.do?code="+this.setting.code),this.setting.readFields&&(this.setting.readFields=this.setting.readFields.split(",")),this.setting.writeFields&&(this.setting.writeFields=this.setting.writeFields.split(","))},_registEvents:function(){this.setting.usesuggest||(this._editable(!1),this.$text.on("click.reference.api",t.proxy(this.openReference,this))),this.$openBtn.on("click.reference.api",t.proxy(this.openReference,this)),t.isFunction(this.setting.afterClose)&&this.on("afterClose",this.setting.afterClose),t.isFunction(this.setting.beforeOpenReference)&&this.on("beforeOpenReference",this.setting.beforeOpenReference)},openReference:function(){if(!1!==this.trigger("beforeOpenReference")){var e=this,i=this.setting,n="reference"+$A.nextId(),a={hasheader:i.hasheader,width:i.digWidth,height:i.digHeight,title:i.title,src:this.$button,url:i.url,params:this.getParameter(),"data-target":"#"+n,dialogId:n,closeCallback:function(t){var i=t.data("referenceData");i&&(e.setReferenceData(i),t.removeData("referenceData")),e.trigger("afterClose")},callback:function(t){t.delegate('[data-dismiss="refClear"]',"click.reference",function(){t.data("referenceData",{text:"",value:""}),t.closeDialog()}),t.delegate('[data-dismiss="refCancel"]',"click.reference",function(){t.removeData("referenceData"),t.closeDialog()}),t.data("referenceData",e.getReferenceData())}};this._closeVisiblePanel(),t.openModalDialog(a)}},setAction:function(t){this.setting.url=t},getReferenceData:function(){return this.$input.data("referenceData")},setReferenceData:function(t){t||(t={text:"",value:""}),this.setText(t.text),this.setValue(t.value),this.$input.data("referenceData",t)},clearValue:function(){this.$input.removeData("referenceData"),this.setText(""),this.setValue("")},setValue:function(t,e){this._setValue(t,e);var i=this.getReferenceData();i?i.value=t:(i={value:t},this.$input.data("referenceData",i)),t||this.setText("")},setText:function(t,e){o.superclass.setText.call(this,t);var i=this.getReferenceData();i?i.text=t:(i={text:t},this.$input.data("referenceData",i))},setDialogTitle:function(t){this.setting.title=t}});return t.fn.reference=function(i,n){var a=undefined,r=arguments,s="reference";return this.each(function(){var n=t(this);if(!n.is("input"))return!0;var l=e.getComponent(n,s);if("string"==typeof i)try{var d=Array.prototype.slice.call(r,1);a=e.componentMethodApply(l,i,d)}catch(h){e.throwCompMethodError(n,s,i,h)}else l?e.throwCompInitError(n,s):(l=new o(this,i),n.data(s,l))}),a},t.fn.reference.Constructor=o,t.closeReference=function(t){var e=i.getCurrent();e.data("referenceData",t),e.closeDialog()},o}),define("app/widgets/app-jqgrid",["app/core/app-jquery","app/core/app-core","app/core/app-options","app/widgets/window/app-messager","app/data/app-ajax",localeFile,"jquery/jquery.jqgrid","app/widgets/button/app-button","app/widgets/form/app-number","app/widgets/form/app-money","app/widgets/form/app-combobox","app/widgets/form/app-datetime","app/widgets/form/app-combogrid","app/widgets/form/app-comboztree","app/widgets/form/app-reference","jquery/jquery.upload"],function($,$A,$options,$messager,$ajax){function templateFormat(t,e,i){return $template(e.template,i)}function extendCompent(t){return{PASSWORD:{init:function(t,e,i,n,a,r,s){var o=$(t),l=o.attr("id")+"-comp",d=a[n].name,h=a[n].validations,c=a[n].events,u=a[n].required,p=a[n].requiredMsg,f=a[n].gearRules,g='<input type="password" id="'+l+'" name="'+d+'" ';g+=' value="'+e+'" '+(h=h?' validations="'+h+'"':"")+(c=c?' events="'+c+'"':"")+(u=u?' required="true"':"")+(p=p?' requiredMsg="'+p+'"':"")+(f=f?' gearRules="'+f+'"':"")+' class="editable" width="100%"/>',o.html(g),require(["app/core/app-jquery"],function(t){o.initPageUI()})},getEditor:function(){var t=$(pnlObj).attr("id")+"-comp";return $(pnlObj).find("#"+t).data("textbox")},xtype:"textbox"},RADIOBOX:{init:function(t,e,i,n,a,r,s){var o=$(t),l=o.attr("id")+"-comp",d=a[n].name,h=a[n].validations,c=a[n].events,u=a[n].required,p=a[n].requiredMsg,f=a[n].gearRules;h=h?' validations="'+h+'"':"",c=c?' events="'+c+'"':"",u=u?' required="true"':"",p=p?' requiredMsg="'+p+'"':"",f=f?' gearRules="'+f+'"':"";var g=a[n].editOptions;g=g||"[]",g=new Function("return NaN")();for(var m=new Array,v=0;v<g.length;v++){var b=g[v],y=e==b.value?"checked='true'":"";m.push('<label><input type="radio" id="'+l+v+'" name="'+d+'" '+y),m.push(' value="'+b.value+'" '+h+c+u+p+f+' class="editable" style="width:auto;"/>'+b.text+"</label>")}o.html(m.join("")),require(["app/core/app-jquery"],function(t){o.initPageUI()})},getVal:function(t){var e=$(t).find(":radio:checked");return e.size()>0?e.val():$(t).attr("val")||$(t).attr("txt")},getTxt:function(t){var e=$(t).find(":radio:checked");return e.size()>0?e.val():$(t).attr("val")||$(t).attr("txt")}},TEXTAREA:{init:function(t,e,i,n,a,r,s){var o=$(t),l=o.attr("id")+"-comp",d=a[n].name,h=a[n].validations,c=a[n].events,u=a[n].required,p=a[n].requiredMsg,f=a[n].gearRules,g='<textarea id="'+l+'" name="'+d+'" ';g+=(h=h?' validations="'+h+'"':"")+(c=c?' events="'+c+'"':"")+(u=u?' required="true"':"")+(p=p?' requiredMsg="'+p+'"':"")+(f=f?' gearRules="'+f+'"':"")+' class="editable" style="resize: none;" width="100%">'+e+"</textarea>",o.html(g),require(["app/core/app-jquery"],function(t){o.initPageUI()})},xtype:"textbox"},MONEY:{init:function(t,e,i,n,a,r,s){var o=$(t),l=o.attr("id")+"-comp",d=a[n].name,h=a[n].validations,c=a[n].events,u=a[n].required,p=a[n].requiredMsg,f=a[n].gearRules,g='<input type="text" id="'+l+'" name="'+d+'" ';g+=' value="'+e+'" '+(h=h?' validations="'+h+'"':"")+(c=c?' events="'+c+'"':"")+(u=u?' required="true"':"")+(p=p?' requiredMsg="'+p+'"':"")+(f=f?' gearRules="'+f+'"':"")+' class="app-money" width="100%"/>';var m=a[n].editOptions,v=$(g);v.attr("_options",m),o.html(v),v.money()},getVal:function(t){var e=$(t).attr("id")+"-comp";return $(t).find("#"+e).money("getValue")},getEditor:function(t){var e=$(t).attr("id")+"-comp";return $(t).find("#"+e).data("money")},xtype:"money"},COMBOGRID:{init:function(t,e,i,n,a,r,s){var o=$(t),l=o.attr("id")+"-comp",d=a[n].editOptions,h=a[n].name,c=a[n].validations,u=a[n].required,p=a[n].requiredMsg,f=a[n].gearRules,g=!1;null!=d.suggest&&(g=!0);var m=$('<input id="'+l+'" name="'+h+'" class="app-combogrid" value="'+e+'" width="100%" />');m.attr("value",e),m.attr("text",r),m.attr("suggest",g),m.attr("validations",c),m.attr("required",u),m.attr("requiredMsg",p),f&&m.attr("gearRules",f),m.attr("_options",d),o.empty().append(m),m.combogrid()},getVal:function(t){var e=$(t).attr("id")+"-comp";return $(t).find("#"+e).combogrid("getValue")},getTxt:function(t){var e=$(t).attr("id")+"-comp";return $(t).find("#"+e).combogrid("getText")},getEditor:function(t){var e=$(t).attr("id")+"-comp";return $(t).find("#"+e).data("combogrid")},xtype:"combogrid"},COMBOZTREE:{init:function(t,e,i,n,a,r,s){var o=$(t),l=o.attr("id")+"-comp",d=a[n].editOptions,h=a[n].name,c=a[n].validations,u=a[n].required,p=a[n].requiredMsg,f=a[n].gearRules,g=$('<input id="'+l+'" name="'+h+'" class="app-comboztree" width="100%">');if(c&&g.attr("validations",c),u&&g.attr("required",!0),p&&g.attr("requiredMsg",p),f&&g.attr("gearRules",f),d&&(d=d.replace(/{/,"{keyShowPanel:[220], ")),d&&g.attr("_options",d),a[n].showField){var m=a[n].formatoptions,v=$(this).jqGrid("getRowData",this.p.selrow);r=a[n].formatter(e,m,v)}g.attr("value",e),g.attr("text",r),o.empty().append(g),g.comboztree()},getVal:function(t){var e=$(t).attr("id")+"-comp";return $(t).find("#"+e).comboztree("getValue")},getTxt:function(t){var e=$(t).attr("id")+"-comp";return $(t).find("#"+e).comboztree("getText")},getEditor:function(t){var e=$(t).attr("id")+"-comp";return $(t).find("#"+e).data("comboztree")},xtype:"comboztree"},COMBOBOX:{init:function(t,e,i,n,a,r,s){var o=$(t),l=o.attr("id")+"-comp",d=a[n].editOptions||{},h=a[n].name,c=a[n].validations,u=a[n].required,p=a[n].requiredMsg,f=a[n].gearRules,g=!1;null!=d.suggest&&(g=!0);var m=$('<input id="'+l+'" name="'+h+'" class="app-combobox"  width="100%"  />');if(m.attr("suggest",g),c&&m.attr("validations",c),u&&m.attr("required",!0),p&&m.attr("requiredMsg",p),f&&m.attr("gearRules",f),d&&m.attr("_options",d),a[n].showField){var v=a[n].formatoptions,b=$(this).jqGrid("getRowData",this.p.selrow);a[n].formatter&&(r=a[n].formatter(e,v,b))}m.attr("value",e),m.attr("text",r),o.empty().append(m),m.combobox()},getVal:function(t){var e=$(t).attr("id")+"-comp";return $(t).find("#"+e).combobox("getValue")},getTxt:function(t){var e=$(t).attr("id")+"-comp";return $(t).find("#"+e).combobox("getText")},getEditor:function(t){var e=$(t).attr("id")+"-comp";return $(t).find("#"+e).data("combobox")},xtype:"combobox"},REFERENCE:{init:function(t,e,i,n,a,r,s){var o=$(t),l=o.attr("id")+"-comp",d=a[n].name,h=a[n].url,c=a[n].validations,u=a[n].events,p=a[n].required,f=a[n].requiredMsg,g=a[n].gearRules,m='<input id="'+l+'"  name="'+d+'"  value="'+e+'" text="'+r+'" ';m+=' class="app-reference" width="98%"',m+=(c=c?' validations="'+c+'"':"")+(u=u?' events="'+u+'"':"")+(p=p?' required="true"':"")+(f=f?' requiredMsg="'+f+'"':"")+(g=g?' gearRules="'+g+'"':"")+(h=h?' action="'+h+'" ':"")+" />";var v=a[n].editOptions,b=$(m);v&&b.attr("_options",v),o.html(b),b.reference()},getVal:function(t){var e=$(t).attr("id")+"-comp";return $(t).find("#"+e).reference("getValue")},getTxt:function(t){var e=$(t).attr("id")+"-comp";return $(t).find("#"+e).reference("getText")},getEditor:function(t){var e=$(t).attr("id")+"-comp";return $(t).find("#"+e).data("reference")},xtype:"reference"},DATETIME:{init:function(t,e,i,n,a,r,s){var o=$(t),l=o.attr("id")+"-comp",d=a[n].name,h=(o.width(),a[n].editOptions),c=a[n].validations,u=a[n].events,p=a[n].required,f=a[n].requiredMsg,g=a[n].gearRules,m="";m+='<input class="app-datetime" id="'+l+'" name="'+d+'" ',m+=' value="'+e+'" width="98%"';var v=$(m+=(c=c?' validations="'+c+'"':"")+(u=u?' events="'+u+'"':"")+(p=p?' required="true"':"")+(f=f?' requiredMsg="'+f+'"':"")+(g=g?' gearRules="'+g+'"':"")+"/>");v.attr("_options",h),o.html(v),v.datetime()},getVal:function(t){var e=$(t).attr("id")+"-comp";return $(t).find("#"+e).datetime("getValue")},getTxt:function(t){return this.getVal(t)},getEditor:function(t){var e=$(t).attr("id")+"-comp";return $(t).find("#"+e).data("datetimepicker")},xtype:"datetimepicker"},NUMBER:{init:function(t,e,i,n,a,r,s){var o=$(t),l=o.attr("id")+"-comp",d=a[n].name,h=a[n].validations,c=a[n].events,u=a[n].required,p=a[n].requiredMsg,f=a[n].gearRules;h=h?' validations="'+h+'"':"",c=c?' events="'+c+'"':"",u=u?' required="true"':"",p=p?' requiredMsg="'+p+'"':"",f=f?' gearRules="'+f+'"':"";var g=a[n].editOptions,m='<input type="text" id="'+l+'" name="'+d+'" ',v=$(m+=' value="'+e+'" '+h+c+u+p+f+' class="app-number" width="100%"/>');g&&v.attr("_options",g),o.html(v),v.number()},getVal:function(t){var e=$(t).attr("id")+"-comp";return $(t).find("#"+e).number("getValue")},getEditor:function(t){var e=$(t).attr("id")+"-comp";return $(t).find("#"+e).data("number")},xtype:"number"}}}var getDefaultCompent=$.jgrid.getDefaultCompent;$.extend($.jgrid,{getDefaultCompent:function(){return $.extend(!0,getDefaultCompent(),extendCompent())}}),$.fn.getJqGrid=function(){var t=$(this);if(!t.isGrid())return null;if("true"==t.attr("jqgrid"))return t;if(t.length>1){var e=[];return t.each(function(){var t=$(this);e.push("#"+t.attr("jqgridid"))}),$(e.join(","))}return $("#"+t.attr("jqgridid"))},$.fn.isGrid=function(){return"true"==$(this).attr("jqgrid")||$(this).attr("jqgridid")},$.fn.initJqGrid=function(){this.each(function(){var $this=$(this),$container=$this.parent(".grid-container"),id=$this.attr("id")||"jqgrid"+$A.nextId(),url=$this.attr("url"),dataType=$this.attr("dataType")||"json",autoLoad=!("false"==$this.attr("autoLoad")),usePage=!("false"==$this.attr("usePage")),pageId=$this.attr("pageId"),pageList=$this.attr("pageList")?$this.attr("pageList").split(","):$options.jqgrid.pageList,rowNum=1*($this.attr("pageSize")||pageList[0]),sortname=$this.attr("sortname"),sortorder=$this.attr("sortorder")||"asc",height=$this.attr("height"),width=$container.width(),showFooter="true"==$this.attr("showFooter"),manualFooter="true"==$this.attr("manualFooter"),page=1*($this.attr("page")||1),method=$this.attr("method")||"POST",multiselect="true"==$this.attr("checkboxable"),loadOnce="true"==$this.attr("loadOnce"),striped="false"!=$this.attr("striped"),treeGrid="true"==$this.attr("treeGrid"),multiboxonly="false"!=$this.attr("checkboxOnly"),autoHeight="false"!=$this.attr("autoHeight"),shrinkToFit="false"!=$this.attr("shrinkToFit"),repeatitems="false"!=$this.attr("repeatitems"),events=$this.attr("events"),params=$this.attr("params"),transor=$this.attr("transor"),jsonReader=$this.attr("jsonReader"),editRow="true"==$this.attr("editRow"),editUrl=$this.attr("editUrl"),editSuccesfunc=$this.attr("editSuccesfunc"),rownumbers=!0,fit="true"==$this.attr("fit"),gridheaders=$this.attr("gridheaders"),fillNum=$this.attr("fillNum"),gridExport="true"==$this.attr("export"),fileName=$this.attr("fileName"),extOptions=$this.attr("extOptions");void 0!==$this.attr("rownumbers")&&(rownumbers="true"==$this.attr("rownumbers")),height&&height.indexOf("px")&&(height=height.replace("px","")),autoHeight&&(height="100%");var cols=[],colNames=[],$colTds=$("thead>tr>th",$this),colFuncs=[];if($colTds.each(function(){var t=$(this),e=t.html()||"",i=t.attr("name")||t.attr("id")||t.attr("field")||e,n=t.attr("field")||i,a=t.attr("valueField"),r=t.attr("width"),s="true"==t.attr("sortable"),o=(t.attr("align")||"left").toLowerCase(),l=t.attr("columnType"),d=t.attr("columnContent"),h=t.attr("columnHeadFunc"),c="true"==t.attr("chidden"),u=t.attr("formatterType"),p=t.attr("formatter"),f=t.attr("formatterOptions"),g="false"!=t.attr("editable"),m=t.attr("edittype")?t.attr("edittype"):"TEXTBOX",v=t.attr("editOptions"),b=t.attr("footerType"),y=t.attr("footerDef"),w=t.attr("footerFormatter"),_=t.attr("required")&&!0,x=t.attr("requiredMsg"),C=t.attr("gearRules"),k=t.attr("events"),T=t.attr("url"),P=t.attr("frozen"),S=t.attr("showField"),D=t.attr("validations"),R=t.attr("transor"),N=!0;_&&"RADIOBOX"!=m&&(e='<span class="required">*</span>'+e,N=!1),y&&(y=y.toLowerCase(),"TEXT"==b?y=y:"FORMULA"==b&&(y=t.getJsFunction(y)));var E={name:i,index:n,sortable:s,align:o,hidden:c,required:_,requiredMsg:x,summaryType:y,summaryTpl:w,validations:D,events:k,footerType:b,editable:g,edittype:m,editOptions:v,url:T,isTransor:R,columnHeadFunc:h,valueField:a,attachField:t.attr("attachField"),validations:D,gearRules:C,frozen:P,autoencode:N};p&&(f&&(f=$A.jsonEval(f)),"FUNC"==u?p=t.getJsFunction("return "+p)():"TEMPLATE"==u&&(f||(f={}),f.template=p,p=templateFormat),E.formatter=p,E.formatoptions=f,E.autoencode=!1),S&&(E.showField=S,E.formatter=function(t,e,i){var n="",a=i[S];return a&&(n=a),n}),r&&(E.width=r),"FUNC"!=l&&"TEMPLATE"!=l&&"OP"!=l||(colFuncs.push({name:i,content:d,type:l}),E.autoencode=!1),E.columnType=l,colNames.push(e),cols.push(E)}),$this.removeAttr("height"),$this.removeAttr("width"),$this.empty(),$container.length>0){$container.find(".grid-info").html($.jgrid.defaults.emptyrecords),$container.attr("jqgridid",id),$this.attr("id",id);var conid=$container.attr("id");$this.attr("origionId",conid||id)}else{var newid="jqgrid"+$A.nextId();$this.attr("id",newid),$this.attr("origionId",id),id=newid}if(usePage){var $page=$A("#"+pageId);$page.size()>0&&(pageId=id+"_pageTool",$page.attr("id",pageId))}$this.attr("cwidth",$container.width()),$container.bind("_resize",function(t,e,i,n){var a=$container.parent(".layout-body,.panel-body");return a.length>0&&(1==fit?(a.css("overflow","hidden"),$container.innerWidth(i),$container.innerHeight(n),$this.jqGrid("setGridHeight",$container.height()),$this.jqGrid("setGridWidth",$container.width())):(a[0].offsetHeight<a[0].scrollHeight&&(i-=18),$container.innerWidth(i),$this.jqGrid("setGridWidth",$container.width()))),!1});var gridComplete=0==$container.length&&0==colFuncs.length?null:function(){var t=$this.jqGrid("getDataIDs");if($container.length>0){var e=$container.find(".grid-info");0==t.length?e.css("display",""):e.css("display","none")}if(0==$this.jqGrid("getGridParam","reccount")&&fillNum){fillNum=parseInt(fillNum,10);var i=[];if(t<=0){for(var n=0;n<fillNum;n++)$.jgrid.randId(),rowData={},i.push(rowData);$this.jqGrid("addRowData",null,i),window.setTimeout(function(){fillNum=0})}}if(0!=colFuncs.length){for(n=0;n<t.length;n++)for(var a=t[n],r=0;r<colFuncs.length;r++){var s,o=colFuncs[r];if("FUNC"==o.type)s=$this.getJsFunction("return "+o.content+".apply(this,arguments)")($this,a);else{var l=$this.jqGrid("getRowData",a);l.id||(l.id=a),s=$template(o.content,l)}var d={};d[o.name]=s,$this.jqGrid("setRowData",a,d)}$("[handle][handleType=JS]",$this).each(function(){var t=$(this),e=t.attr("handle");if(e){var i=null;try{i=$this.getJsFunction(e)}catch(n){return}t.removeAttr("handle"),t.click(function(e){t.isTag("a")&&e.preventDefault(),t.attr("disabled")||t.hasClass("disabled")||i.call(this)})}})}};null==jsonReader&&(jsonReader=repeatitems?{root:"data",page:"page",total:"totalPage",cell:"cell",records:"totalRecords",id:"id"}:{root:"data",page:"page",total:"totalPage",records:"totalRecords",repeatitems:!1,id:"id"});var dt=autoLoad?dataType:"local",myCompent=extendCompent($(this)),gridTotal=function(){var t=$this.jqGrid("getDataIDs"),e={};summary=[];for(var i=0;i<cols.length;i++)cols[i].summaryType&&summary.push({nm:cols[i].name,st:cols[i].summaryType,formatter:cols[i].formatter,v:"TEXT"==cols[i].footerType?cols[i].summaryType:"",footerType:cols[i].footerType});for(i=0;i<t.length;i++){var n=t[i],a=$this.jqGrid("getRowData",n);$.each(summary,function(){$.isFunction(this.st)?this.v=this.st.call($this,this.v,this.nm,a):"TEXT"!=this.footerType&&(this.v=$this.jqGrid("groupingCalculations.handler",this.st,this.v,this.nm,null,null,a))})}$.each(summary,function(){$.isFunction(this.formatter)&&(this.v=this.formatter.call(this,this.v)),e[this.nm]=this.v}),$this.footerData("set",e)},op={url:url,editurl:editUrl,datatype:dt,mtype:method,colNames:colNames,colModel:cols,altRows:striped,height:height,shrinkToFit:shrinkToFit,width:width,loadonce:loadOnce,multiselect:multiselect,multiboxonly:multiboxonly,viewrecords:!0,recordpos:"left",pagerpos:"right",loadui:!1,treeGrid:treeGrid,ExpandColumn:"name",gridComplete:gridComplete,jsonReader:jsonReader,component:myCompent,editSuccesfunc:editSuccesfunc,rownumbers:rownumbers,editRow:editRow,footerrow:showFooter,userDataOnFooter:manualFooter,isExport:gridExport,fileName:fileName,gridTotal:gridTotal};if(extOptions){var extCfg=new Function("return "+extOptions+";")();extCfg&&(op=$.extend(op,extCfg))}if(usePage?(op.pager="#"+pageId,op.rowNum=0==rowNum?1*pageList[0]:rowNum,op.rowList=pageList,op.page=page):op.rowNum=-1,sortname&&(op.sortname=sortname,op.sortorder=sortorder),treeGrid){op.treeGridModel="adjacency";var treeColumn=$this.attr("treeColumn");treeColumn&&(op.ExpandColumn=treeColumn);var treeReader={level_field:$this.attr("levelField")||"level",parent_id_field:$this.attr("parentField")||"parent",leaf_field:$this.attr("leafField")||"leaf",expanded_field:$this.attr("expandedField")||"expanded",loaded:$this.attr("loadedField")||"loaded",icon_field:$this.attr("iconField")||"icon"};op.treeReader=treeReader}if(events){var es=$this.getJsEvent(events),completHandler=es.gridComplete;if(completHandler){var gridHandle=op.gridComplete;es.gridComplete=function(){gridHandle.apply(this,arguments),completHandler.apply(this,arguments)}}$.extend(op,es)}if(params=params?$A.jsonEval(params):{},transor&&(params.__transor=transor),op.postData=params,multiselect&&editRow&&(op.beforeSelectRow||(op.beforeSelectRow=function(t,e){var i=$(this),n=$.jgrid.getCellIndex($(e.target).closest("td")[0]);return"cb"===i.jqGrid("getGridParam","colModel")[n].name})),$this.jqGrid(op),gridheaders){var gridheadersCfg=$.parseJSON(gridheaders),inColumnHeaders=function(t){var e,i=t.groupHeaders.length;for($this.jqGrid("setGroupHeaders",t),e=0;e<i;e++)t.groupHeaders[e].groupHeaders&&(t.groupHeaders[e].useColSpanStyle=t.useColSpanStyle,inColumnHeaders(t.groupHeaders[e]))};inColumnHeaders(gridheadersCfg),$this[0].p.gridheadersCfg=gridheadersCfg}if(showFooter&&$this.bind("jqGridAfterGridComplete",function(){gridTotal()}),$container.bind("_resize",function(t,e,i,n){var a=$container.parent(".layout-body");return a.length>0&&(1==fit?(a.css("overflow","hidden"),$container.innerWidth(i),$container.innerHeight(n),$this.jqGrid("setGridHeight",$container.height()),$this.jqGrid("setGridWidth",$container.width())):(a[0].offsetHeight<a[0].scrollHeight&&(i-=18),$container.innerWidth(i),$this.jqGrid("setGridWidth",$container.width()))),!1}),editRow){var editOp={keys:!0};editSuccesfunc&&(editOp.succesfunc=eval(editSuccesfunc));var editTag=!0;$this.jqGrid("setGridParam",{onClickRow:function(t,t,e){var i={keys:!0,focus:e};window.setTimeout(function(){editTag&&(editTag=!1,$this.jqGrid("editRow",t,i),editTag=!0)},0)}})}$this.attr("jqgrid","true"),$this.attr("init","true"),$this.attr("datatype",dataType)})},$.fn.reloadJqGrid=function(t){$(this).each(function(){var e=$(this),i=e.getJqGrid();if(i&&"true"==i.attr("init")){var n=i.attr("datatype")||"json";t=t||{};var a=e.attr("transor");a&&(t.__transor=a),t.baseParams&&(e.data("baseParams",t.baseParams),delete t.baseParams);var r=e.data("baseParams");t=$.extend(!0,t,r),i.jqGrid("setGridParam",{datatype:n,treedatatype:n,postData:t}).trigger("reloadGrid")}else t&&((i=e.hasClass(".jqgrid")?e:$(".jqgrid[init!=true]",e)).attr("autoLoad","true"),i.attr("params",$A.toJsonString(t)))})},$.fn.bsgrid=function(t){if("string"==typeof t){var e={getGridId:function(){return this.attr("origionId")},getGridParam:function(t){return this.jqGrid("getGridParam",t)},setGridParam:function(t){this.jqGrid("setGridParam",t)},appendRow:function(t,e,i,n){return e=e||"last",t=t||{},n="false"!=n&&0!=n,this.each(function(){if(this.grid){var a=$(this),r=a.jqGrid("getGridParam","jsonReader"),s=t[r.id]||$.jgrid.randId();t[r.id]=s;if(a.jqGrid("addRowData",s,t,e,i)){a.jqGrid("setSelection",s),n&&a.jqGrid("editRow",s,{keys:!0});var o=a.jqGrid("getGridRowById",s).rowIndex,l=$(this.grid.bDiv).outerHeight(),d=this.grid.bDiv.scrollTop,h=$(this.rows[o]).position().top,c=$(this.rows[o]).outerHeight();h+c>=l+d?this.grid.bDiv.scrollTop=h-(l+d)+c+d:h<l+d&&h<d&&(this.grid.bDiv.scrollTop=h)}return s}})},deleteRow:function(t){return this.each(function(){var e;e=t?$.isArray(t)?t:[t]:this.p.multiselect&&this.p.selarrrow.length>0?this.p.selarrrow:[this.p.selrow];for(var i=0;i<e.length;i++){var n=e[i];if(!n)return;$(this).jqGrid("delRowData",n)}})},submitData:function(t,e,i,n,a){return this.each(function(){$(this).jqGrid("submitData",e,t,i,n,a)})},getSubmitData:function(){return $(this).jqGrid("getSubmitData")},getComponent:function(t){return t&&0!=this.length?this[0].p.component[t]:null},hideCol:function(t){if(t){var e=$.isArray(t)?t:[t];$(this).jqGrid("hideCol",e,"none")}},showCol:function(t){if(t){var e=$.isArray(t)?t:[t];$(this).jqGrid("showCol",e,"display")}},setCell:function(t,e,i,n,a,r){$(this).jqGrid("setCell",t,e,i,n,a)},getCell:function(t,e){return $(this).jqGrid("getCell",t,e)},getCellEditor:function(t){var e=this.bsgrid("getSelectRowId");if(!e)return null;var i=$(this).jqGrid("getJqGridObj"),n=-1;if(i.grid){if(isNaN(t)&&$(i.p.colModel).each(function(e){if(this.name===t)return n=e,!1}),n>=0){var a=$(i).jqGrid("getGridRowById",e),r=$("td:eq("+n+")",a);if(!r)return null;var s=$(r),o=s.find("input:first-child");return o.length>0?$("#"+o[0].id):s.length>0?$("#"+s[0].id):null}return null}},setEditEnabled:function(t){return this.each(function(){if(this.grid){if(t)return this.p.editRow=!0,!0;var e=$(this).jqGrid("saveRows",this);return e&&(this.p.editRow=!1),e}})},getEditRow:function(){var t=this.getGridParam("savedRow");return null==t||0==t.length?null:t[0]},getDataIDs:function(){return this.jqGrid("getDataIDs")},getRowData:function(t){return this.jqGrid("getRowData",t)},setRowData:function(t,e,i){this.jqGrid("setRowData",t,e,i)},setSelection:function(t,e,i){this.jqGrid("setSelection",t,e,i)},resetSelection:function(t){this.jqGrid("resetSelection",t)},resetEditData:function(){$(this).jqGrid("resetEditData")},refreshEditData:function(t,e){var i=this.bsgrid("getSubmitData").add||[],n=0;$.each(data,function(t,e){if("ADD"==e.internalStatus)if(i.length>n){var a=i[n].id;this.bsgrid("appendRow",e,"after",pos,!1),this.bsgrid("deleteRow",a),n++}else this.bsgrid("appendRow",e,null,null,!1);else e.internalStatus==UPDATE&&this.bsgrid("setRowData",e.id,e)}),this.bsgrid("resetEditData")},refreshAllData:function(t){var e=this;e.bsgrid("clearData"),$(t).each(function(t,i){e.bsgrid("appendRow",i,null,null,!1)}),e.bsgrid("resetEditData")},editRow:function(t){this.jqGrid("editRow",t)},restoreRow:function(t){this.jqGrid("restoreRow",t)},setWidth:function(t,e){this.jqGrid("setGridWidth",t,e)},setHeight:function(t){this.jqGrid("setGridHeight",t)},setBaseParams:function(t){$(this).each(function(){$(this).data("baseParams",t)})},getBaseParams:function(){var t=null;return $(this).each(function(){var e=$(this);t=e.data("baseParams")}),t},reload:function(t){$(this).each(function(){var e=$(this),i=e.getJqGrid();if(i&&"true"==i.attr("init")){var n=i.attr("datatype")||"json";t=t||{};var a=e.attr("transor");a&&(t.__transor=a),t.baseParams&&(e.data("baseParams",t.baseParams),delete t.baseParams);var r=e.data("baseParams");t=$.extend(!0,t,r),i.jqGrid("setGridParam",{datatype:n,treedatatype:n,postData:t}).trigger("reloadGrid")}else t&&((i=e.hasClass(".jqgrid")?e:$(".jqgrid[init!=true]",e)).attr("autoLoad","true"),i.attr("params",$A.toJsonString(t)))})},load:function(t){$(this).each(function(){var e=$(this),i=e.getJqGrid();if(i&&"true"==i.attr("init")){var n=i.attr("datatype")||"json",a={page:1};(t=t||{}).parma&&$.isPlainObject(t.parma)&&$.extend(a,t.parma),t.baseParams&&(e.data("baseParams",t.baseParams),delete t.baseParams);var r=e.attr("transor");r&&(t.__transor=r);var s=e.data("baseParams");t=$.extend(!0,t,s),i.jqGrid("setGridParam",{datatype:n,treedatatype:n,postData:t,isLoad:!0}).trigger("reloadGrid",a)}else t&&((i=e.hasClass(".jqgrid")?e:$(".jqgrid[init!=true]",e)).attr("autoLoad","true"),i.attr("params",$A.toJsonString(t)))})},nextPage:function(){$(this).each(function(){var t=$(this),e=t.getJqGrid();if(e&&"true"==e.attr("init")){var i=t.attr("id");$("#next_"+i+"_pageTool").click()}})},prvePage:function(){$(this).each(function(){var t=$(this),e=t.getJqGrid();if(e&&"true"==e.attr("init")){var i=t.attr("id");$("#prev_"+i+"_pageTool").click()}})},clearData:function(){$(this).jqGrid("clearGridData",!1)},getSelectRowId:function(){return this.jqGrid("getGridParam","selrow")},getSelectRow:function(){var t=this.bsgrid("getSelectRowId");if(t)return this.bsgrid("getRowData",t)},getSelectIds:function(){return this.bsgrid("getGridParam","selarrrow")},loadData:function(t){$(this).each(function(){this.addJSONData(t)})}}[t];if(!e)throw"该方法未定义: "+t;var i=$.makeArray(arguments).slice(1);return e.apply(this,i)}return this}}),define("app/widgets/app-lang_zh_CN",["app/core/app-jquery","app/core/app-core","app/util/app-utils"],function(t,e,i){var n={locale:"zh_CN",msg:function(t,e){return i.format(this._messages[t],e)},_messages:{validateFormError:"提交数据不完整，{0}个字段有错误，请改正后再提交! ",alertSelectMsg:"请选择信息!"},messager:{OK:"确定",CANCEL:"取消",CONFIRM:"确认",ERROR:"错误",WARN:"警告",INFO:"信息",CORRECT:"成功",PROMPT:"提示"},dataTable:{oLanguage:{oPaginate:{sFirst:"首页",sLast:"末页",sPrevious:"上一页",sNext:"下一页"},sLengthMenu:"每页显示 _MENU_ 条",sSearch:"查找:_INPUT_",sEmptyTable:"无符合条件的数据",sInfo:"当显示&nbsp;从 _START_ 到 _END_ 条记录&nbsp;&nbsp;&nbsp;总共 _TOTAL_ 记录",sInfoEmpty:"无显示记录",sLoadingRecords:"加载中...",sProcessing:"处理中...",sZeroRecords:"无符合条件的数据"}},pagination:{previous:"上一页",next:"下一页",pageInfo:"总共{0}记录,共{2}页,&nbsp;&nbsp;&nbsp;当显示第{3}页&nbsp;从{4}到{5}条记录",pageSizeInfo:"<ul class='ulnostyle uloneline'><li class='controltxt' >每页</li><li>{0}</li><li class='controltxt'>条记录</li></ul>"},validator:{},datetimepicker:{days:["星期日","星期一","星期二","星期三","星期四","星期五","星期六","星期日"],daysShort:["周日","周一","周二","周三","周四","周五","周六","周日"],daysMin:["日","一","二","三","四","五","六","日"],months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthsShort:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],today:"今日",suffix:[],meridiem:[]},magicsuggest:{noSuggestionText:"无相关数据"},flexigrid:{errormsg:"加载数据错误",pagestat:"当前显示从 {from}到{to}条记录&nbsp;&nbsp;&nbsp;总共{total}记录 ",pagetext:"",outof:"/",procmsg:"数据加载中……",nomsg:"无符合条件的数据"}};return e.lang=n,t.jgrid=t.jgrid||{},t.extend(t.jgrid,{defaults:{recordtext:"{0} - {1}　共 {2} 条",emptyrecords:"无符合条件的记录。",loadtext:"读取中...",pgtext:" {0} 共 {1} 页"},search:{caption:"搜索...",Find:"查找",Reset:"重置",odata:[{oper:"eq",text:"等于　　"},{oper:"ne",text:"不等　　"},{oper:"lt",text:"小于　　"},{oper:"le",text:"小于等于"},{oper:"gt",text:"大于　　"},{oper:"ge",text:"大于等于"},{oper:"bw",text:"开始于"},{oper:"bn",text:"不开始于"},{oper:"in",text:"属于　　"},{oper:"ni",text:"不属于"},{oper:"ew",text:"结束于"},{oper:"en",text:"不结束于"},{oper:"cn",text:"包含　　"},{oper:"nc",text:"不包含"}],groupOps:[{op:"AND",text:"所有"},{op:"OR",text:"任一"}]},edit:{addCaption:"添加记录",editCaption:"编辑记录",bSubmit:"提交",bCancel:"取消",bClose:"关闭",saveData:"数据已改变，是否保存？",bYes:"是",bNo:"否",bExit:"取消",msg:{required:"此字段必需",number:"请输入有效数字",minValue:"输值必须大于等于 ",maxValue:"输值必须小于等于 ",email:"这不是有效的e-mail地址",integer:"请输入有效整数",date:"请输入有效时间",url:"无效网址。前缀必须为 ('http://' 或 'https://')",nodefined:" 未定义！",novalue:" 需要返回值！",customarray:"自定义函数需要返回数组！",customfcheck:"Custom function should be present in case of custom checking!"}},view:{caption:"查看记录",bClose:"关闭"},del:{caption:"删除",msg:"删除所选记录？",bSubmit:"删除",bCancel:"取消"},nav:{edittext:"",edittitle:"编辑所选记录",addtext:"",addtitle:"添加新记录",deltext:"",deltitle:"删除所选记录",searchtext:"",searchtitle:"查找",refreshtext:"",refreshtitle:"刷新表格",alertcap:"注意",alerttext:"请选择记录",viewtext:"",viewtitle:"查看所选记录"},col:{caption:"选择列",bSubmit:"确定",bCancel:"取消"},errors:{errcap:"错误",nourl:"没有设置url",norecords:"没有要处理的记录",model:"colNames 和 colModel 长度不等！"},formatter:{integer:{thousandsSeparator:",",defaultValue:"0"},number:{decimalSeparator:".",thousandsSeparator:",",decimalPlaces:2,defaultValue:"0.00"},currency:{decimalSeparator:".",thousandsSeparator:",",decimalPlaces:2,prefix:"",suffix:"",defaultValue:"0.00"},date:{dayNames:["日","一","二","三","四","五","六","星期日","星期一","星期二","星期三","星期四","星期五","星期六"],monthNames:["一","二","三","四","五","六","七","八","九","十","十一","十二","一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],AmPm:["am","pm","上午","下午"],S:function(t){return t<11||t>13?["st","nd","rd","th"][Math.min((t-1)%10,3)]:"th"},srcformat:"Y-m-d",newformat:"Y-m-d",parseRe:/[Tt\\\/:_;.,\t\s-]/,masks:{ISO8601Long:"Y-m-d H:i:s",ISO8601Short:"Y-m-d",ShortDate:"n/j/Y",LongDate:"l, F d, Y",FullDateTime:"l, F d, Y g:i:s A",MonthDay:"F d",ShortTime:"g:i A",LongTime:"g:i:s A",SortableDateTime:"Y-m-d\\TH:i:s",UniversalSortableDateTime:"Y-m-d H:i:sO",YearMonth:"F, Y"},reformatAfterEdit:!1},baseLinkUrl:"",showAction:"",target:"",checkbox:{disabled:!0},idName:"id"}}),n}),define("app/widgets/app-progressbar",["app/core/app-jquery","app/core/app-core","app/core/app-options"],function(t,e,i){"use strict";var n=function(e,i){this.$input=t(e).css("display","none"),this.options=i,this._init()};return n.prototype={constructor:n,_init:function(){this._initOptions(),this._wrapper()},_wrapper:function(){var e=this.setting,i=this.getPercent(),n="";parseInt(e.height)>16&&(n='<span style="color:'+e.color+';">'+i+"%</span>"),this.$element=t('<div style="width:'+e.width+";height:"+e.height+';" class="app-progressbar '+(e.striped?"activebar stripedbar":"")+'"><div style="width: '+i+"%;background-color:"+e["background-color"]+';"></div>'+n+"</div>").insertAfter(this.$input)},_initOptions:function(){var e={},n=this.$input[0].attributes;n&&t.each(n,function(t,i){"true"==i.value?e[i.name]=!0:"false"==i.value?e[i.name]=!1:e[i.name]=i.value});var a=this.setting=t.extend({},i.appDefaults.progressbar,e,this.options);a.value=parseInt(a.value),a.max=parseInt(a.max)},getPercent:function(){return(this.setting.value/this.setting.max*100).toFixed(2)},_setValue:function(t){this.setting.value=t;var e=this.getPercent()+"%";this.$element.find(">div").css("width",e),this.$element.find(">span").html(e)},setValue:function(t){var e=this.setting;isNaN(t)||(t<0&&(t=0),t>e.max&&(t=e.max),this._setValue(t))},active:function(){this.$element.addClass("activebar")},unactive:function(){this.$element.removeClass("activebar")},getValue:function(){return this.setting.value},setMax:function(t){!isNaN(t)&&t>0&&(this.setting.max=t,this.setValue(this.setting.value))},getMax:function(){return this.setting.max},destroy:function(){}},t.fn.progressbar=function(e,i){var a=undefined;return this.each(function(){var r=t(this),s=r.data("progressbar"),o="object"==typeof e&&e;s||r.data("progressbar",s=new n(this,o)),"string"==typeof e&&(a=s[e](i))}),a},t.fn.progressbar.Constructor=n,n}),define("app/widgets/app-resizable",["app/core/app-jquery"],function(t){t.fn.resizable=function(e){function i(e){var i=e.data,n=t.data(i.target,"resizable").options;if(-1!=i.dir.indexOf("e")){var a=i.startWidth+e.pageX-i.startX;a=Math.min(Math.max(a,n.minWidth),n.maxWidth),i.width=a}if(-1!=i.dir.indexOf("s")){var r=i.startHeight+e.pageY-i.startY;r=Math.min(Math.max(r,n.minHeight),n.maxHeight),i.height=r}-1!=i.dir.indexOf("w")&&(i.width=i.startWidth-e.pageX+i.startX,i.width>=n.minWidth&&i.width<=n.maxWidth&&(i.left=i.startLeft+e.pageX-i.startX)),-1!=i.dir.indexOf("n")&&(i.height=i.startHeight-e.pageY+i.startY,i.height>=n.minHeight&&i.height<=n.maxHeight&&(i.top=i.startTop+e.pageY-i.startY))}function n(e){var i=e.data,n=i.target;1==t.boxModel?t(n).css({width:i.width-i.deltaWidth,height:i.height-i.deltaHeight,left:i.left,top:i.top}):t(n).css({width:i.width,height:i.height,left:i.left,top:i.top})}function a(e){return t.data(e.data.target,"resizable").options.onStartResize.call(e.data.target,e),!1}function r(e){return i(e),0!=t.data(e.data.target,"resizable").options.onResize.call(e.data.target,e)&&n(e),!1}function s(e){return i(e),n(e),t(document).unbind(".resizable"),t.data(e.data.target,"resizable").options.onStopResize.call(e.data.target,e),!1}return this.each(function(){function i(e){var i="",n=t(d).offset(),a=t(d).outerWidth(),r=t(d).outerHeight(),s=o.edge;e.pageY>n.top&&e.pageY<n.top+s?i+="n":e.pageY<n.top+r&&e.pageY>n.top+r-s&&(i+="s"),e.pageX>n.left&&e.pageX<n.left+s?i+="w":e.pageX<n.left+a&&e.pageX>n.left+a-s&&(i+="e");for(var l=o.handles.split(","),h=0;h<l.length;h++){var c=l[h].replace(/(^\s*)|(\s*$)/g,"");if("all"==c||c==i)return i}return""}function n(e){var i=parseInt(t(d).css(e));return isNaN(i)?0:i}var o=null,l=t.data(this,"resizable");if(l?(t(this).unbind(".resizable"),o=t.extend(l.options,e||{})):o=t.extend({},t.fn.resizable.defaults,e||{}),1!=o.disabled){t.data(this,"resizable",{options:o});var d=this;t(this).bind("mousemove.resizable",function(e){var n=i(e);""==n?t(d).css("cursor","default"):t(d).css("cursor",n+"-resize")}).bind("mousedown.resizable",function(e){var o=i(e);if(""!=o){var l={target:this,dir:o,startLeft:n("left"),startTop:n("top"),left:n("left"),top:n("top"),startX:e.pageX,startY:e.pageY,startWidth:t(d).outerWidth(),startHeight:t(d).outerHeight(),width:t(d).outerWidth(),height:t(d).outerHeight(),deltaWidth:t(d).outerWidth()-t(d).width(),deltaHeight:t(d).outerHeight()-t(d).height()};t(document).bind("mousedown.resizable",l,a),t(document).bind("mousemove.resizable",l,r),t(document).bind("mouseup.resizable",l,s)}})}})},t.fn.resizable.defaults={disabled:!1,handles:"n, e, s, w, ne, se, sw, nw, all",minWidth:10,minHeight:10,maxWidth:1e4,maxHeight:1e4,edge:5,onStartResize:function(t){},onResize:function(t){},onStopResize:function(t){}}}),define("app/widgets/app-scroll",["app/core/app-jquery","app/core/app-core"],function(t,e){function i(i){var n=t(i),a=n.attr("target"),r=e(a);this.$element=n,0==r.length&&(r=e()),r.is(document)&&(r=t(window)),this.options=t.extend({},t.fn.scrollspy.defaults,e.options.scrollspy);var s=t.proxy(this.process,this);this.$scrollElement=r.on("scroll.scroll-spy.data-api",s),this.selector="ul>li> a",this.$body=t("body"),this.refresh(),this.process()}i.prototype={constructor:i,refresh:function(){var e=this;this.offsets=t([]),this.targets=t([]),$targets=this.$element.find(this.selector).map(function(){var i=t(this),n=i.data("target")||i.attr("href"),a=/^#\w/.test(n)&&t(n);return a&&a.length&&[[a.position().top+(!t.isWindow(e.$scrollElement.get(0))&&e.$scrollElement.scrollTop()-e.$scrollElement.position().top),n]]||null}).sort(function(t,e){return t[0]-e[0]}).each(function(){e.offsets.push(this[0]),e.targets.push(this[1])})},process:function(){var t,e=this.$scrollElement.scrollTop()+this.options.offset,i=(this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight)-this.$scrollElement.height(),n=this.offsets,a=this.targets,r=this.activeTarget;if(e>=i)return r!=(t=a.last()[0])&&this.activate(t);if(e<=this.offsets[0])return r!=(t=a.first()[0])&&this.activate(t);for(t=n.length;t--;)r!=a[t]&&e>=n[t]-50&&(!n[t+1]||e<=n[t+1]-50)&&this.activate(a[t])},activate:function(t){this.activeTarget=t;var e=this.$element.find(this.selector);e.parent(".active").removeClass("active");var i=e.filter('[data-target="'+t+'"],[href="'+t+'"]');i.parent("li").addClass("active"),i.trigger("activate")}},t.fn.scrollspy=function(e){return this.each(function(){var n=t(this),a=n.data("scrollspy"),r="object"==typeof e&&e;a||n.data("scrollspy",a=new i(this,r)),"string"==typeof e&&a[e]()})},t.fn.scrollspy.Constructor=i,t.fn.scrollspy.defaults={offset:30}}),define("app/widgets/app-scrolltable",[],function(){function t(t,e){this.$div=t,this.data=[],this.loading=!1,this.running=!1,this.status=0,e||(e={}),this.setting=$.extend({scrollHeight:170,timer:3e3,startRowIndex:0,columns:[]},e),this.pageIndex=0,this.threadId=(new Date).getTime(),this._init()}return t.prototype._init=function(){this.$div.data("scrollTable",this),this.$div.data("scrollTable_threadId",this.threadId),this.$div.find(".scrollTable_body").height(this.setting.scrollHeight),this.$div.find(".scrollTable_body").hover(function(){$(this).addClass("pause")},function(){$(this).removeClass("pause")}),this.$div.find(".scrollTable_header table tbody").append(this._createTitle())},t.prototype.stop=function(){this.running=!1},t.prototype.start=function(){this.running=!0;var t=this;!function(){if(0!=$(".scrollTable").filter(function(){return $(this).data("scrollTable_threadId")==t.threadId}).length){var e=t.$div,i=t.setting,n=t.running,a=t.$div.find(".scrollTable_body").hasClass("pause");if(n){if(t.loading&&(t.reset(),t.loading=!1),!a){var r=function(t,e){var i=t%e,n=(t-i)/e;return i>0&&n++,n}(e.find(".scrollTable_scrollContent table tr").length,i.scrollRowCount);if(t.pageIndex>=r)t.pageIndex=0,e.find(".scrollTable_scrollContent").css("top","0px");else if(r>0){var s=e.find(".scrollTable_scrollContent table tr:eq("+t.pageIndex*i.scrollRowCount+")").position().top;e.find(".scrollTable_scrollContent").animate({top:"-"+s+"px"},500)}t.pageIndex++}setTimeout(arguments.callee,i.timer)}}}()},t.prototype.loadData=function(t){this.data=t,this.loading=!0},t.prototype.reset=function(){this.pageIndex=0;var t=this.$div.find(".scrollTable_scrollContent table tbody");t.empty();for(var e=0,i=this.data.length;e<i;e++)t.append(this._createRow(this.data[e]));this.$div.find(".scrollTable_scrollContent").css("top","0px")},t.prototype._createRow=function(t){for(var e=$("<tr></tr>"),i=0;i<this.setting.columns.length;i++){var n=$("<td><div></div></td>");if(n.css("width",this.setting.columns[i].width),t[this.setting.columns[i].name]){var a=this.setting.columns[i].format;a||(a=function(t,e){return t});var r=a(t[this.setting.columns[i].name],t);r!==undefined&&null!==r||(r=""),this.setting.columns[i].style&&n.find(">div").attr("style",this.setting.columns[i].style),n.find("div").text(r)}e.append(n)}return e},t.prototype._createTitle=function(){for(var t=$("<tr></tr>"),e=0;e<this.setting.columns.length;e++){var i=$("<th></th>");i.text(this.setting.columns[e].title),i.css("width",this.setting.columns[e].width),t.append(i)}return t},$.fn.ScrollTable=function(e,i){var n=undefined;return this.each(function(){var a=$(this),r=a.data("scrollTable");r||(r=new t(a,"object"==typeof e&&e)),"string"==typeof e&&(n=r[e](i))}),n},t}),define("app/widgets/form/app-checkbox",["app/core/app-base","app/core/app-jquery","app/core/app-core","app/core/app-options","app/data/app-ajax"],function(t,e,i,n,a){"use strict";var r=t.extend({initialize:function(t,a){this.$input=e(t),a||(a={}),this.options=a,this.setting=e.extend({},n.appDefaults.Checkbox,i.getAttrFromElement(this.$input),this.options),this._init()},_init:function(){this._initOptions(),this._wrapDiv(),this._initData(),this._registEvent(),e.isFunction(this.setting.onClick)&&this.on("onClick",this.setting.onClick),this.setting.disabled&&this.disable()},_initOptions:function(){this.setting.id==undefined&&(this.setting.id=i.uuid()),this.setting.name==undefined&&(this.setting.name=i.uuid())},_initData:function(){this.setting.data?this._render$Node(this.setting.data):this.reload()},_registEvent:function(){var t=this;this.$element.on("click.checkbox.api","input[type=checkbox]",function(i){var n=parseInt(t.setting.checkedLen);if(1==n)t.$element.find("input[type=checkbox]").prop("checked",!1),e(this).prop("checked",!0);else if(n>1){if(this.checked&&e.isNumeric(t.setting.checkedLen)){var a=t.getValue();if(a&&a.split(",").length>t.setting.checkedLen)return void e(this).prop("checked",!1)}}t.trigger("onClick",i)})},getValue:function(){var t=[];return this.$element.find("input:checked").each(function(){t.push(this.value)}),t.join(",")},setValue:function(t){e.isArray(t)||(t="string"==typeof t?t.split(","):""+t),this.clearValue();for(var i=0;i<t.length;i++)this.$element.find('input[value="'+t[i]+'"]').prop("checked",!0)},setText:function(){},focus:function(){},getText:function(){if(e.isFunction(this.setting.textFormatter)){var t=this.getValue();return this.setting.textFormatter(t)}var i=[];return this.$element.find("input:checked").each(function(){i.push(e(this).attr("title"))}),i.join(",")},reload:function(t){if(e.isArray(t))this.loadData(t);else{if(t)this.setting.url=t;else if(!this.setting.url)return;var i=this;a.ajaxCall({url:this.setting.url,dataType:"json",type:"POST",success:function(t){i.setting.data=t,i.$element.find(".checkboxDiv").remove(),i._render$Node(t)}})}},loadData:function(t){this.$element.find(".checkboxDiv").remove(),this._render$Node(t)},disable:function(){this.$disabledMask==undefined?(this.$disabledMask=e('<div class="wrapper-disabled-mask"></div>'),this.$element.append(this.$disabledMask)):this.$disabledMask.show(),this.$element.addClass("wrapper-disabled")},enable:function(){this.$disabledMask&&this.$disabledMask.hide(),this.$element.removeClass("wrapper-disabled")},toggleEnable:function(){this.$disabledMask&&this.$disabledMask.is(":visible")?this.enable():this.disable()},clearValue:function(){this.$element.find("input:checked").prop("checked",!1)},_wrapDiv:function(){this.$input.css("display","none"),this.$input.wrap('<div class="multipleboxDiv '+this.setting.orient+'" style="'+this.setting.style+'"></div>'),this.$element=this.$input.parent()},_render$Node:function(t){for(var i="",n=this.setting.id,a=(this.setting.name,this.setting.valuefield),r=this.setting.textfield,s=0;s<t.length;s++){var o=t[s];i+='<div class="checkboxDiv"><input type="checkbox"id="'+n+s+'"name="'+n+'"value="'+o[a]+'"title="'+o[r]+'"'+(o.checked?'checked="true"':"")+'/><label for="'+n+s+'">'+o[r]+"</label></div>"}this.$element.append(e(i))}});return e.fn.checkbox=function(t,n){var a=undefined,s=arguments,o="checkbox";return this.each(function(){var n=e(this);if(!n.is("input"))return!0;var l=i.getComponent(n,o);if("string"==typeof t)try{var d=Array.prototype.slice.call(s,1);a=i.componentMethodApply(l,t,d)}catch(h){i.throwCompMethodError(n,o,t,h)}else l?i.throwCompInitError(n,o):(l=new r(this,t),n.data(o,l))}),a},e.fn.checkbox.Constructor=r,r}),define("app/widgets/form/app-comp",["app/core/app-jquery","app/core/app-core","app/widgets/form/app-combobox"],function(t,e){function i(e){t(this).val(e)}function n(){return t(this).val()}function a(e){var i=t(this);"radio"==i.attr("type")?i.each(function(){var i=t(this);if(i.val()==e)return i.attr("checked","true"),!1}):(e=","+e+",",i.each(function(){var i=t(this),n=i.val();e.indexOf(","+n+",")>-1?i.attr("checked","true"):i.removeAttr("checked")}))}function r(){var e=new Array;return t(this).filter(":checked").each(function(){e.push(t(this).val())}),0==e.length?null:e.join(",")}function s(e,i){t(this)[i]("setValue",e)}function o(e){return t(this)[e]("getValue")}function l(e,i){t(this)[i]("setText",e)}function d(e){return t(this)[e]("getText")}function h(e,i){t(this)[i]("setParameter",e)}function c(){t(this).val("")}function u(e,i){t(this)[i]("clearValue")}function p(e){var i=null;return e.filter(function(){var e=t(this),n=e.attr("type");return e.parent().hasClass("app-number")?!i:e.parent().hasClass("app-money")?!i:e.parent().hasClass("app-datetime")?!i:e.parent().hasClass("app-textbox")?!i:e.parent().hasClass("app-combobox")?!i:e.parent().hasClass("app-reference")?!i:e.parent().hasClass("app-comboztree")?!i:e.parent().hasClass("app-combogrid")?!i:e.parent().hasClass("app-suggest")?(returnType="suggest",!i):e.parent().hasClass("app-typeahead")?!i:"textfield"==n||"textarea"==n||"hidden"==n?!i:e.is("textarea")?!i:("radio"==n||"checkbox"==n)&&(null==i&&(i=n),i==n)})}function f(e,i,n){var a=p(e);if(0!=a.length){var r=t(a[0]).getCompType();if(null!=r){var s=i[r];null!=s&&s.call(a,n,r)}}}function g(e,i){var n=p(e);if(0!=n.length){var a=t(n[0]).getCompType();if(null!=a){var r=i[a];if(null!=r)return r.call(n,a)}}}var m={hidden:n,textfield:n,textbox:o,textarea:n,datetime:o,money:o,number:o,combobox:o,comboztree:o,combogrid:o,reference:o,suggest:o,typeahead:n,radio:r,checkbox:r},v={hidden:i,textfield:i,textarea:i,textbox:s,datetime:s,money:s,number:s,combobox:s,comboztree:s,combogrid:s,reference:s,suggest:s,typeahead:i,radio:a,checkbox:a},b={hidden:n,textfield:n,textarea:n,textbox:n,money:d,number:d,datetime:d,combobox:d,comboztree:d,combogrid:d,reference:d,suggest:d,typeahead:d},y={datetime:l,combobox:l,comboztree:l,combogrid:l,reference:l,suggest:l,typeahead:i},w={textbox:h,combobox:h,comboztree:h,combogrid:h,reference:h,suggest:h},_={hidden:c,textfield:c,textbox:u,textarea:c,money:u,number:u,datetime:u,combobox:u,comboztree:u,combogrid:u,reference:u,suggest:u,typeahead:c};return t.extend(t.fn,{getCompType:function(){var e=null;return t(this).each(function(){var i=t(this),n=i.attr("type");return i.parent().hasClass("app-datetime")?(e="datetime",!1):i.parent().hasClass("app-number")?(e="number",!1):i.parent().hasClass("app-money")?(e="money",!1):i.parent().hasClass("app-textbox")?(e="textbox",!1):i.parent().hasClass("app-combobox")?(e="combobox",!1):i.parent().hasClass("app-reference")?(e="reference",!1):i.parent().hasClass("app-comboztree")?(e="comboztree",!1):i.parent().hasClass("app-combogrid")?(e="combogrid",!1):i.parent().hasClass("app-suggest")?(e="suggest",!1):i.parent().hasClass("app-typeahead")?(e="typeahead",!1):"textfield"==n||"textarea"==n||"hidden"==n||"radio"==n||"checkbox"==n?(e=n,!1):i.is("textarea")?(e="textarea",!1):void 0}),e},isTriggerChange:function(){t(this).attr("type")},getCompText:function(){return g(this,b)},setCompText:function(t){f(this,y,t)},getCompValue:function(){return g(this,m)},setCompValue:function(t){f(this,v,t)},getCompData:function(){var e=p(t(this));if(0!=e.length){var i=t(e[0]).getCompType();if(null!=i){var n=m[i];if(null!=n){var a=n.call(e,i);if(null==(n=b[i]))return{value:a};return{value:a,showValue:n.call(e,i)}}}}},setCompData:function(e,i){var n=p(t(this));if(0!=n.length){var a=t(n[0]).getCompType();if(null!=a){var r=v[a];if(null!=r&&(null!=e&&"object"==typeof e&&e.value&&(i=e.showValue,e=e.value),null!=e&&(e=e.toString()),r.call(n,e,a),null!=i||null==e&&null==i)){var s=y[a];null!=s&&s.call(n,i,a)}}}},setCompParameter:function(t){f(this,w,t)},clearCompValue:function(){f(this,_)}}),t}),define("app/widgets/form/app-validate",["jquery",localeFile,"jquery/jquery.validate","jquery/jquery.metadata"],function(t,e){return t.validator.addMethod("alphanumeric",function(t,e){return this.optional(e)||/^\w+$/i.test(t)},"Letters, numbers or underscores only please"),t.validator.addMethod("lettersonly",function(t,e){return this.optional(e)||/^[a-z]+$/i.test(t)},"Letters only please"),t.validator.addMethod("phone",function(t,e){return t=t.replace(/\s+/g,""),this.optional(e)||t.match(/^[0-9 \(\)]{7,30}$/)},"Please specify a valid phone number"),t.validator.addMethod("postcode",function(t,e){return t=t.replace(/\s+/g,""),this.optional(e)||t.match(/^[0-9 A-Za-z]{5,20}$/)},"Please specify a valid postcode"),t.validator.addMethod("date",function(t,e){return t=t.replace(/\s+/g,""),this.optional(e)||t.match(/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/)}),t.validator.addMethod("equalTo",function(e,i,n){var a=t(n);return this.settings.onfocusout&&a.unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){t(i).valid()}),t(i).parent().hasClass("app-wrapper")&&a.unbind(".validate-equalTo").bind("change.validate-equalTo",function(){t(i).valid()}),e===a.val()}),t.validator.addMethod("laterThan",function(e,i,n){var a=t(n);return this.settings.onfocusout&&a.unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){t(i).valid()}),t(i).parent().hasClass("app-wrapper")&&a.unbind(".validate-equalTo").bind("change.validate-equalTo",function(){t(i).valid()}),e>=a.val()}),t.validator.addMethod("remote",function(e,i,n){if(this.optional(i))return"dependency-mismatch";var a=this.previousValue(i);if(this.settings.messages[i.name]||(this.settings.messages[i.name]={}),a.originalMessage=this.settings.messages[i.name].remote,this.settings.messages[i.name].remote=a.message,n="string"==typeof n&&{url:n}||n,this.pending[i.name])return"pending";if(a.old===e)return a.valid;a.old=e;var r=this;this.startRequest(i);var s={};return s[i.name]=e,function(e,i,n){if(n.withHidden)for(var a=t(i.currentForm).find("input:hidden"),r=0;r<a.length;r++){var s=t(a[r]);e[s.attr("name")]=s.val()}var o=t.extend({},n);delete o.url,t.extend(e,o)}(s,this,n),t.ajax(t.extend(!0,{url:n,mode:"abort",port:"validate"+i.name,dataType:"json",data:s,success:function(n){r.settings.messages[i.name].remote=a.originalMessage;var s=!0===n||"true"===n;if(s){var o=r.formSubmitted;r.prepareElement(i),r.formSubmitted=o,r.successList.push(i),delete r.invalid[i.name],r.showErrors()}else{var l={},d=n||r.defaultMessage(i,"remote");l[i.name]=a.message=t.isFunction(d)?d(e):d,r.invalid[i.name]=!0,r.showErrors(l)}a.valid=s,r.stopRequest(i,s)}},n)),"pending"}),t.validator.addClassRules({date:{date:!1},alphanumeric:{alphanumeric:!0},lettersonly:{lettersonly:!0},phone:{phone:!0},postcode:{postcode:!0}}),t.validator.setDefaults({highlight:function(e,i,n){t(e).parents(".form-group:first").addClass(i).removeClass(n)},unhighlight:function(e,i,n){$grp=t(e).parents(".form-group:first"),$grp.removeClass(i).removeClass(n),this.showHelps(e)},success:function(e,i){$grp=t(i).parents(".form-group:first"),$grp.removeClass("error"),$grp.addClass("success"),this.hideHelps(i),e.html("<i class='icon icon-green icon-check'></i>")},onchange:function(t,e){this.element(t)},invalidHandler:function(e,i){for(var n=i.errorList,a=0;a<n.length;a++){var r=t(n[a].element),s=r.parent();s.is(".app-wrapper")?s.addClass("errorTarger"):r.addClass("errorTarger")}},errorClass:"error",validClass:"success",errorElement:"span",focusInvalid:!1,focusCleanup:!0,ignore:".ignore",onkeyup:t.emptyFunction}),t.validator.autoCreateRanges=!0,t.extend(t.validator.prototype,{init:function(){function e(e){var i=t.data(this[0].form,"validator"),n="on"+e.type.replace(/^validate/,"");i.settings[n]&&i.settings[n].call(i,this[0],e)}this.labelContainer=t(this.settings.errorLabelContainer),this.errorContext=this.labelContainer.length&&this.labelContainer||t(this.currentForm),this.containers=t(this.settings.errorContainer).add(this.settings.errorLabelContainer),this.submitted={},this.valueCache={},this.pendingRequest=0,this.pending={},this.invalid={},this.reset();var i=this.groups={};t.each(this.settings.groups,function(e,n){t.each(n.split(/\s/),function(t,n){i[n]=e})});var n=this.settings.rules;t.each(n,function(e,i){n[e]=t.validator.normalizeRule(i)}),t(this.currentForm).validateDelegate(":text, [type='text'], [type='password'], [type='showValue'], [type='file'], [type='number'], [type='tel'], [type='url'], [type='email'], select, textarea ","focusin focusout keyup",e).validateDelegate("[type='radio'], [type='checkbox'], select, option","click",e),function(t){t.validateDelegate(".app-wrapper input:first-child","change",e)}(t(this.currentForm)),this.settings.invalidHandler&&t(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler)},elementValue:function(e){var i=t(e),n=i.attr("type"),a=i.val();if("radio"===n||"checkbox"===n)return t('input[name="'+i.attr("name")+'"]:checked').val();var r=i.parent();return r.hasClass("app-wrapper")&&r.find("input:first-child").data("context").setting.multiple?a.split(","):"string"==typeof a?a.replace(/\r/g,""):a},showHelps:function(e){t(e).parents(".form-group:first").find(".help-inline:not([for]),.help-block:not([for])").show()},hideHelps:function(e){t(e).parents(".form-group:first").find(".help-inline:not([for]),.help-block:not([for])").hide()},showLabel:function(e,i){var n=this.errorsFor(e);if(n.length)n.attr("generated")&&n.html(i);else{var a="block"==t(e).parents(".form-group:first").attr("helpType")?"help-block":"help-inline";n=t("<"+this.settings.errorElement+"/>").attr({"for":this.idOrName(e),generated:!0}).addClass(a).html(i||""),this.labelContainer.append(n).length||(this.settings.errorPlacement?this.settings.errorPlacement(n,t(e)):function(e,i){var n=i,a=i.parent();a.hasClass("app-wrapper")?n=a:a.parent().hasClass("multipleboxDiv")&&(n=a.parent());var r=n.data("errorWrapper");if(r)r.find("div>span").text(e.text());else{var s=t('<div class="errorWrapper"><div><div></div></div></div>');s.css("width",n.outerWidth()),s.appendTo(t.$appPanelContainer),n.data("errorWrapper",s),e.insertBefore(s.find("div div")),function(e){e.hover(function(){var e=t(this),i=e.data("errorWrapper");if(i.text()){e.addClass("errorTarger");var n=e.offset(),a=e.offset().top;n.display="block",a<i.outerHeight()?(n.top=n.top+e.outerHeight(),i.addClass("up")):(n.top=n.top-i.outerHeight(),i.removeClass("up")),i.css(n)}},function(){var e=t(this);e.removeClass("errorTarger"),e.data("errorWrapper").css({display:"none"})})}(n)}}(n,t(e)))}!i&&this.settings.success&&(n.text(""),"string"==typeof this.settings.success?n.addClass(this.settings.success):this.settings.success.call(this,n,e)),this.toShow=this.toShow.add(n),this.hideHelps(e)},hideErrors:function(){this.showHelps(this.toHide),this.addWrapper(this.toHide).hide()},elements:function(){var e=this,i={};return t(this.currentForm).find("input[type!=showValue], select, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){return!this.name&&e.settings.debug&&window.console&&console.error("%o has no name assigned",this),!(this.name in i||!e.objectLength(t(this).rules()))&&(i[this.name]=!0,!0)})},errors:function(){return t(".errorWrapper",this.errorContext)},validElements:function(){return this.currentElements.not(this.invalidElements()).not(this.successList)},form:function(){if(t(this.currentForm).find(".errorTarger").removeClass("errorTarger"),t(this.currentForm).find(".errorWrapper").remove(),this.checkForm(),t.extend(this.submitted,this.errorMap),this.invalid=t.extend({},this.errorMap),this.valid()||t(this.currentForm).triggerHandler("invalid-form",[this]),this.showErrors(),this.errorList&&this.errorList.length>0){var e=this.errorList[0];t(e.element).parent().find("input:visible,textarea:visible,select:visible").focus()}return this.valid()}}),t}),define("app/widgets/form/app-form",["app/core/app-jquery","app/data/app-ajax","app/widgets/form/app-validate","app/widgets/form/app-comp"],function($,$ajax){$.fn.extend({initForm:function(){return $(this).each(function(){var t=$(this),e=t.isTag("form")?t:$(t.attr("app-form")),i=e.attr("opstate")||"EDIT",n=e.find(".formitem");e.bind($A.eventType.pageLoad,function(){i=e.attr("opstate")||"EDIT",e.attr("opstate",""),e.switchFormState(i)});var a=!1;n.each(function(){var t=$(this),e=(t.find("div.render"),t.attr("editor"));if(0==t.find(".editor").length&&e){$e=$('<div class="editor">'+e+"</div>");$e.getFormEditor().getCompType();$e.appendTo(t),a=!0}}),a&&e.initPageUI(),e.attr("initedit","true")})},loadFormData:function(t,e){$(this).each(function(){var i=$(this),n=i.isTag("form")?i:$(i.attr("app-form")),a=t&&t.loadurl?t.loadurl:i.attr("loadUrl");if(a){var r=n.attr("loadParams");r=r?$.extend(r,t):t;var s=n.attr("transor");s&&(r.__transor=s),n.attr("loadParams",r),op={type:n.attr("method")||"POST",url:a,data:r,dataType:"json",cache:!1,toggle:n,success:function(t){n.refreshFormData(t),e&&e(t)},error:$ajax.ajaxError},$ajax.ajaxCall(op)}})},clearFormEditorValue:function(){var t=$(this),e=t.parent().attr("item-field");t.find("input[id="+e+"],textarea[id="+e+"]").clearCompValue()},setFormEditorValue:function(t,e){var i=$(this),n=i.parent().attr("item-field");i.find("input[id="+n+"],textarea[id="+n+"]").setCompData(t,e)},addFieldRequired:function(t){var e=$A("#label_"+t);e.find("span.required").length>0?e.find("span.required").text("*"):e.prepend('<span class="required">*</span>'),$A("#"+t).attr("required",!0)},hideField:function(t){$A("."+t).hide()},removeFieldRequired:function(t){$A("#label_"+t).find("span.required").remove(),$A("#"+t).attr("required",!1)},getFormEditorValue:function(){var t=$(this),e=t.parent().attr("item-field");return t.find("input[id="+e+"],textarea[id="+e+"]").getCompData()},getFormEditor:function(){var t=$(this),e=t.parent().attr("item-field");return t.find("input[id="+e+"],textarea[id="+e+"]")},setFormRenderValue:function(t,e){var i=$(this),n=i.find("div.render");if(0!=n.length){var a=i.attr("rendertype"),r=i.attr("render"),s=i.getFormEditor(),o=s.getCompType();if("radio"!=o&&"checkbox"!=o)if("TEMPLATE"==a)n.html($template(r,{value:t,showValue:e}));else if("FUNC"==a){var l=n.data("render");l?r=l:(r=i.getJsFunction("return "+r)(),n.data("render",r));var d=r(t,e,n);!1!==d&&(n.html(d),n.attr("title",d))}else null==e&&(e=t),n.html(e),n.attr("title",e);else t==s.val()?s[0].checked=!0:s[0].checked=!1}},setFormItemValue:function(t,e,i){var n=$(this),a=n.find("div.editor");if(n.attr("fieldvalue",t),e&&n.attr("fieldshowvalue",e),a.size()>0&&(t!==undefined&&null!==t||(t=""),a.setFormEditorValue(t,e),!e)){var r=a.getFormEditorValue();r&&(e=r.showValue)}n.setFormRenderValue(t,e)},clearFormItemValue:function(){var t=$(this),e=t.find("div.editor");t.attr("fieldvalue",""),t.attr("fieldshowvalue",""),e.size()>0&&e.clearFormEditorValue(),t.setFormRenderValue("","")},clearFormData:function(){return this.each(function(){var t=$(this),e=t.isTag("form")?t:$(t.attr("app-form")),i=e.find(".formitem");e.find("[hiddencomp=true]").each(function(){$(this).val("")}),i.each(function(){$(this).clearFormItemValue()}),"true"!=e.attr("init")&&e.attr("refresh","true")})},refreshFormData:function(t){return this.each(function(){var e=$(this),i=e.isTag("form")?e:$(e.attr("app-form")),n=i.find(".formitem"),a=i.attr("model"),r=i.find("[hiddencomp=true]"),s=t;a&&(a.indexOf(".")>1?$.each(a.split("."),function(t){if(null==(s=s[this]))return!1}):s=s[a],null==s&&(s=t)),r.each(function(){var t=$(this),e=t.attr("model"),i=t.attr("field"),n=s;e!=a&&(e.indexOf(".")>1?$.each(e.split("."),function(t){if(null==(n=n[this]))return!1}):n=n[e],null==n&&(n=s));var r=n[i];t.val(r)}),n.each(function(){var t=$(this),e=t.attr("item-model"),i=t.attr("item-field"),n=t.attr("item-showfield"),r=s;e!=a&&(e.indexOf(".")>1?$.each(e.split("."),function(t){if(null==(r=r[this]))return!1}):r=r[e],null==r&&(r=s));var o=r[i],l=null;n&&(l=r[n]),t.setFormItemValue(o,l,s)}),"true"!=i.attr("init")&&i.attr("refresh","true")})},toggleFormState:function(){var t=$(this),e=t.isTag("form")?t:$(t.attr("app-form"));"VIEW"==(e.attr("opstate")||"EDIT")?e.switchFormState("EDIT"):e.switchFormState("VIEW")},toggleFormState2:function(t){"VIEW"==t?$form.switchFormState("VIEW"):$form.switchFormState("EDIT")},switchFormState:function(t){this.each(function(){var e=$(this),i=e.isTag("form")?e:$(e.attr("app-form")),n=i.find(".formitem"),a=i.attr("opstate")||"EDIT";t==a||"EDIT"!=t&&"VIEW"!=t||(i.attr("opstate",t),i.addClass("formview"),n.each(function(e,n){var a=$(n).attr("customwidth"),r=$(this),s=r.find("div.render"),o=r.find("div.editor"),l=(y=o.getFormEditor()).getCompType();if("VIEW"==t){if(o.size()>0){var d=o.getFormEditorValue();d&&("string"==typeof d?r.attr("fieldvalue",d):"object"==typeof d&&(r.attr("fieldvalue",d.value),r.attr("fieldshowvalue",d.showValue))),o.hide()}0==s.size()?(s=$(a!=undefined?'<div class="render '+l+'-render" style="width:'+a+';"></div>':'<div class="render '+l+'-render"  ></div>')).appendTo(r):s.show();var h=r.attr("fieldvalue"),c=r.attr("fieldshowvalue"),u=r.attr("rendertype"),p=r.attr("render");if("radio"==l||"checkbox"==l)return o.show(),y.attr("disabled",!0),s.html(""),void s.attr("title","");if("TEMPLATE"==u)s.html($template(p,{value:h,showValue:c}));else if("FUNC"==u)(p=r.getJsFunction("return "+p)())&&s.html(p(h,c,s));else{c||(c=h);s.attr("title",c),s.html(function(t){return t?String(t).replace(/&/g,"&amp;").replace(/\"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):t}(c))}i.find("div.formmore").show()}else if("EDIT"==t){if(s.size()>0&&s.hide(),o.size()>0){o.show();if("radio"==(l=(y=o.getFormEditor()).getCompType())||"checkbox"==l)return y.attr("disabled",!1),void s.html("")}else{h=r.attr("fieldvalue"),c=r.attr("fieldshowvalue");var f=r.attr("item-field"),g=r.attr("item-showfield"),m=r.attr("editor");m&&(o=$('<div class="editor">'+m+"</div>")).appendTo(r);var v=o.find("[field="+f+"]");if(v.isTag("input")||v.isTag("select")?v.val(h):v.html(h),g){var b=o.find("[field="+g+"]");b.length>0&&(b.isTag("input")||b.isTag("select")?b.val(c):v.html(b))}var y;if("radio"==(l=(y=o.getFormEditor()).getCompType())||"checkbox"==l)return y.attr("disabled",!1),void s.html("")}i.find("div.formmore").hide(),i.openFormDetail(null,"all")}}),"EDIT"==t&&"true"!=i.attr("initedit")&&(i.initPageUI(),i.attr("initedit","true")))})},openFormDetail:function(target,sstate){var $e=$(this),$form=target?$(target):$e.isTag("form")?$e:$e.attr("app-form")?$($e.attr("app-form")):$e.parents("form:first"),exSum="true"==$form.attr("summary"),durl=$form.attr("detailurl"),dparam=$form.attr("detailparameter"),sumCount=1*$form.attr("sumcount"),sumstate=$form.attr("sumstate")||"simple";if(sstate!=sumstate)if(exSum&&sumCount>0){var $trs=$form.find("table>tbody>tr:gt("+(sumCount-1)+")");"simple"==sumstate?($trs.show(),$form.attr("sumstate","all"),$form.find("div.formmore>a").html("收起")):($trs.hide(),$form.attr("sumstate","simple"),$form.find("div.formmore>a").html("更多信息"))}else if(durl){dparam||(dparam="id:${id}");var params={};$form.find("[field]").each(function(){var t=$(this),e=t.attr("field"),i=t.val()||t.attr("fieldvalue")||t.html();param[e]=i});var pa=$template(dparam,param);params=eval("{"+pa+"}");var options={href:_contextPath+durl,param:params,isWrapper:!0,isReload:!0};require(["app/widgets/window/app-dialog"],function(){$.openModalDialog(options)})}},isForm:function(){return $form=$(this).getForm(),$form.length>0},getForm:function(){var t=$(this);return t.isTag("form")?t:$(t.attr("app-form"))},getSumbitData:function(t){t||(t={});var e={},i=t.url,n=null,a=!0,r={},s=!1;return $(this).each(function(){var o=$(this);if(o.isForm()){var l=o.getForm();if(n||(n=l),"false"!=l.attr("validate")&&!l.valid())return void(a=!1);if(i||(i=l.attr("action")),1==t.model){var d=l.find("input[model][field],select[model][field]");if(0==d.length)return;var h={};d.each(function(){var t=$(this);h[t.attr("field")]=$.fn.unescapeHtml(t.val())}),$.extend(e,h)}else $.each(l.serializeArray(),function(t,i){e[i.name]=$.fn.unescapeHtml(i.value)});(f=l.attr("transor"))&&(f=$A.jsonEval(f),r[l.attr("id")]=f,s=!0)}else if(o.data("grid")){if(o.data("grid").endEdit(),0==o.grid("isValid"))return void(a=!1);h=o.grid("getAllData");var c=o.attr("id");h=JSON.stringify(h);var u=t.params?t.params[c]||c:c;e[u]=h;var p=o.grid("getFixedParameter");if(p&&p.__transor){(f=p.__transor)&&(r[o.attr("id")]=f,s=!0)}}else if(o.isGrid()){c=(o=$A(o)).bsgrid("getGridId"),u=t.params?t.params[c]||c:c;if("all"==t.submitMode){if(!o.bsgrid("setEditEnabled",!1))return void(a=!1);h=o.bsgrid("getRowData"),o.bsgrid("setEditEnabled",!0)}else if(null==(h=o.bsgrid("getSubmitData")))return void(a=!1);e[u]=JSON.stringify(h);var f;(f=o.attr("transor"))&&(f=$A.jsonEval(f),r[o.attr("id")]=f,s=!0)}}),a?(s&&(e.__transor=JSON.stringify(r)),{url:i,toggle:n,data:e}):a},sumbitData:function(t,e){var i=$.extend({type:"POST",dataType:"json",cache:!1},t,e);$ajax.ajaxCall(i)},sumbitAllComp:function(t){var e=this.getSumbitData(t);e&&this.sumbitData(t,e)},serializeFieldArray:function(){return this.map(function(){var t=$.prop(this,"elements");return t?jQuery.makeArray(t):this}).filter(function(){var t=this.type;return this.field&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(t)&&(this.checked||!manipulation_rcheckableType.test(t))}).map(function(t,e){var i=jQuery(this).val();return null==i?null:jQuery.isArray(i)?jQuery.map(i,function(t){return{name:e.field,value:t.replace(rCRLF,"\r\n")}}):{name:e.field,value:i.replace(rCRLF,"\r\n")}}).get()},submitForm:function(t){return t=t||{},this.each(function(){var e=$(this),i=e.isTag("form")?e:$(e.attr("app-form"));if("false"==i.attr("validate")||i.valid()){var n=t.url||i.attr("action");if(!n)return!1;n=n.evalTemplate(e);var a=null,r=null,s=$('<div style="display:hidden;"></div>');if(t.attachData)for(var o in t.attachData){var l=t.attachData[o];if($.isArray(l))for(var d=0;d<l.length;d++){$('<input type="hidden" name="'+o+'" />').appendTo(s).val(l[d])}else{$('<input type="hidden" name="'+o+'" />').appendTo(s).val(t.attachData[o])}}i.append(s),r=1==t.model?i.serializeFieldArray():i.serializeArray(),s.remove(),a=$.extend({type:i.attr("method")||"POST",url:n,data:r,dataType:"json",cache:!1,toggle:i},t),$ajax.ajaxCall(a)}})}}),$("body").on("click.data-api","[app-form]",function(t){t&&t.preventDefault(),$(this).submitForm()})}),define("app/widgets/form/app-formgroup",["app/core/app-jquery","app/data/app-ajax","app/widgets/form/app-form","app/widgets/form/app-validate","app/widgets/form/app-comp","app/widgets/app-jqgrid"],function(t,e){var i=/\r?\n/g,n=/^(?:submit|button|image|reset|file)$/i,a=/^(?:input|select|textarea|keygen)/i,r=/^(?:checkbox|radio)$/i,s={loadGroupFromData:function(i,n,a,r){var s={type:"POST",url:n,data:a,dataType:"json",cache:!1,success:function(e){t.fn.refreshGroupFormData(i,e),r&&r(e)},error:e.ajaxError};e.ajaxCall(s)},sumbitGroupAllComp:function(e){var i=this.getSubmitGroupFormData(e);i&&t.fn.sumbitData(e,{data:i})},submitGroupForm:function(i){if(!(i=i||{}).id)return null;if(!i.url)return!1;var n=null,a=null,r=t('<div style="display:hidden;"></div>');if(i.attachData)for(var s in i.attachData){var o=i.attachData[s];if("array"==typeof o)for(var l=0;l<o.length;l++){t('<input hiddencomp=true forForm="'+i.id+'" type="hidden" name="'+s+'" />').appendTo(r).val(o[l])}else{t('<input type="hidden" hiddencomp=true forForm="'+i.id+'" name="'+s+'" />').appendTo(r).val(i.attachData[s])}}$A.getContainer().append(r);a=this.getSubmitGroupFormData(i);r.remove(),n=t.extend({type:"POST",data:a,dataType:"json",cache:!1},i),e.ajaxCall(n)},findGroupForms:function(e){var i=$A(".formitem[forform='"+e+"']"),n=($A("[forform='"+e+"'][hiddencomp=true]"),{}),a=[];return i.find("input[type!=showValue], select, textarea").each(function(){if(this.form){var e=t(this.form).attr("id");n[e]||(n[e]=this.form,a.push(this.form))}}),a},hideFormItem:function(t,e){var i=$A("."+t);i.hide();var n=i.attr("forpanel");if(e&&n)$A("#"+n).panel("hide");else if($A("."+t).parents("div.form").length>0){0==$A("."+t).parents("div.form").children("form").children("div").children(":visible").length&&$A("."+t).parents("div.form").hide()}},showFormItem:function(t,e){var i=$A("."+t);i.show();var n=i.attr("forpanel");if(e&&n)$A("#"+n).panel("show");else if($A("."+t).parents("div.form").length>0){0==$A("."+t).parents("div.form").children("form").children("div").children(":visible").length&&$A("."+t).parents("div.form").show()}},validGroupForm:function(e){for(var i=!0,n=this.findGroupForms(e),a=0;a<n.length;a++)i=i&&t(n[a]).valid();return i},getSubmitGroupFormData:function(e){var i={},n=null,a=!0,r={},s=!1;if(e.id)for(var o=e.id.split(","),l=0;l<o.length;l++){var d=o[l],h=$A("#"+d);if(h.data("grid")){if(h.data("grid").endEdit(),0==h.grid("isValid"))return void(a=!1);var c=h.grid("getAllData");d=h.attr("id");c=JSON.stringify(c);var u=e.params?e.params[d]||d:d;i[u]=c;var p=h.grid("getFixedParameter");if(p&&p.__transor){(f=p.__transor)&&(r[h.attr("id")]=f,s=!0)}}else if(h.isGrid()){d=h.bsgrid("getGridId"),u=e.params?e.params[d]||d:d;if("all"==e.submitMode){if(!h.bsgrid("setEditEnabled",!1))return void(a=!1);c=h.bsgrid("getRowData"),h.bsgrid("setEditEnabled",!0)}else if(null==(c=h.bsgrid("getSubmitData")))return void(a=!1);i[u]=JSON.stringify(c);var f;(f=h.attr("transor"))&&(f=$A.jsonEval(f),r[h.attr("id")]=f,s=!0)}else{var g=$A(".formitem[forform='"+d+"']");$A("[forform='"+d+"'][hiddencomp=true]");if(!t.fn.validGroupForm(d))return null;n=g.getGroupFormData(d,e.model);t.each(n,function(t,e){i[e.name]=e.value})}}return a?(s&&(i.__transor=JSON.stringify(r)),i):a},findGroupFormItem:function(e){return $A("[forform='"+e+"']").map(function(){if("true"==t.attr(this,"hiddencomp"))return this;var e=[];return $A("input,select, textarea",this).each(function(){e.push(this)}),e})},getGroupFormData:function(e,s){return this.findGroupFormItem(e).filter(function(){var t=this.type,e=!0;return s&&(e=this.field),e&&!jQuery(this).is(":disabled")&&a.test(this.nodeName)&&!n.test(t)&&(this.checked||!r.test(t))}).map(function(e,n){var a=jQuery(this).val();return null==a?null:jQuery.isArray(a)?jQuery.map(a,function(e){return{name:s?n.field:n.name||n.id,value:t.fn.unescapeHtml(e.replace(i,"\r\n"))}}):{name:s?n.field:n.name||n.id,value:t.fn.unescapeHtml(a.replace(i,"\r\n"))}}).get()},refreshGroupFormData:function(e,i){var n=$A(".formitem[forform='"+e+"']"),a=i;$A("[forform='"+e+"'][hiddencomp=true]").each(function(){var e=t(this),i=e.attr("model"),n=e.attr("field"),r=a;void 0!=i&&(i.indexOf(".")>1?t.each(i.split("."),function(t){if(null==(r=r[this]))return!1}):r=r[i],null==r&&(r=a));var s=r[n];e.val(s)}),n.each(function(){var e=t(this),i=e.attr("item-model"),n=e.attr("item-field"),r=e.attr("item-showfield"),s=a;void 0!=i&&(i.indexOf(".")>1?t.each(i.split("."),function(t){if(null==(s=s[this]))return!1}):s=s[i],null==s&&(s=a));var o=s[n],l=null;r&&(l=s[r]),e.setFormItemValue(o,l,a)})}};return t.fn.extend(s),s}),define("app/widgets/form/app-rule",["jquery","app/core/app-core","app/widgets/form/app-comp"],function(t,e){return e.gearRules={rules:{mnemonic:{name:"mnemonic",trigger:"change",handle:function(t,e,i){var n=t.getCompText();if(n){var a=n.toUpperInitials();e.setCompValue(a),e.setCompText(a)}}},gear:{name:"gear",trigger:"change",init:!0,handle:function(e,i,n){var a=n.map||{},r=(n.clear,{});e.each(function(){var e=t(this),i=e.getCompValue(),n=e.getCompText(),s=e.attr("name"),o=e.attr("showName");r[s=a[s]||s]=i,o&&(r[o=a[o]||o]=n)}),i.setCompParameter(r),i.clearCompValue()}}},addRule:function(t,e){"object"==typeof t?e=t:e.name=t,rules[e.name]=e}},t.fn.gearRule=function(i){i=t.extend({},e.gearRules.rules,i),t(this).each(function(){var n=t(this),a=n.attr("gearRules");a&&(a=e.jsonEval(a),t.each(a,function(a,r){if(r){var s=i[a];if(null!=s){var o=s.trigger||"change",l=r,d=s.init;"string"!=typeof r&&(r=l.depend,l.init!==undefined&&(d=l.init));var h=n;r&&0==(h=e(r)).size()||(d&&("function"==typeof d?d(h,n,l):s.handle(h,n,l)),h.on(o,function(){s.handle(t(this),n,l)}))}}}))})},t}),define("app/widgets/form/app-typeahead",["app/core/app-jquery","app/core/app-core","app/core/app-options","app/data/app-ajax","app/widgets/form/app-combo"],function(t,e,i,n,a){"use strict";var r=a.extend({initialize:function(t,e){e||(e={}),e._=i.appDefaults.Typeahead,r.superclass.initialize.call(this,t,e),this._init()},_init:function(){this._editable(),this._initOptions(),this._initPanelContent(),this._registEvents(),this.setting.value&&this.setText(this.setting.value)},_initOptions:function(){var t=this.setting;""!=t.suggest&&1!=t.suggest||!t.url||(t.suggest=t.url),0==t.suggest&&(t.suggest=""),!t.remote&&t.async&&(t.remote=!0)},_initPanelContent:function(){var e=t('<ul class="combo-list"></ul>');e.appendTo(this.$dropPanelMain),this.$list=e},_registEvents:function(){var t=this;this.$openBtn.on("click.typeahead.api",function(e){t.$text.focus()}),this.$text.on("change.typeahead.api",function(){t.setValue(this.value)}),this._liveItemClickEvent()},_liveItemClickEvent:function(){var e=this;this.$list.on("click.typeahead.api","li",function(){var i=t(this);e.setValue(i.text()),e.hidePanel(),e.$text.focus()})},_keyManager:function(t){this._dealSysKey(t)||(this._mainDivIsVisiable()?function(t){t.keyCode;var i=this.setting;t.stopPropagation(),e.containKeyCode(t,i.keyNextNode)?function(t){var e=this.$list;if(0!=e.find(">li").length){var i=e.find(".current"),n=i.next();0==n.length&&(n=e.find("li:first-child")),this.setValue(n.text()),i.removeClass("current"),n.addClass("current")}}.call(this,t):e.containKeyCode(t,i.keyPrevNode)?function(t){var e=this.$list;if(0!=e.find(">li").length){var i=e.find(".current"),n=i.prev();0==n.length&&(n=e.find("li:last-child")),this.setValue(n.text()),i.removeClass("current"),n.addClass("current")}}.call(this,t):e.containKeyCode(t,i.keyPickNode)?function(t){var e=this.$dropPanel.find(".current");0!=e.length&&(this.setValue(e.text()),this.hidePanel(),t.stopPropagation())}.call(this,t):e.containKeyCode(t,i.keyHidePanel)?this._keyHidePanel(t):this._keyFilterSuggest(t)&&this.suggest()}.call(this,t):function(t){var e=t.keyCode;this._isKeyCursorPos(e)?this._keyCursorPos(t):this._keyFilterSuggest(t)&&this.suggest()}.call(this,t))},suggest:function(){var t=this;clearTimeout(t.timeout),t.timeout=setTimeout(function(){t._suggestFunc()},t.setting.lazy)},_suggestFunc:function(){this._mainDivIsVisiable()||this.showPanel(),this._preventSuggest()||(this.setting.remote?this._suggestByRemote():this._suggestByLocal())},_preventSuggest:function(){var e=this.getText();if(!t.trim(e))return!0;if(this.prevKey){if(this.prevKey==e)return!0;if((this.suggestItems==undefined||0==this.suggestItems.length)&&e.length>=this.prevKey.length&&0==e.indexOf(this.prevKey))return!0}else;return this.prevKey=e,!1},_suggestByLocal:function(){if(this._initDataByParameter(),this.setting.data!=undefined)this._setSuggestItemsByNameLazy(),this._renderSuggestItem(),this.showPanel();else{var t=this.setting.suggest,e=this;t&&n.ajaxCall({url:t,data:this.getParameter(),dataType:"json",type:"POST",success:function(t){e.setting.data=t,e._suggestByLocal()}})}},_initDataByParameter:function(){var t=this.getParameter();t&&(this.lastParam!=t&&(this.setting.data=undefined),this.lastParam=t)},_suggestByRemote:function(){var t=this.setting.suggest,e=this;t&&(-1!=t.indexOf("?")?t+="&_key="+this.getText():t+="?_key="+this.getText(),n.ajaxCall({url:t,data:this.getParameter(),dataType:"json",type:"POST",success:function(t){e.suggestItems=t,e._renderSuggestItem()}}))},_setSuggestItemsByNameLazy:function(){for(var t=this.setting.data,e=this.getText(),i=[],n=0;n<t.length;n++){var a=t[n];-1!=a.indexOf(e)&&i.push(a)}this.suggestItems=i},_renderSuggestItem:function(){var t=this.suggestItems,e=this.getText(),i=[];if(this.$list.html(""),t){for(var n=0;n<t.length;n++)i.push(this._createSuggestItems(n,t[n],e));this.$list.append(i)}},_createSuggestItems:function(e,i,n){return t("<li "+(e%2==1?'class="li-odd"':"")+'><i class="icon-ok"></i>'+this._getName(i,n)+"</li>")},_getName:function(t,e){if(""==e)return t;var i=t.indexOf(e);if(-1==i)return t;var n=e.length;return t.substring(0,i)+"<em>"+e+"</em>"+t.substring(n+i)},showPanel:function(){this._showPanel()},loadData:function(t){this.setting.data=t,this.setting.remote=!1},reload:function(t){if(t){var e=this;n.ajaxCall({url:t,data:this.getParameter(),dataType:"json",type:"POST",success:function(t){e.data=t}})}},setValue:function(t,e){this.setText(t),this._setValue(t,e)}});return t.fn.typeahead=function(i,n){var a=undefined,s=arguments,o="typeahead";return this.each(function(){var n=t(this);if(!n.is("input"))return!0;var l=e.getComponent(n,o);if("string"==typeof i)try{var d=Array.prototype.slice.call(s,1);a=e.componentMethodApply(l,i,d)}catch(h){e.throwCompMethodError(n,o,i,h)}else l?e.throwCompInitError(n,o):(l=new r(this,i),n.data(o,l))}),a},r}),define("app/widgets/form/app-upload",["app/core/app-base","app/core/app-jquery","app/core/app-core","app/core/app-options","app/widgets/app-progressbar","app/data/app-ajax","app/util/app-utils","jquery/jquery.upload"],function(t,e,i,n,a,r,s){"use strict";function o(){var t=this.getFileList().length;t>0?this.$element.removeClass("empty"):this.$element.addClass("empty"),this.setting.multiple||(t>0?this.$element.addClass("un-upload"):this.$element.removeClass("un-upload"))}function l(t){return t.substring(t.lastIndexOf(".")+1,t.length)}function d(t,e){for(var i=0,n=t.length,a=new String,r=0;r<n;r++){var s=t.charAt(r);if(i++,escape(s).length>4&&i++,a=a.concat(s),i>=e)return a}if(i<e)return t}var h=t.extend({initialize:function(t,i){this.$input=e(t),this.options=i,this._init(),this._eventRegister()},_init:function(){this._initOptions(),this.$input.css("display","none"),this._initHTML(),this.setting.requestFile&&this.initLoadedFile(this.setting.fileUrl);var t=this;this.$element.on("click",".file-item .file-icon",function(i){t.setting.selectable&&e(this).parent().toggleClass("selected")}),e.isFunction(t.setting.createDownloadUrl)?this.$element.on("click",".file-name",function(i){var n=e(this).closest(".file-item").attr("fileId");!function(t,i,n){var a=e('<form style="display:none;"></form>').attr("action",t).attr("method","post");n&&a.attr("target","_blank");for(var r in i)e('<input type="hidden" />').attr("name",r).val(i[r]).appendTo(a);e("body").append(a),a.submit(),a.remove()}(t.setting.createDownloadUrl(n),{})}):this.$element.addClass("un-download")},_initOptions:function(){var t=e.extend(i.getAttrFromElement(this.$input),this.options);if(e.isFunction(t.beforeRender)&&t.beforeRender.call(this,t),this.setting=e.extend({},n.appDefaults.upload,t),this.setting.exts){var a=this.setting.exts.toLowerCase();this._exts=a.split(",")}var r={},s=this.setting.events;s&&(r="string"==typeof s?this.$input.getJsEvent(s):s),this.callback=r,this.setting.groupId?this.groupId=this.setting.groupId:this.groupId="g-"+(new Date).getTime()},_eventRegister:function(){var t=this.setting;e.isFunction(t.afterDelete)&&this.on("afterDelete",t.afterDelete),e.isFunction(t.startUpload)&&this.on("startUpload",t.startUpload),e.isFunction(t.uploadError)&&this.on("uploadError",t.uploadError),e.isFunction(t.uploadSuccess)&&this.on("uploadSuccess",t.uploadSuccess)},_initHTML:function(){var t=this.setting;this.$element=e('<div class="app-upload empty '+t.css+'" '+(t.style?'style="'+t.style+'"':"")+'><div class="content"><div class="upload-btn"><div class="file-icon icon-upload"></div></div></div><input class="upload-progress"></input><div class="upload-mask"></div></div>').insertAfter(this.$input),this.$uploadItem=this.$element.find(".upload-btn"),this.$uploadBtn=this.$element.find(".upload-btn .icon-upload"),this.$fileList=this.$element.find(".content"),this.progressbar=new a(this.$element.find(".upload-progress"),{width:"70%",height:"20px"}),this.$mask=this.$element.find(".upload-mask"),this.$input.appendTo(this.$element),this.$input.removeClass("app-upload"),this.$element.data("upload",this),this._new$File()},initLoadedFile:function(t){if(t){var e=this;r.ajaxCall({url:t,dataType:"json",data:{groupId:e.groupId},type:"POST",success:function(t){e.appendHasLoadFile(t)}})}},resetFileList:function(){this.$fileList.html("")},appendHasLoadFile:function(t){e.isArray(t)||(t=[t]);for(var i=t.length-1;i>=0;i--){var n=t[i];n.ext=l(n.name),this._initFileElement(n).show()}this.$element.scrollTop(this.$element[0].scrollHeight)},_new$File:function(){var t=this.$fileInput=e('<input id="'+i.uuid("upload-")+'" type="file" name="file"/>'),n=this;this.setting.extsApply&&t.attr("accept",this.setting.exts),this.$uploadBtn.empty().append(t),t.on("change.upload-append.api",function(){var t=e(this).val().replace(/.*(\/|\\)/,""),i=l(t);if(function(t,e){var i=!1;if(t="."+t,e){for(var n=0;n<e.length;n++)if(e[n].toLowerCase()==t.toLowerCase()){i=!0;break}}else i=!0;return i}(i,n._exts)){var a=n._initFileElement({name:t,ext:i});n._ajaxUpload(a)}else $messager.warn("请上传扩展名为["+n.setting.exts+"]的文件");n._new$File()}),t.on("click.upload-append.api",function(t){n.setting.promptMessage&&n.$fileInput.parent().hasClass(".upload-btn")&&(t.stopPropagation(),t.preventDefault(),$messager.confirm(n.setting.promptMessage),e(e("#_alertMsgBox .btn")[0]).css("position","relative").append(n.$fileInput),e("#_alertMsgBox .btn").on("click",function(){n.$uploadBtn.append(n.$fileInput)}))})},setPromptMessage:function(t){this.setting.promptMessage=t},getPromptMessage:function(){return this.setting.promptMessage},_initFileElement:function(t){this.setting.createDownloadUrl&&this.setting.createDownloadUrl(t);var i=e('<div class="file-item" title="'+t.name+'"><div '+function(t){var e="";switch(t=t.toLowerCase()){case"txt":e="icon-txt";break;case"rar":e="icon-rar";break;case"zip":e="icon-zip";break;case"doc":case"docx":e="icon-word";break;case"ppt":case"pptx":e="icon-ppt";break;case"xls":case"xlsx":e="icon-excel";break;case"pdf":e="icon-pdf";break;case"gif":case"png":case"jpg":case"jpeg":case"bmp":e="icon-image";break;case"avi":case"rmvb":case"qmv":case"mkv":case"rm":e="icon-video"}return'class="file-icon '+e+'"'}(t.ext)+"></div>"+function(t){var e=t.gblen();if(e<=12)return'<div class="file-name" title="'+t+'">'+t+"</div>";var i="",n="";return e<=20?(i=d(t,e-12),n=t.replace(i,"")):((i=d(t,12)).gblen()==i.length&&(i=i.substr(0,11)),n=t.replace(i,"")),'<div class="file-name" title="'+t+'">'+i+'</div><div class="file-name" title="'+t+'">'+n+"</div>"}(t.name)+'<div class="file-selected"><i></i></div><div class="file-delete"><i></i></div></div>');return t.id&&i.attr("fileId",t.id),i.hide(),this.$uploadItem.after(i),this._liveDelete(i),o.call(this),i},_liveDelete:function(t){if(this.setting.canDelete){var e=this;t.find(".file-delete").on("click.upload.api",function(){$messager.confirm("是否确认删除？",{okCall:function(i){e._deleteFile(t)}})})}else t.addClass("un-delete")},setGroupId:function(t){t&&(this.groupId=t)},getGroupId:function(){return this.groupId},_ajaxUpload:function(t){var i=this,n=this.$fileInput.attr("id");this.progressbar.setValue(0),this.progressbar.active(),this.progressbar.$element.show(),function(t){t.interval=setInterval(function(){t.getPercent()<50?t.setValue(t.getValue()+2*Math.random()):t.getPercent()<80?t.setValue(t.getValue()+Math.random()):t.getPercent()<95?t.setValue(t.getValue()+.5*Math.random()):t.getPercent()<99?t.setValue(t.getValue()+.1*Math.random()):t.getPercent()<99.9&&(t.unactive(),clearInterval(t.interval))},500)}(this.progressbar),this.$mask.show(),this.trigger("startUpload"),e.ajaxFileUpload({url:this.setting.uploadUrl,secureuri:!1,dataType:"json",data:{groupId:i.groupId},fileElementId:n,success:function(e){e.errorMsg?i._fileUploadError(e,t):i._onFileFinish(e,t)},error:function(e){i._fileUploadError(e,t)}})},_onFileFinish:function(t,e){e.attr("fileId",t.id),clearInterval(this.progressbar.interval),this.progressbar.setValue(100),this.progressbar.unactive();var i=this;setTimeout(function(){i.progressbar.$element.hide(200)},300),this.$mask.hide(),e.show(500,function(){i.$element.scrollTop(i.$element[0].scrollHeight)}),this.trigger("uploadSuccess",t)},_fileUploadError:function(t,i){if(i.remove(),o.call(this),clearInterval(this.progressbar.interval),this.progressbar.unactive(),!this.setting.ignorUploadError){var n="上传失败";t.errorMsg?n+=":"+t.errorMsg:t.responseText&&(n+=":"+e(t.responseText).find("h1").text()),$messager.warn(n)}this.progressbar.$element.hide(),this.$mask.hide(),this.trigger("uploadError",t)},_deleteFile:function(t){var e=t.attr("fileId"),i=this;this.setting.deleteUrl&&e?r.ajaxCall({url:this.setting.deleteUrl,dataType:"json",type:"POST",data:{fileId:e},success:function(e){e?(t.remove(),o.call(i),i.trigger("afterDelete")):$messager.warn("文件无法完成删除！")}}):(t.remove(),o.call(this),this.trigger("afterDelete"))},getFileList:function(){var t=[];return this.$fileList.find(".file-item").each(function(){var i={},n=e(this);i.name=n.attr("title"),i.id=n.attr("fileid"),t.push(i)}),t},getSelectedFiles:function(){var t=[];return this.$fileList.find(".file-item.selected").each(function(){var i={},n=e(this);i.name=n.attr("title"),i.id=n.attr("fileid"),t.push(i)}),t},disableUpload:function(){this.readonly(!0)},enableUpload:function(){this.readonly(!1)},readonly:function(t){!1===t?this.$element.removeClass("readonly"):this.$element.addClass("readonly")},destroy:function(){}});return e.fn.upload=function(t,n){var a=undefined,r=arguments;return this.each(function(){var n=e(this),s=n.data("upload");if("string"==typeof t)try{var o=Array.prototype.slice.call(r,1);a=i.componentMethodApply(s,t,o)}catch(d){throw(l=n.attr("id"))||(l=n[0].outerHTML),new Error("组件upload["+l+"]调用"+t+"方法:"+d)}else{if(s){var l;throw(l=n.attr("id"))||(l=n[0].outerHTML),new Error("组件upload["+l+"]无法重复初始化")}s=new h(this,t),n.data("upload",s)}}),a},e.fn.upload.Constructor=h,h}),define("app/widgets/form/app-xquery",["app/core/app-jquery","app/widgets/window/app-dialog","app/widgets/form/app-comp"],function(t){"use strict";function e(e){var i=[],n=e.$element,a=e.hiddenCon,r={};return null!=a&&t.each(a,function(t){a[t]&&i.push(param)}),t("[field]",n).each(function(){var e=t(this),a={},s=e.val(),o=e.attr("type");if(null!=s&&""!=s)if("true"!=e.attr("manual")){var l=e.attr("model"),d=e.attr("field"),h=e.attr("operator"),c=null==l?d:l+"."+d,u={};u.prop=c,h&&(u.op=h),d&&("checkbox"==o||"radio"==o?a[c]||(a[c]=c,t("[field="+d+"]:checkbox",n).each(function(){this.checked&&(u.val||(u.val=[]),u.val.push(s))}),u.val=u.val.join(","),i.push(u)):(u.val=s,i.push(u)))}else{(d=e.attr("field"))&&("checkbox"==o||"radio"==o?a[d]||(a[d]=d,r[d]=[],t("[field="+d+"]:checkbox",n).each(function(){this.checked&&r[d].push(s)}),r[d]=r[d].join(",")):r[d]=s)}}),r.__xquery=JSON.stringify(i),r}function i(e){var i=e.$element,n=t.extend({},e.hiddenCon),a={};t("[field]",i).each(function(){var e=t(this),i=e.val();if(null!=i&&""!=i){var r=e.attr("field"),s=e.attr("type");r&&("checkbox"==s||"radio"==s?(a[r]||(a[r]=r,n[r]=[]),e[0].checked&&n[r].push(i)):n[r]=i)}});for(var r in a)n[r]&&(n[r]=n[r].join(","));return n}var n=function(e,i){var n=this,a=n.$element=$A(e),r=a.attr("query-target"),s="true"==a.attr("manual");this.init=!1,this.displaymode=a.attr("displaymode"),n.$element.bind("_resize",function(){if(n.oldElHeight){var t=n.$element.parent();t&&t.attr("region")&&n.oldElHeight!=n.$element.height()&&(n.oldElHeight=n.$element.height(),t.panel("resize",{height:n.oldHeight+n.$element.outerHeight()}),t.parents("div.app-layout").layout("resize"))}});var o=t(r);if(o.length>0)n.$target=o;else if((o=$A("#"+r)).length>0)n.$target=o;else{var l=$A("[query-target]").parents(".dialog").attr("id"),d=t("[dialogid="+l+"]").data("xquery");d&&(n.$target=d.$target)}n.manual=s,n.hiddenCon={}};return n.prototype={quickQuery:function(){var n=!0,a=this.$element.getJsonAttr("quick_validator");if(t.isFunction(a)&&(n=a(this.$element)),!n)return n;var r;return r=this.manual?i(this):e(this),this.$target.isGrid&&this.$target.isGrid()?this.$target.bsgrid("load",r):this.$target.data("grid")&&(this.$target.grid("setParameter",r),this.$target.grid("load")),n},clearQuery:function(){this.$element.find("input,textarea").each(function(){null!=t(this).attr("id")&&t(this).clearCompValue()})},close:function(){"float"==this.displaymode?this.$element.hide():funcs.closeDialog()},advQuery:function(){var t=!0,n=this.$element.getJsonAttr("adv_validator");if(n&&(t=n(this.$element)),!t)return t;var a;return a=this.manual?i(this):e(this),this.$target.isGrid&&this.$target.isGrid()?this.$target.bsgrid("load",a):this.$target.data("grid")&&(this.$target.grid("setParameter",a),this.$target.grid("load")),t},clear:function(){t("[field]",$e).each(function(){t(this).val("")})},addParameter:function(t,e,i){var n=this.hiddenCon;if(null==e||""==e)return n[t]=null,void delete n[t];if(this.manual)n[t]=v;else{var a=n[t];null==a&&(a={prop:t},n[t]=a),i&&(a.op=i),a.val=v}},openQuery:function(){var e=this.$element.attr("advance");if(!e){var i="#"+this.$element.attr("id")+"_advance_content";e=this.$element.find(i).val()}var n=this.$element.attr("dialogId");n||(n="advquery"+$A.nextId(),this.$element.attr("dialogId",n));if(!((s=t("#"+n)).length>0)){var a=function(e){var i;if($A.getWorkSpace()){var n=$A.getWorkSpace().getActionPage();i=t(n).getAppJsObject()}i&&(e.data("jsObject",i),t(e[0]).setAppJsObject(i.param.split(","),i.objs))},r=t(e);r.children().css("visibility","hidden");var s;return s=t.openModalDialog({beforShow:a,afterShow:a,afterClose:function(e){t(e[0]).clearAppJsObject()},url:r,title:"高级查询",dialogId:n,reload:!1,mode:"node",onPageLoad:function(){var e;if(r.children().css("visibility",""),$A.getWorkSpace()){var i=$A.getWorkSpace().getActionPage();e=t(i).getAppJsObject()}if(e&&e.objs){var n=e.objs[0];n.bindEvents&&n.bindEvents(),n.listeners&&n.listeners.onQueryPageLoad&&n.listeners.onQueryPageLoad()}}})}var o=s.data("jsObject");if(o&&t(s[0]).setAppJsObject(o.param.split(","),o.objs),$A.dialog.setCurrent(s),s.show(),o){var l=o.objs[0];l.listeners&&l.listeners.onQueryPageLoad&&l.listeners.onQueryPageLoad()}t("#_dialogMask").show()},hide:function(){if("float"==this.displaymode)this.$element.hide();else if(this.$element){this.$element[0].style.display="none";var t=this.$element.parent();if(t){t.panel("options").region&&(t.panel("resize",{height:this.oldHeight}),t.parents("div.app-layout").layout("resize"))}}},show:function(e){if("float"==this.displaymode){if(e){if(0==this.init){$A.getContainer().append(this.$element);var i="#"+this.$element.attr("id")+"_quicks_content",n="#"+this.$element.attr("id")+"_advances_content",a=(this.$element.find(i).val(),this.$element.find(n).val(),this.$element.find(".xquery-quicks-items .xquery-content"),this.$element.find(".xquery-advance-items .xquery-content"),t(e.currentTarget).parents(".app-xquerybox")),r=a.offset();r.top=r.top+a.outerHeight()+1,this.$element.css({top:r.top+"px"}),this.$element.find(".arrow").on("click",function(){var t=$A(this),e=t.parents(".xquery-advance-items"),i=t.parents(".xquery-quicks-items"),n=e.length>0?e:i;t.hasClass("arrow-up")?(t.removeClass("arrow-up").addClass("arrow-down"),n.find(".xquery-content").hide()):(t.removeClass("arrow-down").addClass("arrow-up"),n.find(".xquery-content").show())});var s=this;t(document).on("click",function(e){var i=t(e.target);i.parents(".xquery").length>0||i.hasClass(".xquery")||s.close()}),this.init=!0}this.$element.show()}}else if(this.$element){var o=this.$element.parent();if(this.oldHeight||(this.oldHeight=o.outerHeight()),this.oldElHeight||(this.oldElHeight=this.$element.outerHeight()),this.$element[0].style.display="inline-block",o){var l=o.panel("options");l&&l.region&&(o.panel("resize",{height:o.height()+this.$element.outerHeight()}),o.parents("div.app-layout").layout("resize"))}}},toggle:function(t){this.$element.is(":hidden")?this.show(t):this.hide()},destroy:function(){var e=this.$element.attr("dialogId");if(e){var i=t("#"+e);i.length>0&&($A.destroyDom(i),i.trigger($A.eventType.pageDestroy).remove())}}},t.fn.xquery=function(e){var i=undefined,a="object"==typeof e?t.extend({},e):null,r=null,s=[];"string"==typeof e&&(r=e,s=t.makeArray(arguments).slice(1));var o=this.each(function(){var e=t(this),o=e.data("xquery");if(o||e.data("xquery",o=new n(this,a)),r){var l=o[r];l&&(i=l.apply(o,s))}});return i===undefined?o:i},t.fn.initXquery=function(e){return t(this).each(function(){t(this).find(".queryitem[visible=false]").hide()})},t.fn.xquery.Constructor=n,t(document).on("click.xquery.data-api","div.xquery .xquery-quick-button",function(e){var i=t(this);e.preventDefault(),i.parents(".xquery").xquery("quickQuery")}),t(document).on("click.xquery.data-api","div.xquery .xquery-adv-button",function(e){var i=t(this);e.preventDefault();i.parents("div.xquery:first").xquery("openQuery")}),t(document).on("click.xquery.data-api","a.advancequery.ok",function(t){t.preventDefault(),$A("[query-target]").xquery("advQuery")&&$A("[query-target]").xquery("close")}),t(document).on("click.xquery.data-api","a.advancequery.rest",function(t){$A("[query-target]").xquery("clearQuery")}),t(document).on("click.xquery.data-api","a.advancequery.cancel",function(t){t.preventDefault(),$A("[query-target]").xquery("close")}),t}),define("app/widgets/form/app-xquerybox",["app/core/app-jquery","app/core/app-core","app/core/app-options","app/data/app-ajax","app/widgets/form/app-suggest"],function(t,e,i,n,a){"use strict";var r=a.extend({initialize:function(t,e){e||(e={}),e.className="app-xquerybox",e._=i.appDefaults.Suggest,r.superclass.initialize.call(this,t,e),r.superclass._init.call(this)},_init:function(){this.setting.valuefield="field",this.setting.textfield="textValue",this.setting.fieldname="name",this.setting.multiple=!1;var e=this.setting.queryid;this.on("afterSelected",this.queryTargetLoad),this.$searchBtn=t('<a class="wrapper-btn wrapper-search"><i></i></a>'),this.$searchBtn.insertBefore(this.$openBtn),this.$element.on("mousedown.textbox.api",".wrapper-btn.wrapper-open",function(t){e&&$A("#"+e).xquery("toggle",t)}),this.$element.on("mousedown.textbox.api","input",function(t){e&&$A("#"+e).xquery("close")});var i=this;this.$element.on("mousedown.textbox.api",".wrapper-btn.wrapper-search",function(){var t=i.getSelectedNode();i.queryTargetLoad(t)}),this.$element.addClass("app-xquerybox"),this.$element.removeClass("app-suggest")},queryTargetLoad:function(t,e){var i=this.setting.querytarget,n=[],a={};if(i){if(t)n.push({op:"like",prop:t.field,val:t.value}),a.__xquery=JSON.stringify(n);else if(e)for(var r=this.setting.data,s=r.length,o=0;o<s;o++)n.push({op:"like",prop:r[o].field,val:r[o].value}),a.__xquery=JSON.stringify(n);else a.__xquery=null;$A("#"+i).grid("setParameter",a),$A("#"+i).grid("load")}},_initOptions:function(){var t=this.setting;""!=t.suggest&&1!=t.suggest||!t.url||(t.suggest=t.url),0==t.suggest&&(t.suggest=""),!t.remote&&t.async&&(t.remote=!0),t.textfield==t.valuefield&&this.setText(t.value),t.suggestfield||(t.suggestfield=t.textfield),t.suggestClear&&!t.multiple?t.suggestClear=!0:t.suggestClear=!1},_initPanelContent:function(){this._fixSuggestPanel(),this.$dropPanelMain.append('<div class="suggest-list"><ul></ul></div>'),this.$dropPanelCustom.append('<div class="selected-list"></div>'),this.$dropPanelCustom.css("overflow","auto"),this.$suggest=this.$dropPanel.find(".suggest-list"),this.$suggestList=this.$suggest.find(">ul"),this.$selectedList=this.$dropPanelCustom.find(".selected-list")},_fixSuggestPanel:function(){var t=0,e=this.setting;e.acceptText?t=0:e.slt_area&&(t=Number(e.slt_area)),isNaN(t)||(this.$dropPanelCustom.css("height",t),this.$dropPanel.css("padding-bottom",t))},_eventRegister:function(){var e=this.setting;t.isFunction(e.afterSelected)&&this.on("afterSelected",e.afterSelected),t.isFunction(e.beforeSelected)&&this.on("beforeSelected",e.beforeSelected)},_registEvents:function(){this.$text.on("focus.suggest.api",t.proxy(this._textFocusEvent,this));var e=this;this.$element.hasClass("app-suggest")?(this.$openBtn.off("click.textbox.api"),this.$openBtn.on("click.suggest.api",function(t){e.$text.focus()})):this.$element.data("suggest",this),this.$suggestList.on("click.suggest.api","li",function(){e._suggestItemActive(t(this))}),this._onSelectedNodeDeleteEvent(),this._bindShowHistory()},_textChangeEvent:function(){if(this.setting.acceptText){var t=this;this.$text.on("change.textbox.api",function(){var e=t.getSelectedNode(),i=t._getSelectedNodeText(e),n=t.getText();i!=n&&(e=t._createSelectedNode(n)),t.setSelectedNode(e)})}},_textFocusEvent:function(){var t=this.$text;t.data("oriText",t.val())},_bindShowHistory:function(){if(this._localStorage){var i=this;this.$text.on("fucus.suggest.api click.suggest.api",function(){t.trim(i.getText())||i._showHistory()}).on("keyup.suggest.api",function(n){i._mainDivIsVisiable()||(n.keyCode!=e.keyCode.DOWN?t.trim(i.getText())||i._showHistory():i._showHistory())})}},_showHistory:function(){var t=this._localStorage.get();t&&(this._render$SuggestNode(t),this.$dropPanel.show(),this.place())},_onSelectedNodeDeleteEvent:function(){var e=this;this.$selectedList.on("click.suggest.api",".sd-close-btn",function(){var i=t(this).parent(),n=e._getNode(i);e.$suggestList.find('.selected[_v="'+n[e.setting.valuefield]+'"]').removeClass("selected"),i.remove(),e._setSelectedNodeBySltArea()})},_keyManager:function(t){this.stopKeyEvent||this._dealSysKey(t)||(this._mainDivIsVisiable()?this._keyForVisiblePanel(t):this._keyForHiddenPanel(t))},_keyForVisiblePanel:function(t){t.keyCode;var i=this.setting;t.stopPropagation(),e.containKeyCode(t,i.keyNextNode)?this._keyNextNode(t):e.containKeyCode(t,i.keyPrevNode)?this._keyPrevNode(t):e.containKeyCode(t,i.keyPickNode)?this._keyPickNode(t):e.containKeyCode(t,i.keyNextSltNode)?this._keyNextSltNode(t):e.containKeyCode(t,i.keyPrevSltNode)?this._keyPrevSltNode(t):e.containKeyCode(t,i.keyHidePanel)?this._keyHidePanel(t):this._keyFilterSuggest(t)&&this.suggest()},_keyForHiddenPanel:function(t){var e=t.keyCode;this._isKeyCursorPos(e)?this._keyCursorPos(t):this._keyFilterSuggest(t)&&this.suggest()},_switchSuggest:function(){var e=this.$selectedList.find(".selected-item.current");if(e.length>0){e.removeClass("current");var i=this.$suggest.scrollTop(),n=this.$suggestList.find(">li"),a=t(n[0]).outerHeight(),r=Math.floor(i/a);t(n[r]).addClass("current")}},_keyPrevNode:function(t){t.preventDefault();var e=this.$suggestList;if(0!=e.find(">li").length){var i=e.find(".current"),n=i.prev();0==n.length&&(n=e.find("li:last-child")),this._switchSuggest(),i.removeClass("current"),n.addClass("current"),this._locateSuggest()}},_keyNextNode:function(t){t.preventDefault(),this._locateNextNode()},_locateNextNode:function(){var t=this.$suggestList;if(0!=t.find(">li").length){var e=t.find(".current"),i=e.next();0==i.length&&(i=t.find("li:first-child")),this._switchSuggest(),e.removeClass("current"),i.addClass("current"),this._locateSuggest()}},_keyPickNode:function(t){t.preventDefault();var e=this.$dropPanel.find(".current");0==e.length&&this.queryTargetLoad(null,!0),e.hasClass("selected-item")?(e.find(".sd-close-btn").click(),this._keyNextSltNode(t)):(this._suggestItemActive(e),this._locateNextNode())},_locateSuggest:function(){var t=this.$suggestList.find("li.current");if(1==t.length){var e=t.offset().top+t.outerHeight()-this.$suggestList.offset().top,i=this.$suggest.outerHeight()-2,n=this.$suggest.scrollTop();e<=n?this.$suggest.scrollTop(e-t.outerHeight()):e>=n+i&&this.$suggest.scrollTop(e-i)}},_switchSelected:function(){this.$suggestList.find("li.current").removeClass("current")},_keyPrevSltNode:function(e){e.preventDefault();var i=this.$selectedList.find(">div");if(0!=i.length){var n=this.$selectedList.find(">div.current"),a=n.prev();0==a.length&&(a=t(i[i.length-1])),this._switchSelected(),n.removeClass("current"),a.addClass("current"),this._locateSelected()}},_keyNextSltNode:function(e){var i=this.$selectedList.find(">div");if(0!=i.length){var n=this.$selectedList.find(">div.current"),a=n.next();0==a.length&&(a=t(i[0])),this._switchSelected(),n.removeClass("current"),a.addClass("current"),this._locateSelected()}},_locateSelected:function(){var t=this.$selectedList.find(">div.current");if(1==t.length){var e=t.offset().top-t.parent().offset().top;this.$selectedList.scrollTop(e)}},suggest:function(){var t=this;clearTimeout(this.timeout),this.timeout=setTimeout(function(){t._suggestFunc()},this.setting.lazy)},_suggestFunc:function(){if(!this.stopKeyEvent&&(this.setting.suggestClear&&(this.setSelectedNode(null,!0),this._setValue("")),this.isActive())){if(this._mainDivIsVisiable()||this.setting.acceptText||this.showPanel(),this._preventSuggest())return this.$input.data("selectNode",null),this.hidePanel(),void this.queryTargetLoad(null,!1);this.setting.acceptText&&this.$selectedList.html(""),!1!==this._onBeforeLoad()&&(this.setting.remote?this._suggestByRemote():this._suggestByLocal())}},_preventSuggest:function(){var e=this.getText(),i=!1;return t.trim(e)?this.prevKey&&(this.prevKey!=e||this.setting.acceptText||(i=!0)):i=!0,this.prevKey=e,i},_suggestByRemote:function(){var e=this.setting.suggest,i=this.setting.onlyleaf,a=this;if(e){var r=t.extend({},this.getParameter());r._key=this.getText(),r.suggestfield=this.setting.suggestfield,this.$dropPanelLoading.show(),n.ajaxCall({url:e,data:r,dataType:"json",type:"POST",success:function(t){a.$dropPanelLoading.hide();var e=[];if(i)for(var n=0;n<t.length;n++)a._isLeaf(t,t[n])&&e.push(t[n]);else e=t;a._render$SuggestNode(e)}})}},_suggestByLocal:function(){if(this._initDataByParameter(),this.setting.data!=undefined){var t=this._filterByKey();this._render$SuggestNode(t)}else{var e=this.setting.suggest,i=this;e&&(this.$dropPanelLoading.show(),n.ajaxCall({url:e,data:this.getParameter(),dataType:"json",type:"POST",success:function(t){i.$dropPanelLoading.hide(),i.setting.data=t,i._suggestByLocal()}}))}},_initDataByParameter:function(){var t=this.getParameter();t&&(JSON.stringify(this.lastParam)!=JSON.stringify(t)&&(this.setting.data=undefined),this.lastParam=t)},_filterByKey:function(){for(var t=this.setting.data,e=this.getText(),i=[],n=0;n<t.length;n++)e=(e=e.replace(t[n][this.setting.fieldname],"")).replace(":","");for(n=0;n<t.length;n++)t[n].textValue=t[n][this.setting.fieldname]+":"+e,t[n].value=e,i.push(t[n]);return i},_isLeaf:function(t,e){var i=this.setting.pidfield,n=this.setting.valuefield;if("true"==e.isParent||1==e.isParent)return!1;for(var a=0;a<t.length;a++)if(t[a][i]==e[n])return!1;return!0},_render$SuggestNode:function(e){this.$suggestList.html("");var i=this.setting.valuefield,n=this.setting.textfield,a=this.getText();0==e.length?this.$dropPanelEmpty.show():this.$dropPanelEmpty.hide();for(var r=0;r<e.length;r++){var s=e[r],o=t('<li _v="'+s[i]+'"><i class="icon-ok"></i>'+this._getSuggestText(s[n],a)+"</li>");this.$suggestList.append(o),this._setNode(o,s)}this._selected$SuggestNode(),1==e.length&&this._locateNextNode(),this.setting.acceptText&&(0==e.length?this.hidePanel():this.showPanel())},_getSuggestText:function(t,e){if(this.setting.suggestfield&&this.setting.suggestfield!=this.setting.textfield)return t;if(""==e)return t;var i=t.indexOf(e);if(-1==i&&-1==(i=t.toUpperCase().indexOf(e.toUpperCase())))return t;var n=e.length;return t.substring(0,i)+"<em>"+t.substring(i,i+n)+"</em>"+t.substring(n+i)},_selected$SuggestNode:function(){var e=this.getSelectedNode(),i=this.setting.valuefield;e?t.isArray(e)||(e=[e]):e=[];for(var n=0;n<e.length;n++){this.$suggestList.find('li[_v="'+e[n][i]+'"]').addClass("selected")}},togglePanel:function(){},showPanel:function(){this._render$SelectedNode(),this._showPanel()},_render$SelectedNode:function(){this._resetRender(),this._reset$SelectedNode();var e=this.getSelectedNode();if(e)if(t.isArray(e))for(var i=0;i<e.length;i++)this._appendSelectedItem(e[i]);else this._appendSelectedItem(e)},_reset$SelectedNode:function(){if(!(d=this.getSelectedNode())){var t=this.getValue();if(t){var e=t.split(","),i=this.$text.data("oriText"),n=this.setting.valuefield,a=this.setting.textfield,r=this.setting.multiple,s=[];if(i)for(var o=i.split(","),l=0;l<e.length;l++){var d;(d={})[n]=e[l],d[a]=o[l],s.push(d)}else this._isLocalSuggest()&&(s=this._getSelectedNodeByValue(e));r?this.setSelectedNode(s,!0):this.setSelectedNode(s[0],!0)}}},_getSelectedNodeByValue:function(t){for(var e=[],i=this.setting.data,n=this.setting.valuefield,a=0;a<t.length;a++)for(var r=0;r<i.length;r++)t[a]!=i[r][n]||e.push(i[r]);return e},_isLocalSuggest:function(t){return this.setting.data!=undefined&&!this.setting.async},hidePanel:function(){this._mainDivIsVisiable()&&(this.$dropPanel.hide(),t(document).off("click.combo.api"),this.setting.acceptText||this.setSelectedNode(this.getSelectedNode()))},_createSelectedNode:function(t){var e={};return e[this.setting.textfield]=t,e[this.setting.valuefield]=t,e},_getSelectedNodeText:function(e){if(!e)return"";var i="",n=this.setting.textfield;if(t.isArray(e)){for(var a=0;a<e.length;a++)i+=e[a][n]+",";i.length>0&&(i=i.substring(0,i.length-1))}else i=e[n]?e[n]:"";return i},loadData:function(t){this.setting.data=t,this.setting.remote=!1},reload:function(t){if(t){var e=this;this.$dropPanelLoading.show(),n.ajaxCall({url:t,data:this.getParameter(),dataType:"json",type:"POST",success:function(t){e.$dropPanelLoading.hide(),e.loadData(t)}})}},clearValue:function(){this.setText(""),this.setValue(""),this._resetRender(),this.setSelectedNode(null)},_resetRender:function(){this.$suggestList.find("li.selected").removeClass("selected"),this.$selectedList.html("")},_setSelectedNodeBySltArea:function(){for(var e=this.$selectedList.children(),i=[],n=0;n<e.length;n++)i.push(this._getNode(t(e[n])));this.setting.multiple||(i=i[0])==undefined&&(i=null),this.setSelectedNode(i,!this.setting.acceptText)},_suggestItemActive:function(t){this._isSelected(t)?(this._unselect$SuggestNode(t),this._setSelectedNodeBySltArea()):this._select$SuggestNode(t)},_isSelected:function(t){return t.hasClass("selected")},_select$SuggestNode:function(t){if(!1!==this._active$NodeEvent("beforeSelected",t)){var e=this._getNode(t);this.setting.multiple?(t.addClass("selected"),this._appendSelectedItem(e),this._setSelectedNodeBySltArea()):(this.$suggestList.find("li.selected").removeClass("selected"),this.$selectedList.html(""),t.addClass("selected"),this._appendSelectedItem(e),this._setSelectedNodeBySltArea(),this.hidePanel()),this._active$NodeEvent("afterSelected",t)}},_unselect$SuggestNode:function(t){t.removeClass("selected");var e=this._getNode(t);this.$selectedList.find('.selected-item[_v="'+e[this.setting.valuefield]+'"]').remove()},_active$NodeEvent:function(t,e){if(this.hasBindEvent(t))return this.trigger(t,this._getNode(e))},_getNode:function(t){return t.data("node")},_setNode:function(t,e){t.data("node",e)},_appendSelectedItem:function(e){if(0==this.$selectedList.find('.selected-item[_v="'+e[this.setting.valuefield]+'"]').length){var i=t('<div class="selected-item" _v="'+e[this.setting.valuefield]+'">'+e[this.setting.textfield]+'<span class="sd-close-btn"></span></div>');this._setNode(i,e),this.$selectedList.append(i)}}});return t.fn.xquerybox=function(i,n){var a=undefined,s=arguments,o="xquerybox";return this.each(function(){var n=t(this);if(!n.is("input"))return!0;var l=n.data(o);if("string"==typeof i)try{var d=Array.prototype.slice.call(s,1);a=e.componentMethodApply(l,i,d)}catch(h){e.throwCompMethodError(n,o,i,h)}else l?e.throwCompInitError(n,o):(l=new r(this,i),n.data(o,l))}),a},r}),define("app/widgets/panel/app-panel",["app/core/app-jquery","app/core/app-core","app/core/app-options","jquery/jquery-ui","app/widgets/app-widget"],function($,$A,Opts,resizable,Widget){var timeout=null;$(window).unbind(".panel").bind("resize.panel",function(){timeout&&clearTimeout(timeout),timeout=setTimeout(function(){var t=$A("body.layout");if(t.length)t.layout("resize");else{var e=$A(".app-layout"),i=$A(".app-vboxLayout,.app-hboxLayout");e.length?$A(e[0]).layout("resize"):i.length?i.triggerHandler("_resize"):$A("body>div.panel").triggerHandler("_resize")}},100)});var Panel=Widget.extend({initialize:function(t,e){e||(e={}),Panel.superclass.initialize.call(this,e);$(t);this.element=t;var i=$.extend({},Opts.appDefaults.Panel,Panel.parseOptions(t),e);$.data(t,"panel",{options:i,panel:this.wrapPanel(t),isLoaded:!1})},_init:function(t){var e=$.data(t,"panel").options,i=$.data(t,"panel").panel;e.content&&($(this).html(e.content),$.parser&&$.parser.parse(this)),this.addEvents("onBeforeLoad","onLoad","onLoadError","onBeforeOpen","onOpen","onBeforeClose","onClose","onBeforeDestroy","onDestroy","BeforeCollapse","onCollapse","onBeforeExpand","onExpand","onResize","onMove","onMove","onMaximize","onRestore","onMinimize"),this.addHeader(t),this.setBorder(t),1==e.doSize&&this._setSize(t),1==e.closed||1==e.minimized?i.hide():this._openPanel(t)},panel:function(t){return $.data(t,"panel").panel},removeNode:function(t){t.each(function(){$(this).remove(),$.browser.msie&&(this.outerHTML="")})},_setSize:function(t,e){var i=$.data(t,"panel").options,n=$.data(t,"panel").panel,a=n.find(">div.panel-header"),r=n.find(">div.panel-body");if(e&&(e.width&&(i.width=e.width),e.height&&(i.height=e.height),null!=e.left&&(i.left=e.left),null!=e.top&&(i.top=e.top)),1==i.fit){var s=n.parent();i.width=s.width(),i.height=s.height()}n.css({left:i.left,top:i.top}),n.css(i.style),n.addClass(i.cls),a.addClass(i.headerCls),r.addClass(i.bodyCls),isNaN(i.width)?(n.width("auto"),r.width("auto")):n.outerWidth(i.width),a.add(r)._outerWidth(n.width()),isNaN(i.height)?r.height("auto"):(n.outerHeight(i.height),r.outerHeight(n.outerHeight()-a.outerHeight())),n.css("height",""),this.trigger("onResize",i.width,i.height),$(t).panel("doLayout")},_movePanel:function(t,e){var i=$.data(t,"panel").options,n=$.data(t,"panel").panel;e&&(null!=e.left&&(i.left=e.left),null!=e.top&&(i.top=e.top)),n.css({left:i.left,top:i.top}),i.onMove.apply(t,[i.left,i.top])},wrapPanel:function(t){var e=$(t).addClass("panel-body").css({margin:0}).wrap('<div class="panel"></div>').parent(),i=this;return e.bind("_resize",function(){return 1==$.data(t,"panel").options.fit&&i._setSize(t),!1}),e},addHeader:function(target){function onToggle(t){return t.hasClass("panel-tool-expand")?_self._expandPanel(target,!1):_self._collapsePanel(target,!1),!1}function onMin(){return _self._minimizePanel(target),!1}function onMax(){return $(this).hasClass("panel-tool-restore")?_self._restorePanel(target):_self._maximizePanel(target),!1}function onClose(){return _self._closePanel(target),!1}var opts=$.data(target,"panel").options,panel=$.data(target,"panel").panel,_self=this;if(this.removeNode(panel.find(">div.panel-header")),opts.title&&!opts.noheader){var header=$('<div class="panel-header"><div class="panel-title">'+opts.title+"</div></div>").prependTo(panel);opts.iconCls&&(header.find(".panel-title").addClass("panel-with-icon"),$('<div class="panel-icon"></div>').addClass(opts.iconCls).appendTo(header));var tool=$('<div class="panel-tool"></div>').appendTo(header);if(opts.closable&&$('<a class="panel-tool-close"></a>').appendTo(tool).bind("click",function(){_self.trigger("onClose",target)}),opts.maximizable&&$('<a class="panel-tool-max"></a>').appendTo(tool).bind("click",function(){_self.trigger("onMax",target)}),opts.minimizable&&$('<a class="panel-tool-min"></a>').appendTo(tool).bind("click",function(){_self.trigger("onMin",target)}),opts.collapsible&&$('<a class="panel-tool-collapse"></a>').appendTo(tool).bind("click",function(){onToggle($(this)),_self.trigger("onToggle",target)}),opts.tools)if("string"==typeof opts.tools)$(opts.tools).children().each(function(){$(this).addClass($(this).attr("iconCls")).addClass("panel-tool-a").appendTo(tool)});else for(var i=0;i<opts.tools.length;i++){var t=$('<a href="javascript:void(0)"></a>').addClass(opts.tools[i].iconCls).appendTo(tool);opts.tools[i].handler&&t.bind("click",eval(opts.tools[i].handler))}tool.find("div").hover(function(){$(this).addClass("panel-tool-over")},function(){$(this).removeClass("panel-tool-over")}),panel.find(">div.panel-body").removeClass("panel-body-noheader")}else panel.find(">div.panel-body").addClass("panel-body-noheader")},loadData:function(t){function e(e){$(t).html(e),$.parser&&$.parser.parse($(t))}var i=$.data(t,"panel"),n=i.options,a=this;if(n.href){if(!i.isLoaded||!n.cache){if(0==this.trigger("onBeforeLoad",t))return;i.isLoaded=!1,destroyContent(t),n.loadingMessage&&$(t).html($('<div class="panel-loading"></div>').html(n.loadingMessage)),$.ajax({url:n.href,cache:!1,dataType:"html",success:function(r,s){e(n.extractor.call(t,r)),a.trigger("onLoad",t,arguments),i.isLoaded=!0}})}}else n.content&&(i.isLoaded||(destroyContent(t),e(n.content),i.isLoaded=!0))},destroyContent:function(t){var e=$(t);e.find(".combo-f").each(function(){$(this).combo("destroy")}),e.find(".m-btn").each(function(){$(this).menubutton("destroy")}),e.find(".s-btn").each(function(){$(this).splitbutton("destroy")})},destroy:function(t,e){$.data(t,"panel").options;var i=$.data(t,"panel").panel;1!=forceDestroy&&0==this.trigger("onBeforeDestroy",t)||(this.removeNode(i),this.trigger("onDestroy",t))},_openPanel:function(t,e){var i=$.data(t,"panel").options,n=$.data(t,"panel").panel;if(1==e||0!=this.trigger("onBeforeOpen",t)){n.show(),i.closed=!1,i.minimized=!1;n.children("div.panel-header").find("a.panel-tool-restore").length&&(i.maximized=!0),this.trigger("onOpen",t),1==i.maximized&&(_maximizePanel(t),i.maximized=!1),1==i.collapsed&&(i.collapsed=!1,this._collapsePanel(t)),i.collapsed||(this.loadData(t),this.doLayout(t))}},_closePanel:function(t,e){var i=$.data(t,"panel").options,n=$.data(t,"panel").panel;1!=e&&0==this.trigger("onBeforeClose",t)||(n.hide(),i.closed=!0,this.trigger("onClose",t))},_destroyPanel:function(t,e){$.data(t,"panel").options;var i=$.data(t,"panel").panel;1!=e&&0==this.trigger("onBeforeDestroy",t)||(this.removeNode(i),this.trigger("onDestroy",t))},_collapsePanel:function(t,e){var i=this,n=$.data(t,"panel").options,a=$.data(t,"panel").panel,r=a.find(">div.panel-body"),s=a.find(">div.panel-header .panel-tool-collapse");r.stop(!0,!0),0!=this.trigger("onBeforeCollapse",t)&&(s.addClass("panel-tool-expand"),1==e?r.slideUp("normal",function(){n.collapsed=!0,i.trigger("onCollapse",t)}):(r.hide(),n.collapsed=!0,i.trigger("onCollapse",t)))},_expandPanel:function(t,e){var i=this,n=$.data(t,"panel").options,a=$.data(t,"panel").panel,r=a.children("div.panel-body"),s=(i=this,a.children("div.panel-header").find("a.panel-tool-collapse"));0!=n.collapsed&&(r.stop(!0,!0),0!=this.trigger("onBeforeExpand",t)&&(s.removeClass("panel-tool-expand"),1==e?r.slideDown("normal",function(){n.collapsed=!1,i.trigger("onExpand",t),i.loadData(t),i.doLayout(t)}):(r.show(),n.collapsed=!1,i.trigger("onExpand",t),i.loadData(t),i.doLayout(t))))},doLayout:function(t){var e=$(t).panel("body"),i=e.height(),n=e.width();e.data("layoutObj")&&e.layout("resize"),e.data("HBoxLayout")||e.data("VBoxLayout")?e.triggerHandler("_resize"):e.children("div.panel:visible,div.app-grid:visible,div.accordion:visible,div.tabs-container:visible,div.layout:visible,div.xquery:visible,div.grid-container:visible,div.ztree-container:visible,div.app-vboxLayout:visible,div.app-hboxLayout:visible,div.datagrid:visible,div.tab-container:visible").each(function(){$(this).triggerHandler("_resize",[!0,n,i,$(t)])})},_maximizePanel:function(t){var e=$.data(t,"panel").options,i=$.data(t,"panel").panel.find(">div.panel-header .panel-tool-max");i.hasClass("panel-tool-restore")||(i.addClass("panel-tool-restore"),$.data(t,"panel").original={width:e.width,height:e.height,left:e.left,top:e.top,fit:e.fit},e.left=0,e.top=0,e.fit=!0,this._setSize(t),e.minimized=!1,e.maximized=!0,this.trigger("onMaximize",t,t))},_minimizePanel:function(t){var e=$.data(t,"panel").options;$.data(t,"panel").panel.hide(),e.minimized=!0,e.maximized=!1,this.trigger("onMinimize",t,t)},_restorePanel:function(t){var e=$.data(t,"panel").options,i=$.data(t,"panel").panel,n=i.find(">div.panel-header .panel-tool-max");if(n.hasClass("panel-tool-restore")){i.show(),n.removeClass("panel-tool-restore");var a=$.data(t,"panel").original;e.width=a.width,e.height=a.height,e.left=a.left,e.top=a.top,e.fit=a.fit,this._setSize(t),e.minimized=!1,e.maximized=!1,this.trigger("onResize",t)}},setBorder:function(t){var e=$.data(t,"panel").options,i=$.data(t,"panel").panel,n=$(t).panel("header"),a=$(t).panel("body");i.css(e.style),i.addClass(e.cls),1==e.border?(i.find(">div.panel-header").removeClass("panel-header-noborder"),i.find(">div.panel-body").removeClass("panel-body-noborder")):(i.find(">div.panel-header").addClass("panel-header-noborder"),i.find(">div.panel-body").addClass("panel-body-noborder")),n.addClass(e.headerCls),a.addClass(e.bodyCls),e.id?$(t).attr("id",e.id):$(t).attr("id","")},setTitle:function(t,e){$.data(t,"panel").options.title=e,$(t).panel("header").find("div.panel-title").html(e)},options:function(t){return $.data(t,"panel").options},panel:function(t){return $.data(t,"panel").panel},header:function(t){return $.data(t,"panel").panel.find(">div.panel-header")},body:function(t){return $.data(t,"panel").panel.find(">div.panel-body")},open:function(t,e){var i=this.options(t);this._openPanel(t,e),i.layout&&i.layout.layout("resize"),$(".xquery",t).show()},close:function(t,e){var i=this.options(t);this._closePanel(t,e),i.layout&&i.layout.layout("resize"),$(".xquery",t).hide()},destroy:function(t,e){this._destroyPanel(t,e)},refresh:function(t,e){$.data(t,"panel").isLoaded=!1,this.loadData(this)},resize:function(t,e){this._setSize(t,e)},move:function(t,e){this._movePanel(t,e)},hide:function(t,e){this.close(t,e)},show:function(t,e){this.open(t,e)},maximize:function(t,e){this._maximizePanel(t,e)},minimize:function(t,e){this._minimizePanel(t,e)},restore:function(t){this._restorePanel(t)},collapse:function(t,e){this._collapsePanel(t,e)},expand:function(t,e){this._expandPanel(t,e)}});return Panel.parseOptions=function(t){var e=$(t),i=e.parseOptions(t,["id","width","height","left","top","title","iconCls","cls","headerCls","bodyCls","tools","region","href",{cache:"boolean",fit:"boolean",border:"boolean",noheader:"boolean"},{collapsible:"boolean",minimizable:"boolean",maximizable:"boolean",width:"number",height:"number"},{closable:"boolean",collapsed:"boolean",minimized:"boolean",maximized:"boolean",closed:"boolean"}]);return(i=$.extend(i,{loadingMessage:e.attr("loadingMessage")!=undefined?e.attr("loadingMessage"):undefined})).width&&"auto"!=i.width&&(i.width=parseInt(i.width)),i.height&&"auto"!=i.height&&(i.height=parseInt(i.height)),i},$.fn.panel=function(t,e){var i;return t=t||{},$set=this.each(function(){var n=$(this),a=$.data(this,"panel"),r=n.data("panelObj");a?"object"==typeof t&&(opts=$.extend(a.options,t)):(r=new Panel(this,t),n.data("panelObj",r),r._init(this)),"string"==typeof t&&(i=r[t](this,e))}),i===undefined?$set:i},Panel}),define("app/widgets/layout/app-containerLayout",["app/core/app-jquery","app/core/app-core","app/widgets/app-widget"],function(t,e,i){return ContainerLayout=i.extend({parseMargins:function(e){t.isNumeric(e)&&(e=e.toString());var i=e.split(" "),n=i.length;return 1==n?i[1]=i[2]=i[3]=i[0]:2==n?(i[2]=i[0],i[3]=i[1]):3==n&&(i[3]=i[1]),{top:parseInt(i[0],10)||0,right:parseInt(i[1],10)||0,bottom:parseInt(i[2],10)||0,left:parseInt(i[3],10)||0}},getPadding:function(e){var i=[];return t.map(["padding-top","padding-right","padding-bottom","padding-left"],function(n){var a=t.trim(e.style[n]||"0");a&&(-1==a.indexOf("%")&&(a=parseInt(a)||0),i.push(a))}),this.parseMargins(i.join(" "))},getMargins:function(e){var i=[];return t.map(["margin-top","margin-right","margin-bottom","margin-left"],function(n){var a=t.trim(e.style[n]||"0");a&&(-1==a.indexOf("%")&&(a=parseInt(a)||0),i.push(a))}),this.parseMargins(i.join(" "))}}),ContainerLayout}),define("app/widgets/layout/app-boxlayout",["app/core/app-jquery","app/core/app-core","app/core/app-options","app/widgets/app-resizable","app/widgets/panel/app-panel","app/widgets/layout/app-containerLayout"],function(t,e,i,n,a,r){var s=r.extend({attrs:{type:null,items:[],fit:null,width:null,height:null,padding:null,margins:null},initialize:function(e){e||(e={}),s.superclass.initialize.call(this,e),e=t.extend({},this.parseOptions(),e),this.initAttrs(e),this.padding=this.padding||this.getPadding(this.element),this.margins=this.margins||this.getMargins(this.element),this.init(),this.get("width")||t(this.element).width()&&this.set("width",t(this.element).width()),this.get("height")||t(this.element).width()&&this.set("height",t(this.element).height()),this.setSize({width:this.get("width"),height:this.get("height")});var i=this;t(this.element).bind("_resize",function(){return i.setSize(),!1})},parseOptions:function(){var e=t(this.element);return t.extend({},e.parseOptions(this.element,["fit","id"]))},setSize:function(e){var i=this.attrs,n=this.element,a=t(n);if(e&&(t.extend(i,{width:e.width||1,height:e.height||1}),a.width(i.width).height(i.height)),1==this.get("fit")){var r=a.parent(),s=r.innerWidth()?r.innerWidth():1,o=r.innerHeight()?r.innerHeight():1;a.outerWidth(s).outerHeight(o)}this.doLayout()},resize:function(){},initProps:function(){this.items=this.get("items"),this.padding=this.get("padding"),this.padding=this.get("margins")},init:function(){var e=this;t(this.element).addClass("layout").children("div").each(function(){var i=e.parsePanelOptions(this);i.padding=e.getPadding(this),i.margins=e.getMargins(this),t(this).removeClass("app-panel"),e.items.push(e.createPanel(this,i))})},parsePanelOptions:function(e){var i=t(e);return t.extend({},a.parseOptions(e),i.parseOptions(e,[{fit:"boolean",flex:"number",height:"number",width:"number"}]))},createPanel:function(e,i){var n=t(e,this.element).addClass("layout-body"),a={},r=this,s=function(e){bodyHeight=t(e).panel("body").height();var i=t.data(e,"panel").options;i.height=i.height-bodyHeight,t(e).data("_panelBodyHeight",bodyHeight),r.doLayout()};i.onExpand?i.onExpand=function(t){i.onExpand.call(t),s(t)}:i.onExpand=function(e){bodyHeight=t(e).data("_panelBodyHeight")||0;var i=t.data(e,"panel").options;i.height=i.height+bodyHeight,r.doLayout()},i.onCollapse?i.onCollapse=function(t){i.onCollapse.call(t),s(t)}:i.onCollapse=s,a="vbox"==this.get("type")?{width:n.length?parseInt(n[0].style.width)||n.outerWidth():"auto",height:i.flex?"auto":n.length?parseInt(n[0].style.height)||n.outerHeight():"auto",doSize:!1,bodyCls:"layout-body",cls:"x-box-item"}:{height:t(this.element).height(),width:i.flex?"auto":n.length?parseInt(n[0].style.width)||n.outerWidth():"auto",doSize:!1,bodyCls:"layout-body",cls:"x-box-item"};var o=t.extend({},a,i);return t(n).panel(o)},updateInnerCtSize:function(){},getVisibleItems:function(){var t,e,i=[],n=this.items,a=n.length;for(t=0;t<a;t++){var r=(e=n[t]).panel("options"),s=e.panel("panel");!0!==r.closed&&"none"!=s.css("display")&&i.push(e)}return i},getLayoutTargetSize:function(){var e=t(this.element),i=null;return e&&((i={}).height=e.innerHeight(),i.width=e.innerWidth()),i},doLayout:function(){var t=this.getVisibleItems(this.element),e=this.getLayoutTargetSize();this.layoutTargetLastSize=e,this.childBoxCache=this.calculateChildBoxes(t,e),this.updateChildBoxes(this.childBoxCache.boxes)},updateChildBoxes:function(t){for(var e=0,i=t.length;e<i;e++){var n=t[e],a=n.component;n.dirtySize&&a.panel("resize",n),!isNaN(n.left)&&isNaN(n.top)}}}),o=s.extend({attrs:{type:"vbox"},calculateChildBoxes:function(e,i){var n,a,r,s,o,l,d,h,c=e.length,u=this.padding,p=u.top,f=u.left,g=f+u.right,m=p+u.bottom,v=(g=f+u.right,i.width),b=i.height,y=Math.max(0,v-g),w=0,_=0,$=0,x=[];for(o=0;o<c;o++)s=(h=(a=e[o]).panel("options")).height,r=h.width,h.flex&&($+=h.flex,s=0),n=h.margins,w+=(s||0)+n.top+n.bottom,t.isNumeric(r)||(r=a._outerWidth()),_=Math.max(_,r),x.push({component:a,height:s||undefined,width:y||undefined});var C=Math.max(0,b-w-m),k=$;for(o=0;o<c;o++)s=(h=(a=e[o]).panel("options")).height,r=h.width,l=x[o],p+=(n=h.margins).top,h.flex&&(C-=d=Math.ceil(h.flex/k*C),k-=h.flex,l.height=d),l.dirtySize=!0,l.left=f,l.top=p,p+=l.height;return{boxes:x,meta:{maxWidth:_}}}});t.fn.VBoxLayout=function(e,i){var n=null,a=this.each(function(){var a=t(this),r=t.data(this,"VBoxLayout");if(!r){var s=t.extend({},{element:this});a.data("VBoxLayout",r=new o(s))}"string"==typeof e&&(n=r[e](this,i))});return n===undefined?a:n};var l=s.extend({attrs:{type:"hbox"},calculateChildBoxes:function(e,i){var n,a,r,s,o,l,d,h,c=e.length,u=this.padding,p=u.top,f=u.left,g=(u.right,p+u.bottom),m=(u.right,i.width),v=i.height,b=Math.max(0,v-g),y=0,w=0,_=0,$=[];for(o=0;o<c;o++)s=(h=(a=e[o]).panel("options")).height,r=h.width,h.flex&&(_+=h.flex,r=0),n=h.margins||this.getMargins(a),y+=(r||0)+n.left+n.right,t.isNumeric(s)&&0!=s||(s=a._outerHeight()),w=Math.max(w,s),$.push({component:a,height:b||undefined,width:r||undefined});var x=Math.max(0,m-y-g),C=_;for(o=0;o<c;o++)s=(h=(a=e[o]).panel("options")).height,r=h.width,l=$[o],p+=(n=h.margins).top,p+=n.bottom,h.flex&&(x-=d=Math.ceil(h.flex/C*x),C-=h.flex,l.width=d),l.dirtySize=!0,l.left=f,l.top=p,f+=n.left,f+=n.right,f+=l.width;return{boxes:$,meta:{maxHeight:w}}}});t.fn.HBoxLayout=function(e,i){var n=null,a=this.each(function(){var a=t(this),r=t.data(this,"HBoxLayout");if(!r){var s=t.extend({},{element:this});a.data("HBoxLayout",r=new l(s))}"string"==typeof e&&(n=r[e](this,i))});return n===undefined?a:n}}),define("app/widgets/layout/app-layout",["app/core/app-jquery","app/core/app-core"],function(t,e){return t.fn.extend({getWindowSize:function(){return t.browser.opera?{width:window.innerWidth,height:window.innerHeight}:{width:t(window).width(),height:t(window).height()}},scrollCenter:function(e){var i=t.extend({z:1e6,mode:"WH"},e),n=this.getWindowSize();return this.each(function(){var e=t(this).css({position:"absolute","z-index":i.z}),a=t(document).scrollTop(),r=t(document).scrollLeft(),s=(n.height-e.height())/2+a,o=(n.width-e.width())/2+r;"W"==i.mode?e.appendTo(document.body).css({left:o+"px"}):"H"==i.model?e.appendTo(document.body).css({top:s+"px"}):e.appendTo(document.body).css({top:(n.height-e.height())/2+t(window).scrollTop()+"px",left:o+"px"}),t(window).scroll(function(n){e.getWindowSize();var l=t(document).scrollTop(),d=t(document).scrollLeft();s+=l-a,o+=d-r,a=l,r=d,"W"==i.mode?e.stop().animate({left:o+"px"}):"H"==i.mode?e.stop().animate({top:s+"px"}):e.stop().animate({top:s+"px",left:o+"px"})}),t(window).resize(function(){var n=e.getWindowSize();s=(n.height-e.height())/2+t(document).scrollTop(),o=(n.width-e.width())/2+t(document).scrollLeft(),"W"==i.mode?e.stop().animate({left:o+"px"}):"H"==i.mode?e.stop().animate({top:s+"px"}):e.stop().animate({top:s+"px",left:o+"px"})})})},layoutHeight:function(e){return this.each(function(){var i=t(this);e||(e=i.parents("div.layoutBox:first"));var n=e.height(),a=parseInt(i.attr("layoutHeight"));if(!isNaN(a)){var r=n-a>50?n-a:50;if(i.isTag("table"))if(i.hasClass("flexigrid"))i.grid?i.grid.fixHeight(r):i.attr("height",r);else if(i.hasClass("jqgrid"))if("true"==i.attr("init")){var s=1*i.attr("pageHeight");s||(s=0),i.jqGrid("setGridHeight",r-s)}else i.attr("height",r);else i.removeAttr("layoutHeight").wrap('<div layoutHeight="'+a+'" style="overflow:auto;height:'+r+'px"></div>');else i.height(r).css("overflow","auto")}})},fillSpace:function(){var e=t(this),i=e.attr("fillpadd"),n=e.find(e.attr("fillSpace"));i=parseInt(i,10),i=isNaN(i)?0:i;var a=e.parent(),r=a.height()-i,s=a.children().not(e);t.each(s,function(e){r-=t(s[e]).outerHeight()}),0==n.length&&(n=e),n.height(r/n.length),null==e.attr("_fillSpaceEvent")&&(e.on("fillSpace",function(){setTimeout(function(){e.fillSpace()},100)}),e.attr("_fillSpaceEvent","true"))}}),e.regInitMethod(function(t){}),e}),define("app/widgets/layout/app-layout2",["app/core/app-jquery","app/core/app-core","app/core/app-options","jquery/jquery-ui","app/widgets/panel/app-panel","app/widgets/layout/app-containerLayout"],function(t,e,i,n,a,r){var s=!1,o=ContainerLayout.extend({initialize:function(e){e||(e={}),e=t.extend(e,this.parseOptions(e.element)),o.superclass.initialize.call(this,e),this.padding=this.padding||this.getPadding(this.element),this.margins=this.margins||this.getMargins(this.element),this.panels=this.init(),this.bindEvents(),this._setSize()},resize:function(t,e){this._setSize(e)},parseOptions:function(e){var i=t(e);return t.extend({},i.parseOptions(e,[{fit:"boolean"}]))},updateChildBoxes:function(t){for(var e=0,i=t.length;e<i;e++){var n=t[e];n.component.panel("resize",n),!isNaN(n.left)&&isNaN(n.top)}},parsePanelOptions:function(e){var i=t(e),n=t.extend({},a.parseOptions(e),i.parseOptions(e,["region",{split:"boolean",collpasedSize:"number",minWidth:"number",minHeight:"number",maxWidth:"number",maxHeight:"number",width:"number",height:"number"}]));return n.width&&"auto"!=n.width&&(n.width=parseInt(n.width)),n.height&&"auto"!=n.height&&(n.height=parseInt(n.height)),n},_setSize:function(e){var i=this.attrs,n=(this.panels,this.element);e&&t.extend(i,{width:e.width,height:e.height});var a=t(n);if(1==this.get("fit")){var r=a.parent();0!=r.width()&&0!=r.height()&&a.width(r.width()).height(r.height())}var s=this.getLayoutTargetSize(),o=this.calculateChildBoxes(s);this.updateChildBoxes(o)},calculateChildBoxes:function(t){var e,i=t.width,n=t.height,a=this.panels,r=this.padding,s=r.top,o=r.left,l=(i=t.width,(n=t.height)-0),d=i-0,h=[];for(var c in{north:null,south:null,west:null,east:null,center:null}){e={};var u=a[c],p=u.panel("options"),f=p.margins,g=p.region;if(0!=a[c].length){if(u.length>0&&!this.isVisible(u)){if(!(u=a["expand"+c])||0==u.length)continue;g=p.region,p=u.panel("options")}switch(g){case"west":d=d-f.left-f.right-p.width,e.height=l-f.top-f.bottom,e.wdth=p.width,e.top=s+f.top,e.left=o+f.left,e.component=u,o=p.width+o+f.left+f.right;break;case"east":d=d-f.left-p.width-f.right,e.height=l-f.top-f.bottom,e.wdth=p.width,e.top=s+f.top,e.left=i-p.width-f.left,e.component=u;break;case"north":l=l-f.top-f.bottom-p.height,e.height=p.height,e.width=d-f.left-f.right,e.top=s+f.top,e.left=s+f.left,e.component=u,s=p.height+f.top+f.bottom;break;case"south":l=l-f.top-f.bottom-p.height,e.height=p.height,e.width=d-f.left-f.right,e.top=n-p.height-f.top-f.bottom,e.left=o+f.left,e.component=u;break;case"center":e.height=l-f.top-f.bottom,e.width=d,e.top=s+f.top,e.left=o+f.left,e.component=u}u.length>0&&(e.region=g,h.push(e))}}return h},getLayoutTargetSize:function(){var e=t(this.element),i=null;return e&&((i={}).height=e.innerHeight(),i.width=e.innerWidth()),i},init:function(){var e=this.element,i=t(e),n=this;"BODY"==i[0].tagName&&(t("html").css({height:"100%",overflow:"hidden"}),t("body").css({height:"100%",overflow:"hidden",border:"none"})),i.addClass("layout"),i.css({margin:0,padding:0});var a={north:t(),south:t(),west:t(),east:t(),center:t()};n=this;return i.children("div").each(function(){var r=n.parsePanelOptions(this);r.layout=i,t(this).removeClass("app-panel"),"north,south,east,west,center".indexOf(r.region)>=0&&(r.padding=n.getPadding(this),r.margins=n.getMargins(this),a[r.region]=function(a,r,o){var l=t(a,e).addClass("layout-body"),d=null;"north"==o?d="layout-button-up":"south"==o?d="layout-button-down":"east"==o?d="layout-button-right":"west"==o&&(d="layout-button-left");var h="layout-panel layout-panel-"+o+" layout-panel-broder-"+o;"true"!=r.split&&!0!==r.split||(h+=" layout-split-"+o);var c={iconCls:d,handler:function(){n.collapsePanel(o)}};"center"==o&&(c={}),r.collapsible||(c={});var u=t.extend({},r,{doSize:l.height()<=0,collapsible:!1,cls:h,tools:[c],bodyCls:"layout-body"});if("center"==o&&(u.height=1),l.panel(u),"true"==u.split||!0===u.split){a=l.panel("panel");var p="";"north"==o&&(p="s"),"south"==o&&(p="n"),"east"==o&&(p="w"),"west"==o&&(p="e"),a.resizable({handles:p,helper:function(){if("north"==o||"south"==o)var i=t(">div.layout-split-proxy-v",e);else i=t(">div.layout-split-proxy-h",e);return i},start:function(n,r){if(s=!0,"north"==o||"south"==o)var l=t(">div.layout-split-proxy-v",e);else l=t(">div.layout-split-proxy-h",e);var d={display:"block"};"north"==o?(d.top=parseInt(a.css("top"))+a.outerHeight()-l.height(),d.left=parseInt(a.css("left")),d.width=a.outerWidth(),d.height=l.height()):"south"==o?(d.top=parseInt(a.css("top")),d.left=parseInt(a.css("left")),d.width=a.outerWidth(),d.height=l.height()):"east"==o?(d.top=parseInt(a.css("top"))||0,d.left=parseInt(a.css("left"))||0,d.width=l.width(),d.height=a.outerHeight()):"west"==o&&(d.top=parseInt(a.css("top"))||0,d.left=a.outerWidth()-l.width(),d.width=l.width(),d.height=a.outerHeight()),l.css(d),t('<div class="layout-mask"></div>').css({left:0,top:0,width:i.width(),height:i.height()}).appendTo(i)},resize:function(i){if("north"==o||"south"==o)(n=t(">div.layout-split-proxy-v",e)).css("top",i.pageY-t(e).offset().top-n.height()/2);else{var n;(n=t(">div.layout-split-proxy-h",e)).css("left",i.pageX-t(e).offset().left-n.width()/2)}return!1},stop:function(r,o){t(">div.layout-split-proxy-v",e).css("display","none"),t(">div.layout-split-proxy-h",e).css("display","none"),o.size;var d=l.panel("options");d.width=a.outerWidth(),d.height=a.outerHeight(),d.left=a.css("left"),d.top=a.css("top"),l.panel("resize"),n._setSize(),s=!1,i.find(">div.layout-mask").remove()}})}return l}(this,r,r.region))}),t('<div class="layout-split-proxy-h"></div>').appendTo(i),t('<div class="layout-split-proxy-v"></div>').appendTo(i),t(e).bind("_resize",function(){return 1==n.get("fit")&&n._setSize(),!1}),a},getPanel:function(t){var e=this.panels;return e?e[t]:null},collapsePanel:function(e){var i=this.element,n=this.panels,a=this,r=t(i),s="expand"+e;n[e]&&n[e].panel("close"),n[s]||(n[s]=function(i){var s;"east"==i?s="layout-button-left":"west"==i?s="layout-button-right":"north"==i?s="layout-button-down":"south"==i&&(s="layout-button-up");var o=n[i].panel("options"),l=t("<div></div>").appendTo(r).panel({cls:"layout-expand",title:"&nbsp;",title:o.title,closed:!0,doSize:!1,height:28,width:28,margins:o.margins,tools:[{iconCls:s,handler:function(){a.expandPanel(e)}}]});return l.panel("panel").hover(function(){t(this).addClass("layout-expand-over")},function(){t(this).removeClass("layout-expand-over")}),l}(e),n[s].panel("panel").click(function(){return a.expandPanel(e),!1})),n[s].panel("open"),this._setSize()},expandPanel:function(e){var i=this.element,n=this.panels;t(i);n["expand"+e].panel("close"),n[e].panel("open"),this._setSize()},bindEvents:function(){function e(t){if(1!=s)return"east"!=t.data&&n.isVisible(a.east)&&n.isVisible(a.expandEast)&&a.east.panel("panel").animate({left:r.width()},function(){a.east.panel("close")}),"west"!=t.data&&n.isVisible(a.west)&&n.isVisible(a.expandWest)&&a.west.panel("panel").animate({left:-a.west.panel("options").width},function(){a.west.panel("close")}),"north"!=t.data&&n.isVisible(a.north)&&n.isVisible(a.expandNorth)&&a.north.panel("panel").animate({top:-a.north.panel("options").height},function(){a.north.panel("close")}),"south"!=t.data&&n.isVisible(a.south)&&n.isVisible(a.expandSouth)&&a.south.panel("panel").animate({top:r.height()},function(){a.south.panel("close")}),!1}var i=this.element,n=this,a=this.panels,r=t(i);a.east.length&&a.east.panel("panel").bind("mouseover","east",e),a.west.length&&a.west.panel("panel").bind("mouseover","west",e),a.north.length&&a.north.panel("panel").bind("mouseover","north",e),a.south.length&&a.south.panel("panel").bind("mouseover","south",e),a.center.panel("panel").bind("mouseover","center",e)},isVisible:function(t){return!!t&&(!!t.length&&"none"!=t.panel("panel").css("display"))}});return t.fn.layout=function(e,i){var n=null;return $set=this.each(function(){var a=t(this),r=(t.data(this,"layout"),t.data(this,"layoutObj"));if(!r){var s=t.extend({},{element:this});a.data("layoutObj",r=new o(s))}"string"==typeof e&&(n=r[e](this,i))}),n===undefined?$set:n},o}),define("app/widgets/menu/app-contextmenu",["app/core/app-jquery","app/core/app-core"],function(t,e,i){function n(){a.hide(),r.hide()}var a,r,s;t.fn.extend({contextMenu:function(i,o){var l=t.extend({shadow:!0,bindings:{},ctrSub:null},o);a||(a=t('<div id="contextmenu"></div>').appendTo("body").hide()),r||(r=t('<div id="contextmenuShadow"></div>').appendTo("body").hide()),(s=s||[]).push({id:i,shadow:l.shadow,bindings:l.bindings||{},ctrSub:l.ctrSub});var d=s.length-1;return t(this).bind("contextmenu",function(i){return function(i,o,l,d){var h=s[i],c=t(e.frags[h.id]);c.find("li").hoverClass(),a.html(c),t.each(h.bindings,function(e,i){t("[rel='"+e+"']",a).bind("click",function(e){n(),i(t(o),t("#"+h.id))})});var u=l.pageX,p=l.pageY;t(window).width()<u+a.width()&&(u-=a.width()),t(window).height()<p+a.height()&&(p-=a.height()),a.css({left:u,top:p}).show(),h.shadow&&r.css({width:a.width(),height:a.height(),left:u+3,top:p+3}).show(),t(document).one("click",n),t.isFunction(h.ctrSub)&&h.ctrSub(t(o),t("#"+h.id))}(d,this,i),!1}),this}})}),define("app/widgets/portlet/app-portal",["app/core/app-jquery","app/data/app-ajax","jquery/jquery-ui"],function(){return Portal={Config:{tableCls:"form-list",tdCls:"form-text",tdCls2:"single",ulCls:"tag-list",layCls:"layout-list",min:"min",mintext:"收起",max:"max",maxtext:"展开",close:"close",closetext:"关闭",refreshtext:"刷新",refresh:"refresh",_groupItemContent:"itemContent",_groupItemHead:"itemHeader",_groupWrapperClass:"groupWrapper",_groupItemClass:"groupItem"}},Portal.Layout={location:{left:"portal_l",center:"portal_m",right:"portal_r"},locationId:{left:"#portal_l",center:"#portal_m",right:"#portal_r"},layoutCss:{0:"1:3",1:"3:1",2:"1:2:1",3:"1:1:2",4:"2:1:1",5:"1:1:1"},layoutText:{0:"w250 w750 wnone",1:"w750 w250 wnone",2:"w250 w500 w250",3:"w250 w250 w500",4:"w500 w250 w250",5:"w250 w250 w250"}},Portal.Util={format:function(t,e){for(var i in e)t=t.replace(RegExp("{"+i+"}","g"),e[i]);return t},refresh:function(){$A("#"+Portal.Layout.left,"#"+Portal.Layout.center,"#"+Portal.Layout.right).sortable("refresh")},toBody:function(t){$A(".portal").append(t)}},Portal.fn=function(t){return t={init:function(e){t._ele={},t._create(),t._createWrap(e),t._bindEvent()},_create:function(){var e=$("<div id='header'/>");t.box=e,Portal.Util.toBody(e)},_createWrap:function(e){var i=t._createTable(Portal.Config.tableCls);t._ele.table=i,t._createModuleList(e),t._createActionButton(),t._addPanel(i)},_createTable:function(e){return e=$("<table/>").addClass(e),$("<tbody/>").append(t._createLayoutTr()).append(t._createBaseTr()).append(t._createActionTr()).appendTo(e),e},_createBaseTr:function(){var e=t._createTd(Portal.Config.tdCls2),i=$("<tr>").append(t._createTd(Portal.Config.tdCls,"功能模块设置：")).append(e);return t._ele.mtd=e,i},_createActionTr:function(){var e=t._createTd(Portal.Config.tdCls2),i=$("<tr>").append(t._createTd(Portal.Config.tdCls)).append(e);return t._ele.atd=e,i},_createLayoutTr:function(){var e=t._createTd(Portal.Config.tdCls2);$("<div/>").addClass(Portal.Config.layCls).append(t._createA("1:3")).append(t._createA("3:1")).append(t._createA("1:1:2")).append(t._createA("1:2:1")).append(t._createA("2:1:1")).append("<a href='javascript:void(0);' class='active' rel='1:1:1'>默认</a>").appendTo(e);var i=$("<tr>").append(t._createTd(Portal.Config.tdCls,"布局设置：")).append(e);return t._ele.layoutTd=e,i},_createModuleList:function(e){var i=$("<ul/>").addClass(Portal.Config.ulCls);t._createLis(e.appL,i),t._createLis(e.appM,i),t._createLis(e.appR,i),t._ele.ul=i,i.appendTo(t._ele.mtd)},_createActionButton:function(){var e=$("<a class='button b' href='#' >添加模块</a>"),i=$("<a class='button b' href='#' >保存配置</a>");t._ele.atd.append(e).append(i),t._bindAdd(e),t._bindSave(i)},_createLis:function(e,i){$.each(e,function(e,n){i.append(t._createLi(e,n))})},_createA:function(t){return $("<a href='javascript:void(0);' rel='"+t+"'>"+t+"</a>")},_createLi:function(t,e){return $("<li/>").append("<a href='#' rel='"+t+"'>"+e+"</a>").append("<span class='ok'></span>")},_createTd:function(t,e){var i=$("<td>").addClass(t);return void 0!=e&&i.text(e),i},_addPanel:function(e){t.box.append(e)},_bindAdd:function(e){e.click(function(){$.fallr("show",{buttons:{button1:{text:"确定",onclick:function(){var e=(n=$(this).children("form")).children("#modulename").val(),i=n.children("#modulekey").val(),n="left"==(n=n.children("input[name='modulelayout']:checked").val())?$("#"+Portal.Layout.location.left):"center"==n?$("#"+Portal.Layout.location.center):$("#"+Portal.Layout.location.right);t._ele.ul.append(t._createLi(i,e)),n.append(Portal.Portal._createPortalOne(i,e)),$.fallr("hide")}},button2:{text:"取消"}},content:'<form style="margin-left:20px"><p>模块名：</p><input type="text" size="15" id="modulename" /><p>模块Code：</p><input type="text" size="15" id="modulekey" /><p>模块位置：</p>左:<input type="radio" name="modulelayout" checked="checked" value="left"/>&nbsp&nbsp中:<input type="radio" name="modulelayout" value="center"/>&nbsp&nbsp右:<input type="radio" name="modulelayout" value="right"/></form>',icon:"add",position:"center"})})},_bindSave:function(t){t.click(function(){var t=$("#"+Portal.Layout.location.left).sortable("toArray"),e=$("#"+Portal.Layout.location.center).sortable("toArray"),i=$("#"+Portal.Layout.location.right).sortable("toArray"),n="";$("."+Portal.Config.layCls+" a").each(function(){$(this).hasClass("active")&&(n=$(this).attr("rel"))}),"1:1:1"==n&&(n="默认"),$.fallr("show",{content:"<p>left:["+t+"]</p><p>center:["+e+"]</p><p>right["+i+"]</p><p>当前布局:"+n+"</p>",position:"center"})})},_bindEvent:function(){t._moduleLiClick(),t._layoutAClick()},_moduleLiClick:function(){$("."+Portal.Config.ulCls+" li").on("click",function(){var t,e=(t=$(this)).find("a").attr("rel");e=$("#"+e);(t=t.find(".ok")).is(":visible")?(t.hide(),e.hide()):(t.show(),e.show()),Portal.Util.refresh()})},_layoutAClick:function(){$("."+Portal.Config.layCls+" a").click(function(){var e=$(this),i=e.attr("rel");t._ToLayout(i),e.addClass("active").siblings().removeClass("active")})},_ToLayout:function(t){var e=Portal.Layout.layoutText,i=Portal.Layout.locationId,n=0,a="";$.each(Portal.Layout.layoutCss,function(e,i){t==i&&(n=e)}),$.each(i,function(t,i){var r=$(i),s=e[n].split(/\s+/);switch(t){case"left":t=0;break;case"center":t=1;break;case"right":t=2}"wnone"==s[t]&&(a=r.sortable("toArray"),$.each(a,function(t,e){$("#"+Portal.Layout.location.left).append($("#"+e))}),r.empty()),r.removeClass("w250 w750 w500 wnone").addClass(s[t])})}}}(),Portal.Portlet=function(t){var e="<div id='"+Portal.Layout.location.left+"' class='"+Portal.Config._groupWrapperClass+" w250'/>",i="<div id='"+Portal.Layout.location.center+"' class='"+Portal.Config._groupWrapperClass+" w250'/>",n="<div id='"+Portal.Layout.location.right+"' class='"+Portal.Config._groupWrapperClass+" w250'/>",a="<div id='{key}' class='"+Portal.Config._groupItemClass+"'/>",r="<div class='"+Portal.Config._groupItemHead+"'><h3>{name}</h3></div>",s="<div class='"+Portal.Config._groupItemContent+"'/>";return t={init:function(e){t._create(),t._bindData(e),t._bindEvent()},_create:function(){t.box=$("<div id='portal'></div>"),t._elements={},t._createModulesWrap(),Portal.Util.toBody(t.box)},_bindData:function(e){$.each(e,function(e,i){t._createPortal(e,i)})},_createModulesWrap:function(){t._elements.m_l=$(e),t._elements.m_m=$(i),t._elements.m_r=$(n),t._addPanel(t._elements.m_l),t._addPanel(t._elements.m_m),t._addPanel(t._elements.m_r)},_addPanel:function(e){t.box.append(e)},_createPortal:function(e,i){var n;switch(e){case"appL":n=t._elements.m_l;break;case"appM":n=t._elements.m_m;break;case"appR":n=t._elements.m_r}$.each(i,function(e,i){n.append(t._createPortalOne(e,i))})},_createPortalOne:function(e,i){var n=t._createItemHeader(i),r=t._createItemContent();return $(Portal.Util.format(a,{key:e})).append(n).append(r)},_createItemHeader:function(e){e=$(Portal.Util.format(r,{name:e}));var i=t._createDiv("action").hide().appendTo(e);return t._createA(Portal.Config.refresh,Portal.Config.refreshtext,!0).appendTo(i),t._createA(Portal.Config.min,Portal.Config.mintext,!0).appendTo(i),t._createA(Portal.Config.max,Portal.Config.maxtext,!1).appendTo(i),t._createA(Portal.Config.close,Portal.Config.closetext,!0).appendTo(i),e.hover(function(){$(this).find(".action").show()},function(){$(this).find(".action").hide()}),e},_createItemContent:function(){var t=$(s);return $("<ul style='width:250px;'><li>xiaofanV587</li><li>xiaofanV587</li><li>xiaofanV587</li><li>xiaofanV587</li></ul>").appendTo(t),t},_createDiv:function(t){return $("<div/>").addClass(t)},_createA:function(t,e,i){return t=$("<a href='javascript:void(0);' class='"+t+"' title='"+e+"'/>"),i||t.hide(),t},_eventMin:function(){$("."+Portal.Config.min).on("click",function(){var t=$(this),e=t.parent().parent().parent();e.find("."+Portal.Config._groupItemContent).hide(),e.find("."+Portal.Config.max).show(),t.hide()})},_eventMax:function(){$("."+Portal.Config.max).on("click",function(){var t=$(this),e=t.parent().parent().parent();e.find("."+Portal.Config._groupItemContent).show(),e.find("."+Portal.Config.min).show(),t.hide()})},_eventRemove:function(){$("."+Portal.Config.close).on("click",function(){$(this).parent().parent().parent().fadeOut("500",function(){var t=$(this),e=t.attr("id");e=$(".tag-list").find("a[rel='"+e+"']");t.remove(),e.parent().remove()})})},_eventRefresh:function(){$("."+Portal.Config.refresh).on("click",function(){$(this).parent().parent().parent().find("ul").empty().append("<li>刷新了</li>")})},_eventSortable:function(){$("."+Portal.Config._groupWrapperClass).sortable({connectWith:"."+Portal.Config._groupWrapperClass,opacity:"0.6",dropOnEmpty:!0}).disableSelection()},_bindEvent:function(){t._eventSortable(),t._eventRefresh(),t._eventRemove(),t._eventMax(),t._eventMin()}}}(),Portal}),define("app/widgets/tabs/app-tab",["app/core/app-jquery","app/core/app-core","app/util/app-utils","app/data/app-ajax","app/widgets/app-widget","app/widgets/button/app-button"],function(t,e,i,n,a){function r(e,i){var n=i.buttons;if(n){e.wrap('<div class="tabs-header" />');e.parent().append(function(e){for(var i=t('<div class="tabs-header-btns"></div>'),n=0;n<e.length;n++){var a=e[n],r=t('<a class="app-button" title="'+a.tips+'">'+a.text+"</a>");i.append(r),r.button(a)}return i}(n))}}var s=a.extend({initialize:function(e,i){i||(i={}),i.element=e,s.superclass.initialize.call(this,i),this.element=e,this.option=i;var n=t(e);this.element=n;var a=n.find(">ul.nav-header");a.length>0&&(this.$header=a),r(a,i);var o=n.find(">div.tab-content");this.$content=o;var l=function(){var e=o.find(">.tab-pane.active");return e=0==e.length?o.find(">.tab-pane:first"):t(e[0])}();o.find(">.tab-pane").each(function(){this!=l[0]?t(this).addClass("inactive").removeClass("active"):t(this).removeClass("inactive").addClass("active").removeClass("lazy")});var d=this;setTimeout(function(){d.setScroll(l)},100);var h=n.attr("beforeSwitchTab");h&&(h=n.getPageJsProperty(h),this.on("beforeSwitchTab",h));d=this;o.find(">.tab-pane").addClass("layout-body"),this.element.bind("_resize",function(t,e,r,s){if(s=s-a.css("marginTop").replace("px","")-a.css("marginBottom").replace("px",""),1==i.fit){n.outerHeight(s),n.outerWidth(r);s-=a.outerHeight(),o.outerHeight(s),o.find(">.tab-pane").outerHeight(s)}o.outerWidth(n.width()),o.find(">.tab-pane").outerWidth(n.width()),d.doLayout(),d.activateTab&&d.setScroll(d.activateTab)});var c=n.attr("afterSwitchTab");c&&(c=n.getPageJsProperty(c),this.on("afterSwitchTab",c))},doLayout:function(){this.element;var e=this.$content.find(">.tab-pane.active"),i=e.height(),n=e.width();e.children("div.panel:visible,div.app-grid:visible,div.accordion:visible,div.tabs-container:visible,div.layout:visible,div.xquery:visible,div.grid-container:visible,div.ztree-container:visible,div.app-vboxLayout,div.app-hboxLayout,div.datagrid:visible").each(function(){t(this).triggerHandler("_resize",[!0,n,i])})},show:function(e){var i,n,a,r,s=this.element,o=this.$header,l=this.$content;if(e||(e=l.find(">.tab-pane:first")),"string"==typeof e&&(0!=e.indexOf("#")&&(e="#"+e),e=l.find(e)),!e.hasClass("active")&&(n=l.find(">.tab-pane.active"),o&&(a=o.find(">.active>a"),i=o.find("a[data-toggle=tab][data-target=#"+e.attr("id")+"]")),r=t.Event("beforeSwitchTab",{previousTab:n,previousHead:a,activeTab:e,activeHead:i}),s.trigger(r),!r.isDefaultPrevented())){a&&a.parent("li").removeClass("active"),i&&i.parent("li").addClass("active");var d=this;this.activate(e,n,function(){var t=e;t.is(".lazy")&&t.length>0&&(t.removeClass("lazy"),t.initPageUI(d.option),t.attr("init",!0)),d.trigger("afterSwitchTab",n,a,a,e,i)}),this.doLayout()}},setScroll:function(t){var e=t;1==this.option.fit&&(e[0].scrollHeight-e[0].offsetHeight>5?e.css("overflow-y","auto"):e.css("overflow-y","hide"),e[0].scrollWidth-e[0].offsetWidth>5?e.css("overflow-x","auto"):e.css("overflow-x","hide"))},activate:function(e,i,n){function a(){i.removeClass("active").addClass("inactive"),e.addClass("active").removeClass("inactive"),r?(e[0].offsetWidth,e.addClass("in")):e.removeClass("fade"),n&&n()}var r=n&&t.support.transition&&i.hasClass("fade");r?$active.one(t.support.transition.end,a):a(),i.removeClass("in");var s=this;this.activateTab=e,setTimeout(function(){s.setScroll(e)},100)},getCurrPane:function(){return this.$content.find(">.tab-pane.active")}});return t.fn.appTabs=function(e,i){var n=undefined,a=t(this).each(function(){var a=t(this),r=a.data("appTabs");r||(e=t.extend(a.parseOptions(this,[{fit:"boolean"}]),e)),r||a.data("appTabs",r=new s(this,e)),"string"==typeof e&&(n=r[e](i))});return n!==undefined?n:a},t(document).on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(i){i.preventDefault();var n=t(this).attr("data-target");if(n){n||(n=(n=$this.attr("href"))&&n.replace(/.*(?=#[^\s]*$)/,""));var a=e(n);if(0!=a.length){var r=a.parent(".tab-content").parent();0!=r.length&&r.appTabs("show",a)}}}),t}),define("app/widgets/tabs/app-tabs",["app/core/app-jquery","app/core/app-core","app/util/app-utils","app/data/app-ajax","app/widgets/app-widget","app/core/app-options","app/widgets/button/app-menubutton","app/widgets/panel/app-panel"],function($,$A,$utils,ajax,Widget,Opt,button,panel){function initMenuButtonHtml(t){var e=$('<a id="'+t.id+'" >'+t.text+"</a>");return t.menuId=$A.uuid(),function(t){for(var e=t.children,i=$('<div id="'+t.menuId+'" style="'+t.menuStyle+';display:none;"></div>'),n=0;n<e.length;n++){var a=e[n];a.menuSep?i.append('<div class="menu-sep"></div>'):function(t){t.id||(t.id=$A.uuid());var e=$('<div id="'+t.id+'" '+function(t){var e="";return t.iconCls&&(e+="iconCls:'"+t.iconCls+"'"),e&&(e='data-options="'+e+'"'),e}(t)+">"+t.text+"</div>");i.append(e),e.on("click",function(e){t.onClick&&t.onClick()})}(a)}$.$appPanelContainer.append(i)}(t),e.menubutton({iconCls:t.iconCls,onClick:t.onClick,plain:!1,menu:t.menuId,menuStyle:t.style?t.style:"width:150px"}),e}var Tabs=Widget.extend({initialize:function(t,e){e||(e={}),Tabs.superclass.initialize.call(this,e);$(t);this.element=t;var i=$.extend({},Tabs.defaults,Tabs.parseOptions(t),e);$.data(t,"tabsObj",{options:i,tabs:[],selectHis:[]}),this._init()},_init:function(){this._wrapTabs(),this._addTools(),this._setProperties(),this._setSize(),this._bindEvents(),this.addEvents("onLoad","onSelect","onBeforeClose","onUnselect","onClose","onAdd","onBeforeDestroy","onUpdate","onContextMenu"),this._doFirstSelect()},options:function(){var t=this.element,e=$.data(t,"tabsObj").options,i=this._getSelectedTab();return e.selected=i?this._getTabIndex(i):-1,e},tabs:function(){return $.data(this.element,"tabsObj")},resize:function(t){this._setSize(t),this.setSelectedSize()},add:function(t){return this._addTab(t)},close:function(t){return this._closeTab(t)},getTab:function(t){return this._getTab(t)},getTabIndex:function(t){return this._getTabIndex(t)},getSelected:function(){return this._getSelectedTab()},select:function(t){if("string"===$.type(t))for(var e=this.element,i=$.data(e,"tabsObj").tabs,n=0;n<i.length;n++){if(i[n].attr("id")===t){t=n;break}}this._selectTab(t)},unselect:function(t){this._unselectTab(t)},exists:function(t){return this.exists(t)},update:function(t){return this._updateTab(t)},enableTab:function(t){var e=this.getTab(t).panel("options");e.tab.removeClass("tabs-disabled"),e.disabled=!1},disableTab:function(t){var e=this.getTab(t).panel("options");e.tab.addClass("tabs-disabled"),e.disabled=!0},showHeader:function(){this._showHeader(!0)},hideHeader:function(){this._showHeader(!1)},showTool:function(){this._showTool(!0)},hideTool:function(t){this._showTool(this,!1)},scrollBy:function(t){var e=this.element,i=this.options(),n=$(e).find(">div.tabs-header>div.tabs-wrap"),a=Math.min(n._scrollLeft()+t,function(){var t=0,e=n.children("ul");return e.children("li").each(function(){t+=$(this).outerWidth(!0)}),t-n.width()+(e.outerWidth()-e.width())}());n.animate({scrollLeft:a},i.scrollDuration)},_showHeader:function(t){$.data(this.element,"tabsObj").options.showHeader=t,this.resize()},_showTool:function(t){var e=$(this.element).find(">.tabs-header>.tabs-tool");t?e.removeClass("tabs-tool-hidden").show():e.addClass("tabs-tool-hidden").hide(),this.resize(),this.scrollBy(0)},_getContentWidth:function(t){var e=0;return $(t).children().each(function(){e+=$(this).outerWidth(!0)}),e},_setScrollers:function(){var t=$.data(this.element,"tabsObj").options;if("left"!=t.tabPosition&&"right"!=t.tabPosition&&t.showHeader){var e=$(this.element).children("div.tabs-header"),i=e.children("div.tabs-tool:not(.tabs-tool-hidden)"),n=e.children("div.tabs-scroller-left"),a=e.children("div.tabs-scroller-right"),r=e.children("div.tabs-wrap"),s=e.outerHeight();t.plain&&(s-=s-e.height()),i._outerHeight(s);var o=this._getContentWidth(e.find("ul.tabs")),l=e.width()-i._outerWidth();o>l?(n.add(a).show()._outerHeight(s),"left"==t.toolPosition?(i.css({left:n.outerWidth(),right:""}),r.css({marginLeft:n.outerWidth()+i._outerWidth(),marginRight:a._outerWidth(),width:l-n.outerWidth()-a.outerWidth()})):(i.css({left:"",right:a.outerWidth()}),r.css({marginLeft:n.outerWidth(),marginRight:a.outerWidth()+i._outerWidth(),width:l-n.outerWidth()-a.outerWidth()}))):(n.add(a).hide(),"left"==t.toolPosition?(i.css({left:0,right:""}),r.css({marginLeft:i._outerWidth(),marginRight:0,width:l})):(i.css({left:"",right:0}),r.css({marginLeft:0,marginRight:i._outerWidth(),width:l})))}},_addTools:function(){var opts=$.data(this.element,"tabsObj").options,header=$(this.element).children("div.tabs-header");if(opts.tools)if("string"==typeof opts.tools)$(opts.tools).addClass("tabs-tool").appendTo(header),$(opts.tools).show();else{header.children("div.tabs-tool").remove();for(var tools=$('<div class="tabs-tool"><table cellspacing="0" cellpadding="0" style="height:100%"><tr></tr></table></div>').appendTo(header),tr=tools.find("tr"),i=0;i<opts.tools.length;i++){var td=$("<td></td>").appendTo(tr);if(opts.tools[i].children){var btn=$.extend(!0,{},opts.tools[i],{plain:!0}),$btn=initMenuButtonHtml(btn);td.append($btn)}else{var tool=$("<a></a>").appendTo(td);tool[0].onclick=eval(opts.tools[i].handler||function(){}),tool.button($.extend({},opts.tools[i],{plain:!0}))}}}else header.children("div.tabs-tool").remove()},_setSize:function(t){function e(t,e){var i=t.panel("options"),a=i.tab.find("a.tabs-inner");(e=e||parseInt(i.tabWidth||n.tabWidth||undefined))?a._outerWidth(e):a.css("width",""),a._outerHeight(n.tabHeight),a.css("lineHeight",a.height()+"px"),a.find(".app-fluid:visible").triggerHandler("_resize")}var i=$.data(this.element,"tabsObj"),n=i.options,a=$(this.element);if(n.doSize){t&&$.extend(n,{width:t.width,height:t.height}),a._size(n);var r=a.children("div.tabs-header"),s=a.children("div.tabs-panels"),o=r.find("div.tabs-wrap"),l=o.find(".tabs");if(l.children("li").removeClass("tabs-first tabs-last"),l.children("li:first").addClass("tabs-first"),l.children("li:last").addClass("tabs-last"),"left"==n.tabPosition||"right"==n.tabPosition?(r._outerWidth(n.showHeader?n.headerWidth:0),s._outerWidth(a.width()-r.outerWidth()),r.add(s)._size("height",isNaN(parseInt(n.height))?"":a.height()),o._outerWidth(r.width()),l._outerWidth(o.width()).css("height","")):(r.children("div.tabs-scroller-left,div.tabs-scroller-right,div.tabs-tool:not(.tabs-tool-hidden)").css("display",n.showHeader?"block":"none"),r._outerWidth(a.width()).css("height",""),n.showHeader?(r.css("background-color",""),o.css("height","")):(r.css("background-color","transparent"),r._outerHeight(0),o._outerHeight(0)),l._outerHeight(n.tabHeight).css("width",""),l._outerHeight(l.outerHeight()-l.height()-1+n.tabHeight).css("width",""),s._size("height",isNaN(parseInt(n.height))?"":a.height()-r.outerHeight()),s._size("width",a.width())),i.tabs.length){var d=l.outerWidth(!0)-l.width(),h=l.children("li:first"),c=h.outerWidth(!0)-h.width(),u=r.width()-r.children(".tabs-tool:not(.tabs-tool-hidden)")._outerWidth(),p=Math.floor((u-d-c*i.tabs.length)/i.tabs.length);if($.map(i.tabs,function(t){e(t,n.justified&&$.inArray(n.tabPosition,["top","bottom"])>=0?p:undefined)}),n.justified&&$.inArray(n.tabPosition,["top","bottom"])>=0){var f=u-d-this._getContentWidth(l);e(i.tabs[i.tabs.length-1],p+f)}}this._setScrollers()}},_setSelectedSize:function(){var t=$.data(this.element,"tabsObj").options,e=this._getSelectedTab();if(e){var i=$(this.element).children("div.tabs-panels"),n="auto"==t.width?"auto":i.width(),a="auto"==t.height?"auto":i.height();e.panel("resize",{width:n,height:a})}},_wrapTabs:function(){$.data(this.element,"tabsObj").tabs;var t=this,e=$(this.element).addClass("tabs-container"),i=$('<div class="tabs-panels"></div>').insertBefore(e);e.children("div").each(function(){i[0].appendChild(this)}),e[0].appendChild(i[0]),$('<div class="tabs-header"><div class="tabs-scroller-left"></div><div class="tabs-scroller-right"></div><div class="tabs-wrap"><ul class="tabs"></ul></div></div>').prependTo(this.element),e.children("div.tabs-panels").children("div").each(function(e){var i=$.extend({},$(this).parseOptions(this),{disabled:!!$(this).attr("disabled")||undefined,selected:!!$(this).attr("selected")||undefined});t._createTab(i,$(this))}),e.children("div.tabs-header").find(".tabs-scroller-left, .tabs-scroller-right").hover(function(){$(this).addClass("tabs-scroller-over")},function(){$(this).removeClass("tabs-scroller-over")});t=this;e.bind("_resize",function(e,i){return($(this).hasClass("app-fluid")||i)&&(t._setSize(),t._setSelectedSize()),!1})},_bindEvents:function(){function t(t){var e=0;return t.parent().children("li").each(function(i){if(t[0]==this)return e=i,!1}),e}var e=$.data(this.element,"tabsObj"),i=e.options,n=this;$(this.element).children("div.tabs-header").unbind().bind("click",function(a){if($(a.target).hasClass("tabs-scroller-left"))$(n.element).tabs("scrollBy",-i.scrollIncrement);else{if(!$(a.target).hasClass("tabs-scroller-right")){var r=$(a.target).closest("li");if(r.hasClass("tabs-disabled"))return!1;if($(a.target).closest("a.tabs-close").length)n._closeTab(t(r));else if(r.length){var s=t(r),o=e.tabs[s].panel("options");o.collapsible?o.closed?n._selectTab(s):n._unselectTab(s):n._selectTab(s)}return!1}$(n.element).tabs("scrollBy",i.scrollIncrement)}}).bind("contextmenu",function(e){var i=$(e.target).closest("li");i.hasClass("tabs-disabled")||i.length&&n.trigger("onContextMenu",e,i.find("span.tabs-title").html(),t(i))})},_setProperties:function(){var t=$.data(this.element,"tabsObj").options,e=$(this.element).children("div.tabs-header"),i=$(this.element).children("div.tabs-panels");e.removeClass("tabs-header-top tabs-header-bottom tabs-header-left tabs-header-right"),i.removeClass("tabs-panels-top tabs-panels-bottom tabs-panels-left tabs-panels-right"),"top"==t.tabPosition?e.insertBefore(i):"bottom"==t.tabPosition?(e.insertAfter(i),e.addClass("tabs-header-bottom"),i.addClass("tabs-panels-top")):"left"==t.tabPosition?(e.addClass("tabs-header-left"),i.addClass("tabs-panels-right")):"right"==t.tabPosition&&(e.addClass("tabs-header-right"),i.addClass("tabs-panels-left")),1==t.plain?e.addClass("tabs-header-plain"):e.removeClass("tabs-header-plain"),e.removeClass("tabs-header-narrow").addClass(t.narrow?"tabs-header-narrow":"");var n=e.find(".tabs");n.removeClass("tabs-pill").addClass(t.pill?"tabs-pill":""),n.removeClass("tabs-narrow").addClass(t.narrow?"tabs-narrow":""),n.removeClass("tabs-justified").addClass(t.justified?"tabs-justified":""),1==t.border?(e.removeClass("tabs-header-noborder"),i.removeClass("tabs-panels-noborder")):(e.addClass("tabs-header-noborder"),i.addClass("tabs-panels-noborder")),t.doSize=!0},_createTab:function(t,e){t=t||{};var i=this.element,n=$.data(i,"tabsObj"),a=n.tabs,r=this;(t.index==undefined||t.index>a.length)&&(t.index=a.length),t.index<0&&(t.index=0);var s=$(i).children("div.tabs-header").find("ul.tabs"),o=$(i).children("div.tabs-panels"),l=$('<li><a href="javascript:void(0);" class="tabs-inner"><span class="tabs-title"></span><span class="tabs-icon"></span></a></li>');e||(e=$("<div></div>")),t.index>=a.length?(l.appendTo(s),e.appendTo(o),a.push(e)):(l.insertBefore(s.children("li:eq("+t.index+")")),e.insertBefore(o.children("div.panel:eq("+t.index+")")),a.splice(t.index,0,e)),e.panel($.extend({},t,{tab:l,border:!1,noheader:!0,closed:!0,doSize:!1,iconCls:t.icon?t.icon:undefined,onLoad:function(){r.trigger("onLoad",i)},onBeforeOpen:function(t){if(0==r.trigger("onBeforeOpen",i))return!1;var e=r.getSelected(),n=r.getTabIndex(e),a=r._getTab(n);if(r.trigger("beforeSwitchTab",n,a),e){if(e[0]==this)return r._setSelectedSize(),!1;if(r.unselect(n),e=r.getSelected())return!1}var s=$(t).panel("options");s.tab.addClass("tabs-selected");var o=$(i).find(">div.tabs-header>div.tabs-wrap"),l=s.tab.position().left,d=l+s.tab.outerWidth();if(l<0||d>o.width()){var h=l-(o.width()-s.tab.width())/2;r.scrollBy(h)}else r.scrollBy(0);var c=$(t).panel("panel");c.css("display","block"),r._setSelectedSize(),c.css("display","none")},onOpen:function(t){var i=$(t).panel("options"),a=r.getTabIndex(e),s=r._getTab(a);r.trigger("onOpen",i.title,a,s),n.selectHis.push(i.title),r.trigger("onSelect",i.title,a,s),r.trigger("afterSwitchTab",i.title,a,s)},onBeforeClose:function(e){return(!t.onBeforeClose||0!=t.onBeforeClose.call(this))&&(0!=r.trigger("onBeforeClose",i)&&void $(e).panel("options").tab.removeClass("tabs-selected"))},onClose:function(t){var n=r.getTabIndex(e),a=r._getTab(n);r.trigger("onClose",i);var s=$(t).panel("options");r.trigger("onUnselect",s.title,n,a)}})),this.update({tab:e,options:e.panel("options"),type:"header"})},_addTab:function(t){var e=this.element;$.data(e,"tabsObj").options;t.selected==undefined&&(t.selected=!0),this._createTab(t),this.trigger("onAdd",t.title,t.index),t.selected&&this._selectTab(t.index)},_updateTab:function(t){var e=this.element;t.type=t.type||"all";var i=$.data(e,"tabsObj").selectHis,n=t.tab,a=n.panel("options"),r=a.title;if($.extend(a,t.options,{iconCls:t.options.icon?t.options.icon:undefined}),"all"!=t.type&&"body"!=t.type||n.panel(),"all"==t.type||"header"==t.type){var s=a.tab;if(a.header)s.find(".tabs-inner").html($(a.header));else{var o=s.find("span.tabs-title"),l=s.find("span.tabs-icon");if(o.html(a.title),l.attr("class","tabs-icon"),s.find("a.tabs-close").remove(),a.closable?(o.addClass("tabs-closable"),$('<a href="javascript:void(0);" class="tabs-close"></a>').appendTo(s)):o.removeClass("tabs-closable"),a.iconCls?(o.addClass("tabs-with-icon"),l.addClass(a.iconCls)):o.removeClass("tabs-with-icon"),a.tools){if(!(d=s.find("span.tabs-p-tool")).length)var d=$('<span class="tabs-p-tool"></span>').insertAfter(s.find("a.tabs-inner"));if($.isArray(a.tools)){d.empty();for(var h=0;h<a.tools.length;h++){var c=$('<a href="javascript:void(0);"></a>').appendTo(d);c.addClass(a.tools[h].iconCls),a.tools[h].handler&&c.bind("click",{handler:a.tools[h].handler},function(t){$(this).parents("li").hasClass("tabs-disabled")||t.data.handler.call(this)})}}else $(a.tools).children().appendTo(d);var u=12*d.children().length;a.closable?(u+=8,d.css("right","")):(u-=3,d.css("right","5px")),o.css("padding-right",u+"px")}else s.find("span.tabs-p-tool").remove(),o.css("padding-right","")}if(r!=a.title)for(h=0;h<i.length;h++)i[h]==r&&(i[h]=a.title)}a.disabled?a.tab.addClass("tabs-disabled"):a.tab.removeClass("tabs-disabled"),this._setSize(),$.data(e,"tabsObj").options.onUpdate.call(e,a.title,this._getTabIndex(n))},_closeTab:function(t){var e=this.element,i=($.data(e,"tabsObj").options,$.data(e,"tabsObj").tabs),n=$.data(e,"tabsObj").selectHis;if(this._exists(t)){var a=(s=this._getTab(t)).panel("options").title,r=this._getTabIndex(s);if(0==this.trigger("onBeforeClose",a,r))return!1;var s;(s=this._getTab(t,!0)).panel("options").tab.remove(),s.panel("destroy"),this.trigger("onClose",a,r),this._setSize();for(var o=0;o<n.length;o++)n[o]==a&&(n.splice(o,1),o--);var l=n.pop();l?this._selectTab(l):i.length&&this._selectTab(0)}},_getTab:function(t,e){var i=this.element,n=$.data(i,"tabsObj").tabs,a=null;if("number"==typeof t)t>=0&&t<n.length&&(a=n[t],e&&n.splice(t,1));else{for(var r=$("<span></span>"),s=0;s<n.length;s++){var o=n[s],l=o.panel("options");if(l.id){if(l.id==t){a=o,e&&n.splice(s,1);break}}else if(r.html(o.panel("options").title),r.text()==t){a=o,e&&n.splice(s,1);break}}r.remove()}return a},_getTabIndex:function(t){for(var e=this.element,i=$.data(e,"tabsObj").tabs,n=0;n<i.length;n++)if(i[n][0]==$(t)[0])return n;return-1},_getSelectedTab:function(){for(var t=this.element,e=$.data(t,"tabsObj").tabs,i=0;i<e.length;i++){var n=e[i];if(n.panel("options").tab.hasClass("tabs-selected"))return n}return null},_doFirstSelect:function(){for(var t=this.element,e=$.data(t,"tabsObj"),i=e.tabs,n=0;n<i.length;n++){var a=i[n].panel("options");if(a.selected&&!a.disabled)return void this._selectTab(n)}this._selectTab(e.options.selected)},_selectTab:function(t){var e=this._getTab(t);e&&!e.is(":visible")&&(this._stopAnimate(),e.panel("options").disabled||e.panel("open"))},_unselectTab:function(t){var e=this._getTab(t);e&&"none"!=e.css("display")&&(this._stopAnimate(),e.panel("close"))},_stopAnimate:function(){var t=this.element;$(t).children("div.tabs-panels").each(function(){$(this).stop(!0,!0)})},_exists:function(t){this.element;return null!=this._getTab(t)},hideTab:function(t){for(var e,i=t.split(","),n=0;n<i.length;n++){e=i[n];var a=this.getTab(e),r=a.panel("options");r&&(r.tab.hide(),a.panel("hide"))}},showTab:function(t){for(var e,i=t.split(","),n=0;n<i.length;n++){e=i[n];var a=this.getTab(e),r=a.panel("options");r&&(r.tab.show(),a.panel("show"))}}});return Tabs.parseOptions=function(t){var e=$(t);return $.extend({},e.parseOptions(t,["tools","toolPosition","tabPosition",{fit:"boolean",border:"boolean",plain:"boolean"},{headerWidth:"number",tabWidth:"number",tabHeight:"number",selected:"number"},{showHeader:"boolean",justified:"boolean",narrow:"boolean",pill:"boolean"}]))},Tabs.defaults={width:"auto",height:"auto",headerWidth:150,tabWidth:"auto",tabHeight:27,selected:0,showHeader:!0,plain:!1,fit:!1,border:!0,justified:!1,narrow:!1,pill:!1,tools:null,toolPosition:"right",tabPosition:"top",scrollIncrement:100,scrollDuration:400,onLoad:function(t){},onSelect:function(t,e){},onUnselect:function(t,e){},onBeforeClose:function(t,e){},onClose:function(t,e){},onAdd:function(t,e){},onUpdate:function(t,e){},onContextMenu:function(t,e,i){}},$.fn.tabs=function(t,e){var i;return t=t||{},$set=this.each(function(){var n=$(this),a=$.data(this,"tabsObj"),r=n.data("tabs");a?"object"==typeof t&&(opts=$.extend(a.options,t)):(r=new Tabs(this,t),n.data("tabs",r)),"string"==typeof t&&(i=r[t](e))}),i===undefined?$set:i},Tabs});var zTree={};zTree.url=null,zTree.qryUrl=null,zTree.hasQry=!0,zTree.isasync=!1,zTree.autoParams=[],zTree.otherParam=[],zTree.isasync=!1,zTree.checkable=!1,zTree.checkboxType={Y:"ps",N:"ps"},zTree.checkField="checked",zTree.childrenField="children",zTree.nameField="name",zTree.titleField="name",zTree.idField="id",zTree.parentField="id",zTree.rootId=null,zTree.hasRoot=!1,zTree.rootNode=null,zTree.rootName=null,zTree.showIcon=!0,zTree.selectedMulti=!1,zTree.cancelSelectedNode=function(){},zTree.checkAllNodes=function(){},zTree.checkNode=function(){},zTree.expandNode=function(){},zTree.getNodeByParam=function(){},zTree.getNodes=function(){},zTree.getNodesByParam=function(){},zTree.getSelectedNodes=function(){},zTree.selectNode=function(){},define("app/widgets/tree/app-ztree-doc",function(){}),define("app/widgets/tree/app-ztree",["app/core/app-jquery","app/core/app-core","app/data/app-ajax","app/core/app-events","jquery/jquery.ztree"],function(t,e,i,n){t.fn.getAppZTree=function(){var e=t(this);if(e.isZTree())return"true"==e.attr("isztree")?t.fn.zTree.getZTreeObj(e.attr("id")):t.fn.zTree.getZTreeObj(e.attr("ztreeid"))},t.fn.isZTree=function(){return"true"==t(this).attr("isztree")||t(this).attr("ztreeid")},t.fn.zTree.search=function(e){var n=t("#"+e),a=n.getAppZTree(),r=a.setting,s=r.data,o=s.simpleData.idKey,l=s.key.title,d=s.key.name,h=s.searchFields,c=t("#"+e).parent().parent(),u=c.find(".serachList"),p=c.find(".searchBar input"),f=p.val(),g={};if(!f)return t("#"+e).show(),u.hide(),c.find(".searchBar a").attr("title","请输入内容后再执行搜索。"),void setTimeout(function(){c.find(".searchBar a").attr("title","执行搜索")},3e3);h?(g.searchFields=h,g._key=f):g[o]=f,r.async&&r.async.otherParam&&t.extend(g,r.async.otherParam);try{i.ajaxCall({url:r.qryUrl,data:g,dataType:"json",type:r.method,success:function(i){if(p.focus(),p[0].select(),t("#"+e).hide(),u.empty(),i&&i.length>0)for(var s=0;s<i.length;s++){var h=i[s],c=t('<li><a val="'+h[o]+'" title="'+h[l]+'" href="javascript:void(0)" onkeyup="$.fn.zTree.searchListKey.call(this,event)">'+h[d]+"</a></li>");u.append(c),c.find(">a").data("bindData",h)}else u.empty().append(t("<li>没有找到数据。</li>"));if(r.clickSearchNode||(r.clickSearchNode=r.callback.onClick),r.clickSearchNode){(f=u.find("a")).click(f,function(e){f.removeClass("select"),t(this).addClass("select");var i=t(this),s=i.data("bindData");s.idKey=i.attr("val"),s.titKey=i.attr("title"),s.nameKey=i.html(),a.selectNode(a.getNodeByParam(n.attr("idField"),s.idKey,null)),r.clickSearchNode(e,i.attr("val"),s)})}if(r.callback.onDblClick){var f;(f=u.find("a")).dblclick(function(e){f.removeClass("select"),t(this).addClass("select");var i=t(this),s={};s[o]=i.attr("val"),s[l]=i.attr("title"),s[d]=i.html(),a.selectNode(a.getNodeByParam(n.attr("idField"),nodeData.idKey,null)),r.callback.onDblClick(e,i.attr("val"),s)})}u.show()}})}catch(m){}},t.fn.zTree.searchListKey=function(e){if(40==e.keyCode||38==e.keyCode){var i=40==e.keyCode,n="INPUT"==this.nodeName.toUpperCase()?t(this).parent().parent().find(".serachList"):t(this).parent().parent(),a=n.find("a"),r=a.size();if(r>0){var s,o=n.find("a.select"),l=a.index(o);s=0==o.size()||l+1==r&&i?i?a.first():a.last():i||0!=l?(s=i?o.parent().next():o.parent().prev()).find("a"):a.last(),o.removeClass("select"),s.addClass("select").focus()}}},t.fn.zTree.bulidSearchBar=function(e){var i=t(this),n=i.parent(),a=n.innerHeight();n.resize(function(){var e=t(this).innerHeight();t(this).find(".treePnl").height(e-r.find(".searchBar").outerHeight())}),i.wrap('<div class="treePnl"></div>');var r=i.parent().parent();r.prepend('<div class="searchBar"><input  placeholder="搜索"/><div><a href="javascript:$.fn.zTree.search(\''+e+'\')" title="执行搜索"><span></span></a></div></div>'),r.height(a-r.find(".searchBar").outerHeight()),i.parent(".treePnl").append("<ul class='serachList'></ul>"),r.find(".searchBar input").unbind("keyup").keyup(e,function(i){if(this.value){if(13==i.keyCode)return t.fn.zTree.search(e),i.stopPropagation(),!1;t.fn.zTree.searchListKey.call(this,i)}else t(this).parent().parent().find(".serachList").hide(),t("#"+e).show()})},t.fn.initZTree=function(){this.each(function(){function a(e){t.fn.zTree.init(r,I,e);var i=t.fn.zTree.getZTreeObj(s);if(C){var a=i.getNodesByParam("id",M[w]);null!=a&&i.expandNode(a[0],!0,!1,!1)}!function(t){n.mixTo(t);var e=t.setting.callback;for(var i in e)e[i]&&t.on(i,e[i]),e[i]=function(e){return function(){var i=Array.prototype.slice.call(arguments,0);i.splice(0,0,e),t.trigger.apply(t,i)}}(i)}(i)}var r=t(this),s=r.attr("id")||"ztree"+e.nextId(),o=r.attr("url"),l=r.attr("qryUrl")||o,d="false"!=r.attr("hasQry"),h="true"==r.attr("isasync"),c=r.attr("autoParam")?r.attr("autoParam").split(","):[],u=r.attr("otherParam")?r.getJsonAttr("otherParam"):{},p=r.attr("method")||"POST",f="true"==r.attr("checkable"),g=r.attr("checkboxType"),m=r.attr("checkField")||"checked",v=r.attr("childrenField")||"children",b=r.attr("nameField")||"name",y=r.attr("titleField")||b,w=r.attr("idField")||"id",_=r.attr("parentField")||"pid",$=r.attr("rootId"),x=(r.attr("oneRoot"),r.attr("events")||r.html()),C="true"==r.attr("hasRoot"),k=r.getJsonAttr("rootNode"),T=r.attr("rootName"),P="false"!=r.attr("showIcon"),S=r.attr("searchFields"),D=r.attr("showLine"),R="true"==r.attr("sortable"),N="true"==r.attr("selectedMulti"),E=r.getJsonAttr("clickSearchNode");r.html(""),r.attr("isztree","true");var I={treeId:s};r.attr("id",s),$container=null,fit="true"==r.attr("fit"),d?(I.qryUrl=l,I.async||(I.async={}),I.async.otherParam=u,I.method=p,I.clickSearchNode=E,t.fn.zTree.bulidSearchBar.call(this,s),r.parent().parent().hasClass("ztree-container")&&($container=r.parent().parent())):r.parent().hasClass("ztree-container")&&($container=r.parent()),$container.attr("ztreeid",s),$container.css("overflow","auto"),fit&&$container.bind("_resize",function(){var e=t(this),i=t(this).parent(),n=i.width(),a=i.height(),r=$container.width(),s=$container.height();n>r&&i.css({"overflow-x":"hidden"}),a>s&&i.css({"overflow-y":"hidden"}),e.width(n),e.height(a),d&&(e.find(),e.find(".treePnl").height(a-e.find(".searchBar").outerHeight()))}),I.async=h?{enable:!0,url:o,dataType:"json",autoParam:c,otherParam:u,type:p}:{enable:!1},x&&(I.callback=r.getJsEvent(x)),f?(I.check={enable:!0,check:!0},g&&(I.check.chkboxType=e.jsonEval(g))):I.check={enable:!1};var F={key:{checked:m,children:v,name:b,title:y},simpleData:{enable:!0,idKey:w,pIdKey:_,rootPId:$},keep:{parent:!0},searchFields:S};I.data=F,I.view={showIcon:P,selectedMulti:N},I.view.showLine="true"==D;var M={isParent:!0,open:!0};if(M[w]=$,M[b]=T,k&&t.extend(M,k),!h&&o)i.ajaxCall({url:o,data:u,dataType:"json",type:p,success:function(t){if(C&&t.push(M),C){a();r.getAppZTree().addNodes(null,t)}else a(t)}});else{var z=[];C&&z.push(M),R&&(I.edit={drag:{autoExpandTrigger:!0,prev:!0,inner:!1,next:!0},enable:!0,showRemoveBtn:!1,showRenameBtn:!1}),$container.attr("_options")||$container.attr("_options","{}");var H=$container.getJsonAttr("_options");t.isFunction(H.beforeRender)&&H.beforeRender.call(this,I),a(z)}})}}),define("app/widgets/treegrid/app-pagination",["app/core/app-jquery","app/core/app-core"],function($,$A){function _1(_2){function _9(t){var e=_4.nav[t],i=$('<a href="javascript:void(0)"></a>').appendTo(tr);return i.wrap("<td></td>"),i.linkbutton({iconCls:e.iconCls,plain:!0}).unbind(".pagination").bind("click.pagination",function(){e.handler.call(_2)}),i}function _6(t,e){var i=$.inArray(e,t);return i>=0&&t.splice(i,1),t}var _3=$.data(_2,"pagination"),_4=_3.options,bb=_3.bb={},_5=$(_2).addClass("pagination").html('<table cellspacing="0" cellpadding="0" border="0"><tr></tr></table>'),tr=_5.find("tr"),aa=$.extend([],_4.layout);_4.showPageList||_6(aa,"list"),_4.showRefresh||_6(aa,"refresh"),"sep"==aa[0]&&aa.shift(),"sep"==aa[aa.length-1]&&aa.pop();for(var _7=0;_7<aa.length;_7++){var _8=aa[_7];if("list"==_8){var ps=$('<select class="pagination-page-list"></select>');ps.bind("change",function(){_4.pageSize=parseInt($(this).val()),_4.onChangePageSize.call(_2,_4.pageSize),_10(_2,_4.pageNumber)});for(var i=0;i<_4.pageList.length;i++)$("<option></option>").text(_4.pageList[i]).appendTo(ps);$("<td></td>").append(ps).appendTo(tr)}else"sep"==_8?$('<td><div class="pagination-btn-separator"></div></td>').appendTo(tr):"first"==_8?bb.first=_9("first"):"prev"==_8?bb.prev=_9("prev"):"next"==_8?bb.next=_9("next"):"last"==_8?bb.last=_9("last"):"manual"==_8?($('<span style="padding-left:6px;"></span>').html(_4.beforePageText).appendTo(tr).wrap("<td></td>"),bb.num=$('<input class="pagination-num" type="text" value="1" size="2">').appendTo(tr).wrap("<td></td>"),bb.num.unbind(".pagination").bind("keydown.pagination",function(t){if(13==t.keyCode){var e=parseInt($(this).val())||1;return _10(_2,e),!1}}),bb.after=$('<span style="padding-right:6px;"></span>').appendTo(tr).wrap("<td></td>")):"refresh"==_8?bb.refresh=_9("refresh"):"links"==_8&&$('<td class="pagination-links"></td>').appendTo(tr)}if(_4.buttons)if($('<td><div class="pagination-btn-separator"></div></td>').appendTo(tr),$.isArray(_4.buttons))for(var i=0;i<_4.buttons.length;i++){var _b=_4.buttons[i];if("-"==_b)$('<td><div class="pagination-btn-separator"></div></td>').appendTo(tr);else{var td=$("<td></td>").appendTo(tr),a=$('<a href="javascript:void(0)"></a>').appendTo(td);a[0].onclick=eval(_b.handler||function(){}),a.linkbutton($.extend({},_b,{plain:!0}))}}else{var td=$("<td></td>").appendTo(tr);$(_4.buttons).appendTo(td).show()}$('<div class="pagination-info"></div>').appendTo(_5),$('<div style="clear:both;"></div>').appendTo(_5)}function _10(t,e){var i=$.data(t,"pagination").options;_14(t,{pageNumber:e}),i.onSelectPage.call(t,i.pageNumber,i.pageSize)}function _14(t,e){var i=$.data(t,"pagination"),n=i.options,a=i.bb;$.extend(n,e||{});var r=$(t).find("select.pagination-page-list");r.length&&(r.val(n.pageSize+""),n.pageSize=parseInt(r.val()));var s=Math.ceil(n.total/n.pageSize)||1;n.pageNumber<1&&(n.pageNumber=1),n.pageNumber>s&&(n.pageNumber=s),0==n.total&&(n.pageNumber=0,s=0),a.num&&a.num.val(n.pageNumber),a.after&&a.after.html(n.afterPageText.replace(/{pages}/,s));var o=$(t).find("td.pagination-links");if(o.length){o.empty();var l=n.pageNumber-Math.floor(n.links/2);l<1&&(l=1);var d=l+n.links-1;d>s&&(d=s),(l=d-n.links+1)<1&&(l=1);for(var h=l;h<=d;h++){var c=$('<a class="pagination-link" href="javascript:void(0)"></a>').appendTo(o);c.linkbutton({plain:!0,text:h}),h==n.pageNumber?c.linkbutton("select"):c.unbind(".pagination").bind("click.pagination",{pageNumber:h},function(e){_10(t,e.data.pageNumber)})}}var u=n.displayMsg;u=(u=(u=u.replace(/{from}/,0==n.total?0:n.pageSize*(n.pageNumber-1)+1)).replace(/{to}/,Math.min(n.pageSize*n.pageNumber,n.total))).replace(/{total}/,n.total),$(t).find("div.pagination-info").html(u),a.first&&a.first.linkbutton({disabled:!n.total||1==n.pageNumber}),a.prev&&a.prev.linkbutton({disabled:!n.total||1==n.pageNumber}),a.next&&a.next.linkbutton({disabled:n.pageNumber==s}),a.last&&a.last.linkbutton({disabled:n.pageNumber==s}),_1d(t,n.loading)}function _1d(t,e){var i=$.data(t,"pagination"),n=i.options;n.loading=e,n.showRefresh&&i.bb.refresh&&i.bb.refresh.linkbutton({iconCls:n.loading?"pagination-loading":"pagination-load"})}$.fn.pagination=function(t,e){return"string"==typeof t?$.fn.pagination.methods[t](this,e):(t=t||{},this.each(function(){var e,i=$.data(this,"pagination");i?e=$.extend(i.options,t):(e=$.extend({},$.fn.pagination.defaults,$.fn.pagination.parseOptions(this),t),$.data(this,"pagination",{options:e})),_1(this),_14(this)}))},$.fn.pagination.methods={options:function(t){return $.data(t[0],"pagination").options},loading:function(t){return t.each(function(){_1d(this,!0)})},loaded:function(t){return t.each(function(){_1d(this,!1)})},refresh:function(t,e){return t.each(function(){_14(this,e)})},select:function(t,e){return t.each(function(){_10(this,e)})}},$.fn.pagination.parseOptions=function(_28){var t=$(_28);return $.extend({},$.parser.parseOptions(_28,[{total:"number",pageSize:"number",pageNumber:"number",links:"number"},{loading:"boolean",showPageList:"boolean",showRefresh:"boolean"}]),{pageList:t.attr("pageList")?eval(t.attr("pageList")):undefined})},$.fn.pagination.defaults={total:1,pageSize:10,pageNumber:1,pageList:[10,20,30,50],loading:!1,buttons:null,showPageList:!0,showRefresh:!0,links:10,layout:["list","sep","first","prev","sep","manual","sep","next","last","sep","refresh"],onSelectPage:function(t,e){},onBeforeRefresh:function(t,e){},onRefresh:function(t,e){},onChangePageSize:function(t){},beforePageText:"Page",afterPageText:"of {pages}",displayMsg:"Displaying {from} to {to} of {total} items",nav:{first:{iconCls:"pagination-first",handler:function(){$(this).pagination("options").pageNumber>1&&$(this).pagination("select",1)}},prev:{iconCls:"pagination-prev",handler:function(){var t=$(this).pagination("options");t.pageNumber>1&&$(this).pagination("select",t.pageNumber-1)}},next:{iconCls:"pagination-next",handler:function(){var t=$(this).pagination("options"),e=Math.ceil(t.total/t.pageSize);t.pageNumber<e&&$(this).pagination("select",t.pageNumber+1)}},last:{iconCls:"pagination-last",handler:function(){var t=$(this).pagination("options"),e=Math.ceil(t.total/t.pageSize);t.pageNumber<e&&$(this).pagination("select",e)}},refresh:{iconCls:"pagination-refresh",handler:function(){var t=$(this).pagination("options");0!=t.onBeforeRefresh.call(this,t.pageNumber,t.pageSize)&&($(this).pagination("select",t.pageNumber),t.onRefresh.call(this,t.pageNumber,t.pageSize))}}}}}),define("app/widgets/treegrid/app-datagrid",["app/core/app-jquery","app/core/app-core","app/core/app-options","jquery/jquery-ui","app/widgets/app-widget","app/widgets/panel/app-panel","app/widgets/treegrid/app-pagination"],function($,$A,Opts,resizable,Widget,Panel){function addArrayMap(t,e,i){for(var n=0,a=t.length;n<a;n++)if(t[n][e]==i[e])return;t.push(i)}function removeArrayMap(t,e,i){if("string"==typeof e){for(var n=0,a=t.length;n<a;n++)if(t[n][e]==i)return void t.splice(n,1)}else{var r=_2(t,e);-1!=r&&t.splice(r,1)}}function createEditors(t){var e={};return $.map(t,function(t){e[t]=function(t){function e(e){return $.data($(e)[0],t)!=undefined}return{init:function(e,i){var n=$('<input type="text" class="datagrid-editable-input" width="100%">').appendTo(e);return n[t]&&"text"!=t?(n[t](i),n):n},destroy:function(i){e(i)&&$(i)[t]("destroy")},getValue:function(i){if(e(i)){var n=$(i)[t]("options");return n.multiple?$(i)[t]("getValues").join(n.separator):$(i)[t]("getValue")}return $(i).val()},setValue:function(i,n){if(e(i)){var a=$(i)[t]("options");a.multiple?n?$(i)[t]("setValues",n.split(a.separator)):$(i)[t]("clear"):$(i)[t]("setValue",n)}else $(i).val()},resize:function(i,n){e(i)?$(i)[t]("resize",n):$(i)._outerWidth(n)._outerHeight(22)}}}(t)}),e}function getGridDom(t){return $(t).closest("div.datagrid-view").children(".datagrid-f")[0]}function getHeaderOverEvent(t){return function(e){var i=$(e.target).closest("td[field]");if(i.length){var n=getGridDom(i);!$(n).data("datagrid").resizing&&t?i.addClass("datagrid-header-over"):i.removeClass("datagrid-header-over")}}}function headerClickEvent(t){var e=getGridDom(t.target),i=$(e).datagrid("options"),n=$(t.target).closest("input[type=checkbox]");if(n.length){if(i.singleSelect&&i.selectOnCheck)return!1;n.is(":checked")?$(e).datagrid("checkAll"):$(e).datagrid("uncheckAll"),t.stopPropagation()}else{var a=$(t.target).closest(".datagrid-cell");if(a.length){var r=a.offset().left+5,s=a.offset().left+a._outerWidth()-5;t.pageX<s&&t.pageX>r&&$(e).datagrid("sort",a.parent().attr("field"))}}}function headerDblclick(t){var e=getGridDom(t.target),i=$(e).datagrid("options"),n=$(t.target).closest(".datagrid-cell");if(n.length){var a=n.offset().left+5,r=n.offset().left+n._outerWidth()-5;if("right"==i.resizeHandle?t.pageX>r:"left"==i.resizeHandle?t.pageX<a:t.pageX<a||t.pageX>r){var s=n.parent().attr("field"),o=$(e).datagrid("getColumnOption",s);if(0==o.resizable)return;$(e).datagrid("autoSizeColumn",s),o.auto=!1}}}function headerContextmenuEvent(t){var e=getGridDom(t.target),i=$(e).datagrid("options"),n=$(t.target).closest("td[field]");i.onHeaderContextMenu.call(e,t,n.attr("field"))}function getGridRowDom(t,e){var i=$(t).closest(e||"tr.datagrid-row");return i.length&&i.parent().length?i:undefined}function getRowIndex(t){return t.attr("datagrid-row-index")?parseInt(t.attr("datagrid-row-index")):t.attr("node-id")}function getCellOverEvent(t){return function(t){var e=getGridRowDom(t.target);if(e){var i=getGridDom(e);if(!$.data(i,"datagrid").resizing){var n=getRowIndex(e);if(n)rowOver(i,n);else{$.data(i,"datagrid").options.finder.getTr(i,n).removeClass("datagrid-row-over")}}}}}function rowOver(t,e){var i=$.data(t,"datagrid"),n=i.options;n.finder.getTr(t,i.highlightIndex).removeClass("datagrid-row-over"),n.finder.getTr(t,e).addClass("datagrid-row-over"),i.highlightIndex=e}function bodyCellClickEvent(t){var e=getGridRowDom(t.target);if(e){var i=getGridDom(e),n=$.data(i,"datagrid").options,a=$.data(i,"datagridObj"),r=getRowIndex(e),s=n.finder.getRow(r),o=$(t.target),l=o.closest("a.rowBtn");if(l.length>0)a.operator[l.attr("id")].call(this,s);else if(o.parent().hasClass("datagrid-cell-check"))n.singleSelect&&n.selectOnCheck?(o.attr("checked",!o.is(":checked")),a.checkRow(r)):o.is(":checked")?(o.attr("checked",!1),a.checkRow(r)):(o.attr("checked",!0),a.uncheckRow(r));else{var d=o.closest("td[field]",e);if(d.length){var h=d.attr("field");a.trigger("onClickCell",r,h,s[h])}if(1==n.singleSelect)a.selectRow(r);else if(n.ctrlSelect)if(t.ctrlKey)e.hasClass("datagrid-row-selected")?a.unselectRow(r):a.selectRow(r);else if(t.shiftKey){$(i).datagrid("clearSelections");for(var c=Math.min(n.lastSelectedIndex||0,r),u=Math.max(n.lastSelectedIndex||0,r),p=c;p<=u;p++)_a5(i,p)}else $(i).datagrid("clearSelections"),a.selectRow(r),n.lastSelectedIndex=r;else e.hasClass("datagrid-row-selected")?a.unselectRow(r):a.selectRow(r);a.trigger("onClickRow",getRowParam(i,[r,s]))}}}function bodyCellDbClickEvent(t){var e=getGridRowDom(t.target);if(e){var i=getGridDom(e),n=$.data(i,"datagrid").options,a=$.data(i,"datagridObj"),r=getRowIndex(e),s=n.finder.getRow(r),o=$(t.target).closest("td[field]",e);if(o.length){var l=o.attr("field");a.trigger("onDblClickCell",r,l,s[l])}a.trigger("onDblClickRow",getRowParam(i,[r,s]))}}function bodyContextmenuEvent(t){var e=getGridRowDom(t.target);if(e||(e=getGridRowDom(t.target,".datagrid-body")),e){var i=getGridDom(e),n=$.data(i,"datagrid").options,a=$.data(i,"datagridObj"),r=getRowIndex(e),s=n.finder.getRow(r);a.trigger("onRowContextMenu",t,r,s)}}function getRowParam(t,e){return $.data(t,"treegrid")?e.slice(1):e}var _1=0,findArrayIndex=function(t,e){for(var i=0,n=t.length;i<n;i++)if(t[i]==e)return i;return-1},DataGrid=Widget.extend({operator:{},initColumnButton:function(t){if(t)for(var e=0;e<t.length;e++)for(var i=0;i<t[e].length;i++){var n=t[e][i];if(n.buttons)for(var a=0;a<n.buttons.length;a++){var r=n.buttons[a];this.operator[r.id]=r.handler}}},initialize:function(t,e){var i,n=$.data(t,"datagrid");if(this.element=t,n)i=$.extend(n.options,e),n.options=i;else{i=$.extend({},$.extend({},DataGrid.defaults,{queryParams:{}}),DataGrid.parseOptions(t),e),$(this).css("width","").css("height","");var a=this.wrapGrid(i.rownumbers);i.view||(i.view=new GridView(this)),i.columns||(i.columns=a.columns),i.frozenColumns||(i.frozenColumns=a.frozenColumns),i.columns=$.extend(!0,[],i.columns),i.frozenColumns=$.extend(!0,[],i.frozenColumns),i.view=$.extend({},i.view),this.initColumnButton(i.columns),this.initColumnButton(i.frozenColumns),$.data(t,"datagrid",{options:i,panel:a.panel,dc:a.dc,ss:null,selectedRows:[],checkedRows:[],data:{total:0,rows:[]},originalRows:[],updatedRows:[],insertedRows:[],deletedRows:[]})}if(this.render(),this.renderGridWarp(),this.resize(),i.data)this.loadData(i.data),this.clearEditData();else{(n=this.parseData()).total>0&&(this.loadData(n),this.clearEditData())}i.autoLoad&&this.load(),DataGrid.superclass.initialize.call(this,i),this.addEvents("onLoadSuccess","onLoadError","onBeforeLoad","onClickRow","onDblClickRow","onClickCell","onDblClickCell","onSortColumn","onResizeColumn","onSelect","onUnselect","onSelectAll","onUnselectAll","onCheck","onUncheck","onCheckAll","onUncheckAll","onBeforeEdit","onAfterEdit","onCancelEdit","onHeaderContextMenu","onAfterRender","onRowContextMenu")},registerEvent:function(t){for(var e=[],i=0;i<e.length;i++)t[e[i]]&&this.on(e[i],t[e[i]])},getPager:function(){return $.data(this.element,"datagrid").panel.children("div.datagrid-pager")},setSelectionState:function(){function t(t,e){for(var i=0;i<t.length;i++)if(t[i][n.idField]==e[n.idField])return t[i]=e,!0;return!1}var e=this.element,i=$.data(e,"datagrid"),n=i.options,a=i.dc;if(a.header1.add(a.header2).find("input[type=checkbox]").attr("checked",!1),n.idField){var r=!!$.data(e,"treegrid"),s=n.onSelect,o=n.onCheck;n.onSelect=n.onCheck=function(){};for(var l=n.finder.getRows.call(this,e),d=0;d<l.length;d++){var h=l[d],c=r?h[n.idField]:d;t(i.selectedRows,h)&&this.selectRow(c,!0),t(i.checkedRows,h)&&this.checkRow(c,!0)}n.onSelect=s,n.onCheck=o}},parseData:function(){var t=$(this.element),e={total:0,rows:[]},i=this.getColumnFields(!0).concat(this.getColumnFields(!1));return t.find("tbody tr").each(function(){e.total++;var t={};$.extend(t,$.fn.parseOptions(this,["iconCls","state"]));for(var n=0;n<i.length;n++)t[i[n]]=$(this).find("td:eq("+n+")").html();e.rows.push(t)}),e},setViewSize:function(){var t=this.element,e=$.data(t,"datagrid"),i=e.options,n=e.dc,a=e.panel,r=a.width(),s=a.height(),o=n.view,l=n.view1,d=n.view2,h=l.children("div.datagrid-header"),c=d.children("div.datagrid-header"),u=h.find("table"),p=c.find("table");o.width(r);var f=h.children("div.datagrid-header-inner").show();l.width(f.find("table").width()),i.showHeader||f.hide(),d.width(r-l._outerWidth()),l.children("div.datagrid-header,div.datagrid-body,div.datagrid-footer").width(l.width()),d.children("div.datagrid-header,div.datagrid-body,div.datagrid-footer").width(d.width());var g;h.add(c).css("height",""),u.add(p).css("height",""),g=Math.max(u.height(),p.height()),u.add(p).height(g),h.add(c)._outerHeight(g),n.body1.add(n.body2).children("table.datagrid-btable-frozen").css({position:"absolute",top:n.header2._outerHeight()});var m=n.body2.children("table.datagrid-btable-frozen")._outerHeight(),v=m+d.children("div.datagrid-header")._outerHeight()+d.children("div.datagrid-footer")._outerHeight()+a.children("div.datagrid-toolbar")._outerHeight();a.children("div.datagrid-pager").each(function(){v+=$(this)._outerHeight()});var b=a.outerHeight()-a.height(),y=a._size("minHeight")||"",w=a._size("maxHeight")||"";l.add(d).children("div.datagrid-body").css({marginTop:m,height:isNaN(parseInt(i.height))?"":s-v,minHeight:y?y-b-v:"",maxHeight:w?w-b-v:""}),o.height(d.height())},loading:function(t){var e=$.data(this.element,"datagrid").options;if(this.getPager().pagination("loading"),e.loadMsg){var i=this.getPanel();if(!i.children("div.datagrid-mask").length){$('<div class="datagrid-mask" style="display:block"></div>').appendTo(i);var n=$('<div class="datagrid-mask-msg" style="display:block;left:50%"></div>').html(e.loadMsg).appendTo(i);n._outerHeight(40),n.css({marginLeft:-n.outerWidth()/2,lineHeight:n.height()+"px"})}}},options:function(){var t=$.data(this.element,"datagrid").options,e=$.data(this.element,"datagrid").panel.panel("options");return $.extend(t,{width:e.width,height:e.height,closed:e.closed,collapsed:e.collapsed,minimized:e.minimized,maximized:e.maximized})},getPanel:function(){return $.data(this.element,"datagrid").panel},reload:function(t){var e=$(this.element).datagrid("options");"string"==typeof t&&(e.url=t,t=null),this.load(t)},reloadFooter:function(t){var e=$.data(this.element,"datagrid").options,i=$.data(this.element,"datagrid").dc;t&&($.data(this.element,"datagrid").footer=t),e.showFooter&&(e.view.renderFooter.call(e.view,this,i.footer2,!1),e.view.renderFooter.call(e.view,this,i.footer1,!0),e.view.onAfterRender&&e.view.onAfterRender.call(e.view,this),this.fixRowHeight())},loaded:function(){this.getPager().pagination("loaded");var t=this.getPanel();t.children("div.datagrid-mask-msg").remove(),t.children("div.datagrid-mask").remove()},freezeRow:function(t){function e(t){var e=t?1:2,n=a.finder.getTr(i,_49,"body",e);(t?r.body1:r.body2).children("table.datagrid-btable-frozen").append(n)}var i=this.element,n=$.data(i,"datagrid"),a=n.options,r=n.dc;r.body2.children("table.datagrid-btable-frozen").length||r.body1.add(r.body2).prepend('<table class="datagrid-btable datagrid-btable-frozen" cellspacing="0" cellpadding="0"></table>'),e(!0),e(!1),this.setViewSize()},autoSizeColumn:function(t){function e(t){function e(e){function r(t){return t.is(":visible")?t._outerWidth():o.html(t.html())._outerWidth()}var s=0;return"header"==e?s=r(n):a.finder.getTr(i,0,e).find('td[field="'+t+'"] div.datagrid-cell').each(function(){var t=r($(this));s<t&&(s=t)}),s}var n=r.view.find('div.datagrid-header td[field="'+t+'"] div.datagrid-cell');n.css("width","");var l=s.getColumnOption(t);l.width=undefined,l.boxWidth=undefined,l.auto=!0,s.fixColumnSize(t);var d=Math.max(e("header"),e("allbody"),e("allfooter"))+1;n._outerWidth(d-1),l.width=d,l.boxWidth=parseInt(n[0].style.width),l.deltaWidth=d-l.boxWidth,n.css("width",""),s.fixColumnSize(t),a.onResizeColumn.call(i,t,l.width)}var i=this.element,n=$.data(i,"datagrid"),a=n.options,r=n.dc,s=this,o=$('<div class="datagrid-cell" style="position:absolute;left:-9999px"></div>').appendTo("body");if(t)e(t),a.fitColumns&&(this.setViewSize(),this.fitColumns());else{for(var l=!1,d=this.getColumnFields(!0).concat(this.getColumnFields(!1)),h=0;h<d.length;h++){t=d[h];this.getColumnOption(t).auto&&(e(t),l=!0)}l&&a.fitColumns&&(this.setViewSize(),this.fitColumns())}o.remove()},getData:function(){return $.data(this.element,"datagrid").data},getRows:function(){return $.data(this.element,"datagrid").data.rows},getFooterRows:function(){return $.data(this.element,"datagrid").footer},getRowIndex:function(t){var e=$.data(this.element,"datagrid"),i=e.options,n=e.data.rows;if("object"==typeof row)return findArrayIndex(n,row);for(var a=0;a<n.length;a++)if(n[a][i.idField]==row)return a;return-1},getChecked:function(){var t=$.data(this.element,"datagrid"),e=t.options;if(e.idField)return t.checkedRows;var i=[];return e.finder.getTr(_f9,"","checked",2).each(function(){i.push(e.finder.getRow(_f9,$(this)))}),i},getSelected:function(){var t=this.getSelections();return t.length>0?t[0]:null},getSelections:function(){var t=$.data(this.element,"datagrid"),e=t.options;t.data;if(e.idField)return t.selectedRows;var i=[];return e.finder.getTr(_f3,"","selected",2).each(function(){i.push(e.finder.getRow(_f3,$(this)))}),i},clearSelections:function(){var t=$.data(this.element,"datagrid"),e=t.selectedRows,i=t.checkedRows;e.splice(0,e.length),_10e(this),t.options.checkOnSelect&&i.splice(0,i.length)},clearChecked:function(){var t=$.data(this.element,"datagrid"),e=t.selectedRows,i=t.checkedRows;i.splice(0,i.length),this.uncheckAll(),t.options.selectOnCheck&&e.splice(0,e.length)},scrollTo:function(t){var e=$.data(this.element,"datagrid"),i=e.dc,n=e.options.finder.getTr(this.element,t);if(n.length){if(n.closest("table").hasClass("datagrid-btable-frozen"))return;var a=i.view2.children("div.datagrid-header")._outerHeight(),r=i.body2,s=r.outerHeight(!0)-r.outerHeight(),o=n.position().top-a-s;o<0?r.scrollTop(r.scrollTop()+o):o+n._outerHeight()>r.height()-18&&r.scrollTop(r.scrollTop()+o+n._outerHeight()-r.height()+18)}},rowOver:function(t){var e=$.data(this.element,"datagrid"),i=e.options;i.finder.getTr(this.element,e.highlightIndex).removeClass("datagrid-row-over"),i.finder.getTr(this.element,t).addClass("datagrid-row-over"),e.highlightIndex=t},highlightRow:function(t){this.rowOver(t),this.scrollTo(t)},selectAll:function(){var t=this.element,e=$.data(this.element,"datagrid").options,i=e.finder.getRows.call(this,t),n=$.data(this.element,"datagrid").selectedRows;if(!_119&&e.checkOnSelect&&this.checkAll(!0),e.finder.getTr(this.element,"","allbody").addClass("datagrid-row-selected"),e.idField)for(var a=0;a<i.length;a++)removeArrayMap(n,e.idField,i[a]);this.trigger("onSelectAll",i)},unselectAll:function(t){var e=this.element,i=$.data(e,"datagrid").options,n=i.finder.getRows.call(this,e),a=$.data(e,"datagrid").selectedRows;if(!t&&i.checkOnSelect&&this.uncheckAll(!0),i.finder.getTr(e,"","selected").removeClass("datagrid-row-selected"),i.idField)for(var r=0;r<n.length;r++)removeArrayMap(a,i.idField,n[r][i.idField]);this.trigger("onUnselectAll",n)},selectRow:function(t,e){var i=this.element,n=$.data(i,"datagrid"),a=(n.dc,n.options),r=n.selectedRows;a.singleSelect&&(this.unselectAll(),r.splice(0,r.length)),!e&&a.checkOnSelect&&this.checkRow(t,!0);var s=a.finder.getRow.call(this,t);a.idField&&addArrayMap(r,a.idField,s),a.finder.getTr(i,t).addClass("datagrid-row-selected"),this.trigger("onSelect",t,s),this.scrollTo(t)},selectRecord:function(t){if($.data(this.element,"datagrid").options.idField){var e=_ed(this,t);e>=0&&this.selectRow(e)}},unselectRow:function(t,e){var i=this.element,n=$.data(i,"datagrid"),a=(n.dc,n.options),r=$.data(i,"datagrid").selectedRows;!e&&a.checkOnSelect&&this.uncheckRow(t,!0),a.finder.getTr(i,t).removeClass("datagrid-row-selected");var s=a.finder.getRow(this,i,t);a.idField&&removeArrayMap(r,a.idField,s[a.idField]),this.trigger("onUnselect",t,s)},checkRow:function(t,e){var i=this.element,n=$.data(i,"datagrid"),a=n.options;!e&&a.selectOnCheck&&this.selectRow(t,!0);var r=a.finder.getTr(i,t).addClass("datagrid-row-checked");if(r.find("div.datagrid-cell-check input[type=checkbox]").attr("checked",!0),(r=a.finder.getTr(i,"","checked",2)).length==a.finder.getRows.call(this,i).length){var s=n.dc;s.header1.add(s.header2).find("input[type=checkbox]").attr("checked",!0)}var o=a.finder.getRow.call(this,t);a.idField&&addArrayMap(n.checkedRows,a.idField,o),this.trigger("onCheck",t,o)},uncheckRow:function(t,e){var i=this.element,n=$.data(i,"datagrid"),a=n.options;!e&&a.selectOnCheck&&this.unselectRow(i,t,!0);a.finder.getTr(i,t).removeClass("datagrid-row-checked").find("div.datagrid-cell-check input[type=checkbox]").attr("checked",!1);var r=n.dc;r.header1.add(r.header2).find("input[type=checkbox]").attr("checked",!1);var s=a.finder.getRow.call(this,i,t);a.idField&&removeArrayMap(n.checkedRows,a.idField,s[a.idField]),this.trigger("onUncheck",t,s)},beginEdit:function(t){var e=this.element,i=$.data(e,"datagrid").options,n=i.finder.getTr(e,t),a=i.finder.getRow.call(this,t);n.hasClass("datagrid-row-editing")||0!=this.trigger("onBeforeEdit",t,a)&&(n.addClass("datagrid-row-editing"),this.showEditor(t),this.setEditorWidth(),n.find("div.datagrid-editable").each(function(){var t=$(this).parent().attr("field"),e=$.data(this,"datagrid.editor");e.actions.setValue(e.target,a[t])}),this.validateRow(t),this.trigger("onBeginEdit",t,a))},showEditor:function(t){var e=this.element,i=$.data(e,"datagrid").options;i.finder.getTr(e,_14f).children("td").each(function(){var t=$(this).find("div.datagrid-cell"),e=$(this).attr("field"),n=getColumnOption(e);if(n&&n.editor){var a,r;"string"==typeof n.editor?a=n.editor:(a=n.editor.type,r=n.editor.options);var s=i.editors[a];if(s){var o=t.html(),l=t._outerWidth();t.addClass("datagrid-editable"),t._outerWidth(l),t.html('<table border="0" cellspacing="0" cellpadding="1"><tr><td></td></tr></table>'),t.children("table").bind("click dblclick contextmenu",function(t){t.stopPropagation()}),$.data(t[0],"datagrid.editor",{actions:s,target:s.init(t.find("td"),r),field:e,type:a,oldHtml:o})}}}),this.fixRowHeight(_14f,!0)},endEdit:function(t,e){var i=this.element,n=$.data(i,"datagrid"),a=n.options,r=n.updatedRows,s=n.insertedRows,o=a.finder.getTr(i,t),l=a.finder.getRow.call(this,t);if(o.hasClass("datagrid-row-editing")){if(!e){if(!this.validateRow(t))return;var d=!1,h={};o.find("div.datagrid-editable").each(function(){var t=$(this).parent().attr("field"),e=$.data(this,"datagrid.editor"),i=e.actions.getValue(e.target);l[t]!=i&&(l[t]=i,d=!0,h[t]=i)}),d&&-1==_2(s,l)&&-1==_2(r,l)&&r.push(l),this.trigger("onEndEdit",t,l,h)}o.removeClass("datagrid-row-editing"),this.endEditRow(t),$(i).datagrid("refreshRow",t),e?this.trigger("onCancelEdit",t,l):this.trigger("onAfterEdit",t,l,h)}},endEditRow:function(t){var e=this.element;$.data(e,"datagrid").options.finder.getTr(e,_157).children("td").each(function(){var t=$(this).find("div.datagrid-editable");if(t.length){var e=$.data(t[0],"datagrid.editor");e.actions.destroy&&e.actions.destroy(e.target),t.html(e.oldHtml),$.removeData(t[0],"datagrid.editor"),t.removeClass("datagrid-editable"),t.css("width","")}})},cancelEdit:function(t){return this.endEdit(t,!0)},getEditors:function(t){var e=this.element,i=[];return $.data(e,"datagrid").options.finder.getTr(e,t).children("td").each(function(){var t=$(this).find("div.datagrid-editable");if(t.length){var e=$.data(t[0],"datagrid.editor");i.push(e)}}),i},getEditor:function(t){for(var e=this.getEditors(t.index!=undefined?t.index:t.id),i=0;i<e.length;i++)if(e[i].field==t.field)return e[i];return null},refreshRow:function(t){var e=$.data(this.element,"datagrid").options;e.view.refreshRow.call(e.view,this,t)},validateRow:function(t){var e=this.element,i=$.data(e,"datagrid").options.finder.getTr(e,t);if(!i.hasClass("datagrid-row-editing"))return!0;var n=i.find(".validatebox-text");n.validatebox("validate"),n.trigger("mouseleave");return 0==i.find(".validatebox-invalid").length},updateRow:function(t){var e=$.data(this.element,"datagrid").options;e.view.updateRow.call(e.view,this,t.index,t.row)},appendRow:function(t){var e=this.element,i=$.data(e,"datagrid").data,n=$.data(e,"datagrid").options.view,a=$.data(e,"datagrid").insertedRows;n.insertRow.call(n,null,t),a.push(t),$(e).datagrid("getPager").pagination("refresh",{total:i.total})},insertRow:function(t){var e=this.element,i=$.data(e,"datagrid").data,n=$.data(e,"datagrid").options.view,a=$.data(e,"datagrid").insertedRows;n.insertRow.call(n,t.index,t.row),a.push(t.row),$(e).datagrid("getPager").pagination("refresh",{total:i.total})},deleteRow:function(t){var e=this.element,i=$.data(e,"datagrid"),n=i.options,a=i.data,r=i.insertedRows,s=i.deletedRows;$(e).datagrid("cancelEdit",_163);var o=n.finder.getRow.call(this,e,_163);findArrayIndex(r,o)>=0?removeArrayMap(r,o):s.push(o),removeArrayMap(i.selectedRows,n.idField,o[n.idField]),removeArrayMap(i.checkedRows,n.idField,o[n.idField]),n.view.deleteRow.call(n.view,_163),"auto"==n.height&&this.fixRowHeight(),$(e).datagrid("getPager").pagination("refresh",{total:a.total})},getChanges:function(t){var e=this.element,i=$.data(e,"datagrid").insertedRows,n=$.data(e,"datagrid").deletedRows,a=$.data(e,"datagrid").updatedRows;if(!t){var r=[];return r=r.concat(i),r=r.concat(n),r=r.concat(a)}return"inserted"==t?i:"deleted"==t?n:"updated"==t?a:[]},acceptChanges:function(){for(var t=this.element,e=!0,i=0,n=$.data(t,"datagrid").data.rows.length;i<n;i++)validateRow(i)?$(t).datagrid("endEdit",i):e=!1;e&&clearEditData(t)},rejectChanges:function(t){},mergeCells:function(t){function e(t,e){for(var i=0;i<e;i++)t.hide(),t=t.next()}var i=this.element,n=$.data(i,"datagrid").options;if(t.type=t.type||"body",t.rowspan=t.rowspan||1,t.colspan=t.colspan||1,1!=t.rowspan||1!=t.colspan){var a=n.finder.getTr(i,t.index!=undefined?t.index:t.id,t.type);if(a.length){var r=a.find('td[field="'+t.field+'"]');r.attr("rowspan",t.rowspan).attr("colspan",t.colspan),r.addClass("datagrid-td-merged"),e(r.next(),t.colspan-1);for(var s=1;s<t.rowspan&&(a=a.next()).length;s++)e(r=a.find('td[field="'+t.field+'"]'),t.colspan);this.setCellWidth()}}},showColumn:function(t){this.getPanel().find('td[field="'+t+'"]').show(),this.getColumnOption(t).hidden=!1,this.fitColumns(t)},hideColumn:function(t){this.getPanel().find('td[field="'+t+'"]').hide(),this.getColumnOption(t).hidden=!0,this.fitColumns(t)},resize:function(t){var e=this.element,i=$.data(e,"datagrid"),n=i.options,a=i.panel;if(t&&$.extend(n,t),1==n.fit){var r=a.panel("panel").parent();n.width=r.width(),n.height=r.height()}a.panel("resize",n)},checkAll:function(){var t=this.element,e=$.data(t,"datagrid"),i=e.options,n=i.finder.getRows.call(this,t);!_12f&&i.selectOnCheck&&_117(t,!0);var a=e.dc,r=a.header1.add(a.header2).find("input[type=checkbox]"),s=i.finder.getTr(t,"","allbody").addClass("datagrid-row-checked").find("div.datagrid-cell-check input[type=checkbox]");if(r.add(s).attr("checked",!0),i.idField)for(var o=0;o<n.length;o++)addArrayMap(e.checkedRows,i.idField,n[o]);this.trigger("onCheckAll",n)},uncheckAll:function(t){var e=this.element,i=$.data(e,"datagrid"),n=i.options,a=n.finder.getRows.call(this,e);!t&&n.selectOnCheck&&_10e(e,!0);var r=i.dc,s=r.header1.add(r.header2).find("input[type=checkbox]"),o=n.finder.getTr(e,"","checked").removeClass("datagrid-row-checked").find("div.datagrid-cell-check input[type=checkbox]");if(s.add(o).attr("checked",!1),n.idField)for(var l=0;l<a.length;l++)removeArrayMap(i.checkedRows,n.idField,a[l][n.idField]);this.trigger("onUncheckAll",a)},sort:function(t){var e=this.element,i=$.data(e,"datagrid"),n=i.options;t=t||{};var a={sortName:n.sortName,sortOrder:n.sortOrder};"object"==typeof t&&$.extend(a,t);var r=[],s=[];if(a.sortName&&(r=a.sortName.split(","),s=a.sortOrder.split(",")),"string"==typeof t){var o=t;if(!(p=this.getColumnOption(o)).sortable||i.resizing)return;var l=p.colOrder||"asc",d=findArrayIndex(r,o);if(d>=0){s="asc"==s[d]?"desc":"asc";n.multiSort&&s==l?(r.splice(d,1),s.splice(d,1)):s[d]=s}else n.multiSort?(r.push(o),s.push(l)):(r=[o],s=[l]);a.sortName=r.join(","),a.sortOrder=s.join(",")}if(0!=this.trigger("onBeforeSortColumn",a.sortName,a.sortOrder)){$.extend(n,a);var h=i.dc,c=h.header1.add(h.header2);c.find("div.datagrid-cell").removeClass("datagrid-sort-asc datagrid-sort-desc");for(var u=0;u<r.length;u++){var p=this.getColumnOption(r[u]);c.find("div."+p.cellClass).addClass("datagrid-sort-"+s[u])}n.remoteSort?this.load():this.loadData($(e).datagrid("getData")),this.trigger("onSortColumn",n.sortName,n.sortOrder)}},renderGridWarp:function(){var t=$.data(this.element,"datagrid"),e=t.panel,i=t.options,n=t.dc,a=n.header1.add(n.header2),r=this;a.unbind(".datagrid");for(var s in i.headerEvents)a.bind(s+".datagrid",i.headerEvents[s]);var o=a.find("div.datagrid-cell"),l="right"==i.resizeHandle?"e":"left"==i.resizeHandle?"w":"e,w";o.each(function(){$(this).resizable({handles:l,disabled:!!$(this).attr("resizable")&&"false"==$(this).attr("resizable"),minWidth:25,start:function(i){t.resizing=!0,a.css("cursor",$("body").css("cursor")),t.proxy||(t.proxy=$('<div class="datagrid-resize-proxy"></div>').appendTo(n.view)),t.proxy.css({left:i.pageX-$(e).offset().left-1,display:"none"}),setTimeout(function(){t.proxy&&t.proxy.show()},500)},resize:function(i){return t.proxy.css({left:i.pageX-$(e).offset().left-1,display:"block"}),!1},stop:function(e){a.css("cursor",""),$(this).css("height","");var i=$(this).parent().attr("field"),n=r.getColumnOption(i);n.width=$(this)._outerWidth(),n.boxWidth=n.width-n.deltaWidth,n.auto=undefined,$(this).css("width",""),r.fixColumnSize(i),t.proxy.remove(),t.proxy=null,$(this).parents("div:first.datagrid-header").parent().hasClass("datagrid-view1")&&r.setViewSize(),r.fitColumns(),r.trigger("onResizeColumn",i,n.width),setTimeout(function(){t.resizing=!1},0)}})});var d=n.body1.add(n.body2);d.unbind();for(var s in i.rowEvents)d.bind(s,i.rowEvents[s]);n.body1.bind("mousewheel DOMMouseScroll",function(t){t.preventDefault();var e=t.originalEvent||window.event,i=e.wheelDelta||-1*e.detail;"deltaY"in e&&(i=-1*e.deltaY);var n=$(t.target).closest("div.datagrid-view").children(".datagrid-f").data("datagrid").dc;n.body2.scrollTop(n.body2.scrollTop()-i)}),n.body2.bind("scroll",function(){var t=n.view1.children("div.datagrid-body");t.scrollTop($(this).scrollTop());var e=n.body1.children(":first"),i=n.body2.children(":first");if(e.length&&i.length){var a=e.offset().top,r=i.offset().top;a!=r&&t.scrollTop(t.scrollTop()+a-r)}n.view2.children("div.datagrid-header,div.datagrid-footer")._scrollLeft($(this)._scrollLeft()),n.body2.children("table.datagrid-btable-frozen").css("left",-$(this)._scrollLeft())})},fixRowHeight:function(t,e){function i(t,e){for(var i=0;i<e.length;i++){t=$(t[i]),e=$(e[i]);t.css("height",""),e.css("height","");var n=Math.max(t.height(),e.height());t.css("height",n),e.css("height",n)}}var n=this.element,a=($.data(n,"datagrid").data.rows,$.data(n,"datagrid").options),r=$.data(n,"datagrid").dc;if(!r.body1.is(":empty")&&(!a.nowrap||a.autoRowHeight||e))if(t!=undefined){i(a.finder.getTr(n,t,"body",1),a.finder.getTr(n,t,"body",2))}else{if(i(a.finder.getTr(n,0,"allbody",1),a.finder.getTr(n,0,"allbody",2)),a.showFooter){i(a.finder.getTr(n,0,"allfooter",1),a.finder.getTr(n,0,"allfooter",2))}}if(this.setViewSize(),"auto"==a.height){var s=r.body1.parent(),o=r.body2,l=function(t){var e=0,i=0;return $(t).children().each(function(){var t=$(this);t.is(":visible")&&(i+=t._outerHeight(),e<t._outerWidth()&&(e=t._outerWidth()))}),{width:e,height:i}}(o),d=l.height;l.width>o.width()&&(d+=18),d-=parseInt(o.css("marginTop"))||0,s.height(d),o.height(d),r.view.height(r.view2.height())}r.body2.triggerHandler("scroll")},getColumnOption:function(t){function e(e){if(e)for(var i=0;i<e.length;i++)for(var n=e[i],a=0;a<n.length;a++){var r=n[a];if(r.field==t)return r}return null}var i=$.data(this.element,"datagrid").options,n=e(i.columns);return n||(n=e(i.frozenColumns)),n},setEditorWidth:function(){var t=this.element;$.data(t,"datagrid").dc.view.find("div.datagrid-editable").each(function(){var e=$(this),i=e.parent().attr("field"),n=$(t).datagrid("getColumnOption",i);e._outerWidth(n.boxWidth+n.deltaWidth-1);var a=$.data(this,"datagrid.editor");a.actions.resize&&a.actions.resize(a.target,e.width())})},setCellWidth:function(){var t=this.element;$.data(t,"datagrid").dc.view.find("td.datagrid-td-merged").each(function(){for(var t=$(this),e=t.attr("colspan")||1,i=this.getColumnOption(t.attr("field")),n=i.boxWidth+i.deltaWidth-1,a=1;a<e;a++)t=t.next(),n+=(i=this.getColumnOption(t.attr("field"))).boxWidth+i.deltaWidth;$(this).children("div.datagrid-cell")._outerWidth(n)})},fixColumnSize:function(t){function e(t){var e=i.getColumnOption(t);e.cellClass&&a.ss.set("."+e.cellClass,e.boxWidth?e.boxWidth+"px":"auto")}var i=this,n=this.element,a=$.data(n,"datagrid"),r=(a.options,a.dc.view.find("table.datagrid-btable,table.datagrid-ftable"));if(r.css("table-layout","fixed"),t)e(t);else for(var s=i.getColumnFields(!0).concat(i.getColumnFields(!1)),o=0;o<s.length;o++)e(s[o]);r.css("table-layout","auto"),this.setCellWidth(),this.fixRowHeight(),this.setEditorWidth()},fitColumns:function(){var t=this.element,e=$.data(t,"datagrid"),i=e.options,n=e.dc,a=this,r=n.view2.children("div.datagrid-header");n.body2.css("overflow-x",""),function(){var e=!1,r=a.getColumnFields(!0).concat(a.getColumnFields(!1));$.map(r,function(t){var r=a.getColumnOption(t);if(String(r.width||"").indexOf("%")>=0){var s=$.fn.parseValue("width",r.width,n.view,i.scrollbarSize)-r.deltaWidth;s>0&&(r.boxWidth=s,e=!0)}}),e&&_bb(t)}(),function(){if(i.fitColumns){e.leftWidth||(e.leftWidth=0);for(var t=0,n=[],s=a.getColumnFields(!1),o=0;o<s.length;o++){var l=a.getColumnOption(s[o]);(function(t){return!(String(t.width||"").indexOf("%")>=0)&&(!(t.hidden||t.checkbox||t.auto||t.fixed)||void 0)})(l)&&(t+=l.width,n.push({field:l.field,col:l,addingWidth:0}))}if(t){n[n.length-1].addingWidth-=e.leftWidth;var d=r.children("div.datagrid-header-inner").show(),h=r.width()-r.find("table").width()-i.scrollbarSize+e.leftWidth,c=h/t;for(i.showHeader||d.hide(),o=0;o<n.length;o++){var u=n[o],p=parseInt(u.col.width*c);u.addingWidth+=p,h-=p}for(n[n.length-1].addingWidth+=h,o=0;o<n.length;o++)(u=n[o]).col.boxWidth+u.addingWidth>0&&(u.col.boxWidth+=u.addingWidth,u.col.width+=u.addingWidth);e.leftWidth=h,a.fixColumnSize()}}}(),r.width()>=r.find("table").width()&&n.body2.css("overflow-x","hidden")},getColumnFields:function(t){var e=this.element,i=$.data(e,"datagrid").options,n=1==t?i.frozenColumns||[[]]:i.columns;if(0==n.length)return[];for(var a=[],r=function(){var t=0;return $.map(n[0],function(e){t+=e.colspan||1}),t}(),s=0;s<n.length;s++)a[s]=new Array(r);for(s=0;s<n.length;s++)$.map(n[s],function(t){var e=function(t){for(var e=0;e<t.length;e++)if(t[e]==undefined)return e;return-1}(a[s]);if(e>=0)for(var i=t.field||"",n=0;n<(t.colspan||1);n++){for(var r=0;r<(t.rowspan||1);r++)a[s+r][e]=i;e++}});return a[a.length-1]},loadData:function(t){var e=this.element,i=$.data(e,"datagrid"),n=i.options,a=i.dc;if(t=n.loadFilter.call(e,t),t.total=parseInt(t.total),i.data=t,t.footer&&(i.footer=t.footer),!n.remoteSort&&n.sortName){var r=n.sortName.split(","),s=n.sortOrder.split(",");t.rows.sort(function(t,i){for(var n=0,a=0;a<r.length;a++){var o=r[a],l=s[a];if(0!=(n=(getColumnOption(e,o).sorter||function(t,e){return t==e?0:t>e?1:-1})(t[o],i[o])*("asc"==l?1:-1)))return n}return n})}n.view.onBeforeRender&&n.view.onBeforeRender.call(n.view,t.rows),n.view.render.call(n.view,a.body2,!1),n.view.render.call(n.view,a.body1,!0),n.showFooter&&(n.view.renderFooter.call(n.view,a.footer2,!1),n.view.renderFooter.call(n.view,a.footer1,!0)),n.view.onAfterRender&&n.view.onAfterRender.call(n.view,e),i.ss.clean();var o=this.getPager();if(o.length){var l=o.pagination("options");l.total!=t.total&&(o.pagination("refresh",{total:t.total}),n.pageNumber!=l.pageNumber&&(n.pageNumber=l.pageNumber,load(e)))}this.fixRowHeight(),a.body2.triggerHandler("scroll"),this.setSelectionState(),this.autoSizeColumn(),this.trigger("onLoadSuccess",e,t)},load:function(t){var e=this.element,i=this,n=$.data(e,"datagrid").options;t&&(n.queryParams=t);var a=$.extend({},n.queryParams);n.pagination&&$.extend(a,{page:n.pageNumber,rows:n.pageSize}),n.sortName&&$.extend(a,{sort:n.sortName,order:n.sortOrder}),0!=this.trigger("onBeforeLoad",e,a)&&(this.loading(),setTimeout(function(){0==n.loader.call(i,a,function(t){setTimeout(function(){i.loaded()},0),loadData(t),setTimeout(function(){clearEditData()},0)},function(){setTimeout(function(){i.loaded()},0),i.trigger("onLoadError",e,arguments)})&&i.loaded()},0))},clearEditData:function(){for(var t=this.element,e=$.data(t,"datagrid"),i=e.data.rows,n=[],a=0;a<i.length;a++)n.push($.extend({},i[a]));e.originalRows=n,e.updatedRows=[],e.insertedRows=[],e.deletedRows=[]},createStyleSheet:function(){var t=this.element,e=$.data(t,"datagrid"),i=e.options,n=e.panel,a=e.dc,r=null;i.sharedStyleSheet?r="boolean"==typeof i.sharedStyleSheet?"head":i.sharedStyleSheet:(r=n.closest("div.datagrid-view")).length||(r=a.view);var s=$(r),o=$.data(s[0],"ss");return o||(o=$.data(s[0],"ss",{cache:{},dirty:[]})),{add:function(t){for(var e=['<style type="text/css" appui="true">'],i=0;i<t.length;i++)o.cache[t[i][0]]={width:t[i][1]};var n=0;for(var a in o.cache){var r=o.cache[a];r.index=n++,e.push(a+"{width:"+r.width+"}")}e.push("</style>"),$(e.join("\n")).appendTo(s),s.children("style[appui]:not(:last)").remove()},getRule:function(t){var e=s.children("style[appui]:last")[0],i=e.styleSheet?e.styleSheet:e.sheet||document.styleSheets[document.styleSheets.length-1];return(i.cssRules||i.rules)[t]},set:function(t,e){var i=o.cache[t];if(i){i.width=e;var n=this.getRule(i.index);n&&(n.style.width=e)}},remove:function(t){var e=[];for(var i in o.cache)-1==i.indexOf(t)&&e.push([i,o.cache[i].width]);o.cache={},this.add(e)},dirty:function(t){t&&o.dirty.push(t)},clean:function(){for(var t=0;t<o.dirty.length;t++)this.remove(o.dirty[t]);o.dirty=[]}}},render:function(){function createColumnHeader(t,e,i){if(e){$(t).show(),$(t).empty();var n=[],a=[];opts.sortName&&(n=opts.sortName.split(","),a=opts.sortOrder.split(","));for(var r=$('<table class="datagrid-htable" border="0" cellspacing="0" cellpadding="0"><tbody></tbody></table>').appendTo(t),s=0;s<e.length;s++)for(var o=$('<tr class="datagrid-header-row"></tr>').appendTo($("tbody",r)),l=e[s],d=0;d<l.length;d++){var h=l[d],c="";h.rowspan&&(c+='rowspan="'+h.rowspan+'" '),h.colspan&&(c+='colspan="'+h.colspan+'" ');var u=$("<td "+c+"></td>").appendTo(o);if(h.checkbox)u.attr("field",h.field),$('<div class="datagrid-header-check"></div>').html('<input type="checkbox"/>').appendTo(u);else if(h.field){u.attr("field",h.field),u.append('<div class="datagrid-cell"><span></span><span class="datagrid-sort-icon"></span></div>'),$("span",u).html(h.title),$("span.datagrid-sort-icon",u).html("&nbsp;");var p=u.find("div.datagrid-cell"),f=findArrayIndex(n,h.field);if(f>=0&&p.addClass("datagrid-sort-"+a[f]),0==h.resizable&&p.attr("resizable","false"),h.width){var g=$.fn.parseValue("width",h.width,dc.view,opts.scrollbarSize);p._outerWidth(g-1),h.boxWidth=parseInt(p[0].style.width),h.deltaWidth=g-h.boxWidth}else h.auto=!0;p.css("text-align",h.halign||h.align||""),h.cellClass=wrapdata.cellClassPrefix+"-"+h.field.replace(/[\.|\s]/g,"-"),p.addClass(h.cellClass).css("width","")}else $('<div class="datagrid-cell-group"></div>').html(h.title).appendTo(u);h.hidden&&u.hide()}if(i&&opts.rownumbers){u=$('<td rowspan="'+opts.frozenColumns.length+'"><div class="datagrid-header-rownumber"></div></td>');0==$("tr",r).length?u.wrap('<tr class="datagrid-header-row"></tr>').parent().appendTo($("tbody",r)):u.prependTo($("tr:first",r))}}}function createColumnCheckBox(){for(var t=[],e=_self.getColumnFields(!0).concat(_self.getColumnFields(gridEl)),i=0;i<e.length;i++){var n=_self.getColumnOption(e[i]);n&&!n.checkbox&&t.push(["."+n.cellClass,n.boxWidth?n.boxWidth+"px":"auto"])}wrapdata.ss.add(t),wrapdata.ss.dirty(wrapdata.cellSelectorPrefix),wrapdata.cellSelectorPrefix="."+wrapdata.cellClassPrefix}var wrapdata=$.data(this.element,"datagrid"),opts=wrapdata.options,_self=this,dc=wrapdata.dc,gridPanel=wrapdata.panel,gridEl=this.element;if(wrapdata.ss=this.createStyleSheet(),gridPanel.panel($.extend({},opts,{id:null,doSize:!1,onResize:function(t,e){setTimeout(function(){$.data(gridEl,"datagrid")&&(_self.setViewSize(),_self.fitColumns(),_self.trigger("onResize",gridPanel,t,e))},0)},onExpand:function(){fixRowHeight(gridEl),_self.trigger("onExpand",gridPanel)}})),wrapdata.rowIdPrefix="datagrid-row-r"+ ++_1,wrapdata.cellClassPrefix="datagrid-cell-c"+_1,createColumnHeader(dc.header1,opts.frozenColumns,!0),createColumnHeader(dc.header2,opts.columns,!1),createColumnCheckBox(),dc.header1.add(dc.header2).css("display",opts.showHeader?"block":"none"),dc.footer1.add(dc.footer2).css("display",opts.showFooter?"block":"none"),opts.toolbar)if($.isArray(opts.toolbar)){$("div.datagrid-toolbar",gridPanel).remove();for(var tb=$('<div class="datagrid-toolbar"><table cellspacing="0" cellpadding="0"><tr></tr></table></div>').prependTo(gridPanel),tr=tb.find("tr"),i=0;i<opts.toolbar.length;i++){var btn=opts.toolbar[i];if("-"==btn)$('<td><div class="datagrid-btn-separator"></div></td>').appendTo(tr);else{var td=$("<td></td>").appendTo(tr),btn=$('<a href="javascript:void(0)"></a>').appendTo(td);btn[0].onclick=eval(btn.handler||function(){}),btn.linkbutton($.extend({},btn,{plain:!0}))}}}else $(opts.toolbar).addClass("datagrid-toolbar").prependTo(gridPanel),$(opts.toolbar).show();else $("div.datagrid-toolbar",gridPanel).remove();if($("div.datagrid-pager",gridPanel).remove(),opts.pagination){var pagerDom=$('<div class="datagrid-pager"></div>');if("bottom"==opts.pagePosition)pagerDom.appendTo(gridPanel);else if("top"==opts.pagePosition)pagerDom.addClass("datagrid-pager-top").prependTo(gridPanel);else{var pagertop=$('<div class="datagrid-pager datagrid-pager-top"></div>').prependTo(gridPanel);pagerDom.appendTo(gridPanel),pagerDom=pagerDom.add(pagertop)}pagerDom.pagination({total:opts.pageNumber*opts.pageSize,pageNumber:opts.pageNumber,pageSize:opts.pageSize,pageList:opts.pageList,onSelectPage:function(t,e){opts.pageNumber=t,opts.pageSize=e,pagerDom.pagination("refresh",{pageNumber:t,pageSize:e}),load()}}),opts.pageSize=pagerDom.pagination("options").pageSize}},wrapGrid:function(rownumbers){function getColumns(){var frozenColumns=[],columns=[];return $this.children("thead").each(function(){var opt=$this.parseOptions(this,[{frozen:"boolean"}]);$(this).find("tr").each(function(){var column=[];$(this).find("th").each(function(){var th=$(this),col=$.extend({},th.parseOptions(this,["field","align","halign","order","width",{sortable:"boolean",checkbox:"boolean",resizable:"boolean",fixed:"boolean"},{rowspan:"number",colspan:"number"}]),{title:th.html()||undefined,hidden:!!th.attr("hidden")||undefined,formatter:th.attr("formatter")?eval(th.attr("formatter")):undefined,styler:th.attr("styler")?eval(th.attr("styler")):undefined,sorter:th.attr("sorter")?eval(th.attr("sorter")):undefined});if(col.width&&-1==String(col.width).indexOf("%")&&(col.width=parseInt(col.width)),th.attr("editor")){var s=$.trim(th.attr("editor"));"{"==s.substr(0,1)?col.editor=eval("("+s+")"):col.editor=s}column.push(col)}),opt.frozen?frozenColumns.push(column):columns.push(column)})}),[frozenColumns,columns]}var $this=$(this.element),wrap=$('<div class="datagrid-wrap"><div class="datagrid-view"><div class="datagrid-view1"><div class="datagrid-header"><div class="datagrid-header-inner"></div></div><div class="datagrid-body"><div class="datagrid-body-inner"></div></div><div class="datagrid-footer"><div class="datagrid-footer-inner"></div></div></div><div class="datagrid-view2"><div class="datagrid-header"><div class="datagrid-header-inner"></div></div><div class="datagrid-body"></div><div class="datagrid-footer"><div class="datagrid-footer-inner"></div></div></div></div></div>').insertAfter($this);wrap.panel({doSize:!1,cls:"datagrid"}),$($this).addClass("datagrid-f").hide().appendTo(wrap.children("div.datagrid-view"));var columns=getColumns(),gridViewWrap=wrap.children("div.datagrid-view"),gridViewWrap1=gridViewWrap.children("div.datagrid-view1"),gridViewWrap2=gridViewWrap.children("div.datagrid-view2");return{panel:wrap,frozenColumns:columns[0],columns:columns[1],dc:{view:gridViewWrap,view1:gridViewWrap1,view2:gridViewWrap2,header1:gridViewWrap1.children("div.datagrid-header").children("div.datagrid-header-inner"),header2:gridViewWrap2.children("div.datagrid-header").children("div.datagrid-header-inner"),body1:gridViewWrap1.children("div.datagrid-body").children("div.datagrid-body-inner"),body2:gridViewWrap2.children("div.datagrid-body"),footer1:gridViewWrap1.children("div.datagrid-footer").children("div.datagrid-footer-inner"),footer2:gridViewWrap2.children("div.datagrid-footer").children("div.datagrid-footer-inner")}}}}),GridView=Widget.extend({initialize:function(t){this.grid=t},getStyleValue:function(t){var e="",i="";return"string"==typeof t?i=t:t&&(e=t["class"]||"",i=t.style||""),{c:e,s:i}},render:function(t,e){var i=$.data(this.grid.element,"datagrid"),n=i.options,a=i.data.rows,r=this.grid.getColumnFields();if(!e||n.rownumbers||n.frozenColumns&&n.frozenColumns.length){for(var s=['<table class="datagrid-btable" cellspacing="0" cellpadding="0" border="0"><tbody>'],o=0;o<a.length;o++){var l=n.rowStyler?n.rowStyler.call(this.grid.element,o,a[o]):"",d="",h="";"string"==typeof l?h=l:l&&(d=l["class"]||"",h=l.style||"");var c='class="datagrid-row '+(o%2&&n.striped?"datagrid-row-alt ":" ")+d+'"',u=h?'style="'+h+'"':"",p=i.rowIdPrefix+"-"+(e?1:2)+"-"+o;s.push('<tr id="'+p+'" datagrid-row-index="'+o+'" '+c+" "+u+">"),s.push(this.renderRow.call(this,r,e,o,a[o])),s.push("</tr>")}s.push("</tbody></table>"),$(t).html(s.join(""))}},renderFooter:function(t,e){$.data(this.grid.element,"datagrid").options;for(var i=$.data(this.grid.element,"datagrid").footer||[],n=this.grid.getColumnFields(e),a=['<table class="datagrid-ftable" cellspacing="0" cellpadding="0" border="0"><tbody>'],r=0;r<i.length;r++)a.push('<tr class="datagrid-row" datagrid-row-index="'+r+'">'),a.push(this.renderRow.call(this,n,e,r,i[r])),a.push("</tr>");a.push("</tbody></table>"),$(t).html(a.join(""))},renderRow:function(t,e,i,n){var a=$.data(this.grid.element,"datagrid").options,r=[];if(e&&a.rownumbers){var s=i+1;a.pagination&&(s+=(a.pageNumber-1)*a.pageSize),r.push('<td class="datagrid-td-rownumber"><div class="datagrid-cell-rownumber">'+s+"</div></td>")}for(var o=0;o<t.length;o++){var l=t[o],d=this.grid.getColumnOption(l);if(d){var h=n[l],c=d.styler?d.styler(h,n,i)||"":"",u="",p="";"string"==typeof c?p=c:c&&(u=c["class"]||"",p=c.style||"");var f=u?'class="'+u+'"':"",g=d.hidden?'style="display:none;'+p+'"':p?'style="'+p+'"':"";r.push('<td field="'+l+'" '+f+" "+g+">");g="";d.checkbox||(d.align&&(g+="text-align:"+d.align+";"),a.nowrap?a.autoRowHeight&&(g+="height:auto;"):g+="white-space:normal;height:auto;"),r.push('<div style="'+g+'" '),r.push(d.checkbox?'class="datagrid-cell-check"':'class="datagrid-cell '+d.cellClass+'"'),r.push(">"),d.checkbox?(r.push('<input type="checkbox" '+(n.checked?'checked="checked"':"")),r.push(' name="'+l+'" value="'+(h!=undefined?h:"")+'">')):d.formatter?r.push(d.formatter(h,n,i)):r.push(h),r.push("</div>"),r.push("</td>")}}return r.join("")},refreshRow:function(t,e){this.updateRow.call(this,t,e,{})},updateRow:function(t,e,i){function n(t){var i=$(this.grid.element).datagrid("getColumnFields",t),n=a.finder.getTr(this.grid.element,e,"body",t?1:2),s=n.find("div.datagrid-cell-check input[type=checkbox]").is(":checked");n.html(this.renderRow.call(this,this.grid.element,i,t,e,r[e])),n.attr("style",l).attr("class",n.hasClass("datagrid-row-selected")?o+" datagrid-row-selected":o),s&&n.find("div.datagrid-cell-check input[type=checkbox]").attr("checked",!0)}var a=$.data(this.grid.element,"datagrid").options,r=$(this.grid.element).datagrid("getRows");$.extend(r[e],i);var s=a.rowStyler?a.rowStyler.call(this.grid.element,e,r[e]):"",o="",l="";"string"==typeof s?l=s:s&&(o=s["class"]||"",l=s.style||"");o="datagrid-row "+(e%2&&a.striped?"datagrid-row-alt ":" ")+o;n.call(this,!0),n.call(this,!1),this.grid.fixRowHeight(e)},insertRow:function(t,e){function i(e){for(var i=e?1:2,n=o.rows.length-1;n>=t;n--){var s=r.finder.getTr(this.grid.element,n,"body",i);if(s.attr("datagrid-row-index",n+1),s.attr("id",a.rowIdPrefix+"-"+i+"-"+(n+1)),e&&r.rownumbers){var l=n+2;r.pagination&&(l+=(r.pageNumber-1)*r.pageSize),s.find("div.datagrid-cell-rownumber").html(l)}r.striped&&s.removeClass("datagrid-row-alt").addClass((n+1)%2?"datagrid-row-alt":"")}}function n(e){var i=e?1:2,n=(this.grid.getColumnFields(e),'<tr id="'+(a.rowIdPrefix+"-"+i+"-"+t)+'" class="datagrid-row" datagrid-row-index="'+t+'"></tr>');if(t>=o.rows.length)if(o.rows.length)r.finder.getTr(this.grid.element,"","last",i).after(n);else{(e?s.body1:s.body2).html('<table cellspacing="0" cellpadding="0" border="0"><tbody>'+n+"</tbody></table>")}else r.finder.getTr(this.grid.element,t+1,"body",i).before(n)}var a=$.data(this.grid.element,"datagrid"),r=a.options,s=a.dc,o=a.data;t!=undefined&&null!=t||(t=o.rows.length),t>o.rows.length&&(t=o.rows.length),i.call(this,!0),i.call(this,!1),n.call(this,!0),n.call(this,!1),o.total+=1,o.rows.splice(t,0,e),this.refreshRow.call(this,this.grid.element,t)},deleteRow:function(t,e){function i(i){for(var s=i?1:2,o=e+1;o<r.rows.length;o++){var l=a.finder.getTr(t,o,"body",s);if(l.attr("datagrid-row-index",o-1),l.attr("id",n.rowIdPrefix+"-"+s+"-"+(o-1)),i&&a.rownumbers){var d=o;a.pagination&&(d+=(a.pageNumber-1)*a.pageSize),l.find("div.datagrid-cell-rownumber").html(d)}a.striped&&l.removeClass("datagrid-row-alt").addClass((o-1)%2?"datagrid-row-alt":"")}}var n=$.data(t,"datagrid"),a=n.options,r=n.data;a.finder.getTr(t,e).remove(),i.call(this,!0),i.call(this,!1),r.total-=1,r.rows.splice(e,1)},onBeforeRender:function(t,e){},onAfterRender:function(){if($.data(this.grid.element,"datagrid").options.showFooter){this.grid.getPanel().find("div.datagrid-footer").find("div.datagrid-cell-rownumber,div.datagrid-cell-check").css("visibility","hidden")}}}),editors=$.extend({},createEditors(["text","textbox","number","numberspinner","combobox","combotree","combogrid","datebox","datetimebox","timespinner","datetimespinner"]),{textarea:{init:function(t,e){return $('<textarea class="datagrid-editable-input"></textarea>').appendTo(t)},getValue:function(t){return $(t).val()},setValue:function(t,e){$(t).val(e)},resize:function(t,e){$(t)._outerWidth(e)}},checkbox:{init:function(t,e){var i=$('<input type="checkbox">').appendTo(t);return i.val(_1a8.on),i.attr("offval",_1a8.off),i},getValue:function(t){return $(t).is(":checked")?$(t).val():$(t).attr("offval")},setValue:function(t,e){var i=!1;$(t).val()==e&&(i=!0),$(t).attr("checked",i)}},validatebox:{init:function(t,e){var i=$('<input type="text" class="datagrid-editable-input">').appendTo(t);return i.validatebox(e),i},destroy:function(t){$(t).validatebox("destroy")},getValue:function(t){return $(t).val()},setValue:function(t,e){$(t).val(e)},resize:function(t,e){$(t)._outerWidth(e)._outerHeight(22)}},button:{init:function(t,e){var i=$("<a>[对象]</a>").appendTo(t);return i.button(e),i},destroy:function(t){},getValue:function(t,e,i){return e[i]},setValue:function(t,e){$(t).val(e)},resize:function(t,e){$(t)._outerWidth(e)._outerHeight(22)}}});return DataGrid.defaults=$.extend({},Opts.appDefaults.Pane,{sharedStyleSheet:!1,frozenColumns:undefined,columns:undefined,fitColumns:!1,resizeHandle:"right",autoRowHeight:!0,toolbar:null,striped:!1,method:"post",nowrap:!0,idField:null,url:null,data:null,loadMsg:"数据加载中 ...",rownumbers:!1,singleSelect:!1,ctrlSelect:!1,selectOnCheck:!0,checkOnSelect:!0,pagination:!1,pagePosition:"bottom",pageNumber:1,pageSize:10,pageList:[10,20,30,40,50],queryParams:{},sortName:null,sortOrder:"asc",multiSort:!1,remoteSort:!1,showHeader:!0,showFooter:!1,scrollbarSize:18,rowStyler:function(t,e){},headerEvents:{mouseover:getHeaderOverEvent(!0),mouseout:getHeaderOverEvent(!1),click:headerClickEvent,dblclick:headerDblclick,contextmenu:headerContextmenuEvent},rowEvents:{mouseover:getCellOverEvent(),mouseout:getCellOverEvent(),click:bodyCellClickEvent,dblclick:bodyCellDbClickEvent,contextmenu:bodyContextmenuEvent},loader:function(t,e,i){var n=this.options();if(!n.url)return!1;$.ajax({type:n.method,url:n.url,data:t,dataType:"json",success:function(t){e(t)},error:function(){i.apply(this,arguments)}})},loadFilter:function(t){return"number"==typeof t.length&&"function"==typeof t.splice?{total:t.length,rows:t}:t},editors:editors,finder:{getTr:function(t,e,i,n){i=i||"body",n=n||0;var a=$.data(t,"datagrid"),r=a.dc,s=a.options;if(0==n){var o=s.finder.getTr(t,e,i,1),l=s.finder.getTr(t,e,i,2);return o.add(l)}if("body"==i){var d=$("#"+a.rowIdPrefix+"-"+n+"-"+e);return d.length||(d=(1==n?r.body1:r.body2).find(">table>tbody>tr[datagrid-row-index="+e+"]")),d}return"footer"==i?(1==n?r.footer1:r.footer2).find(">table>tbody>tr[datagrid-row-index="+e+"]"):"selected"==i?(1==n?r.body1:r.body2).find(">table>tbody>tr.datagrid-row-selected"):"highlight"==i?(1==n?r.body1:r.body2).find(">table>tbody>tr.datagrid-row-over"):"checked"==i?(1==n?r.body1:r.body2).find(">table>tbody>tr.datagrid-row-checked"):"last"==i?(1==n?r.body1:r.body2).find(">table>tbody>tr[datagrid-row-index]:last"):"allbody"==i?(1==n?r.body1:r.body2).find(">table>tbody>tr[datagrid-row-index]"):"allfooter"==i?(1==n?r.footer1:r.footer2).find(">table>tbody>tr[datagrid-row-index]"):void 0},getRow:function(t){var e="object"==typeof t?t.attr("datagrid-row-index"):t;return $.data(this.element,"datagrid").data.rows[parseInt(e)]},getRows:function(){return $(this.element).datagrid("getRows")}},onBeforeLoad:function(t){},onLoadSuccess:function(){},onLoadError:function(){},onClickRow:function(t,e){},onDblClickRow:function(t,e){},onClickCell:function(t,e,i){},onDblClickCell:function(t,e,i){},onBeforeSortColumn:function(t,e){},onSortColumn:function(t,e){},onResizeColumn:function(t,e){},onResize:function(){},onSelect:function(t,e){},onUnselect:function(t,e){},onSelectAll:function(t){},onUnselectAll:function(t){},onCheck:function(t,e){},onUncheck:function(t,e){},onCheckAll:function(t){},onUncheckAll:function(t){},onBeforeEdit:function(t,e){},onBeginEdit:function(t,e){},onEndEdit:function(t,e,i){},onAfterEdit:function(t,e,i){},onCancelEdit:function(t,e){},onHeaderContextMenu:function(t,e){},onRowContextMenu:function(t,e,i){}}),DataGrid.parseOptions=function(gridDom){var t=$(gridDom);return $.extend({},Panel.parseOptions(gridDom),t.parseOptions(gridDom,["url","toolbar","idField","sortName","sortOrder","pagePosition","resizeHandle",{sharedStyleSheet:"boolean",fitColumns:"boolean",autoRowHeight:"boolean",striped:"boolean",nowrap:"boolean"},{rownumbers:"boolean",singleSelect:"boolean",ctrlSelect:"boolean",checkOnSelect:"boolean",selectOnCheck:"boolean"},{pagination:"boolean",pageSize:"number",pageNumber:"number"},{multiSort:"boolean",remoteSort:"boolean",showHeader:"boolean",showFooter:"boolean"},{scrollbarSize:"number"}]),{pageList:t.attr("pageList")?eval(t.attr("pageList")):undefined,loadMsg:t.attr("loadMsg")!=undefined?t.attr("loadMsg"):undefined,rowStyler:t.attr("rowStyler")?eval(t.attr("rowStyler")):undefined})},$.fn.datagrid=function(t,e){var i;return t=t||{},$set=this.each(function(){var n=$(this),a=$.data(this,"datagrid"),r=n.data("datagridObj");a?"object"==typeof t&&(opts=$.extend(a.options,t)):(t.element=this,r=new DataGrid(this,t),n.data("datagridObj",r)),"string"==typeof t&&(i=r[t](e))}),i===undefined?$set:i},DataGrid.GridView=GridView,DataGrid}),define("app/widgets/treegrid/app-treegrid",["app/core/app-jquery","app/core/app-core","app/core/app-options","jquery/jquery-ui","app/widgets/app-widget","app/widgets/treegrid/app-datagrid","app/data/app-ajax"],function(t,e,i,n,a,r,s){function o(e){return function(i){r.defaults.rowEvents[e?"mouseover":"mouseout"](i);var n=t(i.target),a=e?"addClass":"removeClass";n.hasClass("tree-hit")&&(n.hasClass("tree-expanded")?n[a]("tree-expanded-hover"):n[a]("tree-collapsed-hover"))}}var l={indexOfArray:function(t,e,i){for(var n=0,a=t.length;n<a;n++)if(i==undefined){if(t[n]==e)return n}else if(t[n][e]==i)return n;return-1},removeArrayItem:function(t,e,i){if("string"==typeof e){for(var n=0,a=t.length;n<a;n++)if(t[n][e]==i)return void t.splice(n,1)}else{var r=this.indexOfArray(t,e);-1!=r&&t.splice(r,1)}},addArrayItem:function(t,e,i){var n=this.indexOfArray(t,e,i?i[e]:undefined);-1==n?t.push(i||e):t[n]=i||e},getArrayItem:function(t,e,i){var n=this.indexOfArray(t,e,i);return-1==n?null:t[n]},forEach:function(t,e,i){for(var n=[],a=0;a<t.length;a++)n.push(t[a]);for(;n.length;){var r=n.shift();if(0==i(r))return;if(e&&r.children)for(a=r.children.length-1;a>=0;a--)n.unshift(r.children[a])}}},d=r.extend({grid:null,initialize:function(e,i){this.element=e;var n;i||(i={});var a=this;i.view||(i.view=new h(this)),n=t.data(e,"treegrid",{options:t.extend({},d.defaults,d.parseOptions(e),{finder:{getTr:function(e,i,n,a){n=n||"body",a=a||0;var r=t.data(e,"datagrid").dc;if(0==a){var s=t.data(e,"treegrid").options,o=s.finder.getTr(e,i,n,1),l=s.finder.getTr(e,i,n,2);return o.add(l)}if("body"==n){var d=t("#"+t.data(e,"datagrid").rowIdPrefix+"-"+a+"-"+i);return d.length||(d=(1==a?r.body1:r.body2).find('tr[node-id="'+i+'"]')),d}return"footer"==n?(1==a?r.footer1:r.footer2).find('tr[node-id="'+i+'"]'):"selected"==n?(1==a?r.body1:r.body2).find("tr.datagrid-row-selected"):"highlight"==n?(1==a?r.body1:r.body2).find("tr.datagrid-row-over"):"checked"==n?(1==a?r.body1:r.body2).find("tr.datagrid-row-checked"):"last"==n?(1==a?r.body1:r.body2).find("tr:last[node-id]"):"allbody"==n?(1==a?r.body1:r.body2).find("tr[node-id]"):"allfooter"==n?(1==a?r.footer1:r.footer2).find("tr[node-id]"):void 0},getRow:function(t){var e="object"==typeof t?t.attr("node-id"):t;return a.find(e)},getRows:function(t){return a.getChildren()}}},i),checkedRows:[],data:[]});a=this;var s=n.options,o=t.extend({},s,{url:null,data:null,element:e,autoLoad:!1,loader:function(){return!1},onResizeColumn:function(t,e){a.fixRowHeight(),a.trigger("onResizeColumn",t,e)},onSortColumn:function(t,e){if(s.sortName=t,s.sortOrder=e,s.remoteSort)_1f(_2);else{var i=a.loadData("getData");a.loadData(i)}}});if(this.grid=new r(e,o),t.data(e,"datagridObj",this.grid),r.superclass.initialize.call(this,s),!s.columns){var l=t.data(e,"datagrid").options;s.columns=l.columns,s.frozenColumns=l.frozenColumns}n.dc=t.data(e,"datagrid").dc,s.data&&this.loadData(s.data),this.nodeLoad(),this.bindNodeEvent(),this.addEvents("onLoadSuccess","onLoadError","onBeforeLoad","onClickRow","onDblClickRow","onClickCell","onDblClickCell","onSortColumn","onResizeColumn","onSelect","onUnselect","onSelectAll","onUnselectAll","onCheck","onUncheck","onCheckAll","onUncheckAll","onBeforeEdit","onAfterEdit","onCancelEdit","onHeaderContextMenu","onAfterRender","onRowContextMenu")},toTreeNodeData:function(e){var i={children:[],state:this.get("asyTree")?"closed":"open"};return i=t.extend(i,e)},listToTreeData:function(t){for(var e,i={},n={},a=0;a<t.length;a++)e=t[a][this.get("parentField")]||this.get("rootId"),t[a][this.get("parentField")]=e,i[e.toString()]||(i[e.toString()]={}),i[e.toString()][t[a][this.get("idField")]]={data:t[a],children:{}},n[t[a][this.get("idField")]]={data:t[a],children:[]};var r=[];for(var s in i)n[s]||(s,r.push(s));var o,l=this,d=function(t,e){var i,n=[];for(var a in t)i=l.toTreeNodeData(t[a].data),e[a]?(t[a].children=e[a],i.children=d(t[a].children,e)):t[a].children=null,0==i.children.length?delete i.children:i.leaf=!1,n.push(i);return n},h=[];for(a=0;a<r.length;a++){var c=i[r[a]];o=d(c,i),h=h.concat(o)}return h},bindNodeEvent:function(){var e=this.element,i=t.data(e,"datagrid").dc,n=i.body1.add(i.body2),a=this,r=(t.data(n[0],"events")||t._data(n[0],"events")).click[0].handler;i.body1.add(i.body2).bind("mouseover",function(e){var i=t(e.target);i.closest("tr.datagrid-row").length&&i.hasClass("tree-hit")&&(i.hasClass("tree-expanded")?i.addClass("tree-expanded-hover"):i.addClass("tree-collapsed-hover"))}).bind("mouseout",function(e){var i=t(e.target);i.closest("tr.datagrid-row").length&&i.hasClass("tree-hit")&&(i.hasClass("tree-expanded")?i.removeClass("tree-expanded-hover"):i.removeClass("tree-collapsed-hover"))}).unbind("click").bind("click",function(e){var i=t(e.target),n=i.closest("tr.datagrid-row");n.length&&(i.hasClass("tree-hit")?a.toggle(n.attr("node-id")):r(e))})},nodeLoad:function(e,i,n,a){var r=this.element,s=t.data(r,"treegrid").options,o=this.getPanel().find("div.datagrid-body"),l=this;i&&(s.queryParams=i);var d=t.extend({},s.queryParams);s.pagination&&t.extend(d,{page:s.pageNumber,rows:s.pageSize}),s.sortName&&t.extend(d,{sort:s.sortName,order:s.sortOrder});var h=this.find(e);if(0!=this.trigger("onBeforeLoad",h,d)){var c=o.find('tr[node-id="'+e+'"] span.tree-folder');c.addClass("tree-loading"),this.loading();0==s.loader.call(this,d,function(t){c.removeClass("tree-loading"),l.loaded(),l.loadNodeData(e,t,n),a&&a()},function(){c.removeClass("tree-loading"),l.loaded(),l.trigger("onLoadError",arguments),a&&a()})&&(c.removeClass("tree-loading"),l.loaded())}},options:function(){return t.data(this.element,"treegrid").options},resize:function(t){d.superclass.resize.call(this,t)},fixRowHeight:function(e){var i=this.element,n=t.data(i,"datagrid").options;if(!t.data(i,"datagrid").dc.body1.is(":empty")&&(!n.nowrap||n.autoRowHeight)&&e!=undefined)for(var a=this.getChildren(e),r=0;r<a.length;r++)!function(t){var e=n.finder.getTr(i,t,"body",1),a=n.finder.getTr(i,t,"body",2);e.css("height",""),a.css("height","");var r=Math.max(e.height(),a.height());e.css("height",r),a.css("height",r)}(a[r][n.idField]);d.superclass.fixRowHeight.call(this,e)},loadNodeData:function(e,i,n){var a=this.element,r=t.data(a,"treegrid"),s=r.options,o=r.dc;i=s.loadFilter.call(a,i,e);var l=this.find(e);if(l){var d=s.finder.getTr(a,e,"body",1),h=s.finder.getTr(a,e,"body",2),c=d.next("tr.treegrid-tr-tree").children("td").children("div"),u=h.next("tr.treegrid-tr-tree").children("td").children("div");n||(l.children=[])}else{c=o.body1,u=o.body2;n||(r.data=[])}if(n||(c.empty(),u.empty()),s.view.onBeforeRender&&s.view.onBeforeRender.call(s.view,e,i),s.view.render.call(s.view,c,!0),s.view.render.call(s.view,u,!1),s.showFooter&&(s.view.renderFooter.call(s.view,o.footer1,!0),s.view.renderFooter.call(s.view,o.footer2,!1)),s.view.onAfterRender&&s.view.onAfterRender.call(s.view,a),!e&&s.pagination){var p=t.data(a,"treegrid").total,f=this.grid.getPager();f.pagination("options").total!=p&&f.pagination({total:p})}this.fixRowHeight(),this.setRownumber(),this.showLines(),this.setSelectionState(),this.autoSizeColumn(),this.trigger("onLoadSuccess",l,i)},setRownumber:function(){var e=t.data(this.element,"datagrid").dc;t.data(this.element,"treegrid").options.rownumbers&&e.body1.find("div.datagrid-cell-rownumber").each(function(e){t(this).html(e+1)})},loadData:function(t){this.loadNodeData(t.parent,t)},load:function(t){this.options().pageNumber=1,this.getPager().pagination({pageNumber:1}),this.reload(t)},reload:function(e){var i=this.options(),n={};if("object"==typeof e?n=e:(n=t.extend({},i.queryParams)).id=e,n.id){var a=t(this).treegrid("find",n.id);a.children&&a.children.splice(0,a.children.length),i.queryParams=n;var r=i.finder.getTr(this,n.id);r.next("tr.treegrid-tr-tree").remove(),r.find("span.tree-hit").removeClass("tree-expanded tree-expanded-hover").addClass("tree-collapsed"),this.expand(n.id)}else this.nodeLoad(null,n)},reloadFooter:function(e){return jq.each(function(){var i=t.data(this,"treegrid").options,n=t.data(this,"datagrid").dc;e&&(t.data(this,"treegrid").footer=e),i.showFooter&&(i.view.renderFooter.call(i.view,this,n.footer1,!0),i.view.renderFooter.call(i.view,this,n.footer2,!1),i.view.onAfterRender&&i.view.onAfterRender.call(i.view,this),t(this).treegrid("fixRowHeight"))})},getData:function(){return t.data(this.element,"treegrid").data},getFooterRows:function(){return t.data(this.element,"treegrid").footer},getRoot:function(){var t=this.getRoots();return t.length?t[0]:null},getRoots:function(){return t.data(this.element,"treegrid").data},getParent:function(t){var e=this.find(t);return e._parentId?this.find(e._parentId):null},getChildren:function(e){function i(t){var e=n.find(t);if(e&&e.children)for(var a=0,o=e.children.length;a<o;a++){var l=e.children[a];s.push(l),i(l[r.idField])}}var n=this,a=this.element,r=t.data(a,"treegrid").options,s=(this.getPanel().find("div.datagrid-view2 div.datagrid-body"),[]);if(e)i(e);else for(var o=this.getRoots(),l=0;l<o.length;l++)s.push(o[l]),i(o[l][r.idField]);return s},getLevel:function(e){if(!e)return 0;var i=this.element,n=t.data(i,"treegrid").options;return this.getPanel().children("div.datagrid-view").find('div.datagrid-body tr[node-id="'+e+'"]').children('td[field="'+n.treeField+'"]').find("span.tree-indent,span.tree-hit").length},find:function(e){if(!e)return null;for(var i=this.element,n=t.data(i,"treegrid").options,a=[t.data(i,"treegrid").data];a.length;)for(var r=a.shift(),s=0;s<r.length;s++){var o=r[s];if(o[n.idField]==e)return o;o.children&&a.push(o.children)}return null},isLeaf:function(e){return 0==t.data(this.element,"treegrid").options.finder.getTr(this.element,e).find("span.tree-hit").length},select:function(t){return this.grid.selectRow(t)},unselect:function(t){return this.grid.unselectRow(t)},collapse:function(e){var i=this.element,n=t.data(i,"treegrid").options,a=this.find(e),r=this,s=n.finder.getTr(i,e),o=s.find("span.tree-hit");if(0!=o.length&&!o.hasClass("tree-collapsed")&&0!=this.trigger("onBeforeCollapse",a)){o.removeClass("tree-expanded tree-expanded-hover").addClass("tree-collapsed"),o.next().removeClass("tree-folder-open"),a.state="closed";var l=(s=s.next("tr.treegrid-tr-tree")).children("td").children("div");n.animate?l.slideUp("normal",function(){r.autoSizeColumn(),r.fixRowHeight(e),r.trigger("onCollapse",a)}):(l.hide(),r.autoSizeColumn(),r.fixRowHeight(e),r.trigger("onCollapse",a))}},renderNodeChildren:function(e){function i(e,i){t('<tr class="treegrid-tr-tree"><td style="border:0px" colspan="'+i+'"><div></div></td></tr>').insertAfter(e)}var n=this.element,a=t.data(n,"treegrid").options,r=a.finder.getTr(n,e,"body",1),s=a.finder.getTr(n,e,"body",2),o=this.getColumnFields(!0).length+(a.rownumbers?1:0),l=this.getColumnFields(!1).length;i(r,o),i(s,l)},expand:function(e){function i(t){o.state="open",a.animate?t.slideDown("normal",function(){l.autoSizeColumn(),l.fixRowHeight(e),l.trigger("onExpand",o)}):(t.show(),l.autoSizeColumn(),l.fixRowHeight(e),l.trigger("onExpand",o))}var n=this.element,a=t.data(n,"treegrid").options,r=a.finder.getTr(n,e),s=r.find("span.tree-hit"),o=this.find(e),l=this;if(0!=s.length&&!s.hasClass("tree-expanded")&&0!=this.trigger("onBeforeExpand",o)){s.removeClass("tree-collapsed tree-collapsed-hover").addClass("tree-expanded"),s.next().addClass("tree-folder-open");if((h=r.next("tr.treegrid-tr-tree")).length){i(d=h.children("td").children("div"))}else{this.renderNodeChildren(o[a.idField]);var d,h=r.next("tr.treegrid-tr-tree");(d=h.children("td").children("div")).hide();var c=t.extend({},a.queryParams||{}),u=l.get("queryParamFields");if(c.id=o[a.idField],u)for(var p=u.split(","),f=0;f<p.length;f++)c[p[f]]=o[p[f]];this.nodeLoad(o[a.idField],c,!0,function(){d.is(":empty")?h.remove():i(d)})}}},toggle:function(e){t.data(this.element,"treegrid").options.finder.getTr(this.element,e).find("span.tree-hit").hasClass("tree-expanded")?this.collapse(e):this.expand(e)},collapseAll:function(t){return jq.each(function(){_7c(this,t)})},expandAll:function(t){return jq.each(function(){_81(this,t)})},expandTo:function(t){return jq.each(function(){_86(this,t)})},append:function(t){return jq.each(function(){_8a(this,t)})},getCheckedNodes:function(e){e=e||"checked";var i=[];return l.forEach(t(this.element).data("treegrid").checkedRows,!1,function(t){t.checkState==_e0&&i.push(t)}),i},checkNode:function(t){this.changeCheckNode(t,!0)},uncheckNode:function(t){this.changeCheckNode(t,!1)},changeCheckNode:function(e,i,n,a){var r=t.data(this.element,"treegrid"),s=(r.checkedRows,r.options);if(s.checkbox){var o=this.find(e);if(o.checkState){var l=s.finder.getTr(this.element,e).find(".tree-checkbox");if(i==undefined&&(l.hasClass("tree-checkbox1")?i=!1:l.hasClass("tree-checkbox0")?i=!0:(o._checked==undefined&&(o._checked=l.hasClass("tree-checkbox1")),i=!o._checked)),o._checked=i,i){if(l.hasClass("tree-checkbox1"))return}else if(l.hasClass("tree-checkbox0"))return;(n||0!=s.onBeforeCheckNode.call(o,i))&&(s.cascadeCheck?(this.setChildrenNodeChecBox(o,i),this.setParentNodeCheckbox(o)):this.setNodeCheckBox(o,i?"1":"0"),a||s.onCheckNode.call(o,i))}}},setChildrenNodeChecBox:function(t,e){e=e?1:0,this.setNodeCheckBox(t,e);var i=this;l.forEach(t.children||[],!0,function(t){i.setNodeCheckBox(t,e)})},setParentNodeCheckbox:function(e){var i=t.data(this.element,"treegrid").options,n=this.getParent(e[i.idField]);n&&(this.setNodeCheckBox(n,this.getNodeCheckValue(n)),this.setParentNodeCheckbox(n))},getNodeCheckValue:function(t){var e=0,i=0,n=0;if(l.forEach(t.children||[],!1,function(t){t.checkState&&(e++,"checked"==t.checkState?n++:"unchecked"==t.checkState&&i++)}),0==e)return undefined;return i==e?0:n==e?1:2},setNodeCheckBox:function(e,i){var n=t.data(this.element,"treegrid"),a=n.checkedRows,r=n.options;if(e.checkState&&i!=undefined){var s=r.finder.getTr(this.element,e[r.idField]).find(".tree-checkbox");s.length&&(e.checkState=["unchecked","checked","indeterminate"][i],e.checked="checked"==e.checkState,s.removeClass("tree-checkbox0 tree-checkbox1 tree-checkbox2"),s.addClass("tree-checkbox"+i),0==i?l.removeArrayItem(a,r.idField,e[r.idField]):l.addArrayItem(a,r.idField,e))}},insert:function(t){return jq.each(function(){_90(this,t)})},remove:function(t){return jq.each(function(){_9c(this,t)})},pop:function(t){var e=jq.treegrid("find",t);return jq.treegrid("remove",t),e},refresh:function(e){return jq.each(function(){var i=t.data(this,"treegrid").options;i.view.refreshRow.call(i.view,this,e)})},update:function(e){var i=t.data(this.element,"treegrid").options;i.view.updateRow.call(i.view,this,e.id,e.row);var n=e.row;n.checked!=undefined&&(n=this.find(e.id),t.extend(n,{checkState:n.checked?"checked":!1===n.checked?"unchecked":undefined}),this.updateCheckbox(_dd.id))},updateCheckbox:function(e){var i=t.data(this.element,"treegrid").options;if(i.checkbox){var n=this.find(e),a=i.finder.getTr(e),r=a.find(".tree-checkbox");if(i.view.hasCheckbox(n))if(r.length||(n.checkState=n.checkState||"unchecked",t('<span class="tree-checkbox"></span>').insertBefore(a.find(".tree-title"))),"checked"==n.checkState)this.changeCheckNode(e,!0,!0);else if("unchecked"==n.checkState)this.changeCheckNode(e,!1,!0);else{var s=this.getNodeCheckValue(n);0===s?this.changeCheckNode(e,!1,!0):1===s&&this.changeCheckNode(e,!0,!0)}else r.remove(),n.checkState=undefined,n.checked=undefined,this.setParentNodeCheckbox(n)}},beginEdit:function(e){return jq.each(function(){t(this).datagrid("beginEdit",e),t(this).treegrid("fixRowHeight",e)})},endEdit:function(e){return jq.each(function(){t(this).datagrid("endEdit",e)})},cancelEdit:function(e){return jq.each(function(){t(this).datagrid("cancelEdit",e)})},showLines:function(){function e(i){t.map(i,function(t){if(t.children&&t.children.length)e(t.children);else{n(t).find(".tree-icon").prev().addClass("tree-join")}});var a=n(i[i.length-1]);a.addClass("tree-node-last"),a.find(".tree-join").removeClass("tree-join").addClass("tree-joinbottom")}function i(e){t.map(e,function(t){t.children&&t.children.length&&i(t.children)});for(var n=0;n<e.length-1;n++){var o=e[n],l=a.getLevel(o[s.idField]);s.finder.getTr(r,o[s.idField]).next().find('tr.datagrid-row td[field="'+s.treeField+'"] div.datagrid-cell').find("span:eq("+(l-1)+")").addClass("tree-line")}}function n(t){return s.finder.getTr(r,t[s.idField]).find('td[field="'+s.treeField+'"] div.datagrid-cell')}t(this.element);var a=this,r=this.element,s=this.options();if(s.lines){this.getPanel().addClass("tree-lines"),this.getPanel().find("span.tree-indent").removeClass("tree-line tree-join tree-joinbottom"),this.getPanel().find("div.datagrid-cell").removeClass("tree-node-last tree-root-first tree-root-one");var o=this.getRoots();o.length>1?n(o[0]).addClass("tree-root-first"):1==o.length&&n(o[0]).addClass("tree-root-one"),e(o),i(o)}else this.getPanel().removeClass("tree-lines")}});d.parseOptions=function(e){return t.extend({},r.parseOptions(e),t.fn.parseOptions(e,["treeField",{animate:"boolean"}]))};var h=r.GridView.extend({initialize:function(t){this.treeGrid=t},render:function(e,i){function n(t,e,i){for(var d=r.treeGrid.getParent(i[0][s.idField]),h=(d?d.children.length:r.treeGrid.getRoots())-i.length,c=['<table class="datagrid-btable" cellspacing="0" cellpadding="0" border="0"><tbody>'],u=0;u<i.length;u++){var p=i[u];s.leafField?1==p[s.leafField]||"1"==p[s.leafField]?p.state="open":p.state="closed":s.state?p.state=s.state:"open"!=p.state&&"closed"!=p.state&&(p.state="closed");var f=s.rowStyler?s.rowStyler.call(a,p):"",g="",m="";"string"==typeof f?m=f:f&&(g=f["class"]||"",m=f.style||"");var v='class="datagrid-row '+(h++%2&&s.striped?"datagrid-row-alt ":" ")+g+'"',b=m?'style="'+m+'"':"",y=l+"-"+(t?1:2)+"-"+p[s.idField];if(c.push('<tr id="'+y+'" node-id="'+p[s.idField]+'" '+v+" "+b+">"),(c=c.concat(r.renderRow.call(r,o,t,e,p))).push("</tr>"),p.children&&p.children.length){var w=n(t,e+1,p.children),_="closed"==p.state?"none":"block";c.push('<tr class="treegrid-tr-tree"><td style="border:0px" colspan='+(o.length+(s.rownumbers?1:0))+'><div style="display:'+_+'">'),(c=c.concat(w)).push("</div></td></tr>")}}return c.push("</tbody></table>"),c}var a=this.treeGrid.element,r=this,s=t.data(a,"treegrid").options,o=this.treeGrid.getColumnFields(i),l=t.data(a,"datagrid").rowIdPrefix;if((!i||s.rownumbers||s.frozenColumns&&s.frozenColumns.length)&&this.treeNodes&&this.treeNodes.length){var d=n(i,this.treeLevel,this.treeNodes);t(e).append(d.join(""))}},renderFooter:function(e,i){for(var n=this.treeGrid.element,a=t.data(n,"treegrid").options,r=t.data(n,"treegrid").footer||[],s=this.treeGrid.getColumnFields(i),o=['<table class="datagrid-ftable" cellspacing="0" cellpadding="0" border="0"><tbody>'],l=0;l<r.length;l++){var d=r[l];d[a.idField]=d[a.idField]||"foot-row-id"+l,o.push('<tr class="datagrid-row" node-id="'+d[a.idField]+'">'),o.push(this.renderRow.call(this,s,i,0,d)),o.push("</tr>")}o.push("</tbody></table>"),t(e).html(o.join(""))},renderRow:function(e,i,n,a){var r=this.treeGrid.element,s=t.data(r,"treegrid"),o=s.options,d=[];i&&o.rownumbers&&d.push('<td class="datagrid-td-rownumber"><div class="datagrid-cell-rownumber">0</div></td>');for(var h=0;h<e.length;h++){var c=e[h],u=t(r).treegrid("getColumnOption",c);if(u){var p=u.styler?u.styler(a[c],a)||"":"",f=this.getStyleValue(p),g=f.c?'class="'+f.c+'"':"",m=u.hidden?'style="display:none;'+f.s+'"':f.s?'style="'+f.s+'"':"";d.push('<td field="'+c+'" '+g+" "+m+">");m="";if(u.checkbox||c==o.treeField||(u.align&&(m+="text-align:"+u.align+";"),o.nowrap?o.autoRowHeight&&(m+="height:auto;"):m+="white-space:normal;height:auto;"),d.push('<div style="'+m+'" '),u.checkbox?d.push('class="datagrid-cell-check '):d.push('class="datagrid-cell '+u.cellClass),d.push('">'),u.buttons)for(var v=0;v<u.buttons.length;v++){var b=u.buttons[v],y="";t.isFunction(b.disabled)?b.disabled(rowData,rowIndex)&&(y=" disabled"):!0===b.disabled&&(y=" disabled"),d.push('<a id="'+b.id+'" class="rowBtn'+y+'" tab-index="-1" href="javascript:void(0)"><i class="'+b.iconCls+'" title="'+b.text+'"></i></a>')}if(u.checkbox)a.checked?d.push('<input type="checkbox" checked="checked"'):d.push('<input type="checkbox"'),d.push(' name="'+c+'" value="'+(a[c]!=undefined?a[c]:"")+'">');else{var w=null;if(w=u.formatter?u.formatter(a[c],a):a[c],c==o.treeField){for(v=0;v<n;v++)d.push('<span class="tree-indent"></span>');if("closed"==a.state?(d.push('<span class="tree-hit tree-collapsed"></span>'),d.push('<span class="tree-icon tree-folder '+(a.iconCls?a.iconCls:"")+'"></span>')):a.children&&a.children.length?(d.push('<span class="tree-hit tree-expanded"></span>'),d.push('<span class="tree-icon tree-folder tree-folder-open '+(a.iconCls?a.iconCls:"")+'"></span>')):(d.push('<span class="tree-indent"></span>'),d.push('<span class="tree-icon tree-file '+(a.iconCls?a.iconCls:"")+'"></span>')),this.hasCheckbox(a)){var _=0,$=l.getArrayItem(s.checkedRows,o.idField,a[o.idField]);if($)_="checked"==$.checkState?1:2,a.checkState=$.checkState,a.checked=$.checked,l.addArrayItem(s.checkedRows,o.idField,a);else{var x=l.getArrayItem(s.checkedRows,o.idField,a._parentId);x&&"checked"==x.checkState&&o.cascadeCheck?(_=1,a.checked=!0,l.addArrayItem(s.checkedRows,o.idField,a)):a.checked&&l.addArrayItem(s.tmpIds,a[o.idField]),a.checkState=_?"checked":"unchecked"}d.push('<span class="tree-checkbox tree-checkbox'+_+'"></span>')}else a.checkState=undefined,a.checked=undefined;d.push('<span class="tree-title">'+w+"</span>")}else d.push(w)}d.push("</div>"),d.push("</td>")}}return d.join("")},hasCheckbox:function(e){var i=this.treeGrid.element,n=t.data(i,"treegrid").options;if(n.checkbox){if(t.isFunction(n.checkbox))return!!n.checkbox.call(_105,e);if(!n.onlyLeafCheck)return!0;if(!("open"!=e.state||e.children&&e.children.length))return!0}return!1},refreshRow:function(t,e){this.updateRow.call(this,t,e,{})},updateRow:function(e,i,n){function a(n){var a=t(e).treegrid("getColumnFields",n),c=r.finder.getTr(e,i,"body",n?1:2),u=c.find("div.datagrid-cell-rownumber").html(),p=c.find("div.datagrid-cell-check input[type=checkbox]").is(":checked");c.html(this.renderRow(e,a,n,o,s)),c.attr("style",l||""),c.find("div.datagrid-cell-rownumber").html(u),p&&c.find("div.datagrid-cell-check input[type=checkbox]")._propAttr("checked",!0),h!=i&&(c.attr("id",d+"-"+(n?1:2)+"-"+h),c.attr("node-id",h))}var r=t.data(e,"treegrid").options,s=t(e).treegrid("find",i);t.extend(s,n);var o=t(e).treegrid("getLevel",i)-1,l=r.rowStyler?r.rowStyler.call(e,s):"",d=t.data(e,"datagrid").rowIdPrefix,h=s[r.idField];a.call(this,!0),a.call(this,!1),t(e).treegrid("fixRowHeight",i)},deleteRow:function(e,i){var n=t.data(e,"treegrid").options,a=n.finder.getTr(e,i);a.next("tr.treegrid-tr-tree").remove(),a.remove();var r=function(i){var a,r=t(e).treegrid("getParent",i);a=r?r.children:t(e).treegrid("getData");for(var s=0;s<a.length;s++)if(a[s][n.idField]==i){a.splice(s,1);break}return r}(i);if(r&&0==r.children.length){(a=n.finder.getTr(e,r[n.idField])).next("tr.treegrid-tr-tree").remove();var s=a.children('td[field="'+n.treeField+'"]').children("div.datagrid-cell");s.find(".tree-icon").removeClass("tree-folder").addClass("tree-file"),s.find(".tree-hit").remove(),t('<span class="tree-indent"></span>').prependTo(s)}},onBeforeRender:function(e,i){function n(t,e){for(var i=0;i<t.length;i++){var a=t[i];a._parentId=e,a.children&&a.children.length&&n(a.children,a[s.idField])}}var a=this.treeGrid.element;if(t.isArray(e)&&(i={total:e.length,rows:e},e=null),!i)return!1;var r=t.data(a,"treegrid"),s=r.options;i.length==undefined?(i.footer&&(r.footer=i.footer),i.total&&(r.total=i.total),i=this.transfer(e,i.rows)):n(i,e);var o=this.treeGrid.find(e);o?o.children?o.children=o.children.concat(i):o.children=i:r.data=r.data.concat(i),this.sort(i),this.treeNodes=i,this.treeLevel=this.treeGrid.getLevel(e)},onAfterRender:function(){if(t.data(this.treeGrid.element,"datagrid").options.showFooter){this.grid.getPanel().find("div.datagrid-footer").find("div.datagrid-cell-rownumber,div.datagrid-cell-check").css("visibility","hidden")}},sort:function(e){function i(e){e.sort(function(e,i){for(var a=0,o=0;o<r.length;o++){var l=r[o],d=s[o];if(0!=(a=(t(n).treegrid("getColumnOption",l).sorter||function(t,e){return t==e?0:t>e?1:-1})(e[l],i[l])*("asc"==d?1:-1)))return a}return a});for(var a=0;a<e.length;a++){var o=e[a].children;o&&o.length&&i(o)}}var n=this.treeGrid.element,a=t.data(n,"treegrid").options;if(!a.remoteSort&&a.sortName){var r=a.sortName.split(","),s=a.sortOrder.split(",");i(e)}},transfer:function(e,i){for(var n=this.treeGrid.element,a=t.data(n,"treegrid").options,r=[],s=0;s<i.length;s++)r.push(i[s]);var o=[];for(s=0;s<r.length;s++){var l=r[s];e?l._parentId==e&&(o.push(l),r.splice(s,1),s--):l._parentId||(o.push(l),r.splice(s,1),s--)}var d=[];for(s=0;s<o.length;s++)d.push(o[s]);for(;d.length;){var h=d.shift();for(s=0;s<r.length;s++){(l=r[s])._parentId==h[a.idField]&&(h.children?h.children.push(l):h.children=[l],d.push(l),r.splice(s,1),s--)}}return o}});return d.defaults=t.extend({},r.defaults,{treeField:null,lines:!1,animate:!1,singleSelect:!0,rootId:"-1",asyTree:!1,leafField:"",checkboxField:"",checkbox:!1,cascadeCheck:!0,onlyLeafCheck:!1,onBeforeCheckNode:function(t,e){},onCheckNode:function(t,e){},rowEvents:t.extend({},r.defaults.rowEvents,{mouseover:o(!0),mouseout:o(!1),click:function(e){var i=t(e.target),n=i.closest("tr.datagrid-row");if(n.length&&n.parent().length){var a=n.attr("node-id"),s=function(e){return t(e).closest("div.datagrid-view").children(".datagrid-f")[0]}(n),o=t.data(s,"treeGridObj");if(i.hasClass("tree-hit"))o.toggle(a);else if(i.hasClass("tree-checkbox"))o.changeCheckNode(a);else{var d=t(s).treegrid("options");if(i.parent().hasClass("datagrid-cell-check")||d.singleSelect||!e.shiftKey)r.defaults.rowEvents.click(e);else{var h=t(s).treegrid("getChildren"),c=l.indexOfArray(h,d.idField,d.lastSelectedIndex),u=l.indexOfArray(h,d.idField,a),p=Math.min(Math.max(c,0),u),f=Math.max(c,u),g=h[u],m=i.closest("td[field]",n);if(m.length){var v=m.attr("field");d.onClickCell.call(s,a,v,g[v])}t(s).treegrid("clearSelections");for(var b=p;b<=f;b++)t(s).treegrid("selectRow",h[b][d.idField]);o.trigger("onClickRow",g)}}}}}),loader:function(t,e,i){var n=this.options(),a=this;if(!n.url)return!1;if(!i){var r=i;i=function(){r.apply(this,arguments)}}s.ajaxCall({type:n.method,url:n.url,data:t,dataType:"json",success:function(t){t=t.data||t;t=a.listToTreeData(t),e(t)},error:i})},loadFilter:function(t,e){return t}}),t.fn.treegrid=function(e,i){var n;e=e||{};var a=this.each(function(){var a=t(this),r=t.data(this,"treegrid"),s=a.data("treeGridObj");if(r){if("object"==typeof e)t.extend(r.options,e)}else e.element=this,s=new d(this,e),a.data("treeGridObj",s);"string"==typeof e&&(n=s[e](i))});return n===undefined?a:n},d}),window.localeFile=window.localeFile?window.localeFile:"app/widgets/app-lang_zh_CN",window.bossJS={init:function(t){if(t.jquery==undefined)if(window.jQuery&&jQuery.fn.jquery)t.jquery=window.jQuery;else{if(!window.$||!$.fn.jquery)throw new Error("jquery undefied");t.jquery=window.$}require.reg({id:"jquery","export":t.jquery}),window._contextPath=t.path,require.config({baseUrl:_contextPath,shim:{"base/json2":{exports:"JSON"},"base/dotpl-js":{exports:"dotpl"}}});return require.sync(["app/core/app-jquery","app/core/app-core","base/dotpl-js","app/app-funcbase","app/widgets/window/app-messager","app/util/app-utils","app/widgets/window/app-dialog"],function(t,e,i,n,a,r,s){window.jQuery=t,window.$=t,window.$template=function(t,e){return i.applyTpl(t,e)},window.$messager=a,window.$utils=r,window.$app=window.$A=window.$a=e,require.sync(["bs-http-plugin/bs-ca-auth","bs-http-plugin/bs-doccamera","bs-http-plugin/bs-pd","bs-http-plugin/bs-pos","bs-http-plugin/bs-print","bs-http-plugin/data-transmit/socket"],function(t,e,i,n,a,r){window.bossJS={CA:t,DocCamera:e,PD:i,POS:n,Print:a,Socket:r}})}),bossJS}},define("app-plugin-require-config",function(){}),define("bs-http-plugin/bs-ca-auth",["bs-http-plugin/base-pluginvoke"],function(t,e){var i=t.extend({module:"ca",functions:["doSign","initParams"],doSign:function(t){var e={signText:"",provider:undefined};return"object"===$.type(t)?(e.signText=t.signText,"string"==$.type(t.provider)&&(e.provider=t.provider)):"string"===$.type(t)&&(e.signText=t,e.provider=$A.getCaProvider()),"string"!=$.type(e.cryptoType)&&(e.cryptoType=$A.getCaCryptoType()),"string"!=$.type(e.provider)?$.Deferred().reject("CA验证提供商为空"):this.operate({data:[e],func:"doSign"})},validateSN:function(t){var e={signText:"",provider:undefined,validateSN:!0};if("object"===$.type(t)?(e.signText=t.signText,"string"==$.type(t.provider)&&(e.provider=t.provider)):"string"===$.type(t)&&(e.signText=t,e.provider=$A.getCaProvider()),"string"!=$.type(e.provider))return $.Deferred().reject("CA验证提供商为空");var i=$A.getCaInfo();if(!i||!i.caNo){return $.Deferred().reject("Ukey信息与当前ca产商不一致，请联系管理员！")}return e.certNo=i.caNo,this.operate({data:[e],func:"doSign"})},Statics:{getInstance:function(t){return this.instance||(this.instance=new i(t)),this.instance}}});return i}),define("bs-http-plugin/bs-doccamera",["bs-http-plugin/base-pluginvoke","bs-http-plugin/util/uuid"],function(t,e){var i=t.extend({module:"Doccamera",functions:["TakePhotoes","GetImageList","GetImageListWithoutBase64","GetImages","ClearImages"],getPicture:function(t,e){var i=this,n=$.Deferred(),a=function(){i[e]().then(function(e){e[t]&&n.resolve(e[t]),e[t]||0==e.state||setTimeout(function(){a()},2500)}).fail(function(){n.rejectWith(n,arguments)})};return a(),n},takePicture:function(){var t=this,i=e.v4().replace(/-/g,"");return t.TakePhotoes({id:i}).then(function(){return t.getPicture(i,"GetImageList")})},bufferTakePicture:function(){$.Deferred();var t=this,i=e.v4().replace(/-/g,"");return t.TakePhotoes({id:i}).then(function(){return t.getPicture(i,"GetImageListWithoutBase64")}).then(function(e){return t.getImagesAndClean(i,e)})},getImgSize:2,getImagesAndClean:function(t,e){var i=this,n=$.Deferred(),a=e.pictures;$.isArray(a)||n.rejectWith(this,["picture is not array!"]),a=$(a).map(function(t,e){return e.filename}).toArray();var r={},s=[],o=function(){if(0==a.length)return n.resolve(r),void i.ClearImages();i.GetImages({pictures:a.splice(0,i.getImgSize)}).then(function(e){r=e[t],s=s.concat(r.pictures),r.pictures=s,o(),!e[t]&&e.state}).fail(function(){n.rejectWith(n,arguments)})};return o(),n},Statics:{getInstance:function(t){return this.instance||(this.instance=new i(t)),this.instance}}});return i}),define("bs-http-plugin/bs-pd",["bs-http-plugin/base-pluginvoke"],function(t,e){var i=t.extend({module:"pd",functions:["expPd","impPd"],Statics:{getInstance:function(t){return this.instance||(this.instance=new i(t)),this.instance}}});return i}),define("bs-http-plugin/bs-pos",["bs-http-plugin/base-pluginvoke"],function(t,e){var i=t.extend({module:"pos",functions:["doPos","initParams"],Statics:{getInstance:function(t){return this.instance||(this.instance=new i(t)),this.instance}}});return i}),function(t){var e=function(){var t=this;t.msgStack={},window.onmessage=function(e){var i=e.data;i=$.parseJSON(i);var n=t.get(i.id);n&&n.call({},i)}};e.prototype={constructor:e,set:function(t,e){this.msgStack[t]=e},get:function(t){var e=this.msgStack[t];return e&&delete this.msgStack[t],e}};var i=new e,n=function(){return this.ret.ret_msg},a=function(){};a.prototype={constructor:a,send:function(t){var e=t.data;if(t.id=t.data.id=(new Date).getTime(),"undefined"==typeof e.payload)throw new Error("data.payload not found!");var a=e.payload;a=JSON.stringify(a),a=this.base64Encode(a),t.data.payload=a;var r=this.createIframe(t),s=this.createForm(t);s.find('[name="payload"]').val(a);i.set(t.id,function(e){"undefined"===e&&(e={}),e.getResult=n;var i=[e.getResult()];try{(i=i.concat([].slice.call(arguments,0))).push(t),"0"===e.ret.ret_code?t.success.apply(t,i):t.error.apply(t,i),s.remove(),r.remove()}catch(a){throw s.remove(),r.remove(),a}}),s.submit(),$.ajax({url:"http://127.0.0.1:13526/heart",timeout:t.timeout?t.timeout:3e3,contentType:"application/x-www-form-urlencoded; charset=utf-8",dataType:"jsonp",jsonp:"jsonp",type:"GET",error:function(){s.remove(),r.remove(),t.clientError.apply(t,arguments)}})},createIframe:function(t){var e=$('<iframe                                 id="socketIframe$id"                                 name="socketIframe$id"                                 style="position:absolute; top:-9999px; left:-9999px">                            </iframe>'.replace(/\$id/g,t.id));return e.appendTo("body"),e},createForm:function(t){t.func?(t.invokeType="func",t.invokeValue=t.func):(t.invokeType="proc",t.invokeValue=t.proc);var e=$('<form id="socketForm$id" name="socketForm$id"                 target="socketIframe$id"                 action="$url"                 method="post"                 accept-charset="UTF-8"                 >                 <input type="hidden" name="$invokeType" value="$invokeValue" />                 <input type="hidden" name="id" value="$id" />                 <input type="hidden" name="payload" />                 </form>'.replace(/\$id/g,t.id).replace(/\$url/,t.url).replace(/\$invokeType/,t.invokeType).replace(/\$invokeValue/,t.invokeValue));return e.appendTo("body"),e},base64Encode:function(t){return Base64.encode(t)}};var r=new a,s=function(){};s.prototype={constructor:s,doSign:function(t){var e=$.isFunction(t.success)?t.success:$.noop,i=$.isFunction(t.success)?t.success:$.noop,n=$.isFunction(t.clientError)?t.clientError:$.noop;delete t.success,delete t.error,delete t.clientError;var a={url:"http://127.0.0.1:13526/ca",func:"doSign",success:e,error:i,clientError:n,data:{payload:{config:{appId:"cas-server"},data:[t]}}};r.send(a)}},t.casLogin=new s}(window),define("bs-http-plugin/cas-login",function(){}),define("app-plugin",["bs-http-plugin/base-pluginvoke","bs-http-plugin/bs-ca-auth","bs-http-plugin/bs-doccamera","bs-http-plugin/bs-pd","bs-http-plugin/bs-pos","bs-http-plugin/bs-print","bs-http-plugin/cas-login","bs-http-plugin/config-ext","bs-http-plugin/config","bs-http-plugin/data-transmit/message","bs-http-plugin/data-transmit/socket","bs-http-plugin/util/img-lazyload","bs-http-plugin/util/uuid","app/widgets/app-lang_zh_CN"],function(){}),function(t,e){function i(t){var e={},i=t.createElement,n=(0,t.createDocumentFragment)();t.createElement=function(t){if(!d.shivMethods)return i(t);var a;return(a=e[t]?e[t].cloneNode():l.test(t)?(e[t]=i(t)).cloneNode():i(t)).canHaveChildren&&!o.test(t)?n.appendChild(a):a},t.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+function(){var t=d.elements;return"string"==typeof t?t.split(" "):t}().join().replace(/\w+/g,function(t){return i(t),n.createElement(t),'c("'+t+'")'})+");return n}")(d,n)}function n(t){var e;return t.documentShived?t:(d.shivCSS&&!a&&(e=!!function(t,e){var i=t.createElement("p"),n=t.getElementsByTagName("head")[0]||t.documentElement;return i.innerHTML="x<style>"+e+"</style>",n.insertBefore(i.lastChild,n.firstChild)}(t,"article,aside,details,figcaption,figure,footer,header,hgroup,nav,section{display:block}audio{display:none}canvas,video{display:inline-block;*display:inline;*zoom:1}[hidden]{display:none}audio[controls]{display:inline-block;*display:inline;*zoom:1}mark{background:#FF0;color:#000}")),r||(e=!i(t)),e&&(t.documentShived=e),t)}var a,r,s=t.html5||{},o=/^<|^(?:button|form|map|select|textarea|object|iframe|option|optgroup)$/i,l=/^<|^(?:a|b|button|code|div|fieldset|form|h1|h2|h3|h4|h5|h6|i|iframe|img|input|label|li|link|ol|option|p|param|q|script|select|span|strong|style|table|tbody|td|textarea|tfoot|th|thead|tr|ul)$/i;!function(){var i=e.createElement("a");i.innerHTML="<xyz></xyz>",(a="hidden"in i)&&"function"==typeof injectElementWithStyles&&injectElementWithStyles("#modernizr{}",function(e){e.hidden=!0,a="none"==(t.getComputedStyle?getComputedStyle(e,null):e.currentStyle).display}),r=1==i.childNodes.length||function(){try{e.createElement("a")}catch(t){return!0}var i=e.createDocumentFragment();return"undefined"==typeof i.cloneNode||"undefined"==typeof i.createDocumentFragment||"undefined"==typeof i.createElement}()}();var d={elements:s.elements||"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",shivCSS:!1!==s.shivCSS,shivMethods:!1!==s.shivMethods,type:"default",shivDocument:n};t.html5=d,n(e)}(this,document),define("base/html5",function(){}),Template=function(t){for(var e,i=arguments,n=[],a=0,r=i.length;a<r;a++)"object"==typeof(e=i[a])?apply(this,e):n.push(e);t=n.join(""),this.html=t,this.compiled&&this.compile()},Template.prototype={re:/\{([\w-]+)\}/g,applyTemplate:function(t){return this.compiled?this.compiled(t):this.html.replace(this.re,function(e,i){return t[i]!==undefined?t[i]:""})},set:function(t,e){return this.html=t,this.compiled=null,e?this.compile():this},compile:function(){function fn(t,e){return e="values['"+e+"']","'"+sep+"("+e+" == undefined ? '' : "+e+")"+sep+"'"}var me=this,sep=isGecko?"+":",";return eval("this.compiled = function(values){ return "+(isGecko?"'":"['")+me.html.replace(/\\/g,"\\\\").replace(/(\r\n|\n)/g,"\\n").replace(/'/g,"\\'").replace(this.re,fn)+(isGecko?"';};":"'].join('');};")),me},overwrite:function(t,e,i){return t=getDom(t),t.innerHTML=this.applyTemplate(e),i?get(t.firstChild,!0):t.firstChild}},Template.prototype.apply=Template.prototype.applyTemplate,Template.from=function(t,e){return t=getDom(t),new Template(t.value||t.innerHTML,e||"")},define("base/template",function(){}),define("bs-http-plugin/bs-upload",["bs-http-plugin/base-pluginvoke","app/widgets/grid/app-grid"],function(t){var e=t.extend({module:"upload",functions:["uploadFile","uploadIsComplete","getCurrentProgress","getFileList","removeFile","resumeUpload","executeFile"],init:function(){var t=$.Deferred();return this.render(),this.bindEvents(),t.resolve(),t},render:function(){this.$container=$('<div class="upload-box ">                <div class="upload-box-header ">                    <span class="upload-box-title">文件上传进度</span>                    <span id="closeBtn" class="title-btn" title="关闭">×</span>                    <span id="zoomBtn" max=true class="title-btn" title="最小化">-</span>                </div>                <div class="upload-box-body">                    <table style="display: none;"/>                </div>                </div>'),this.$zoomBtn=this.$container.find("#zoomBtn"),this.$closeBtn=this.$container.find("#closeBtn"),this.$body=this.$container.find(".upload-box-body"),this.$table=this.$container.find("table"),this.$file=this.$container.find(".upload-add-btn"),this.$table.grid({url:"",rownumbers:"normal",height:165,pager:"none",columns:[[{title:"文件名称",field:"path",width:121,align:"left",showTitle:!0},{title:"进度",field:"percent",width:150,align:"left",formatter:function(t){var e={width:t,radius:t>96?"10px":"10px 0px 0px 10px"};return dotpl.applyTpl('<div class="upload-progress-bar"><div class="progress-percent" style="width:${width}%;border-radius: ${radius};"></div><span class="progress-text">${width}%</span></div>',e)}},{title:"操作",field:"state",width:80,align:"center",formatter:function(t,e){var i=$('                                    <div><i class="upload-btn bs-font bs-ui-start" title="开始"></i>                                    <i class="upload-btn bs-font bs-ui-pause" title="暂停"></i>                                    <i class="upload-btn bs-font bs-ui-delete" title="删除"></i></div>                            ');switch(i.css("padding-top","3px"),i.find(".bs-font").hide(),i.find("i").attr("data-item",encodeURIComponent(JSON.stringify(e))),i.find("i").attr("data-file",e.path),t){case 0:i.find(".bs-ui-start").show(),i.find(".bs-ui-delete").show();break;case 1:i.find(".bs-ui-delete").show();break;case 2:break;case 3:i.find(".bs-ui-delete").show()}return i.html()}}]]}),this.setAutoRefresh(!0),this.$container.hide().prependTo("body")},bindEvents:function(){var t=this;t.$container.find(".upload-box-body").on("click",function(e){if($(e.target).is(".bs-ui-start")&&t.resumeUpload({file:$(e.target).data("file")}).done(function(){t.setAutoRefresh(!0)}).fail(function(){t.setAutoRefresh(!1)}),$(e.target).is(".bs-ui-pause")&&t.pauseUpload({file:$(e.target).data("file")}).done(function(){t.setAutoRefresh(!0)}).fail(function(){t.setAutoRefresh(!1)}),$(e.target).is(".bs-ui-delete")){var i=$(e.target),n=JSON.parse(decodeURIComponent(i.data("item")));t.removeFile({file:i.data("file"),DelSrvFile:1}).done(function(){t.emitDelSuccess(arguments,n),t.setAutoRefresh(!0)}).fail(function(){t.emitDelError(arguments,n),t.setAutoRefresh(!1)})}}),this.$container.draggable({handle:".upload-box-header",distance:20,scroll:!0,containment:"body",stop:function(e){t.containerTop=t.$container.css("top"),t.containerLeft=t.$container.css("left")}}),this.$closeBtn.on("click",function(){t.setAutoRefresh(!1),t.close()}),this.$zoomBtn.on("click",function(){"true"===t.$zoomBtn.attr("max")?t.minimize():(t.setAutoRefresh(!0),t.maximize())}),this.$file.on("click",function(){t.addFile()})},setAutoRefresh:function(t){this.auto=t,t?!this.timeout&&this.refresh():(clearTimeout(this.timeout),this.timeout=undefined)},emitDelSuccess:function(t,e){var i=["deleteSuccess",e].concat([].slice.call(t,0));this.emit.apply(this,i)},emitDelError:function(t,e){var i=["deleteError",e].concat([].slice.call(t,0));this.emit.apply(this,i)},frequency:2e3,setUpSucTip:function(t){this.successTip=t},refresh:function(){var t=this;this.auto&&(t.timeout=setTimeout(function(){t.getFileList().done(function(e){t.$table.grid("loadData",e),t.emit("refresh",e);var i=[],n=[],a=!1;$(e).each(function(e,r){100==r.percent&&2==r.state&&(i.push(r),t.removeFile({file:r.path,DelSrvFile:0})),3==r.state&&n.push(r),1==r.state&&(a=!0)}),i.length&&(t.successTip&&$A.messager.correct(i.join("、")+" 上传成功！"),t.emit("uploadSuccess",i)),n.length&&t.emit("uploadError",n),a&&e.length?t.refresh():t.setAutoRefresh(!1)}).fail(function(){t.setAutoRefresh(!1)})},t.frequency))},addFile:function(t){var e=this.params;return"object"!==$.type(e)&&(e={}),"none"===this.$container.css("display")&&this.show(),this.setAutoRefresh(!0),this.uploadFile(t).done(function(){}).fail(function(){})},maximize:function(){var t=this;t.$container.animate({top:document.body.clientHeight-200,left:document.body.clientWidth-420,width:400,height:200},"normal","swing",function(){t.$container.find(".upload-box-body").slideDown(),t.$zoomBtn.attr({max:!0,title:"最大化"}).text("-")})},minimize:function(){var t=this;t.$container.animate({left:document.body.clientWidth-200,top:document.body.clientHeight-30,width:180,height:30},"normal","swing",function(){t.$container.find(".upload-box-body").slideUp(),t.$zoomBtn.attr({max:!1,title:"最小化"}).text("□")})},show:function(){this.$container.css({display:"block",left:document.body.clientWidth-180,top:document.body.clientHeight-30}),this.maximize(),this.setAutoRefresh(!0)},close:function(){this.$container.hide()},Statics:{getInstance:function(t){return this.instance||(this.instance=new e(t)),this.instance}}});return e}),define("require-plugin/css.min",[],function(){if("undefined"==typeof window)return{load:function(t,e,i){i()}};var t=document.getElementsByTagName("head")[0],e=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)|AndroidWebKit\/([^ ;]*)/)||0,i=!1,n=!0;e[1]||e[7]?i=parseInt(e[1])<6||parseInt(e[7])<=9:e[2]||e[8]?n=!1:e[4]&&(i=parseInt(e[4])<18);var a={};a.pluginBuilder="./css-builder";var r,s,o,l=function(){r=document.createElement("style"),t.appendChild(r),s=r.styleSheet||r.sheet},d=0,h=[],c=function(t){s.addImport(t),r.onload=function(){u()},31==++d&&(l(),d=0)},u=function(){o();var t=h.shift();return t?(o=t[1],void c(t[0])):void(o=null)};return a.normalize=function(t,e){return".css"==t.substr(t.length-4,4)&&(t=t.substr(0,t.length-4)),e(t)},a.load=function(e,a,d,u){(i?function(t,e){if(s&&s.addImport||l(),s&&s.addImport)o?h.push([t,e]):(c(t),o=e);else{r.textContent='@import "'+t+'";';var i=setInterval(function(){try{r.sheet.cssRules,clearInterval(i),e()}catch(t){}},10)}}:function(e,i){var a=document.createElement("link");if(a.type="text/css",a.rel="stylesheet",n)a.onload=function(){a.onload=function(){},setTimeout(i,7)};else var r=setInterval(function(){for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].href==a.href)return clearInterval(r),i()},10);a.href=e,t.appendChild(a)})(a.toUrl(e+".css"),d)},a});
